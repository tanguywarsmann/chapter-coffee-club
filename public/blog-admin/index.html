<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>READ – Administration Blog</title>

  <!-- favicon -->
  <link rel="icon"
        href="/lovable-uploads/aad9910b-4e2b-46cf-933a-002fa4205756.png"
        type="image/png" />
</head>
<body>
  <!-- Désactive l’auto-init par défaut -->
  <script>
    window.CMS_MANUAL_INIT = true;
  </script>

  <!-- Décap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

  <!-- Charge le config.yml puis lance CMS -->
  <script>
    fetch('/blog-admin/config.yml')
      .then(r => r.text())
      .then(cfg => {
        CMS.init({ config: cfg, configType: 'yaml' });
      })
      .catch(err => console.error('Erreur chargement config.yml :', err));
  </script>

  <!-- Fallback : si un jeton existe déjà, on (re)lance CMS.init -->
  <script>
    (function () {
      const user =
        localStorage.getItem('decap-cms-user') ||
        localStorage.getItem('netlify-cms-user');

      if (user) {
        try { CMS.init(); } catch (e) { /* déjà lancé ? */ }
      }
    })();
  </script>
</body>
</html>
