const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-zi00Hz3E.js","assets/vendor-react-vY6T1xyC.js","assets/vendor-ui-ByoYm48K.js","assets/vendor-supabase-Bb6fchLG.js","assets/web-CBaHgju-.js","assets/web-9276I1Kp.js","assets/sonner-BGHkHUJU.js","assets/pwa-BGgcqMez.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{r as s,j as r,C as n,P as a,R as i,T as o,a as l,b as c,Q as d,S as u,c as m,d as h,e as p,f,h as g,I as x,i as v,k as b,l as y,m as j,n as w,L as N,o as _,p as k,q as S,G as E,X as R,A as C,H as A,s as T,U as P,O as I,t as D,u as L,v as O,D as M,w as V,x as q,y as B,z,B as U,E as F,F as $,J as W,M as Z,K as H,N as G,V as K,W as Y,Y as Q,Z as X,_ as J,$ as ee,a0 as te,a1 as se,a2 as re,a3 as ne,a4 as ae,a5 as ie,a6 as oe,a7 as le,a8 as ce,a9 as de,aa as ue,ab as me,ac as he,ad as pe,ae as fe,af as ge,ag as xe,ah as ve,ai as be,aj as ye,ak as je,al as we,am as Ne,an as _e,ao as ke,ap as Se,aq as Ee,ar as Re,as as Ce,at as Ae,au as Te,av as Pe,aw as Ie,ax as De,ay as Le,az as Oe,aA as Me,aB as Ve,aC as qe,aD as Be,aE as ze,aF as Ue,aG as Fe,aH as $e,aI as We,aJ as Ze,aK as He,aL as Ge,aM as Ke,aN as Ye,aO as Qe,aP as Xe,aQ as Je,aR as et,aS as tt,aT as st,aU as rt,aV as nt,aW as at,aX as it,aY as ot,aZ as lt,a_ as ct,a$ as dt,b0 as ut,b1 as mt,b2 as ht,b3 as pt,b4 as ft,b5 as gt,b6 as xt,b7 as vt,b8 as bt,b9 as yt,ba as jt,bb as wt,bc as Nt,bd as _t,be as kt,bf as St,bg as Et,bh as Rt,bi as Ct,bj as At,bk as Tt,bl as Pt,bm as It,bn as Dt,bo as Lt,bp as Ot,bq as Mt,br as Vt,bs as qt,bt as Bt,bu as zt,bv as Ut,bw as Ft,bx as $t,by as Wt,bz as Zt,bA as Ht,bB as Gt,bC as Kt,bD as Yt,bE as Qt,bF as Xt,bG as Jt,bH as es,bI as ts,bJ as ss,bK as rs,bL as ns,bM as as,bN as is,bO as os,bP as ls,bQ as cs,bR as ds,bS as us,bT as ms,bU as hs,bV as ps,bW as fs,bX as gs,bY as xs,bZ as vs,b_ as bs,b$ as ys,c0 as js}from"./vendor-react-vY6T1xyC.js";import{c as ws}from"./vendor-supabase-Bb6fchLG.js";import"./vendor-ui-ByoYm48K.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Ns={},_s=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Ns)return;Ns[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var ks,Ss;(Ss=ks||(ks={})).Unimplemented="UNIMPLEMENTED",Ss.Unavailable="UNAVAILABLE";class Es extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const Rs=e=>{const t=e.CapacitorCustomPlatform||null,s=e.Capacitor||{},r=s.Plugins=s.Plugins||{},n=()=>null!==t?t.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e),a=e=>{var t;return null===(t=s.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},i=new Map;return s.convertFileSrc||(s.convertFileSrc=e=>e),s.getPlatform=n,s.handleError=t=>e.console.error(t),s.isNativePlatform=()=>"web"!==n(),s.isPluginAvailable=e=>{const t=i.get(e);return!!(null==t?void 0:t.platforms.has(n()))||!!a(e)},s.registerPlugin=(e,o={})=>{const l=i.get(e);if(l)return l.proxy;const c=n(),d=a(e);let u;const m=r=>{let n;const a=(...a)=>{const i=(async()=>(!u&&c in o?u=u="function"==typeof o[c]?await o[c]():o[c]:null!==t&&!u&&"web"in o&&(u=u="function"==typeof o.web?await o.web():o.web),u))().then(t=>{const i=((t,r)=>{var n,a;if(!d){if(t)return null===(a=t[r])||void 0===a?void 0:a.bind(t);throw new Es(`"${e}" plugin is not implemented on ${c}`,ks.Unimplemented)}{const a=null==d?void 0:d.methods.find(e=>r===e.name);if(a)return"promise"===a.rtype?t=>s.nativePromise(e,r.toString(),t):(t,n)=>s.nativeCallback(e,r.toString(),t,n);if(t)return null===(n=t[r])||void 0===n?void 0:n.bind(t)}})(t,r);if(i){const e=i(...a);return n=null==e?void 0:e.remove,e}throw new Es(`"${e}.${r}()" is not implemented on ${c}`,ks.Unimplemented)});return"addListener"===r&&(i.remove=async()=>n()),i};return a.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(a,"name",{value:r,writable:!1,configurable:!1}),a},h=m("addListener"),p=m("removeListener"),f=(e,t)=>{const s=h({eventName:e},t),r=async()=>{const r=await s;p({eventName:e,callbackId:r},t)},n=new Promise(e=>s.then(()=>e({remove:r})));return n.remove=async()=>{await r()},n},g=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:h;case"removeListener":return p;default:return m(t)}}});return r[e]=g,i.set(e,{name:e,proxy:g,platforms:new Set([...Object.keys(o),...d?[c]:[]])}),g},s.Exception=Es,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},Cs=(e=>e.Capacitor=Rs(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),As=Cs.registerPlugin;class Ts{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const r=this.listeners[e];if(r)r.forEach(e=>e(t));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new Cs.Exception(e,ks.Unimplemented)}unavailable(e="not available"){return new Cs.Exception(e,ks.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const r=s.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const Ps=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Is=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ds extends Ts{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=Is(s).trim(),r=Is(r).trim(),t[s]=r}),t}async setCookie(e){try{const t=Ps(e.key),s=Ps(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),a=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${r}; path=${n}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}As("CapacitorCookies",{web:()=>new Ds});const Ls=(e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((s,r,n)=>(s[r]=e[t[n]],s),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(r.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,r]of Object.entries(e.data||{}))t.set(s,r);s.body=t.toString()}else if(r.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const r=new Headers(s.headers);r.delete("content-type"),s.headers=r}else(r.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s};class Os extends Ts{async request(e){const t=Ls(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{const[r,n]=s;let a,i;return Array.isArray(n)?(i="",n.forEach(e=>{a=t?encodeURIComponent(e):e,i+=`${r}=${a}&`}),i.slice(0,-1)):(a=t?encodeURIComponent(n):n,i=`${r}=${a}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=s?`${e.url}?${s}`:e.url,n=await fetch(r,t),a=n.headers.get("content-type")||"";let i,o,{responseType:l="text"}=n.ok?e:{};switch(a.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":o=await n.blob(),i=await(async e=>new Promise((t,s)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>s(e),r.readAsDataURL(e)}))(o);break;case"json":i=await n.json();break;default:i=await n.text()}const c={};return n.headers.forEach((e,t)=>{c[t]=e}),{data:i,headers:c,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}var Ms,Vs,qs,Bs;As("CapacitorHttp",{web:()=>new Os}),(Vs=Ms||(Ms={})).Dark="DARK",Vs.Light="LIGHT",Vs.Default="DEFAULT",(Bs=qs||(qs={})).None="NONE",Bs.Slide="SLIDE",Bs.Fade="FADE";const zs=As("StatusBar");var Us,Fs,$s,Ws;(Fs=Us||(Us={})).Dark="DARK",Fs.Light="LIGHT",Fs.Default="DEFAULT",(Ws=$s||($s={})).Body="body",Ws.Ionic="ionic",Ws.Native="native",Ws.None="none";const Zs=As("Keyboard");function Hs(e){var t,s,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(s=Hs(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}function Gs(){for(var e,t,s=0,r="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=Hs(e))&&(r&&(r+=" "),r+=t);return r}const Ks=e=>{const t=Js(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),Ys(s,t)||Xs(e)},getConflictingClassGroupIds:(e,t)=>{const n=s[e]||[];return t&&r[e]?[...n,...r[e]]:n}}},Ys=(e,t)=>{if(0===e.length)return t.classGroupId;const s=e[0],r=t.nextPart.get(s),n=r?Ys(e.slice(1),r):void 0;if(n)return n;if(0===t.validators.length)return;const a=e.join("-");return t.validators.find(({validator:e})=>e(a))?.classGroupId},Qs=/^\[(.+)\]$/,Xs=e=>{if(Qs.test(e)){const t=Qs.exec(e)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},Js=e=>{const{theme:t,prefix:s}=e,r={nextPart:new Map,validators:[]};return rr(Object.entries(e.classGroups),s).forEach(([e,s])=>{er(s,r,e,t)}),r},er=(e,t,s,r)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:tr(t,e)).classGroupId=s)}if("function"==typeof e)return sr(e)?void er(e(r),t,s,r):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach(([e,n])=>{er(n,tr(t,e),s,r)})})},tr=(e,t)=>{let s=e;return t.split("-").forEach(e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)}),s},sr=e=>e.isThemeGetter,rr=(e,t)=>t?e.map(([e,s])=>[e,s.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,s])=>[t+e,s])):e)]):e,nr=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,r=new Map;const n=(n,a)=>{s.set(n,a),t++,t>e&&(t=0,r=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(n(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):n(e,t)}}},ar=e=>{const{separator:t,experimentalParseClassName:s}=e,r=1===t.length,n=t[0],a=t.length,i=e=>{const s=[];let i,o=0,l=0;for(let u=0;u<e.length;u++){let c=e[u];if(0===o){if(c===n&&(r||e.slice(u,u+a)===t)){s.push(e.slice(l,u)),l=u+a;continue}if("/"===c){i=u;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:i&&i>l?i-l:void 0}};return s?e=>s({className:e,parseClassName:i}):i},ir=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach(e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)}),t.push(...s.sort()),t},or=/\s+/;function lr(){let e,t,s=0,r="";for(;s<arguments.length;)(e=arguments[s++])&&(t=cr(e))&&(r&&(r+=" "),r+=t);return r}const cr=e=>{if("string"==typeof e)return e;let t,s="";for(let r=0;r<e.length;r++)e[r]&&(t=cr(e[r]))&&(s&&(s+=" "),s+=t);return s};function dr(e,...t){let s,r,n,a=function(o){const l=t.reduce((e,t)=>t(e),e());return s=(e=>({cache:nr(e.cacheSize),parseClassName:ar(e),...Ks(e)}))(l),r=s.cache.get,n=s.cache.set,a=i,i(o)};function i(e){const t=r(e);if(t)return t;const a=((e,t)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n}=t,a=[],i=e.trim().split(or);let o="";for(let l=i.length-1;l>=0;l-=1){const e=i[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:u}=s(e);let m=Boolean(u),h=r(m?d.substring(0,u):d);if(!h){if(!m){o=e+(o.length>0?" "+o:o);continue}if(h=r(d),!h){o=e+(o.length>0?" "+o:o);continue}m=!1}const p=ir(t).join(":"),f=c?p+"!":p,g=f+h;if(a.includes(g))continue;a.push(g);const x=n(h,m);for(let s=0;s<x.length;++s){const e=x[s];a.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return n(e,a),a}return function(){return a(lr.apply(null,arguments))}}const ur=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},mr=/^\[(?:([a-z-]+):)?(.+)\]$/i,hr=/^\d+\/\d+$/,pr=new Set(["px","full","screen"]),fr=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,gr=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,xr=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,vr=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,br=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,yr=e=>wr(e)||pr.has(e)||hr.test(e),jr=e=>Lr(e,"length",Or),wr=e=>Boolean(e)&&!Number.isNaN(Number(e)),Nr=e=>Lr(e,"number",wr),_r=e=>Boolean(e)&&Number.isInteger(Number(e)),kr=e=>e.endsWith("%")&&wr(e.slice(0,-1)),Sr=e=>mr.test(e),Er=e=>fr.test(e),Rr=new Set(["length","size","percentage"]),Cr=e=>Lr(e,Rr,Mr),Ar=e=>Lr(e,"position",Mr),Tr=new Set(["image","url"]),Pr=e=>Lr(e,Tr,qr),Ir=e=>Lr(e,"",Vr),Dr=()=>!0,Lr=(e,t,s)=>{const r=mr.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):s(r[2]))},Or=e=>gr.test(e)&&!xr.test(e),Mr=()=>!1,Vr=e=>vr.test(e),qr=e=>br.test(e),Br=dr(()=>{const e=ur("colors"),t=ur("spacing"),s=ur("blur"),r=ur("brightness"),n=ur("borderColor"),a=ur("borderRadius"),i=ur("borderSpacing"),o=ur("borderWidth"),l=ur("contrast"),c=ur("grayscale"),d=ur("hueRotate"),u=ur("invert"),m=ur("gap"),h=ur("gradientColorStops"),p=ur("gradientColorStopPositions"),f=ur("inset"),g=ur("margin"),x=ur("opacity"),v=ur("padding"),b=ur("saturate"),y=ur("scale"),j=ur("sepia"),w=ur("skew"),N=ur("space"),_=ur("translate"),k=()=>["auto",Sr,t],S=()=>[Sr,t],E=()=>["",yr,jr],R=()=>["auto",wr,Sr],C=()=>["","0",Sr],A=()=>[wr,Sr];return{cacheSize:500,separator:":",theme:{colors:[Dr],spacing:[yr,jr],blur:["none","",Er,Sr],brightness:A(),borderColor:[e],borderRadius:["none","","full",Er,Sr],borderSpacing:S(),borderWidth:E(),contrast:A(),grayscale:C(),hueRotate:A(),invert:C(),gap:S(),gradientColorStops:[e],gradientColorStopPositions:[kr,jr],inset:k(),margin:k(),opacity:A(),padding:S(),saturate:A(),scale:A(),sepia:C(),skew:A(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",Sr]}],container:["container"],columns:[{columns:[Er]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Sr]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",_r,Sr]}],basis:[{basis:k()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Sr]}],grow:[{grow:C()}],shrink:[{shrink:C()}],order:[{order:["first","last","none",_r,Sr]}],"grid-cols":[{"grid-cols":[Dr]}],"col-start-end":[{col:["auto",{span:["full",_r,Sr]},Sr]}],"col-start":[{"col-start":R()}],"col-end":[{"col-end":R()}],"grid-rows":[{"grid-rows":[Dr]}],"row-start-end":[{row:["auto",{span:[_r,Sr]},Sr]}],"row-start":[{"row-start":R()}],"row-end":[{"row-end":R()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Sr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Sr]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Sr,t]}],"min-w":[{"min-w":[Sr,t,"min","max","fit"]}],"max-w":[{"max-w":[Sr,t,"none","full","min","max","fit","prose",{screen:[Er]},Er]}],h:[{h:[Sr,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Sr,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Sr,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Sr,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Er,jr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Nr]}],"font-family":[{font:[Dr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Sr]}],"line-clamp":[{"line-clamp":["none",wr,Nr]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",yr,Sr]}],"list-image":[{"list-image":["none",Sr]}],"list-style-type":[{list:["none","disc","decimal",Sr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",yr,jr]}],"underline-offset":[{"underline-offset":["auto",yr,Sr]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Sr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Sr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ar]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Cr]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Pr]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[yr,Sr]}],"outline-w":[{outline:[yr,jr]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:E()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[yr,jr]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Er,Ir]}],"shadow-color":[{shadow:[Dr]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Er,Sr]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[b]}],sepia:[{sepia:[j]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Sr]}],duration:[{duration:A()}],ease:[{ease:["linear","in","out","in-out",Sr]}],delay:[{delay:A()}],animate:[{animate:["none","spin","ping","pulse","bounce",Sr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[y]}],"scale-x":[{"scale-x":[y]}],"scale-y":[{"scale-y":[y]}],rotate:[{rotate:[_r,Sr]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[w]}],"skew-y":[{"skew-y":[w]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Sr]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Sr]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Sr]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[yr,jr,Nr]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function zr(...e){return Br(Gs(e))}const Ur=a,Fr=i,$r=o,Wr=s.forwardRef(({className:e,sideOffset:t=4,...s},a)=>r.jsx(n,{ref:a,sideOffset:t,className:zr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));Wr.displayName=n.displayName;const Zr=As("Preferences",{web:()=>_s(()=>import("./web-zi00Hz3E.js"),__vite__mapDeps([0,1,2,3])).then(e=>new e.PreferencesWeb)});let Hr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqdW1zcmp1eXp2c2l4dmZ3b2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxNTU1NjYsImV4cCI6MjA2MDczMTU2Nn0.GXAF1p5iTeI3mLwwYi4rnXLsWHSUwglmdQJ7SoC3rH8",Gr=!1;try{const e="__storage_test__";localStorage.setItem(e,e),localStorage.removeItem(e),Gr=!0}catch{Gr=!1}const Kr=new Map,Yr={getItem:e=>{if(!Gr)return Kr.get(e)||null;try{return localStorage.getItem(e)}catch(t){return Kr.get(e)||null}},setItem:(e,t)=>{if(Gr)try{localStorage.setItem(e,t)}catch(s){Kr.set(e,t)}else Kr.set(e,t)},removeItem:e=>{if(Gr)try{localStorage.removeItem(e)}catch(t){Kr.delete(e)}else Kr.delete(e)}},Qr={getItem:async e=>{const{value:t}=await Zr.get({key:e});return t??null},setItem:async(e,t)=>{await Zr.set({key:e,value:t})},removeItem:async e=>{await Zr.remove({key:e})}},Xr="undefined"!=typeof window&&!!Cs?.isNativePlatform?.()&&"ios"===Cs.getPlatform();let Jr=null;const en=(Jr||(Jr=ws("https://xjumsrjuyzvsixvfwoiz.supabase.co",Hr,{auth:{storage:Xr?Qr:Yr,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{apikey:Hr}}})),Jr);var tn=Array(12).fill(0),sn=({visible:e})=>l.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},l.createElement("div",{className:"sonner-spinner"},tn.map((e,t)=>l.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),rn=l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},l.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),nn=l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},l.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),an=l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},l.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),on=l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},l.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),ln=1,cn=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:s,...r}=e,n="number"==typeof(null==e?void 0:e.id)||(null==(t=e.id)?void 0:t.length)>0?e.id:ln++,a=this.toasts.find(e=>e.id===n),i=void 0===e.dismissible||e.dismissible;return a?this.toasts=this.toasts.map(t=>t.id===n?(this.publish({...t,...e,id:n,title:s}),{...t,...e,id:n,dismissible:i,title:s}):t):this.addToast({title:s,...r,dismissible:i,id:n}),n},this.dismiss=e=>(e||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let s;void 0!==t.loading&&(s=this.create({...t,promise:e,type:"loading",message:t.loading,description:"function"!=typeof t.description?t.description:void 0}));let r=e instanceof Promise?e:e(),n=void 0!==s;return r.then(async e=>{if(dn(e)&&!e.ok){n=!1;let r="function"==typeof t.error?await t.error(`HTTP error! status: ${e.status}`):t.error,a="function"==typeof t.description?await t.description(`HTTP error! status: ${e.status}`):t.description;this.create({id:s,type:"error",message:r,description:a})}else if(void 0!==t.success){n=!1;let r="function"==typeof t.success?await t.success(e):t.success,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:s,type:"success",message:r,description:a})}}).catch(async e=>{if(void 0!==t.error){n=!1;let r="function"==typeof t.error?await t.error(e):t.error,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:s,type:"error",message:r,description:a})}}).finally(()=>{var e;n&&(this.dismiss(s),s=void 0),null==(e=t.finally)||e.call(t)}),s},this.custom=(e,t)=>{let s=(null==t?void 0:t.id)||ln++;return this.create({jsx:e(s),id:s,...t}),s},this.subscribers=[],this.toasts=[]}},dn=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,un=(e,t)=>{let s=(null==t?void 0:t.id)||ln++;return cn.addToast({title:e,...t,id:s}),s},mn=Object.assign(un,{success:cn.success,info:cn.info,warning:cn.warning,error:cn.error,custom:cn.custom,message:cn.message,promise:cn.promise,dismiss:cn.dismiss,loading:cn.loading},{getHistory:()=>cn.toasts});function hn(e){return void 0!==e.label}!function(e,{insertAt:t}={}){if("undefined"==typeof document)return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}(':where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\n');var pn=3,fn=14;function gn(...e){return e.filter(Boolean).join(" ")}var xn=e=>{var t,s,r,n,a,i,o,c,d,u;let{invert:m,toast:h,unstyled:p,interacting:f,setHeights:g,visibleToasts:x,heights:v,index:b,toasts:y,expanded:j,removeToast:w,defaultRichColors:N,closeButton:_,style:k,cancelButtonStyle:S,actionButtonStyle:E,className:R="",descriptionClassName:C="",duration:A,position:T,gap:P,loadingIcon:I,expandByDefault:D,classNames:L,icons:O,closeButtonAriaLabel:M="Close toast",pauseWhenPageIsHidden:V,cn:q}=e,[B,z]=l.useState(!1),[U,F]=l.useState(!1),[$,W]=l.useState(!1),[Z,H]=l.useState(!1),[G,K]=l.useState(0),[Y,Q]=l.useState(0),X=l.useRef(null),J=l.useRef(null),ee=0===b,te=b+1<=x,se=h.type,re=!1!==h.dismissible,ne=h.className||"",ae=h.descriptionClassName||"",ie=l.useMemo(()=>v.findIndex(e=>e.toastId===h.id)||0,[v,h.id]),oe=l.useMemo(()=>{var e;return null!=(e=h.closeButton)?e:_},[h.closeButton,_]),le=l.useMemo(()=>h.duration||A||4e3,[h.duration,A]),ce=l.useRef(0),de=l.useRef(0),ue=l.useRef(0),me=l.useRef(null),[he,pe]=T.split("-"),fe=l.useMemo(()=>v.reduce((e,t,s)=>s>=ie?e:e+t.height,0),[v,ie]),ge=(()=>{let[e,t]=l.useState(document.hidden);return l.useEffect(()=>{let e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)},[]),e})(),xe=h.invert||m,ve="loading"===se;de.current=l.useMemo(()=>ie*P+fe,[ie,fe]),l.useEffect(()=>{z(!0)},[]),l.useLayoutEffect(()=>{if(!B)return;let e=J.current,t=e.style.height;e.style.height="auto";let s=e.getBoundingClientRect().height;e.style.height=t,Q(s),g(e=>e.find(e=>e.toastId===h.id)?e.map(e=>e.toastId===h.id?{...e,height:s}:e):[{toastId:h.id,height:s,position:h.position},...e])},[B,h.title,h.description,g,h.id]);let be=l.useCallback(()=>{F(!0),K(de.current),g(e=>e.filter(e=>e.toastId!==h.id)),setTimeout(()=>{w(h)},200)},[h,w,g,de]);return l.useEffect(()=>{if(h.promise&&"loading"===se||h.duration===1/0||"loading"===h.type)return;let e,t=le;return j||f||V&&ge?(()=>{if(ue.current<ce.current){let e=(new Date).getTime()-ce.current;t-=e}ue.current=(new Date).getTime()})():t!==1/0&&(ce.current=(new Date).getTime(),e=setTimeout(()=>{var e;null==(e=h.onAutoClose)||e.call(h,h),be()},t)),()=>clearTimeout(e)},[j,f,D,h,le,be,h.promise,se,V,ge]),l.useEffect(()=>{let e=J.current;if(e){let t=e.getBoundingClientRect().height;return Q(t),g(e=>[{toastId:h.id,height:t,position:h.position},...e]),()=>g(e=>e.filter(e=>e.toastId!==h.id))}},[g,h.id]),l.useEffect(()=>{h.delete&&be()},[be,h.delete]),l.createElement("li",{"aria-live":h.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:J,className:q(R,ne,null==L?void 0:L.toast,null==(t=null==h?void 0:h.classNames)?void 0:t.toast,null==L?void 0:L.default,null==L?void 0:L[se],null==(s=null==h?void 0:h.classNames)?void 0:s[se]),"data-sonner-toast":"","data-rich-colors":null!=(r=h.richColors)?r:N,"data-styled":!(h.jsx||h.unstyled||p),"data-mounted":B,"data-promise":!!h.promise,"data-removed":U,"data-visible":te,"data-y-position":he,"data-x-position":pe,"data-index":b,"data-front":ee,"data-swiping":$,"data-dismissible":re,"data-type":se,"data-invert":xe,"data-swipe-out":Z,"data-expanded":!!(j||D&&B),style:{"--index":b,"--toasts-before":b,"--z-index":y.length-b,"--offset":`${U?G:de.current}px`,"--initial-height":D?"auto":`${Y}px`,...k,...h.style},onPointerDown:e=>{ve||!re||(X.current=new Date,K(de.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(W(!0),me.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,t,s,r;if(Z||!re)return;me.current=null;let n=Number((null==(e=J.current)?void 0:e.style.getPropertyValue("--swipe-amount").replace("px",""))||0),a=(new Date).getTime()-(null==(t=X.current)?void 0:t.getTime()),i=Math.abs(n)/a;if(Math.abs(n)>=20||i>.11)return K(de.current),null==(s=h.onDismiss)||s.call(h,h),be(),void H(!0);null==(r=J.current)||r.style.setProperty("--swipe-amount","0px"),W(!1)},onPointerMove:e=>{var t;if(!me.current||!re)return;let s=e.clientY-me.current.y,r=e.clientX-me.current.x,n=("top"===he?Math.min:Math.max)(0,s),a="touch"===e.pointerType?10:2;Math.abs(n)>a?null==(t=J.current)||t.style.setProperty("--swipe-amount",`${s}px`):Math.abs(r)>a&&(me.current=null)}},oe&&!h.jsx?l.createElement("button",{"aria-label":M,"data-disabled":ve,"data-close-button":!0,onClick:ve||!re?()=>{}:()=>{var e;be(),null==(e=h.onDismiss)||e.call(h,h)},className:q(null==L?void 0:L.closeButton,null==(n=null==h?void 0:h.classNames)?void 0:n.closeButton)},l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},l.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,h.jsx||l.isValidElement(h.title)?h.jsx||h.title:l.createElement(l.Fragment,null,se||h.icon||h.promise?l.createElement("div",{"data-icon":"",className:q(null==L?void 0:L.icon,null==(a=null==h?void 0:h.classNames)?void 0:a.icon)},h.promise||"loading"===h.type&&!h.icon?h.icon||(null!=O&&O.loading?l.createElement("div",{className:"sonner-loader","data-visible":"loading"===se},O.loading):I?l.createElement("div",{className:"sonner-loader","data-visible":"loading"===se},I):l.createElement(sn,{visible:"loading"===se})):null,"loading"!==h.type?h.icon||(null==O?void 0:O[se])||(e=>{switch(e){case"success":return rn;case"info":return an;case"warning":return nn;case"error":return on;default:return null}})(se):null):null,l.createElement("div",{"data-content":"",className:q(null==L?void 0:L.content,null==(i=null==h?void 0:h.classNames)?void 0:i.content)},l.createElement("div",{"data-title":"",className:q(null==L?void 0:L.title,null==(o=null==h?void 0:h.classNames)?void 0:o.title)},h.title),h.description?l.createElement("div",{"data-description":"",className:q(C,ae,null==L?void 0:L.description,null==(c=null==h?void 0:h.classNames)?void 0:c.description)},h.description):null),l.isValidElement(h.cancel)?h.cancel:h.cancel&&hn(h.cancel)?l.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||S,onClick:e=>{var t,s;hn(h.cancel)&&re&&(null==(s=(t=h.cancel).onClick)||s.call(t,e),be())},className:q(null==L?void 0:L.cancelButton,null==(d=null==h?void 0:h.classNames)?void 0:d.cancelButton)},h.cancel.label):null,l.isValidElement(h.action)?h.action:h.action&&hn(h.action)?l.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||E,onClick:e=>{var t,s;hn(h.action)&&(e.defaultPrevented||(null==(s=(t=h.action).onClick)||s.call(t,e),be()))},className:q(null==L?void 0:L.actionButton,null==(u=null==h?void 0:h.classNames)?void 0:u.actionButton)},h.action.label):null))};function vn(){if("undefined"==typeof window||"undefined"==typeof document)return"ltr";let e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}const bn=Object.freeze(Object.defineProperty({__proto__:null,Toaster:e=>{let{invert:t,position:s="bottom-right",hotkey:r=["altKey","KeyT"],expand:n,closeButton:a,className:i,offset:o,theme:d="light",richColors:u,duration:m,style:h,visibleToasts:p=pn,toastOptions:f,dir:g=vn(),gap:x=fn,loadingIcon:v,icons:b,containerAriaLabel:y="Notifications",pauseWhenPageIsHidden:j,cn:w=gn}=e,[N,_]=l.useState([]),k=l.useMemo(()=>Array.from(new Set([s].concat(N.filter(e=>e.position).map(e=>e.position)))),[N,s]),[S,E]=l.useState([]),[R,C]=l.useState(!1),[A,T]=l.useState(!1),[P,I]=l.useState("system"!==d?d:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),D=l.useRef(null),L=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=l.useRef(null),M=l.useRef(!1),V=l.useCallback(e=>{var t;null!=(t=N.find(t=>t.id===e.id))&&t.delete||cn.dismiss(e.id),_(t=>t.filter(({id:t})=>t!==e.id))},[N]);return l.useEffect(()=>cn.subscribe(e=>{e.dismiss?_(t=>t.map(t=>t.id===e.id?{...t,delete:!0}:t)):setTimeout(()=>{c.flushSync(()=>{_(t=>{let s=t.findIndex(t=>t.id===e.id);return-1!==s?[...t.slice(0,s),{...t[s],...e},...t.slice(s+1)]:[e,...t]})})})}),[]),l.useEffect(()=>{"system"===d?("system"===d&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?I("dark"):I("light")),"undefined"!=typeof window&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{I(e?"dark":"light")})):I(d)},[d]),l.useEffect(()=>{N.length<=1&&C(!1)},[N]),l.useEffect(()=>{let e=e=>{var t,s;r.every(t=>e[t]||e.code===t)&&(C(!0),null==(t=D.current)||t.focus()),"Escape"===e.code&&(document.activeElement===D.current||null!=(s=D.current)&&s.contains(document.activeElement))&&C(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),l.useEffect(()=>{if(D.current)return()=>{O.current&&(O.current.focus({preventScroll:!0}),O.current=null,M.current=!1)}},[D.current]),N.length?l.createElement("section",{"aria-label":`${y} ${L}`,tabIndex:-1},k.map((e,s)=>{var r;let[c,d]=e.split("-");return l.createElement("ol",{key:e,dir:"auto"===g?vn():g,tabIndex:-1,ref:D,className:i,"data-sonner-toaster":!0,"data-theme":P,"data-y-position":c,"data-x-position":d,style:{"--front-toast-height":`${(null==(r=S[0])?void 0:r.height)||0}px`,"--offset":"number"==typeof o?`${o}px`:o||"32px","--width":"356px","--gap":`${x}px`,...h},onBlur:e=>{M.current&&!e.currentTarget.contains(e.relatedTarget)&&(M.current=!1,O.current&&(O.current.focus({preventScroll:!0}),O.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||M.current||(M.current=!0,O.current=e.relatedTarget)},onMouseEnter:()=>C(!0),onMouseMove:()=>C(!0),onMouseLeave:()=>{A||C(!1)},onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||T(!0)},onPointerUp:()=>T(!1)},N.filter(t=>!t.position&&0===s||t.position===e).map((s,r)=>{var i,o;return l.createElement(xn,{key:s.id,icons:b,index:r,toast:s,defaultRichColors:u,duration:null!=(i=null==f?void 0:f.duration)?i:m,className:null==f?void 0:f.className,descriptionClassName:null==f?void 0:f.descriptionClassName,invert:t,visibleToasts:p,closeButton:null!=(o=null==f?void 0:f.closeButton)?o:a,interacting:A,position:e,style:null==f?void 0:f.style,unstyled:null==f?void 0:f.unstyled,classNames:null==f?void 0:f.classNames,cancelButtonStyle:null==f?void 0:f.cancelButtonStyle,actionButtonStyle:null==f?void 0:f.actionButtonStyle,removeToast:V,toasts:N.filter(e=>e.position==s.position),heights:S.filter(e=>e.position==s.position),setHeights:E,expandByDefault:n,gap:x,loadingIcon:v,expanded:R,pauseWhenPageIsHidden:j,cn:w})}))})):null},toast:mn,useSonner:function(){let[e,t]=l.useState([]);return l.useEffect(()=>cn.subscribe(e=>{t(t=>{if("dismiss"in e&&e.dismiss)return t.filter(t=>t.id!==e.id);let s=t.findIndex(t=>t.id===e.id);if(-1!==s){let r=[...t];return r[s]={...r[s],...e},r}return[e,...t]})}),[]),{toasts:e}}},Symbol.toStringTag,{value:"Module"}));async function yn(e){if(!e)return null;try{const{data:t}=await en.auth.getSession(),s=t.session?.user?.id||null;if(s&&s===e){const{data:t,error:s}=await en.from("profiles").select("*").eq("id",e).maybeSingle();return s?(mn.error("Impossible de charger votre profil",{description:"Erreur"}),null):t}const{data:r,error:n}=await en.rpc("get_public_profile",{target_id:e}).maybeSingle();if(n)return mn.error("Impossible de charger le profil public",{description:"Erreur"}),null;if(!r)return null;return{id:r.id,username:r.username??null,avatar_url:r.avatar_url??null,created_at:r.created_at??null,updated_at:null,email:null,is_admin:null}}catch(t){return mn.error("Erreur inattendue lors du chargement du profil"),null}}function jn(e,t,s){return e||(t?function(e){if(!e)return"";const t=e.indexOf("@");return t>8?`${e.substring(0,8)}...`:t>0?`${e.substring(0,t)}...`:e}(t):`Lecteur ${s.substring(0,4)}`)}function wn(e,t){const s=function(e){if(!e)return!1;const t=e.message?.toLowerCase()||"",s=e.code?.toLowerCase()||"",r=e.status||e.statusCode;return 401===r||403===r||406===r||t.includes("jwt expired")||t.includes("invalid token")||t.includes("invalid jwt")||t.includes("jwt malformed")||t.includes("not authenticated")||t.includes("invalid signature")||t.includes("token has expired")||"pgrst301"===s||"pgrst116"===s||"invalid_grant"===s}(t),r=function(e){if(!e)return!1;const t=e.message?.toLowerCase()||"";return t.includes("network")||t.includes("timeout")||t.includes("fetch failed")||t.includes("econnrefused")||t.includes("failed to fetch")||"TypeError"===e.name&&t.includes("fetch")}(t),n=function(e){return e&&(e.code?.startsWith("23")||e.code?.startsWith("42"))}(t);let a;a=s?"auth":r?"network":n?"postgres":"unknown";const i=function(e,t){return!t&&"network"===e}(a,s),o=function(e,t){if(t)return"Votre session a expir. Veuillez vous reconnecter.";switch(e){case"network":return"Problme de connexion rseau. Vrifiez votre connexion.";case"postgres":return"Erreur lors de l'opration. Veuillez ressayer.";case"auth":return"Erreur d'authentification. Veuillez vous reconnecter.";default:return"Une erreur inattendue est survenue."}}(a,s);return{context:e,type:a,isAuthExpired:s,shouldRetry:i,userMessage:o,originalError:t}}const Nn=s.createContext({supabase:en,session:null,user:null,isLoading:!0,isInitialized:!1,isAdmin:!1,isPremium:!1,error:null,setError:()=>{},signUp:async()=>{},signIn:async()=>{},signOut:async()=>{},refreshUserStatus:async()=>{},pollForPremiumStatus:async()=>!1});function _n({children:e}){const[t,n]=s.useState(null),[a,i]=s.useState(null),[o,l]=s.useState(!0),[c,d]=s.useState(!1),[u,m]=s.useState(!1),[h,p]=s.useState(!1),[f,g]=s.useState(null),x=s.useCallback(async e=>{try{if(!e)return{isAdmin:!1,isPremium:!1};const{data:t,error:s}=await en.from("profiles").select("is_admin, is_premium, premium_since").eq("id",e).single();if(s){return wn("fetchUserStatus",s).isAuthExpired&&(window.dispatchEvent(new Event("auth-expired")),setTimeout(()=>N(),0)),m(!1),p(!1),{isAdmin:!1,isPremium:!1}}const r=t?.is_admin||!1,n=t?.is_premium||!1;return m(r),p(n),i(e=>{if(!e)return e;return{...e,is_admin:r,is_premium:n,premium_since:t?.premium_since}}),{isAdmin:r,isPremium:n}}catch(t){return m(!1),p(!1),{isAdmin:!1,isPremium:!1}}},[]),v=s.useRef(!1),b=s.useCallback(async(e,t)=>{if(!v.current){v.current=!0;try{await async function(e,t){if(!e)return!1;try{const{data:s,error:r}=await en.from("profiles").select("id, username, email, avatar_url, is_premium, premium_since, is_admin, created_at, updated_at").eq("id",e).maybeSingle();if(r)return mn.error("Impossible de vrifier le profil existant",{description:"Erreur de synchronisation"}),!1;if(s){if(t){const{error:s}=await en.from("profiles").update({email:t}).eq("id",e);if(s)return mn.error("Impossible de mettre  jour l'email du profil",{description:"Erreur de mise  jour"}),!1}}else{const{error:s}=await en.from("profiles").insert({id:e,email:t,username:null,is_admin:!1});if(s)return mn.error("Impossible de crer le profil utilisateur",{description:"Erreur de cration"}),!1}return!0}catch(f){return mn.error("Erreur inattendue lors de la synchronisation du profil"),!1}}(e,t);return await x(e)}catch(s){return{isAdmin:!1,isPremium:!1}}finally{v.current=!1}}},[x]);s.useEffect(()=>{let e=!0,t=null;return(async()=>{try{const{data:{session:s},error:r}=await en.auth.getSession();if(!e)return;if(r&&(mn.error("Error connecting to Supabase"),g("Error connecting to Supabase")),s?.user){const t=await b(s.user.id,s.user.email);if(!e)return;const r={...s.user,is_admin:t?.isAdmin||!1,is_premium:t?.isPremium||!1};i(r),n(s)}else i(null),n(null);d(!0),l(!1);const{data:{subscription:a}}=en.auth.onAuthStateChange(async(t,s)=>{if(e){if(!s&&"INITIAL_SESSION"!==t)return i(null),n(null),m(!1),void p(!1);if(s?.user){const t=await b(s.user.id,s.user.email);if(!e)return;const r={...s.user,is_admin:t?.isAdmin||!1,is_premium:t?.isPremium||!1};i(r),n(s)}else i(null),n(null)}});t=a}catch(s){if(!e)return;d(!0),l(!1)}})(),()=>{e=!1,t&&t.unsubscribe()}},[]);const y=s.useRef(!1);s.useEffect(()=>{if(!a?.id)return;y.current=h;const e=en.channel(`premium-status-${a.id}`).on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`id=eq.${a.id}`},e=>{const t=e.new,s=!!t.is_premium,r=y.current;p(s),void 0!==t.is_admin&&m(t.is_admin),i(e=>e?{...e,is_premium:s,is_admin:t.is_admin??e.is_admin,premium_since:t.premium_since??e.premium_since}:e),!r&&s&&mn.success(" Flicitations ! Vous tes maintenant Premium !",{duration:5e3,style:{background:"linear-gradient(to right, #f97316, #eab308)",color:"white",fontWeight:"bold",fontSize:"16px"}}),y.current=s}).subscribe(e=>{});return()=>{en.removeChannel(e)}},[a?.id]);const j=s.useCallback(async(e,t)=>{g(null);const{error:s}=await en.auth.signUp({email:e,password:t});if(s)throw new Error(s.message)},[]),w=s.useCallback(async(e,t)=>{g(null);const{error:s}=await en.auth.signInWithPassword({email:e,password:t});if(s)throw new Error(s.message)},[]),N=s.useCallback(async()=>{g(null);const{error:e}=await en.auth.signOut();if(e)throw new Error(e.message)},[]),_=s.useCallback(async()=>{if(a?.id)try{const{data:{session:e},error:t}=await en.auth.getSession();if(t)return;if(e?.user){const t=await b(e.user.id,e.user.email),s={...e.user,is_admin:t?.isAdmin||!1,is_premium:t?.isPremium||!1};i(s),n(e)}}catch(e){}},[a?.id,b]),k=s.useCallback(async(e=!0)=>{if(!a?.id)return!1;const t=h;for(let r=1;r<=6;r++){try{const{data:s,error:r}=await en.from("profiles").select("is_premium, is_admin, premium_since").eq("id",a.id).single();if(r){if(wn("pollForPremiumStatus",r).isAuthExpired)return window.dispatchEvent(new Event("auth-expired")),setTimeout(()=>N(),0),!1}else if(s?.is_premium)return m(s.is_admin||!1),p(!0),i(e=>e?{...e,is_admin:s.is_admin||!1,is_premium:!0,premium_since:s.premium_since}:e),e&&!t&&mn.success(" Flicitations ! Vous tes maintenant Premium !",{duration:5e3,style:{background:"linear-gradient(to right, #f97316, #eab308)",color:"white",fontWeight:"bold"}}),!0}catch(s){}r<6&&await new Promise(e=>setTimeout(e,2e3))}return mn.error("Le statut premium n'a pas t dtect. Essayez de vous dconnecter puis reconnecter.",{duration:6e3}),!1},[a?.id,h,N]);s.useEffect(()=>{let e=!1;const t=async()=>{try{const{data:t,error:s}=await en.auth.getSession();if(e)return;if(s){return void(wn("authWatchdog",s).isAuthExpired&&(window.dispatchEvent(new Event("auth-expired")),setTimeout(()=>N(),0)))}const r=t?.session||null;if(!r&&a)return window.dispatchEvent(new Event("auth-expired")),void setTimeout(()=>N(),0)}catch(t){if(e)return}};t();const s=setInterval(t,6e4);return()=>{e=!0,clearInterval(s)}},[a,N]);const S=s.useMemo(()=>({supabase:en,session:t,user:a,isLoading:o,isInitialized:c,isAdmin:u,isPremium:h,error:f,setError:g,signUp:j,signIn:w,signOut:N,refreshUserStatus:_,pollForPremiumStatus:k}),[t,a,o,c,u,h,f,j,w,N,_,k]);return r.jsx(Nn.Provider,{value:S,children:e})}const kn=()=>s.useContext(Nn),Sn=new d({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:3e5}}}),En=()=>null,Rn=s.createContext(void 0),Cn={fr:{nav:{home:"Accueil",explore:"Explorer",discover:"Lecteurs",readingList:"Ma liste",achievements:"Rcompenses",admin:"Administration",profile:"Profil",settings:"Paramtres",menu:"Menu",blog:"Blog",about:" propos",press:"Presse",contact:"Contact",premium:"Premium",requestBook:"Demander un livre",feedback:"Feedback"},landing:{title:"Si ce n'est pas sur VREAD, tu ne l'as pas lu",description:"En moyenne, sur 10 livres achets, on finit seulement 2 livres.",heroTitle1:"En moyenne,",heroTitle2:"sur dix livres achets,",heroTitle3:"on finit seulement",finalTitle1:"Avec Vread,",finalTitle2:"tu les finis tous.",cta:"Commence gratuitement",clickToReveal:"Clique pour rvler",touchToReveal:"Touche pour rvler",restart:"Recommencer",twoBooks:"DEUX LIVRES",sloganPart1:"Si ce n'est pas sur",sloganPart2:"Vread",sloganPart3:",",sloganPart4:"tu ne l'as pas lu.",valueSection:{title:"Pourquoi on abandonne nos livres ?",withoutTitle:"Sans VREAD",without1:"On lit sans objectif clair",without2:"On perd le fil de l'histoire",without3:"On manque de motivation dans la dure",withTitle:"Avec VREAD",with1:"Un checkpoint tous les 30 pages",with2:"Des questions pour valider la comprhension",with3:"Une communaut qui nous challenge",mechanism:"Le principe : Lire 30 pages  Rpondre aux questions  Valider son segment  Continuer l'aventure"}},publicHome:{tagline:"L'appli qui t'accompagne dans ta lecture, page aprs page",subtitle:"Le Strava de la lecture",heroIntro:"L'appli qui t'accompagne",heroHighlight:"dans ta lecture",heroEnd:"page aprs page",description:"Relevez des dfis, suivez vos progrs, lisez  votre rythme.",ctaStart:"Commencer gratuitement",ctaBlog:"Dcouvrir le blog",sectionTitle:"Une nouvelle faon de lire",readyTitle:"Prt  recommencer  lire ?",readyDescription:"Rejoignez des milliers de lecteurs qui ont redcouvert le plaisir de la lecture.",ctaCreate:"Crer mon compte gratuit",freeNoCommitment:"Gratuit  Sans engagement  Sans carte bancaire",features:{progressive:{title:"Lecture progressive",description:"Reprenez got  la lecture avec des segments courts et des validations rgulires."},community:{title:"Communaut",description:"Rejoignez une communaut de lecteurs passionns et partagez vos dcouvertes."},achievements:{title:"Accomplissements",description:"Dbloquez des badges et suivez vos progrs de lecture au fil du temps."},statistics:{title:"Statistiques",description:"Analysez vos habitudes de lecture et visualisez votre volution."}}},home:{currentReadings:"Lectures en cours",continueReading:"Continuer la lecture",startReading:"Commencer la lecture",noCurrentReading:"Aucune lecture en cours",startYourNextAdventure:"Commencez votre prochaine aventure de lecture",startLiteraryJourney:"Reprends got  la lecture",discoverCollection:"Transforme chaque livre en dfi avec des checkpoints tous les 30 pages",exploreBooks:"Explorer les livres",myLibrary:"Ma bibliothque",noBooksInLibrary:"Aucun livre en cours",exploreCatalog:"Explorez notre catalogue pour commencer votre lecture",discoverBooks:"Dcouvrir des livres",seeAll:"Voir tout",viewAllBooks:"Voir tous les {{count}} livres",completed:"complt",continueWhereYouLeftOff:"Reprends ta lecture",viewYourReadingStats:"Voir mes statistiques",currentReading:"Votre lecture en cours",progression:"Progression",segmentsValidated:"segments valids"},explore:{title:"Explorer",categories:{litterature:"Littrature",religion:"Religion",essai:"Essai",bio:"Bio"},search:{placeholder:"Titre ou auteur",loading:"Chargement des livres",noResults:"Aucun livre dans cette catgorie."},pagination:{previous:"Prcdent",next:"Suivant",page:"Page"},requestBook:"Demander un livre"},reading:{progression:"Progression",chaptersRead:"chapitres lus",segmentsValidated:"segments valids",validateSegment:"Valider 30 pages",validateMyReading:"Valider ma lecture",segmentValidated:"Segment valid avec succs !",alreadyValidated:"Ce segment a dj t valid",validationFailed:"chec de la validation"},auth:{signIn:"Se connecter",signUp:"S'inscrire",signOut:"Se dconnecter",email:"Email",password:"Mot de passe",createAccount:"Crer un compte",welcome:"Bienvenue",firstTimeHere:"Premire fois ici ?",createAccountIn30s:"Cre un compte en 30 s.",confirmPassword:"Confirmer le mot de passe",alreadyRegistered:"Dj inscrit ? Se connecter",passwordsDontMatch:"Les mots de passe ne correspondent pas.",signupFailed:"Inscription impossible.",loginFailed:"Connexion impossible.",signingUp:"Inscription...",loggingIn:"Connexion...",pageTitle:"VREAD | Crer un compte ou se connecter",pageDescription:"Cre un compte en 30 secondes ou connecte-toi  VREAD."},common:{loading:"Chargement...",error:"Erreur",success:"Succs",warning:"Attention",save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",view:"Voir",close:"Fermer",confirm:"Confirmer",search:"Rechercher",searchPlaceholder:"Rechercher un livre, un auteur...",searching:"Recherche en cours...",noResultsFound:"Aucun rsultat trouv",tryAnotherSearch:"Essayez une autre recherche",seeAll:"Voir tout",discover:"Dcouvrir",bookNotAvailable:"Livre non disponible",bookNotAvailableDescription:"Le livre demand n'est pas disponible pour le moment.",discoverOtherBooks:"Dcouvrir d'autres livres",recentBadges:"Badges rcents"},language:{switch:"Changer de langue",french:"Franais",english:"English"},premium:{title:"Premium  Vie",earlyBirdBadge:"Offre de lancement - Limite",earlyBirdTitle:" Offre de Lancement Exclusive",earlyBirdDesc:"Accs illimit  la demande de livres + toutes les fonctionnalits premium sans limite de temps. Offre de lancement  vie - Paiement unique, bnfices permanents.",loginRequired:" Connectez-vous pour acheter Premium",loginRequiredDesc:"Parcourez les offres ci-dessous. Vous serez invit  vous connecter lors de l'achat.",iosPurchaseNote:" Sur iOS, les achats sont grs par l'App Store",androidPurchaseNote:" Sur Android, les achats sont grs par Google Play Store",cards:{free:{title:"Gratuit",price:"0",period:"pour toujours",features:{catalog:"Accs au catalogue de livres classiques",checkpoints:"Validation par checkpoints toutes les ~30 pages",tracking:"Suivi de progression et statistiques",badges:"Badges et systme de rcompenses",community:"Communaut de lecteurs"}},lifetime:{title:"Lifetime - Early Bird",titleAlt:"Premium  Vie",originalPrice:"99",price:"29",priceWithValue:"Acheter - {price} Lifetime",period:"Accs  vie",periodOnce:"Accs  vie - Paiement unique",validUntil:"Valable jusqu'au 30 novembre",iosNote:" Achat via App Store",features:{requestBooks:"Demander l'ajout de n'importe quel livre",processing:"Traitement sous 48-72h",advancedStats:"Statistiques de lecture avances",exclusiveBadges:"Badges exclusifs Premium",prioritySupport:"Support prioritaire",earlyAccess:"Accs anticip aux nouvelles fonctionnalits"}},annual:{title:"Premium Annuel",price:"50",period:"/an",pricePerMonth:"Soit 4,17/mois",priceWithValue:"Acheter - {price}/an"}},loading:{purchase:"Chargement de l'achat...",storeApple:"Chargement du store Apple...",storeAndroid:"Chargement du store Android...",connecting:"Connexion  l'App Store en cours",restoring:"Restauration en cours..."},buttons:{buy:"Acheter",restore:"Restaurer mes achats"},trust:{securePayment:" Paiement 100% scuris par Stripe",cancelAnytime:" Annulation possible  tout moment",immediateAccess:" Accs immdiat aprs paiement",appleManaged:" Les achats sont grs par Google Play Store",appleNote:"Paiement trait par l'App Store. Pas d'abonnement, paiement unique."},active:{title:"Premium Actif ",message:"Merci pour ton soutien ! Tu as accs  toutes les fonctionnalits Premium."},toast:{activated:" VREAD Premium activ !",activatedDesc:"Tu as maintenant accs  toutes les fonctionnalits Premium",notConfirmed:"Achat non confirm",notConfirmedDesc:"Vrifie ton compte Play Store",cancelled:"Achat annul",error:"Erreur lors de l'achat",errorDesc:"Ressaye plus tard",restored:" Achats restaurs !",restoredDesc:"Ton accs Premium a t rtabli",noRestore:"Aucun achat  restaurer",noRestoreDesc:"Aucun achat Premium trouv sur ce compte Google Play",restoreError:"Erreur lors de la restauration"},faq:{title:"Questions frquentes",howItWorks:{question:"Comment fonctionne la demande de livre ?",answer:"Une fois Premium, tu peux demander n'importe quel livre via le formulaire ddi. Nous crons les questions de comprhension et ajoutons le livre ASAP."},howMany:{question:"Combien de livres puis-je demander ?",answer:"Deux livres par deux livres ! Tu dois valider un des deux livres demands pour en obtenir un autre."},cancel:{question:"Puis-je annuler mon abonnement ?",answer:"Oui, tu peux annuler  tout moment. Tu garderas l'accs Premium jusqu' la fin de ta priode paye."}}},requestBook:{title:"Demander un livre",paywall:{title:"Fonctionnalit Premium",description:"Passe Premium pour demander l'ajout de n'importe quel livre dans VREAD. Nous crons les questions de comprhension et ajoutons le livre sous 48-72h.",cta:"Dcouvrir Premium",ctaIOS:"Dcouvrir Premium (In-App Purchase)"},form:{title:"Titre du livre *",titlePlaceholder:"Ex: L'tranger",author:"Auteur",authorPlaceholder:"Ex: Albert Camus",isbn:"ISBN (optionnel)",isbnPlaceholder:"Ex: 978-2070360024",reason:"Pourquoi ce livre ? (optionnel)",reasonPlaceholder:"Ex: Classique de la littrature franaise que je veux lire pour mes tudes",submit:"Envoyer la demande",submitting:"Envoi en cours...",info:" Nous traitons les demandes sous 48-72h.",infoEmail:"Tu seras notifi par email quand le livre sera disponible."},toast:{loginRequired:"Connecte-toi pour continuer",premiumRequired:"Cette fonctionnalit est rserve aux membres Premium",titleRequired:"Le titre du livre est obligatoire",success:"Nous traiterons ta demande sous 48-72h. Tu seras notifi par email.",error:"Impossible d'envoyer la demande. Ressaye plus tard."}},achievements:{title:"Vos Accomplissements",subtitle:"Clbrez votre parcours littraire",stats:{booksRead:"Livres lus",pagesRead:"Pages lues",currentStreak:"Srie actuelle",bestStreak:"Record",badges:"Badges",record:"Record: {count}"},badges:{title:"Badges Dbloqus",subtitle:"Vos accomplissements par ordre de raret",empty:"Aucun badge dbloqu",emptyDesc:"Continuez  lire pour dbloquer vos premiers badges !",earnedOn:"Obtenu le {date}",rarity:{legendary:"Lg.",epic:"pic.",rare:"Rare",common:"Com."}},quests:{title:"Qutes Accomplies",subtitle:"Exploits spciaux dverrouills par vos actions",empty:"Aucune qute disponible",emptyDesc:"Les qutes seront bientt disponibles",categories:{marathons:{icon:"",label:"Marathons",desc:"Dfis intenses"},vitesse:{icon:"",label:"Vitesse & Performance",desc:"Dfis de rapidit"},variete:{icon:"",label:"Varit & Exploration",desc:"Dfis de diversit"},regularite:{icon:"",label:"Rgularit Extrme",desc:"Dfis de constance"},horaires:{icon:"",label:"Horaires Spciaux",desc:"Dfis temporels"}},questsCount:"{count} qute",questsCountPlural:"{count} qutes"}},discover:{title:"Dcouvrir la communaut",subtitle:"Explorez l'activit des lecteurs, suivez leur progression et rejoignez une communaut passionne",error:"Une erreur est survenue lors du chargement des donnes."},feedback:{title:" Fais pousser VREAD avec nous",subtitle:"Chaque feedback est une graine qui amliore l'exprience de toute la communaut",buttons:{give:" Donner mon feedback",view:" Voir les suggestions"},realTime:" En temps rel  Des centaines de feedbacks partags"}},en:{nav:{home:"Home",explore:"Explore",discover:"Readers",readingList:"My List",achievements:"Achievements",admin:"Administration",profile:"Profile",settings:"Settings",menu:"Menu",blog:"Blog",about:"About",press:"Press",contact:"Contact",premium:"Premium",requestBook:"Request a Book",feedback:"Feedback"},landing:{title:"If it's not on VREAD, you haven't read it",description:"On average, out of 10 books purchased, we only finish 2 books.",heroTitle1:"On average,",heroTitle2:"out of ten books purchased,",heroTitle3:"we only finish",finalTitle1:"With Vread,",finalTitle2:"you finish them all.",cta:"Start for free",clickToReveal:"Click to reveal",touchToReveal:"Touch to reveal",restart:"Restart",twoBooks:"TWO BOOKS",sloganPart1:"If it's not on",sloganPart2:"Vread",sloganPart3:",",sloganPart4:"you haven't read it.",valueSection:{title:"Why we abandon our books?",withoutTitle:"Without VREAD",without1:"We read without clear goals",without2:"We lose track of the story",without3:"We lack long-term motivation",withTitle:"With VREAD",with1:"A checkpoint every 30 pages",with2:"Questions to validate comprehension",with3:"A community that challenges us",mechanism:"The principle: Read 30 pages  Answer questions  Validate your segment  Continue the adventure"}},publicHome:{tagline:"The app that supports you in your reading, page by page",subtitle:"The Strava of reading",heroIntro:"The app that supports you",heroHighlight:"in your reading",heroEnd:"page by page",description:"Take on challenges, track your progress, read at your own pace.",ctaStart:"Start for free",ctaBlog:"Discover the blog",sectionTitle:"A new way to read",readyTitle:"Ready to start reading again?",readyDescription:"Join thousands of readers who have rediscovered the joy of reading.",ctaCreate:"Create my free account",freeNoCommitment:"Free  No commitment  No credit card",features:{progressive:{title:"Progressive Reading",description:"Rediscover the joy of reading with short segments and regular validations."},community:{title:"Community",description:"Join a community of passionate readers and share your discoveries."},achievements:{title:"Achievements",description:"Unlock badges and track your reading progress over time."},statistics:{title:"Statistics",description:"Analyze your reading habits and visualize your progress."}}},home:{currentReadings:"Current Readings",continueReading:"Continue Reading",startReading:"Start Reading",noCurrentReading:"No current reading",startYourNextAdventure:"Start your next reading adventure",startLiteraryJourney:"Start your literary journey",discoverCollection:"Discover our collection of classics and start reading today",exploreBooks:"Explore books",myLibrary:"My Library",noBooksInLibrary:"No books in progress",exploreCatalog:"Explore our catalog to start your reading",discoverBooks:"Discover books",seeAll:"See all",viewAllBooks:"View all {{count}} books",completed:"completed",continueWhereYouLeftOff:"Continue where you left off",viewYourReadingStats:"View my statistics",currentReading:"Your current reading",progression:"Progress",segmentsValidated:"segments validated"},explore:{title:"Explore",categories:{litterature:"Literature",religion:"Religion",essai:"Essay",bio:"Biography"},search:{placeholder:"Title or author",loading:"Loading books",noResults:"No books in this category."},pagination:{previous:"Previous",next:"Next",page:"Page"},requestBook:"Request a book"},reading:{progression:"Progress",chaptersRead:"chapters read",segmentsValidated:"segments validated",validateSegment:"Validate 30 pages",validateMyReading:"Validate my reading",segmentValidated:"Segment validated successfully!",alreadyValidated:"This segment has already been validated",validationFailed:"Validation failed"},auth:{signIn:"Sign In",signUp:"Sign Up",signOut:"Sign Out",email:"Email",password:"Password",createAccount:"Create an account",welcome:"Welcome",firstTimeHere:"First time here?",createAccountIn30s:"Create an account in 30 seconds.",confirmPassword:"Confirm password",alreadyRegistered:"Already registered? Sign in",passwordsDontMatch:"Passwords don't match.",signupFailed:"Signup failed.",loginFailed:"Login failed.",signingUp:"Signing up...",loggingIn:"Logging in...",pageTitle:"VREAD | Create an account or sign in",pageDescription:"Create an account in 30 seconds or sign in to VREAD."},common:{loading:"Loading...",error:"Error",success:"Success",warning:"Warning",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",view:"View",close:"Close",confirm:"Confirm",search:"Search",searchPlaceholder:"Search for a book, author...",searching:"Searching...",noResultsFound:"No results found",tryAnotherSearch:"Try another search",seeAll:"See all",discover:"Discover",bookNotAvailable:"Book not available",bookNotAvailableDescription:"The requested book is not available at the moment.",discoverOtherBooks:"Discover other books",recentBadges:"Recent badges"},language:{switch:"Change language",french:"Franais",english:"English"},premium:{title:"Lifetime Premium",earlyBirdBadge:"Launch Offer - Limited",earlyBirdTitle:" Exclusive Launch Offer",earlyBirdDesc:"Unlimited access to book requests + all premium features with no time limit. Lifetime launch offer - One-time payment, permanent benefits.",loginRequired:" Sign in to purchase Premium",loginRequiredDesc:"Browse the offers below. You'll be prompted to sign in when purchasing.",iosPurchaseNote:" On iOS, purchases are managed by the App Store",androidPurchaseNote:" On Android, purchases are managed by Google Play Store",cards:{free:{title:"Free",price:"0",period:"forever",features:{catalog:"Access to classic books catalog",checkpoints:"Validation at checkpoints every ~30 pages",tracking:"Progress tracking and statistics",badges:"Badges and rewards system",community:"Readers community"}},lifetime:{title:"Lifetime - Early Bird",titleAlt:"Lifetime Premium",originalPrice:"99",price:"29",priceWithValue:"Buy - {price} Lifetime",period:"Lifetime access",periodOnce:"Lifetime access - One-time payment",validUntil:"Valid until November 30",iosNote:" Purchase via App Store",features:{requestBooks:"Request any book to be added",processing:"Processing within 48-72h",advancedStats:"Advanced reading statistics",exclusiveBadges:"Exclusive Premium badges",prioritySupport:"Priority support",earlyAccess:"Early access to new features"}},annual:{title:"Annual Premium",price:"50",period:"/year",pricePerMonth:"That's 4.17/month",priceWithValue:"Buy - {price}/year"}},loading:{purchase:"Loading purchase...",storeApple:"Loading Apple store...",storeAndroid:"Loading Android store...",connecting:"Connecting to App Store",restoring:"Restoring..."},buttons:{buy:"Buy",restore:"Restore purchases"},trust:{securePayment:" 100% secure payment by Stripe",cancelAnytime:" Cancel anytime",immediateAccess:" Immediate access after payment",appleManaged:" Purchases are managed by Google Play Store",appleNote:"Payment processed by App Store. No subscription, one-time payment."},active:{title:"Premium Active ",message:"Thank you for your support! You now have access to all Premium features."},toast:{activated:" VREAD Premium activated!",activatedDesc:"You now have access to all Premium features",notConfirmed:"Purchase not confirmed",notConfirmedDesc:"Check your Play Store account",cancelled:"Purchase cancelled",error:"Purchase error",errorDesc:"Try again later",restored:" Purchases restored!",restoredDesc:"Your Premium access has been restored",noRestore:"No purchases to restore",noRestoreDesc:"No Premium purchase found on this Google Play account",restoreError:"Restore error"},faq:{title:"Frequently Asked Questions",howItWorks:{question:"How does book request work?",answer:"Once Premium, you can request any book via the dedicated form. We create comprehension questions and add the book ASAP."},howMany:{question:"How many books can I request?",answer:"Two books at a time! You must validate one of the two requested books to get another."},cancel:{question:"Can I cancel my subscription?",answer:"Yes, you can cancel anytime. You'll keep Premium access until the end of your paid period."}}},requestBook:{title:"Request a Book",paywall:{title:"Premium Feature",description:"Upgrade to Premium to request any book to be added to VREAD. We create comprehension questions and add the book within 48-72h.",cta:"Discover Premium - 50/year",ctaIOS:"Discover Premium (In-App Purchase)"},form:{title:"Book title *",titlePlaceholder:"E.g.: The Stranger",author:"Author",authorPlaceholder:"E.g.: Albert Camus",isbn:"ISBN (optional)",isbnPlaceholder:"E.g.: 978-2070360024",reason:"Why this book? (optional)",reasonPlaceholder:"E.g.: French literature classic I want to read for my studies",submit:"Submit request",submitting:"Submitting...",info:" We process requests within 48-72h.",infoEmail:"You'll be notified by email when the book is available."},toast:{loginRequired:"Sign in to continue",premiumRequired:"This feature is reserved for Premium members",titleRequired:"Book title is required",success:"We'll process your request within 48-72h. You'll be notified by email.",error:"Unable to submit request. Try again later."}},achievements:{title:"Your Achievements",subtitle:"Celebrate your literary journey",stats:{booksRead:"Books read",pagesRead:"Pages read",currentStreak:"Current streak",bestStreak:"Best",badges:"Badges",record:"Best: {count}"},badges:{title:"Unlocked Badges",subtitle:"Your achievements by rarity",empty:"No badges unlocked",emptyDesc:"Keep reading to unlock your first badges!",earnedOn:"Earned on {date}",rarity:{legendary:"Leg.",epic:"Epic",rare:"Rare",common:"Com."}},quests:{title:"Completed Quests",subtitle:"Special achievements unlocked by your actions",empty:"No quests available",emptyDesc:"Quests will be available soon",categories:{marathons:{icon:"",label:"Marathons",desc:"Intense challenges"},vitesse:{icon:"",label:"Speed & Performance",desc:"Speed challenges"},variete:{icon:"",label:"Variety & Exploration",desc:"Diversity challenges"},regularite:{icon:"",label:"Extreme Regularity",desc:"Consistency challenges"},horaires:{icon:"",label:"Special Hours",desc:"Time-based challenges"}},questsCount:"{count} quest",questsCountPlural:"{count} quests"}},discover:{title:"Discover the Community",subtitle:"Explore readers' activity, follow their progress and join a passionate community",error:"An error occurred while loading data."},feedback:{title:" Grow VREAD with us",subtitle:"Every feedback is a seed that improves the experience for the whole community",buttons:{give:" Give feedback",view:" View suggestions"},realTime:" Real-time  Hundreds of feedbacks shared"}}},An=({children:e})=>{const[t,n]=s.useState(()=>{const e=localStorage.getItem("vread-language");return!e||"fr"!==e&&"en"!==e?"fr"===navigator.language.split("-")[0]?"fr":"en":e});s.useEffect(()=>{localStorage.setItem("vread-language",t),document.documentElement.lang=t},[t]);return r.jsx(Rn.Provider,{value:{language:t,setLanguage:e=>{n(e)},t:Cn[t]},children:e})},Tn=()=>{const e=s.useContext(Rn);if(!e)throw new Error("useTranslation must be used within LanguageProvider");return e};function Pn({size:e=32,className:t="",...s}){return r.jsx("img",{src:"/branding/vread-logo-512.png",width:e,height:e,alt:"VREAD logo",className:t,loading:"eager",decoding:"async",style:{imageRendering:"auto"},...s})}var In={};!function e(t,s,r,n){var a=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),i="function"==typeof Path2D&&"function"==typeof DOMMatrix;function o(){}function l(e){var r=s.exports.Promise,n=void 0!==r?r:t.Promise;return"function"==typeof n?new n(e):(e(o,o),null)}var c,d,u,m,h,p,f=function(e,t){return{transform:function(s){if(e)return s;if(t.has(s))return t.get(s);var r=new OffscreenCanvas(s.width,s.height);return r.getContext("2d").drawImage(s,0,0),t.set(s,r),r},clear:function(){t.clear()}}}(function(){if(!t.OffscreenCanvas)return!1;try{var e=new OffscreenCanvas(1,1),s=e.getContext("2d");s.fillRect(0,0,1,1);var r=e.transferToImageBitmap();s.createPattern(r,"no-repeat")}catch(n){return!1}return!0}(),new Map),g=(u=Math.floor(1e3/60),m={},h=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(c=function(e){var t=Math.random();return m[t]=requestAnimationFrame(function s(r){h===r||h+u-1<r?(h=r,delete m[t],e()):m[t]=requestAnimationFrame(s)}),t},d=function(e){m[e]&&cancelAnimationFrame(m[e])}):(c=function(e){return setTimeout(e,u)},d=function(e){return clearTimeout(e)}),{frame:c,cancel:d}),x=function(){var t,s,n={};return function(){if(t)return t;if(!r&&a){var i=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{t=new Worker(URL.createObjectURL(new Blob([i])))}catch(o){return"undefined"!=typeof console&&console.warn,null}!function(e){function t(t,s){e.postMessage({options:t||{},callback:s})}e.init=function(t){var s=t.transferControlToOffscreen();e.postMessage({canvas:s},[s])},e.fire=function(r,a,i){if(s)return t(r,null),s;var o=Math.random().toString(36).slice(2);return s=l(function(a){function l(t){t.data.callback===o&&(delete n[o],e.removeEventListener("message",l),s=null,f.clear(),i(),a())}e.addEventListener("message",l),t(r,o),n[o]=l.bind(null,{data:{callback:o}})})},e.reset=function(){for(var t in e.postMessage({reset:!0}),n)n[t](),delete n[t]}}(t)}return t}}(),v={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function b(e,t,s){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:v[t],s)}function y(e){return e<0?0:Math.floor(e)}function j(e,t){return Math.floor(Math.random()*(t-e))+e}function w(e){return parseInt(e,16)}function N(e){return e.map(_)}function _(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:w(t.substring(0,2)),g:w(t.substring(2,4)),b:w(t.substring(4,6))}}function k(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function S(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function E(e){var t=e.angle*(Math.PI/180),s=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-t+(.5*s-Math.random()*s),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function R(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var s=t.tick++/t.totalTicks,r=t.x+t.random*t.tiltCos,n=t.y+t.random*t.tiltSin,a=t.wobbleX+t.random*t.tiltCos,o=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-s)+")",e.beginPath(),i&&"path"===t.shape.type&&"string"==typeof t.shape.path&&Array.isArray(t.shape.matrix))e.fill(function(e,t,s,r,n,a,i){var o=new Path2D(e),l=new Path2D;l.addPath(o,new DOMMatrix(t));var c=new Path2D;return c.addPath(l,new DOMMatrix([Math.cos(i)*n,Math.sin(i)*n,-Math.sin(i)*a,Math.cos(i)*a,s,r])),c}(t.shape.path,t.shape.matrix,t.x,t.y,.1*Math.abs(a-r),.1*Math.abs(o-n),Math.PI/10*t.wobble));else if("bitmap"===t.shape.type){var l=Math.PI/10*t.wobble,c=.1*Math.abs(a-r),d=.1*Math.abs(o-n),u=t.shape.bitmap.width*t.scalar,m=t.shape.bitmap.height*t.scalar,h=new DOMMatrix([Math.cos(l)*c,Math.sin(l)*c,-Math.sin(l)*d,Math.cos(l)*d,t.x,t.y]);h.multiplySelf(new DOMMatrix(t.shape.matrix));var p=e.createPattern(f.transform(t.shape.bitmap),"no-repeat");p.setTransform(h),e.globalAlpha=1-s,e.fillStyle=p,e.fillRect(t.x-u/2,t.y-m/2,u,m),e.globalAlpha=1}else if("circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(a-r)*t.ovalScalar,Math.abs(o-n)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,s,r,n,a,i,o,l){e.save(),e.translate(t,s),e.rotate(a),e.scale(r,n),e.arc(0,0,1,i,o,l),e.restore()}(e,t.x,t.y,Math.abs(a-r)*t.ovalScalar,Math.abs(o-n)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var g=Math.PI/2*3,x=4*t.scalar,v=8*t.scalar,b=t.x,y=t.y,j=5,w=Math.PI/j;j--;)b=t.x+Math.cos(g)*v,y=t.y+Math.sin(g)*v,e.lineTo(b,y),g+=w,b=t.x+Math.cos(g)*x,y=t.y+Math.sin(g)*x,e.lineTo(b,y),g+=w;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(n)),e.lineTo(Math.floor(a),Math.floor(o)),e.lineTo(Math.floor(r),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}function C(e,s){var i,o=!e,c=!!b(s||{},"resize"),d=!1,u=b(s,"disableForReducedMotion",Boolean),m=a&&!!b(s||{},"useWorker")?x():null,h=o?k:S,p=!(!e||!m)&&!!e.__confetti_initialized,v="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function w(t,s,a){for(var o=b(t,"particleCount",y),c=b(t,"angle",Number),d=b(t,"spread",Number),u=b(t,"startVelocity",Number),m=b(t,"decay",Number),p=b(t,"gravity",Number),x=b(t,"drift",Number),v=b(t,"colors",N),w=b(t,"ticks",Number),_=b(t,"shapes"),k=b(t,"scalar"),S=!!b(t,"flat"),C=function(e){var t=b(e,"origin",Object);return t.x=b(t,"x",Number),t.y=b(t,"y",Number),t}(t),A=o,T=[],P=e.width*C.x,I=e.height*C.y;A--;)T.push(E({x:P,y:I,angle:c,spread:d,startVelocity:u,color:v[A%v.length],shape:_[j(0,_.length)],ticks:w,decay:m,gravity:p,drift:x,scalar:k,flat:S}));return i?i.addFettis(T):(i=function(e,t,s,a,i){var o,c,d=t.slice(),u=e.getContext("2d"),m=l(function(t){function l(){o=c=null,u.clearRect(0,0,a.width,a.height),f.clear(),i(),t()}o=g.frame(function t(){!r||a.width===n.width&&a.height===n.height||(a.width=e.width=n.width,a.height=e.height=n.height),a.width||a.height||(s(e),a.width=e.width,a.height=e.height),u.clearRect(0,0,a.width,a.height),(d=d.filter(function(e){return R(u,e)})).length?o=g.frame(t):l()}),c=l});return{addFettis:function(e){return d=d.concat(e),m},canvas:e,promise:m,reset:function(){o&&g.cancel(o),c&&c()}}}(e,T,h,s,a),i.promise)}function _(s){var r=u||b(s,"disableForReducedMotion",Boolean),n=b(s,"zIndex",Number);if(r&&v)return l(function(e){e()});o&&i?e=i.canvas:o&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(n),document.body.appendChild(e)),c&&!p&&h(e);var a={width:e.width,height:e.height};function f(){if(m){var t={getBoundingClientRect:function(){if(!o)return e.getBoundingClientRect()}};return h(t),void m.postMessage({resize:{width:t.width,height:t.height}})}a.width=a.height=null}function g(){i=null,c&&(d=!1,t.removeEventListener("resize",f)),o&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,p=!1)}return m&&!p&&m.init(e),p=!0,m&&(e.__confetti_initialized=!0),c&&!d&&(d=!0,t.addEventListener("resize",f,!1)),m?m.fire(s,a,g):w(s,a,g)}return _.reset=function(){m&&m.reset(),i&&i.reset()},_}function A(){return p||(p=C(null,{useWorker:!0,resize:!0})),p}s.exports=function(){return A().apply(this,arguments)},s.exports.reset=function(){A().reset()},s.exports.create=C,s.exports.shapeFromPath=function(e){if(!i)throw new Error("path confetti are not supported in this browser");var t,s;"string"==typeof e?t=e:(t=e.path,s=e.matrix);var r=new Path2D(t),n=document.createElement("canvas").getContext("2d");if(!s){for(var a,o,l=1e3,c=l,d=l,u=0,m=0,h=0;h<l;h+=2)for(var p=0;p<l;p+=2)n.isPointInPath(r,h,p,"nonzero")&&(c=Math.min(c,h),d=Math.min(d,p),u=Math.max(u,h),m=Math.max(m,p));a=u-c,o=m-d;var f=Math.min(10/a,10/o);s=[f,0,0,f,-Math.round(a/2+c)*f,-Math.round(o/2+d)*f]}return{type:"path",path:t,matrix:s}},s.exports.shapeFromText=function(e){var t,s=1,r="#000000",n='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?t=e:(t=e.text,s="scalar"in e?e.scalar:s,n="fontFamily"in e?e.fontFamily:n,r="color"in e?e.color:r);var a=10*s,i=a+"px "+n,o=new OffscreenCanvas(a,a),l=o.getContext("2d");l.font=i;var c=l.measureText(t),d=Math.ceil(c.actualBoundingBoxRight+c.actualBoundingBoxLeft),u=Math.ceil(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent),m=c.actualBoundingBoxLeft+2,h=c.actualBoundingBoxAscent+2;d+=4,u+=4,(l=(o=new OffscreenCanvas(d,u)).getContext("2d")).font=i,l.fillStyle=r,l.fillText(t,m,h);var p=1/s;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[p,0,0,p,-d*p/2,-u*p/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),In,!1);const Dn=In.exports;In.exports.create;const Ln=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,On=Gs,Mn=(e,t)=>s=>{var r;if(null==(null==t?void 0:t.variants))return On(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:n,defaultVariants:a}=t,i=Object.keys(n).map(e=>{const t=null==s?void 0:s[e],r=null==a?void 0:a[e];if(null===t)return null;const i=Ln(t)||Ln(r);return n[e][i]}),o=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),l=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...o}[t]):{...a,...o}[t]===s})?[...e,s,r]:e},[]);return On(e,i,l,null==s?void 0:s.class,null==s?void 0:s.className)},Vn=Mn("inline-flex items-center justify-center gap-2 whitespace-normal break-words text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-[1.02] shadow-sm hover:shadow-md",premium:"relative overflow-hidden bg-gradient-to-r from-brand-600 to-brand-500 text-white shadow-lg hover:shadow-xl hover:scale-[1.02] before:absolute before:inset-0 before:bg-gradient-to-r before:from-white/0 before:via-white/20 before:to-white/0 before:translate-x-[-100%] hover:before:translate-x-[100%] before:transition-transform before:duration-1000",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:scale-[1.02]",outline:"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-brand-400",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:scale-[1.02]",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",bookCta:"bg-coffee-dark text-white hover:bg-coffee-darker hover:scale-[1.02] shadow-md hover:shadow-lg"},size:{default:"h-auto min-h-[44px] px-6 py-3 rounded-xl text-base sm:text-sm sm:min-h-10 sm:px-4 sm:py-2",sm:"h-auto min-h-[40px] px-4 py-2 rounded-lg text-sm sm:h-9 sm:px-3",lg:"h-auto min-h-[48px] px-8 py-4 rounded-xl text-lg sm:h-11 sm:px-8 sm:text-base",icon:"h-[44px] w-[44px] rounded-lg sm:h-10 sm:w-10"}},defaultVariants:{variant:"default",size:"default"}}),qn=s.forwardRef(({className:e,variant:t,size:s,asChild:n=!1,...a},i)=>{const o=n?u:"button";return r.jsx(o,{className:zr(Vn({variant:t,size:s,className:e})),ref:i,...a})});qn.displayName="Button";const Bn=k,zn=S;s.forwardRef(({className:e,inset:t,children:s,...n},a)=>r.jsxs(m,{ref:a,className:zr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...n,children:[s,r.jsx(h,{className:"ml-auto h-4 w-4"})]})).displayName=m.displayName;s.forwardRef(({className:e,...t},s)=>r.jsx(p,{ref:s,className:zr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=p.displayName;const Un=s.forwardRef(({className:e,sideOffset:t=4,...s},n)=>r.jsx(f,{children:r.jsx(g,{ref:n,sideOffset:t,className:zr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));Un.displayName=g.displayName;const Fn=s.forwardRef(({className:e,inset:t,...s},n)=>r.jsx(x,{ref:n,className:zr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));Fn.displayName=x.displayName;s.forwardRef(({className:e,children:t,checked:s,...n},a)=>r.jsxs(v,{ref:a,className:zr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...n,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(b,{children:r.jsx(y,{className:"h-4 w-4"})})}),t]})).displayName=v.displayName;s.forwardRef(({className:e,children:t,...s},n)=>r.jsxs(j,{ref:n,className:zr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(b,{children:r.jsx(w,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=j.displayName;const $n=s.forwardRef(({className:e,inset:t,...s},n)=>r.jsx(N,{ref:n,className:zr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...s}));$n.displayName=N.displayName;const Wn=s.forwardRef(({className:e,...t},s)=>r.jsx(_,{ref:s,className:zr("-mx-1 my-1 h-px bg-muted",e),...t}));Wn.displayName=_.displayName;const Zn=()=>{const{language:e,setLanguage:t,t:s}=Tn();return r.jsxs(Bn,{children:[r.jsx(zn,{asChild:!0,children:r.jsx(qn,{variant:"ghost",size:"icon",className:"hover:bg-brand-100/50 transition-colors","aria-label":s.language.switch,children:r.jsx(E,{className:"h-5 w-5"})})}),r.jsxs(Un,{align:"end",className:"min-w-[140px] bg-white border-brand-200 z-50",children:[r.jsxs(Fn,{onClick:()=>t("fr"),className:"cursor-pointer "+("fr"===e?"bg-brand-100 text-brand-700":""),children:[" ",s.language.french]}),r.jsxs(Fn,{onClick:()=>t("en"),className:"cursor-pointer "+("en"===e?"bg-brand-100 text-brand-700":""),children:[" ",s.language.english]})]})]})},Hn=s.createContext({});function Gn(e){const t=s.useRef(null);return null===t.current&&(t.current=e()),t.current}const Kn="undefined"!=typeof window,Yn=Kn?s.useLayoutEffect:s.useEffect,Qn=s.createContext(null);function Xn(e,t){-1===e.indexOf(t)&&e.push(t)}function Jn(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}const ea=(e,t,s)=>s>t?t:s<e?e:s;const ta={},sa=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function ra(e){return"object"==typeof e&&null!==e}const na=e=>/^0[^.\s]+$/u.test(e);function aa(e){let t;return()=>(void 0===t&&(t=e()),t)}const ia=e=>e,oa=(e,t)=>s=>t(e(s)),la=(...e)=>e.reduce(oa),ca=(e,t,s)=>{const r=t-e;return 0===r?1:(s-e)/r};class da{constructor(){this.subscriptions=[]}add(e){return Xn(this.subscriptions,e),()=>Jn(this.subscriptions,e)}notify(e,t,s){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,s);else for(let n=0;n<r;n++){const r=this.subscriptions[n];r&&r(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ua=e=>1e3*e,ma=e=>e/1e3;function ha(e,t){return t?e*(1e3/t):0}const pa=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function fa(e,t,s,r){if(e===t&&s===r)return ia;const n=t=>function(e,t,s,r,n){let a,i,o=0;do{i=t+(s-t)/2,a=pa(i,r,n)-e,a>0?s=i:t=i}while(Math.abs(a)>1e-7&&++o<12);return i}(t,0,1,e,s);return e=>0===e||1===e?e:pa(n(e),t,r)}const ga=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,xa=e=>t=>1-e(1-t),va=fa(.33,1.53,.69,.99),ba=xa(va),ya=ga(ba),ja=e=>(e*=2)<1?.5*ba(e):.5*(2-Math.pow(2,-10*(e-1))),wa=e=>1-Math.sin(Math.acos(e)),Na=xa(wa),_a=ga(wa),ka=fa(.42,0,1,1),Sa=fa(0,0,.58,1),Ea=fa(.42,0,.58,1),Ra=e=>Array.isArray(e)&&"number"==typeof e[0],Ca={linear:ia,easeIn:ka,easeInOut:Ea,easeOut:Sa,circIn:wa,circInOut:_a,circOut:Na,backIn:ba,backInOut:ya,backOut:va,anticipate:ja},Aa=e=>{if(Ra(e)){e.length;const[t,s,r,n]=e;return fa(t,s,r,n)}return"string"==typeof e?Ca[e]:e},Ta=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Pa={value:null,addProjectionMetrics:null};function Ia(e,t){let s=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},a=()=>s=!0,i=Ta.reduce((e,s)=>(e[s]=function(e,t){let s=new Set,r=new Set,n=!1,a=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){i.has(t)&&(d.schedule(t),e()),l++,t(o)}const d={schedule:(e,t=!1,a=!1)=>{const o=a&&n?s:r;return t&&i.add(e),o.has(e)||o.add(e),e},cancel:e=>{r.delete(e),i.delete(e)},process:e=>{o=e,n?a=!0:(n=!0,[s,r]=[r,s],s.forEach(c),t&&Pa.value&&Pa.value.frameloop[t].push(l),l=0,s.clear(),n=!1,a&&(a=!1,d.process(e)))}};return d}(a,t?s:void 0),e),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:d,update:u,preRender:m,render:h,postRender:p}=i,f=()=>{const a=ta.useManualTiming?n.timestamp:performance.now();s=!1,ta.useManualTiming||(n.delta=r?1e3/60:Math.max(Math.min(a-n.timestamp,40),1)),n.timestamp=a,n.isProcessing=!0,o.process(n),l.process(n),c.process(n),d.process(n),u.process(n),m.process(n),h.process(n),p.process(n),n.isProcessing=!1,s&&t&&(r=!1,e(f))};return{schedule:Ta.reduce((t,a)=>{const o=i[a];return t[a]=(t,a=!1,i=!1)=>(s||(s=!0,r=!0,n.isProcessing||e(f)),o.schedule(t,a,i)),t},{}),cancel:e=>{for(let t=0;t<Ta.length;t++)i[Ta[t]].cancel(e)},state:n,steps:i}}const{schedule:Da,cancel:La,state:Oa,steps:Ma}=Ia("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:ia,!0);let Va;function qa(){Va=void 0}const Ba={now:()=>(void 0===Va&&Ba.set(Oa.isProcessing||ta.useManualTiming?Oa.timestamp:performance.now()),Va),set:e=>{Va=e,queueMicrotask(qa)}},za=e=>t=>"string"==typeof t&&t.startsWith(e),Ua=za("--"),Fa=za("var(--"),$a=e=>!!Fa(e)&&Wa.test(e.split("/*")[0].trim()),Wa=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Za={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Ha={...Za,transform:e=>ea(0,1,e)},Ga={...Za,default:1},Ka=e=>Math.round(1e5*e)/1e5,Ya=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Qa=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Xa=(e,t)=>s=>Boolean("string"==typeof s&&Qa.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),Ja=(e,t,s)=>r=>{if("string"!=typeof r)return r;const[n,a,i,o]=r.match(Ya);return{[e]:parseFloat(n),[t]:parseFloat(a),[s]:parseFloat(i),alpha:void 0!==o?parseFloat(o):1}},ei={...Za,transform:e=>Math.round((e=>ea(0,255,e))(e))},ti={test:Xa("rgb","red"),parse:Ja("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:r=1})=>"rgba("+ei.transform(e)+", "+ei.transform(t)+", "+ei.transform(s)+", "+Ka(Ha.transform(r))+")"};const si={test:Xa("#"),parse:function(e){let t="",s="",r="",n="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,s+=s,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}},transform:ti.transform},ri=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),ni=ri("deg"),ai=ri("%"),ii=ri("px"),oi=ri("vh"),li=ri("vw"),ci=(()=>({...ai,parse:e=>ai.parse(e)/100,transform:e=>ai.transform(100*e)}))(),di={test:Xa("hsl","hue"),parse:Ja("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:r=1})=>"hsla("+Math.round(e)+", "+ai.transform(Ka(t))+", "+ai.transform(Ka(s))+", "+Ka(Ha.transform(r))+")"},ui={test:e=>ti.test(e)||si.test(e)||di.test(e),parse:e=>ti.test(e)?ti.parse(e):di.test(e)?di.parse(e):si.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?ti.transform(e):di.transform(e),getAnimatableNone:e=>{const t=ui.parse(e);return t.alpha=0,ui.transform(t)}},mi=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const hi="number",pi="color",fi=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function gi(e){const t=e.toString(),s=[],r={color:[],number:[],var:[]},n=[];let a=0;const i=t.replace(fi,e=>(ui.test(e)?(r.color.push(a),n.push(pi),s.push(ui.parse(e))):e.startsWith("var(")?(r.var.push(a),n.push("var"),s.push(e)):(r.number.push(a),n.push(hi),s.push(parseFloat(e))),++a,"${}")).split("${}");return{values:s,split:i,indexes:r,types:n}}function xi(e){return gi(e).values}function vi(e){const{split:t,types:s}=gi(e),r=t.length;return e=>{let n="";for(let a=0;a<r;a++)if(n+=t[a],void 0!==e[a]){const t=s[a];n+=t===hi?Ka(e[a]):t===pi?ui.transform(e[a]):e[a]}return n}}const bi=e=>"number"==typeof e?0:ui.test(e)?ui.getAnimatableNone(e):e;const yi={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(Ya)?.length||0)+(e.match(mi)?.length||0)>0},parse:xi,createTransformer:vi,getAnimatableNone:function(e){const t=xi(e);return vi(e)(t.map(bi))}};function ji(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function wi(e,t){return s=>s>0?t:e}const Ni=(e,t,s)=>e+(t-e)*s,_i=(e,t,s)=>{const r=e*e,n=s*(t*t-r)+r;return n<0?0:Math.sqrt(n)},ki=[si,ti,di];function Si(e){const t=(s=e,ki.find(e=>e.test(s)));var s;if(!Boolean(t))return!1;let r=t.parse(e);return t===di&&(r=function({hue:e,saturation:t,lightness:s,alpha:r}){e/=360,s/=100;let n=0,a=0,i=0;if(t/=100){const r=s<.5?s*(1+t):s+t-s*t,o=2*s-r;n=ji(o,r,e+1/3),a=ji(o,r,e),i=ji(o,r,e-1/3)}else n=a=i=s;return{red:Math.round(255*n),green:Math.round(255*a),blue:Math.round(255*i),alpha:r}}(r)),r}const Ei=(e,t)=>{const s=Si(e),r=Si(t);if(!s||!r)return wi(e,t);const n={...s};return e=>(n.red=_i(s.red,r.red,e),n.green=_i(s.green,r.green,e),n.blue=_i(s.blue,r.blue,e),n.alpha=Ni(s.alpha,r.alpha,e),ti.transform(n))},Ri=new Set(["none","hidden"]);function Ci(e,t){return s=>Ni(e,t,s)}function Ai(e){return"number"==typeof e?Ci:"string"==typeof e?$a(e)?wi:ui.test(e)?Ei:Ii:Array.isArray(e)?Ti:"object"==typeof e?ui.test(e)?Ei:Pi:wi}function Ti(e,t){const s=[...e],r=s.length,n=e.map((e,s)=>Ai(e)(e,t[s]));return e=>{for(let t=0;t<r;t++)s[t]=n[t](e);return s}}function Pi(e,t){const s={...e,...t},r={};for(const n in s)void 0!==e[n]&&void 0!==t[n]&&(r[n]=Ai(e[n])(e[n],t[n]));return e=>{for(const t in r)s[t]=r[t](e);return s}}const Ii=(e,t)=>{const s=yi.createTransformer(t),r=gi(e),n=gi(t);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?Ri.has(e)&&!n.values.length||Ri.has(t)&&!r.values.length?function(e,t){return Ri.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):la(Ti(function(e,t){const s=[],r={color:0,var:0,number:0};for(let n=0;n<t.values.length;n++){const a=t.types[n],i=e.indexes[a][r[a]],o=e.values[i]??0;s[n]=o,r[a]++}return s}(r,n),n.values),s):wi(e,t)};function Di(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return Ni(e,t,s);return Ai(e)(e,t)}const Li=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>Da.update(t,e),stop:()=>La(t),now:()=>Oa.isProcessing?Oa.timestamp:Ba.now()}},Oi=(e,t,s=10)=>{let r="";const n=Math.max(Math.round(t/s),2);for(let a=0;a<n;a++)r+=Math.round(1e4*e(a/(n-1)))/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},Mi=2e4;function Vi(e){let t=0;let s=e.next(t);for(;!s.done&&t<Mi;)t+=50,s=e.next(t);return t>=Mi?1/0:t}function qi(e,t,s){const r=Math.max(t-5,0);return ha(s-e(r),t-r)}const Bi=100,zi=10,Ui=1,Fi=0,$i=800,Wi=.3,Zi=.3,Hi={granular:.01,default:2},Gi={granular:.005,default:.5},Ki=.01,Yi=10,Qi=.05,Xi=1,Ji=.001;function eo({duration:e=$i,bounce:t=Wi,velocity:s=Fi,mass:r=Ui}){let n,a,i=1-t;i=ea(Qi,Xi,i),e=ea(Ki,Yi,ma(e)),i<1?(n=t=>{const r=t*i,n=r*e,a=r-s,o=so(t,i),l=Math.exp(-n);return Ji-a/o*l},a=t=>{const r=t*i*e,a=r*s+s,o=Math.pow(i,2)*Math.pow(t,2)*e,l=Math.exp(-r),c=so(Math.pow(t,2),i);return(-n(t)+Ji>0?-1:1)*((a-o)*l)/c}):(n=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,a=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let r=s;for(let n=1;n<to;n++)r-=e(r)/t(r);return r}(n,a,5/e);if(e=ua(e),isNaN(o))return{stiffness:Bi,damping:zi,duration:e};{const t=Math.pow(o,2)*r;return{stiffness:t,damping:2*i*Math.sqrt(r*t),duration:e}}}const to=12;function so(e,t){return e*Math.sqrt(1-t*t)}const ro=["duration","bounce"],no=["stiffness","damping","mass"];function ao(e,t){return t.some(t=>void 0!==e[t])}function io(e=Zi,t=Wi){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:n}=s;const a=s.keyframes[0],i=s.keyframes[s.keyframes.length-1],o={done:!1,value:a},{stiffness:l,damping:c,mass:d,duration:u,velocity:m,isResolvedFromDuration:h}=function(e){let t={velocity:Fi,stiffness:Bi,damping:zi,mass:Ui,isResolvedFromDuration:!1,...e};if(!ao(e,no)&&ao(e,ro))if(e.visualDuration){const s=e.visualDuration,r=2*Math.PI/(1.2*s),n=r*r,a=2*ea(.05,1,1-(e.bounce||0))*Math.sqrt(n);t={...t,mass:Ui,stiffness:n,damping:a}}else{const s=eo(e);t={...t,...s,mass:Ui},t.isResolvedFromDuration=!0}return t}({...s,velocity:-ma(s.velocity||0)}),p=m||0,f=c/(2*Math.sqrt(l*d)),g=i-a,x=ma(Math.sqrt(l/d)),v=Math.abs(g)<5;let b;if(r||(r=v?Hi.granular:Hi.default),n||(n=v?Gi.granular:Gi.default),f<1){const e=so(x,f);b=t=>{const s=Math.exp(-f*x*t);return i-s*((p+f*x*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===f)b=e=>i-Math.exp(-x*e)*(g+(p+x*g)*e);else{const e=x*Math.sqrt(f*f-1);b=t=>{const s=Math.exp(-f*x*t),r=Math.min(e*t,300);return i-s*((p+f*x*g)*Math.sinh(r)+e*g*Math.cosh(r))/e}}const y={calculatedDuration:h&&u||null,next:e=>{const t=b(e);if(h)o.done=e>=u;else{let s=0===e?p:0;f<1&&(s=0===e?ua(p):qi(b,e,t));const a=Math.abs(s)<=r,l=Math.abs(i-t)<=n;o.done=a&&l}return o.value=o.done?i:t,o},toString:()=>{const e=Math.min(Vi(y),Mi),t=Oi(t=>y.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return y}function oo({keyframes:e,velocity:t=0,power:s=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:a=500,modifyTarget:i,min:o,max:l,restDelta:c=.5,restSpeed:d}){const u=e[0],m={done:!1,value:u},h=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let p=s*t;const f=u+p,g=void 0===i?f:i(f);g!==f&&(p=g-u);const x=e=>-p*Math.exp(-e/r),v=e=>g+x(e),b=e=>{const t=x(e),s=v(e);m.done=Math.abs(t)<=c,m.value=m.done?g:s};let y,j;const w=e=>{var t;(t=m.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(y=e,j=io({keyframes:[m.value,h(m.value)],velocity:qi(v,e,m.value),damping:n,stiffness:a,restDelta:c,restSpeed:d}))};return w(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==y||(t=!0,b(e),w(e)),void 0!==y&&e>=y?j.next(e-y):(!t&&b(e),m)}}}function lo(e,t,{clamp:s=!0,ease:r,mixer:n}={}){const a=e.length;if(t.length,1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const r=[],n=s||ta.mix||Di,a=e.length-1;for(let i=0;i<a;i++){let s=n(e[i],e[i+1]);if(t){const e=Array.isArray(t)?t[i]||ia:t;s=la(e,s)}r.push(s)}return r}(t,r,n),l=o.length,c=s=>{if(i&&s<e[0])return t[0];let r=0;if(l>1)for(;r<e.length-2&&!(s<e[r+1]);r++);const n=ca(e[r],e[r+1],s);return o[r](n)};return s?t=>c(ea(e[0],e[a-1],t)):c}function co(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let r=1;r<=t;r++){const n=ca(0,t,r);e.push(Ni(s,1,n))}}(t,e.length-1),t}function uo({duration:e=300,keyframes:t,times:s,ease:r="easeInOut"}){const n=(e=>Array.isArray(e)&&"number"!=typeof e[0])(r)?r.map(Aa):Aa(r),a={done:!1,value:t[0]},i=function(e,t){return e.map(e=>e*t)}(s&&s.length===t.length?s:co(t),e),o=lo(i,t,{ease:Array.isArray(n)?n:(l=t,c=n,l.map(()=>c||Ea).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(a.value=o(t),a.done=t>=e,a)}}io.applyToOptions=e=>{const t=function(e,t=100,s){const r=s({...e,keyframes:[0,t]}),n=Math.min(Vi(r),Mi);return{type:"keyframes",ease:e=>r.next(n*e).value/t,duration:ma(n)}}(e,100,io);return e.ease=t.ease,e.duration=ua(t.duration),e.type="keyframes",e};const mo=e=>null!==e;function ho(e,{repeat:t,repeatType:s="loop"},r,n=1){const a=e.filter(mo),i=n<0||t&&"loop"!==s&&t%2==1?0:a.length-1;return i&&void 0!==r?r:a[i]}const po={decay:oo,inertia:oo,tween:uo,keyframes:uo,spring:io};function fo(e){"string"==typeof e.type&&(e.type=po[e.type])}class go{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const xo=e=>e/100;class vo extends go{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Ba.now()&&this.tick(Ba.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;fo(e);const{type:t=uo,repeat:s=0,repeatDelay:r=0,repeatType:n,velocity:a=0}=e;let{keyframes:i}=e;const o=t||uo;o!==uo&&"number"!=typeof i[0]&&(this.mixKeyframes=la(xo,Di(i[0],i[1])),i=[0,100]);const l=o({...e,keyframes:i});"mirror"===n&&(this.mirroredGenerator=o({...e,keyframes:[...i].reverse(),velocity:-a})),null===l.calculatedDuration&&(l.calculatedDuration=Vi(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+r,this.totalDuration=this.resolvedDuration*(s+1)-r,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:r,mixKeyframes:n,mirroredGenerator:a,resolvedDuration:i,calculatedDuration:o}=this;if(null===this.startTime)return s.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:u,repeatDelay:m,type:h,onUpdate:p,finalKeyframe:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),x=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=r);let v=this.currentTime,b=s;if(d){const e=Math.min(this.currentTime,r)/i;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===u?(s=1-s,m&&(s-=m/i)):"mirror"===u&&(b=a)),v=ea(0,1,s)*i}const y=x?{done:!1,value:c[0]}:b.next(v);n&&(y.value=n(y.value));let{done:j}=y;x||null===o||(j=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&j);return w&&h!==oo&&(y.value=ho(c,this.options,f,this.speed)),p&&p(y.value),w&&this.finish(),y}then(e,t){return this.finished.then(e,t)}get duration(){return ma(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ma(e)}get time(){return ma(this.currentTime)}set time(e){e=ua(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Ba.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=ma(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=Li,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();const s=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=s):null!==this.holdTime?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ba.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}const bo=e=>180*e/Math.PI,yo=e=>{const t=bo(Math.atan2(e[1],e[0]));return wo(t)},jo={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:yo,rotateZ:yo,skewX:e=>bo(Math.atan(e[1])),skewY:e=>bo(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},wo=e=>((e%=360)<0&&(e+=360),e),No=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),_o=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),ko={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:No,scaleY:_o,scale:e=>(No(e)+_o(e))/2,rotateX:e=>wo(bo(Math.atan2(e[6],e[5]))),rotateY:e=>wo(bo(Math.atan2(-e[2],e[0]))),rotateZ:yo,rotate:yo,skewX:e=>bo(Math.atan(e[4])),skewY:e=>bo(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function So(e){return e.includes("scale")?1:0}function Eo(e,t){if(!e||"none"===e)return So(t);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,n;if(s)r=ko,n=s;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=jo,n=t}if(!n)return So(t);const a=r[t],i=n[1].split(",").map(Ro);return"function"==typeof a?a(i):i[a]}function Ro(e){return parseFloat(e.trim())}const Co=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ao=(()=>new Set(Co))(),To=e=>e===Za||e===ii,Po=new Set(["x","y","z"]),Io=Co.filter(e=>!Po.has(e));const Do={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Eo(t,"x"),y:(e,{transform:t})=>Eo(t,"y")};Do.translateX=Do.x,Do.translateY=Do.y;const Lo=new Set;let Oo=!1,Mo=!1,Vo=!1;function qo(){if(Mo){const e=Array.from(Lo).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),s=new Map;t.forEach(e=>{const t=function(e){const t=[];return Io.forEach(s=>{const r=e.getValue(s);void 0!==r&&(t.push([s,r.get()]),r.set(s.startsWith("scale")?1:0))}),t}(e);t.length&&(s.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=s.get(e);t&&t.forEach(([t,s])=>{e.getValue(t)?.set(s)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}Mo=!1,Oo=!1,Lo.forEach(e=>e.complete(Vo)),Lo.clear()}function Bo(){Lo.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Mo=!0)})}class zo{constructor(e,t,s,r,n,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=r,this.element=n,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(Lo.add(this),Oo||(Oo=!0,Da.read(Bo),Da.resolveKeyframes(qo))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:r}=this;if(null===e[0]){const n=r?.get(),a=e[e.length-1];if(void 0!==n)e[0]=n;else if(s&&t){const r=s.readValue(t,a);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=a),r&&void 0===n&&r.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Lo.delete(this)}cancel(){"scheduled"===this.state&&(Lo.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const Uo=aa(()=>void 0!==window.ScrollTimeline),Fo={};function $o(e,t){const s=aa(e);return()=>Fo[t]??s()}const Wo=$o(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),Zo=([e,t,s,r])=>`cubic-bezier(${e}, ${t}, ${s}, ${r})`,Ho={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Zo([0,.65,.55,1]),circOut:Zo([.55,0,1,.45]),backIn:Zo([.31,.01,.66,-.59]),backOut:Zo([.33,1.53,.69,.99])};function Go(e,t){return e?"function"==typeof e?Wo()?Oi(e,t):"ease-out":Ra(e)?Zo(e):Array.isArray(e)?e.map(e=>Go(e,t)||Ho.easeOut):Ho[e]:void 0}function Ko(e,t,s,{delay:r=0,duration:n=300,repeat:a=0,repeatType:i="loop",ease:o="easeOut",times:l}={},c=void 0){const d={[t]:s};l&&(d.offset=l);const u=Go(o,n);Array.isArray(u)&&(d.easing=u);const m={delay:r,duration:n,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===i?"alternate":"normal"};c&&(m.pseudoElement=c);return e.animate(d,m)}function Yo(e){return"function"==typeof e&&"applyToOptions"in e}class Qo extends go{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:r,pseudoElement:n,allowFlatten:a=!1,finalKeyframe:i,onComplete:o}=e;this.isPseudoElement=Boolean(n),this.allowFlatten=a,this.options=e,e.type;const l=function({type:e,...t}){return Yo(e)&&Wo()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Ko(t,s,r,l,n),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!n){const e=ho(r,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,s){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,s):e.style[t]=s}(t,s,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return ma(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ma(e)}get time(){return ma(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ua(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Uo()?(this.animation.timeline=e,ia):t(this)}}const Xo={anticipate:ja,backInOut:ya,circInOut:_a};function Jo(e){"string"==typeof e.ease&&e.ease in Xo&&(e.ease=Xo[e.ease])}class el extends Qo{constructor(e){Jo(e),fo(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:r,element:n,...a}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const i=new vo({...a,autoplay:!1}),o=ua(this.finishedTime??this.time);t.setWithVelocity(i.sample(o-10).value,i.sample(o).value,10),i.stop()}}const tl=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!yi.test(e)&&"0"!==e||e.startsWith("url(")));function sl(e){e.duration=0,e.type="keyframes"}const rl=new Set(["opacity","clipPath","filter","transform"]),nl=aa(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class al extends go{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:a="loop",keyframes:i,name:o,motionValue:l,element:c,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ba.now();const u={autoplay:e,delay:t,type:s,repeat:r,repeatDelay:n,repeatType:a,name:o,motionValue:l,element:c,...d},m=c?.KeyframeResolver||zo;this.keyframeResolver=new m(i,(e,t,s)=>this.onKeyframesResolved(e,t,u,!s),o,l,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,r){this.keyframeResolver=void 0;const{name:n,type:a,velocity:i,delay:o,isHandoff:l,onUpdate:c}=s;this.resolvedAt=Ba.now(),function(e,t,s,r){const n=e[0];if(null===n)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],i=tl(n,t),o=tl(a,t);return!(!i||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Yo(s))&&r)}(e,n,a,i)||(!ta.instantAnimations&&o||c?.(ho(e,s,t)),e[0]=e[e.length-1],sl(s),s.repeat=0);const d={startTime:r?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},u=!l&&function(e){const{motionValue:t,name:s,repeatDelay:r,repeatType:n,damping:a,type:i}=e,o=t?.owner?.current;if(!(o instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=t.owner.getProps();return nl()&&s&&rl.has(s)&&("transform"!==s||!c)&&!l&&!r&&"mirror"!==n&&0!==a&&"inertia"!==i}(d)?new el({...d,element:d.motionValue.owner.current}):new vo(d);u.finished.then(()=>this.notifyFinished()).catch(ia),this.pendingTimeline&&(this.stopTimeline=u.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=u}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Vo=!0,Bo(),qo(),Vo=!1),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const il=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ol(e,t,s=1){const[r,n]=function(e){const t=il.exec(e);if(!t)return[,];const[,s,r,n]=t;return[`--${s??r}`,n]}(e);if(!r)return;const a=window.getComputedStyle(t).getPropertyValue(r);if(a){const e=a.trim();return sa(e)?parseFloat(e):e}return $a(n)?ol(n,t,s+1):n}function ll(e,t){return e?.[t]??e?.default??e}const cl=new Set(["width","height","top","left","right","bottom",...Co]),dl=e=>t=>t.test(e),ul=[Za,ii,ai,ni,li,oi,{test:e=>"auto"===e,parse:e=>e}],ml=e=>ul.find(dl(e));function hl(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||na(e))}const pl=new Set(["brightness","contrast","saturate","opacity"]);function fl(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[r]=s.match(Ya)||[];if(!r)return e;const n=s.replace(r,"");let a=pl.has(t)?1:0;return r!==s&&(a*=100),t+"("+a+n+")"}const gl=/\b([a-z-]*)\(.*?\)/gu,xl={...yi,getAnimatableNone:e=>{const t=e.match(gl);return t?t.map(fl).join(" "):e}},vl={...Za,transform:Math.round},bl={borderWidth:ii,borderTopWidth:ii,borderRightWidth:ii,borderBottomWidth:ii,borderLeftWidth:ii,borderRadius:ii,radius:ii,borderTopLeftRadius:ii,borderTopRightRadius:ii,borderBottomRightRadius:ii,borderBottomLeftRadius:ii,width:ii,maxWidth:ii,height:ii,maxHeight:ii,top:ii,right:ii,bottom:ii,left:ii,padding:ii,paddingTop:ii,paddingRight:ii,paddingBottom:ii,paddingLeft:ii,margin:ii,marginTop:ii,marginRight:ii,marginBottom:ii,marginLeft:ii,backgroundPositionX:ii,backgroundPositionY:ii,...{rotate:ni,rotateX:ni,rotateY:ni,rotateZ:ni,scale:Ga,scaleX:Ga,scaleY:Ga,scaleZ:Ga,skew:ni,skewX:ni,skewY:ni,distance:ii,translateX:ii,translateY:ii,translateZ:ii,x:ii,y:ii,z:ii,perspective:ii,transformPerspective:ii,opacity:Ha,originX:ci,originY:ci,originZ:ii},zIndex:vl,fillOpacity:Ha,strokeOpacity:Ha,numOctaves:vl},yl={...bl,color:ui,backgroundColor:ui,outlineColor:ui,fill:ui,stroke:ui,borderColor:ui,borderTopColor:ui,borderRightColor:ui,borderBottomColor:ui,borderLeftColor:ui,filter:xl,WebkitFilter:xl},jl=e=>yl[e];function wl(e,t){let s=jl(e);return s!==xl&&(s=yi),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Nl=new Set(["auto","none","0"]);class _l extends zo{constructor(e,t,s,r,n){super(e,t,s,r,n,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),$a(s))){const r=ol(s,t.current);void 0!==r&&(e[o]=r),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!cl.has(s)||2!==e.length)return;const[r,n]=e,a=ml(r),i=ml(n);if(a!==i)if(To(a)&&To(i))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else Do[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(null===e[r]||hl(e[r]))&&s.push(r);s.length&&function(e,t,s){let r,n=0;for(;n<e.length&&!r;){const t=e[n];"string"==typeof t&&!Nl.has(t)&&gi(t).values.length&&(r=e[n]),n++}if(r&&s)for(const a of t)e[a]=wl(s,r)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Do[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];void 0!==r&&e.getValue(s,r).jump(r,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const n=s.length-1,a=s[n];s[n]=Do[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,s])=>{e.getValue(t).set(s)}),this.resolveNoneKeyframes()}}const kl=(e,t)=>t&&"number"==typeof e?t.transform(e):e;function Sl(e){return ra(e)&&"offsetHeight"in e}class El{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=Ba.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Ba.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new da);const s=this.events[e].add(t);return"change"===e?()=>{s(),Da.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ba.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return ha(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Rl(e,t){return new El(e,t)}const{schedule:Cl,cancel:Al}=Ia(queueMicrotask,!1),Tl={x:!1,y:!1};function Pl(){return Tl.x||Tl.y}function Il(e,t){const s=function(e){if(e instanceof EventTarget)return[e];if("string"==typeof e){const t=document.querySelectorAll(e);return t?Array.from(t):[]}return Array.from(e)}(e),r=new AbortController;return[s,{passive:!0,...t,signal:r.signal},()=>r.abort()]}function Dl(e){return!("touch"===e.pointerType||Pl())}const Ll=(e,t)=>!!t&&(e===t||Ll(e,t.parentElement)),Ol=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Ml=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Vl=new WeakSet;function ql(e){return t=>{"Enter"===t.key&&e(t)}}function Bl(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function zl(e){return Ol(e)&&!Pl()}function Ul(e,t,s={}){const[r,n,a]=Il(e,s),i=e=>{const r=e.currentTarget;if(!zl(e))return;Vl.add(r);const a=t(r,e),i=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Vl.has(r)&&Vl.delete(r),zl(e)&&"function"==typeof a&&a(e,{success:t})},o=e=>{i(e,r===window||r===document||s.useGlobalTarget||Ll(r,e.target))},l=e=>{i(e,!1)};window.addEventListener("pointerup",o,n),window.addEventListener("pointercancel",l,n)};return r.forEach(e=>{var t;(s.useGlobalTarget?window:e).addEventListener("pointerdown",i,n),Sl(e)&&(e.addEventListener("focus",e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const r=ql(()=>{if(Vl.has(s))return;Bl(s,"down");const e=ql(()=>{Bl(s,"up")});s.addEventListener("keyup",e,t),s.addEventListener("blur",()=>Bl(s,"cancel"),t)});s.addEventListener("keydown",r,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",r),t)})(e,n)),t=e,Ml.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),a}function Fl(e){return ra(e)&&"ownerSVGElement"in e}const $l=e=>Boolean(e&&e.getVelocity),Wl=[...ul,ui,yi],Zl=s.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Hl(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Gl(...e){return s.useCallback(function(...e){return t=>{let s=!1;const r=e.map(e=>{const r=Hl(e,t);return s||"function"!=typeof r||(s=!0),r});if(s)return()=>{for(let t=0;t<r.length;t++){const s=r[t];"function"==typeof s?s():Hl(e[t],null)}}}}(...e),e)}class Kl extends s.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,s=Sl(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=s-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Yl({children:e,isPresent:t,anchorX:n,root:a}){const i=s.useId(),o=s.useRef(null),l=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=s.useContext(Zl),d=Gl(o,e?.ref);return s.useInsertionEffect(()=>{const{width:e,height:s,top:r,left:d,right:u}=l.current;if(t||!o.current||!e||!s)return;const m="left"===n?`left: ${d}`:`right: ${u}`;o.current.dataset.motionPopId=i;const h=document.createElement("style");c&&(h.nonce=c);const p=a??document.head;return p.appendChild(h),h.sheet&&h.sheet.insertRule(`\n          [data-motion-pop-id="${i}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${s}px !important;\n            ${m}px !important;\n            top: ${r}px !important;\n          }\n        `),()=>{p.contains(h)&&p.removeChild(h)}},[t]),r.jsx(Kl,{isPresent:t,childRef:o,sizeRef:l,children:s.cloneElement(e,{ref:d})})}const Ql=({children:e,initial:t,isPresent:n,onExitComplete:a,custom:i,presenceAffectsLayout:o,mode:l,anchorX:c,root:d})=>{const u=Gn(Xl),m=s.useId();let h=!0,p=s.useMemo(()=>(h=!1,{id:m,initial:t,isPresent:n,custom:i,onExitComplete:e=>{u.set(e,!0);for(const t of u.values())if(!t)return;a&&a()},register:e=>(u.set(e,!1),()=>u.delete(e))}),[n,u,a]);return o&&h&&(p={...p}),s.useMemo(()=>{u.forEach((e,t)=>u.set(t,!1))},[n]),s.useEffect(()=>{!n&&!u.size&&a&&a()},[n]),"popLayout"===l&&(e=r.jsx(Yl,{isPresent:n,anchorX:c,root:d,children:e})),r.jsx(Qn.Provider,{value:p,children:e})};function Xl(){return new Map}function Jl(e=!0){const t=s.useContext(Qn);if(null===t)return[!0,null];const{isPresent:r,onExitComplete:n,register:a}=t,i=s.useId();s.useEffect(()=>{if(e)return a(i)},[e]);const o=s.useCallback(()=>e&&n&&n(i),[i,n,e]);return!r&&n?[!1,o]:[!0]}const ec=e=>e.key||"";function tc(e){const t=[];return s.Children.forEach(e,e=>{s.isValidElement(e)&&t.push(e)}),t}const sc=({children:e,custom:t,initial:n=!0,onExitComplete:a,presenceAffectsLayout:i=!0,mode:o="sync",propagate:l=!1,anchorX:c="left",root:d})=>{const[u,m]=Jl(l),h=s.useMemo(()=>tc(e),[e]),p=l&&!u?[]:h.map(ec),f=s.useRef(!0),g=s.useRef(h),x=Gn(()=>new Map),[v,b]=s.useState(h),[y,j]=s.useState(h);Yn(()=>{f.current=!1,g.current=h;for(let e=0;e<y.length;e++){const t=ec(y[e]);p.includes(t)?x.delete(t):!0!==x.get(t)&&x.set(t,!1)}},[y,p.length,p.join("-")]);const w=[];if(h!==v){let e=[...h];for(let t=0;t<y.length;t++){const s=y[t],r=ec(s);p.includes(r)||(e.splice(t,0,s),w.push(s))}return"wait"===o&&w.length&&(e=w),j(tc(e)),b(h),null}const{forceRender:N}=s.useContext(Hn);return r.jsx(r.Fragment,{children:y.map(e=>{const s=ec(e),v=!(l&&!u)&&(h===y||p.includes(s));return r.jsx(Ql,{isPresent:v,initial:!(f.current&&!n)&&void 0,custom:t,presenceAffectsLayout:i,mode:o,root:d,onExitComplete:v?void 0:()=>{if(!x.has(s))return;x.set(s,!0);let e=!0;x.forEach(t=>{t||(e=!1)}),e&&(N?.(),j(g.current),l&&m?.(),a&&a())},anchorX:c,children:e},s)})})},rc=s.createContext({strict:!1}),nc={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ac={};for(const q_ in nc)ac[q_]={isEnabled:e=>nc[q_].some(t=>!!e[t])};const ic=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function oc(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||ic.has(e)}let lc=e=>!oc(e);try{"function"==typeof(cc=require("@emotion/is-prop-valid").default)&&(lc=e=>e.startsWith("on")?!oc(e):cc(e))}catch{}var cc;const dc=s.createContext({});function uc(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function mc(e){return"string"==typeof e||Array.isArray(e)}const hc=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],pc=["initial",...hc];function fc(e){return uc(e.animate)||pc.some(t=>mc(e[t]))}function gc(e){return Boolean(fc(e)||e.variants)}function xc(e){const{initial:t,animate:r}=function(e,t){if(fc(e)){const{initial:t,animate:s}=e;return{initial:!1===t||mc(t)?t:void 0,animate:mc(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,s.useContext(dc));return s.useMemo(()=>({initial:t,animate:r}),[vc(t),vc(r)])}function vc(e){return Array.isArray(e)?e.join(" "):e}const bc={};function yc(e,{layout:t,layoutId:s}){return Ao.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!bc[e]||"opacity"===e)}const jc={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},wc=Co.length;function Nc(e,t,s){const{style:r,vars:n,transformOrigin:a}=e;let i=!1,o=!1;for(const l in t){const e=t[l];if(Ao.has(l))i=!0;else if(Ua(l))n[l]=e;else{const t=kl(e,bl[l]);l.startsWith("origin")?(o=!0,a[l]=t):r[l]=t}}if(t.transform||(i||s?r.transform=function(e,t,s){let r="",n=!0;for(let a=0;a<wc;a++){const i=Co[a],o=e[i];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(i.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=kl(o,bl[i]);l||(n=!1,r+=`${jc[i]||i}(${e}) `),s&&(t[i]=e)}}return r=r.trim(),s?r=s(t,n?"":r):n&&(r="none"),r}(t,e.transform,s):r.transform&&(r.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=a;r.transformOrigin=`${e} ${t} ${s}`}}const _c=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function kc(e,t,s){for(const r in t)$l(t[r])||yc(r,s)||(e[r]=t[r])}function Sc(e,t){const r={};return kc(r,e.style||{},e),Object.assign(r,function({transformTemplate:e},t){return s.useMemo(()=>{const s={style:{},transform:{},transformOrigin:{},vars:{}};return Nc(s,t,e),Object.assign({},s.vars,s.style)},[t])}(e,t)),r}function Ec(e,t){const s={},r=Sc(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=r,s}const Rc={offset:"stroke-dashoffset",array:"stroke-dasharray"},Cc={offset:"strokeDashoffset",array:"strokeDasharray"};function Ac(e,{attrX:t,attrY:s,attrScale:r,pathLength:n,pathSpacing:a=1,pathOffset:i=0,...o},l,c,d){if(Nc(e,o,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:m}=e;u.transform&&(m.transform=u.transform,delete u.transform),(m.transform||u.transformOrigin)&&(m.transformOrigin=u.transformOrigin??"50% 50%",delete u.transformOrigin),m.transform&&(m.transformBox=d?.transformBox??"fill-box",delete u.transformBox),void 0!==t&&(u.x=t),void 0!==s&&(u.y=s),void 0!==r&&(u.scale=r),void 0!==n&&function(e,t,s=1,r=0,n=!0){e.pathLength=1;const a=n?Rc:Cc;e[a.offset]=ii.transform(-r);const i=ii.transform(t),o=ii.transform(s);e[a.array]=`${i} ${o}`}(u,n,a,i,!1)}const Tc=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Pc=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Ic(e,t,r,n){const a=s.useMemo(()=>{const s={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Ac(s,t,Pc(n),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const t={};kc(t,e.style,e),a.style={...t,...a.style}}return a}const Dc=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Lc(e){return"string"==typeof e&&!e.includes("-")&&!!(Dc.indexOf(e)>-1||/[A-Z]/u.test(e))}function Oc(e,t,r,{latestValues:n},a,i=!1){const o=(Lc(e)?Ic:Ec)(t,n,a,e),l=function(e,t,s){const r={};for(const n in e)"values"===n&&"object"==typeof e.values||(lc(n)||!0===s&&oc(n)||!t&&!oc(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}(t,"string"==typeof e,i),c=e!==s.Fragment?{...l,...o,ref:r}:{},{children:d}=t,u=s.useMemo(()=>$l(d)?d.get():d,[d]);return s.createElement(e,{...c,children:u})}function Mc(e){const t=[{},{}];return e?.values.forEach((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()}),t}function Vc(e,t,s,r){if("function"==typeof t){const[n,a]=Mc(r);t=t(void 0!==s?s:e.custom,n,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[n,a]=Mc(r);t=t(void 0!==s?s:e.custom,n,a)}return t}function qc(e){return $l(e)?e.get():e}function Bc(e,t,s,r){const n={},a=r(e,{});for(const m in a)n[m]=qc(a[m]);let{initial:i,animate:o}=e;const l=fc(e),c=gc(e);t&&c&&!l&&!1!==e.inherit&&(void 0===i&&(i=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===i;const u=d?o:i;if(u&&"boolean"!=typeof u&&!uc(u)){const t=Array.isArray(u)?u:[u];for(let s=0;s<t.length;s++){const r=Vc(e,t[s]);if(r){const{transitionEnd:e,transition:t,...s}=r;for(const r in s){let e=s[r];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(n[r]=e)}for(const r in e)n[r]=e[r]}}}return n}const zc=e=>(t,r)=>{const n=s.useContext(dc),a=s.useContext(Qn),i=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},s,r,n){return{latestValues:Bc(s,r,n,e),renderState:t()}}(e,t,n,a);return r?i():Gn(i)};function Uc(e,t,s){const{style:r}=e,n={};for(const a in r)($l(r[a])||t.style&&$l(t.style[a])||yc(a,e)||void 0!==s?.getValue(a)?.liveStyle)&&(n[a]=r[a]);return n}const Fc=zc({scrapeMotionValuesFromProps:Uc,createRenderState:_c});function $c(e,t,s){const r=Uc(e,t,s);for(const n in e)if($l(e[n])||$l(t[n])){r[-1!==Co.indexOf(n)?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n]=e[n]}return r}const Wc=zc({scrapeMotionValuesFromProps:$c,createRenderState:Tc}),Zc=Symbol.for("motionComponentSymbol");function Hc(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Gc(e,t,r){return s.useCallback(s=>{s&&e.onMount&&e.onMount(s),t&&(s?t.mount(s):t.unmount()),r&&("function"==typeof r?r(s):Hc(r)&&(r.current=s))},[t])}const Kc=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Yc="data-"+Kc("framerAppearId"),Qc=s.createContext({});function Xc(e,t,r,n,a){const{visualElement:i}=s.useContext(dc),o=s.useContext(rc),l=s.useContext(Qn),c=s.useContext(Zl).reducedMotion,d=s.useRef(null);n=n||o.renderer,!d.current&&n&&(d.current=n(e,{visualState:t,parent:i,props:r,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const u=d.current,m=s.useContext(Qc);!u||u.projection||!a||"html"!==u.type&&"svg"!==u.type||function(e,t,s,r){const{layoutId:n,layout:a,drag:i,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Jc(e.parent)),e.projection.setOptions({layoutId:n,layout:a,alwaysMeasureLayout:Boolean(i)||o&&Hc(o),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:c})}(d.current,r,a,m);const h=s.useRef(!1);s.useInsertionEffect(()=>{u&&h.current&&u.update(r,l)});const p=r[Yc],f=s.useRef(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Yn(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),f.current&&u.animationState&&u.animationState.animateChanges())}),s.useEffect(()=>{u&&(!f.current&&u.animationState&&u.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),f.current=!1),u.enteringChildren=void 0)}),u}function Jc(e){if(e)return!1!==e.options.allowProjection?e.projection:Jc(e.parent)}function ed(e,{forwardMotionProps:t=!1}={},n,a){n&&function(e){for(const t in e)ac[t]={...ac[t],...e[t]}}(n);const i=Lc(e)?Wc:Fc;function o(n,o){let l;const c={...s.useContext(Zl),...n,layoutId:td(n)},{isStatic:d}=c,u=xc(n),m=i(n,d);if(!d&&Kn){s.useContext(rc).strict;const t=function(e){const{drag:t,layout:s}=ac;if(!t&&!s)return{};const r={...t,...s};return{MeasureLayout:t?.isEnabled(e)||s?.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(c);l=t.MeasureLayout,u.visualElement=Xc(e,m,c,a,t.ProjectionNode)}return r.jsxs(dc.Provider,{value:u,children:[l&&u.visualElement?r.jsx(l,{visualElement:u.visualElement,...c}):null,Oc(e,n,Gc(m,u.visualElement,o),m,d,t)]})}o.displayName=`motion.${"string"==typeof e?e:`create(${e.displayName??e.name??""})`}`;const l=s.forwardRef(o);return l[Zc]=e,l}function td({layoutId:e}){const t=s.useContext(Hn).id;return t&&void 0!==e?t+"-"+e:e}function sd(e,t){if("undefined"==typeof Proxy)return ed;const s=new Map,r=(s,r)=>ed(s,r,e,t);return new Proxy((e,t)=>r(e,t),{get:(n,a)=>"create"===a?r:(s.has(a)||s.set(a,ed(a,void 0,e,t)),s.get(a))})}function rd({top:e,left:t,right:s,bottom:r}){return{x:{min:t,max:s},y:{min:e,max:r}}}function nd(e){return void 0===e||1===e}function ad({scale:e,scaleX:t,scaleY:s}){return!nd(e)||!nd(t)||!nd(s)}function id(e){return ad(e)||od(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function od(e){return ld(e.x)||ld(e.y)}function ld(e){return e&&"0%"!==e}function cd(e,t,s){return s+t*(e-s)}function dd(e,t,s,r,n){return void 0!==n&&(e=cd(e,n,r)),cd(e,s,r)+t}function ud(e,t=0,s=1,r,n){e.min=dd(e.min,t,s,r,n),e.max=dd(e.max,t,s,r,n)}function md(e,{x:t,y:s}){ud(e.x,t.translate,t.scale,t.originPoint),ud(e.y,s.translate,s.scale,s.originPoint)}const hd=.999999999999,pd=1.0000000000001;function fd(e,t){e.min=e.min+t,e.max=e.max+t}function gd(e,t,s,r,n=.5){ud(e,t,s,Ni(e.min,e.max,n),r)}function xd(e,t){gd(e.x,t.x,t.scaleX,t.scale,t.originX),gd(e.y,t.y,t.scaleY,t.scale,t.originY)}function vd(e,t){return rd(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),t))}const bd=()=>({x:{min:0,max:0},y:{min:0,max:0}}),yd={current:null},jd={current:!1};function wd(){if(jd.current=!0,Kn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>yd.current=e.matches;e.addEventListener("change",t),t()}else yd.current=!1}const Nd=new WeakMap;const _d=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class kd{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:n,visualState:a},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=zo,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Ba.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Da.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=a;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=i,this.blockInitialAnimation=Boolean(n),this.isControllingVariants=fc(t),this.isVariantNode=gc(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const u in d){const e=d[u];void 0!==o[u]&&$l(e)&&e.set(o[u])}}mount(e){this.current=e,Nd.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),jd.current||wd(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||yd.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),La(this.notifyUpdate),La(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=Ao.has(e);s&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Da.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in ac){const t=ac[e];if(!t)continue;const{isEnabled:s,Feature:r}=t;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<_d.length;s++){const t=_d[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,t,s){for(const r in t){const n=t[r],a=s[r];if($l(n))e.addValue(r,n);else if($l(a))e.addValue(r,Rl(n,{owner:e}));else if(a!==n)if(e.hasValue(r)){const t=e.getValue(r);!0===t.liveStyle?t.jump(n):t.hasAnimated||t.set(n)}else{const t=e.getStaticValue(r);e.addValue(r,Rl(void 0!==t?t:n,{owner:e}))}}for(const r in s)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=Rl(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=s&&("string"==typeof s&&(sa(s)||na(s))?s=parseFloat(s):(r=s,!Wl.find(dl(r))&&yi.test(t)&&(s=wl(e,t))),this.setBaseTarget(e,$l(s)?s.get():s)),$l(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if("string"==typeof t||"object"==typeof t){const r=Vc(this.props,t,this.presenceContext?.custom);r&&(s=r[e])}if(t&&void 0!==s)return s;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||$l(r)?void 0!==this.initialValues[e]&&void 0===s?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new da),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Cl.render(this.render)}}class Sd extends kd{constructor(){super(...arguments),this.KeyframeResolver=_l}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;$l(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function Ed(e,{style:t,vars:s},r,n){const a=e.style;let i;for(i in t)a[i]=t[i];for(i in n?.applyProjectionStyles(a,r),s)a.setProperty(i,s[i])}class Rd extends Sd{constructor(){super(...arguments),this.type="html",this.renderInstance=Ed}readValueFromInstance(e,t){if(Ao.has(t))return this.projection?.isProjecting?So(t):((e,t)=>{const{transform:s="none"}=getComputedStyle(e);return Eo(s,t)})(e,t);{const r=(s=e,window.getComputedStyle(s)),n=(Ua(t)?r.getPropertyValue(t):r[t])||0;return"string"==typeof n?n.trim():n}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return vd(e,t)}build(e,t,s){Nc(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Uc(e,t,s)}}const Cd=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class Ad extends Sd{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=bd}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Ao.has(t)){const e=jl(t);return e&&e.default||0}return t=Cd.has(t)?t:Kc(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return $c(e,t,s)}build(e,t,s){Ac(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,r){!function(e,t,s,r){Ed(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(Cd.has(n)?n:Kc(n),t.attrs[n])}(e,t,0,r)}mount(e){this.isSVGTag=Pc(e.tagName),super.mount(e)}}const Td=(e,t)=>Lc(e)?new Ad(t):new Rd(t,{allowProjection:e!==s.Fragment});function Pd(e,t,s){const r=e.getProps();return Vc(r,t,void 0!==s?s:r.custom,e)}const Id=e=>Array.isArray(e);function Dd(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Rl(s))}function Ld(e){return Id(e)?e[e.length-1]||0:e}function Od(e,t){const s=e.getValue("willChange");if(r=s,Boolean($l(r)&&r.add))return s.add(t);if(!s&&ta.WillChange){const s=new ta.WillChange("auto");e.addValue("willChange",s),s.add(t)}var r}function Md(e){return e.props[Yc]}const Vd=e=>null!==e;const qd={type:"spring",stiffness:500,damping:25,restSpeed:10},Bd={type:"keyframes",duration:.8},zd={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ud=(e,{keyframes:t})=>t.length>2?Bd:Ao.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:qd:zd;const Fd=(e,t,s,r={},n,a)=>i=>{const o=ll(r,e)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c-=ua(l);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{i(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:a?void 0:n};(function({when:e,delay:t,delayChildren:s,staggerChildren:r,staggerDirection:n,repeat:a,repeatType:i,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||Object.assign(d,Ud(e,d)),d.duration&&(d.duration=ua(d.duration)),d.repeatDelay&&(d.repeatDelay=ua(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let u=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(sl(d),0===d.delay&&(u=!0)),(ta.instantAnimations||ta.skipAnimations)&&(u=!0,sl(d),d.delay=0),d.allowFlatten=!o.type&&!o.ease,u&&!a&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:s="loop"},r){const n=e.filter(Vd),a=t&&"loop"!==s&&t%2==1?0:n.length-1;return a&&void 0!==r?r:n[a]}(d.keyframes,o);if(void 0!==e)return void Da.update(()=>{d.onUpdate(e),d.onComplete()})}return o.isSync?new vo(d):new al(d)};function $d({protectedKeys:e,needsAnimating:t},s){const r=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,r}function Wd(e,t,{delay:s=0,transitionOverride:r,type:n}={}){let{transition:a=e.getDefaultTransition(),transitionEnd:i,...o}=t;r&&(a=r);const l=[],c=n&&e.animationState&&e.animationState.getState()[n];for(const d in o){const t=e.getValue(d,e.latestValues[d]??null),r=o[d];if(void 0===r||c&&$d(c,d))continue;const n={delay:s,...ll(a||{},d)},i=t.get();if(void 0!==i&&!t.isAnimating&&!Array.isArray(r)&&r===i&&!n.velocity)continue;let u=!1;if(window.MotionHandoffAnimation){const t=Md(e);if(t){const e=window.MotionHandoffAnimation(t,d,Da);null!==e&&(n.startTime=e,u=!0)}}Od(e,d),t.start(Fd(d,t,r,e.shouldReduceMotion&&cl.has(d)?{type:!1}:n,e,u));const m=t.animation;m&&l.push(m)}return i&&Promise.all(l).then(()=>{Da.update(()=>{i&&function(e,t){const s=Pd(e,t);let{transitionEnd:r={},transition:n={},...a}=s||{};a={...a,...r};for(const i in a)Dd(e,i,Ld(a[i]))}(e,i)})}),l}function Zd(e,t,s,r=0,n=1){const a=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),i=e.size,o=(i-1)*r;return"function"==typeof s?s(a,i):1===n?a*r:o-a*r}function Hd(e,t,s={}){const r=Pd(e,t,"exit"===s.type?e.presenceContext?.custom:void 0);let{transition:n=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(n=s.transitionOverride);const a=r?()=>Promise.all(Wd(e,r,s)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:a=0,staggerChildren:i,staggerDirection:o}=n;return function(e,t,s=0,r=0,n=0,a=1,i){const o=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),o.push(Hd(l,t,{...i,delay:s+("function"==typeof r?0:r)+Zd(e.variantChildren,l,r,n,a)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(o)}(e,t,r,a,i,o,s)}:()=>Promise.resolve(),{when:o}=n;if(o){const[e,t]="beforeChildren"===o?[a,i]:[i,a];return e().then(()=>t())}return Promise.all([a(),i(s.delay)])}function Gd(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let r=0;r<s;r++)if(t[r]!==e[r])return!1;return!0}const Kd=pc.length;function Yd(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Yd(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<Kd;s++){const r=pc[s],n=e.props[r];(mc(n)||!1===n)&&(t[r]=n)}return t}const Qd=[...hc].reverse(),Xd=hc.length;function Jd(e){return t=>Promise.all(t.map(({animation:t,options:s})=>function(e,t,s={}){let r;if(e.notify("AnimationStart",t),Array.isArray(t)){const n=t.map(t=>Hd(e,t,s));r=Promise.all(n)}else if("string"==typeof t)r=Hd(e,t,s);else{const n="function"==typeof t?Pd(e,t,s.custom):t;r=Promise.all(Wd(e,n,s))}return r.then(()=>{e.notify("AnimationComplete",t)})}(e,t,s)))}function eu(e){let t=Jd(e),s=ru(),r=!0;const n=t=>(s,r)=>{const n=Pd(e,r,"exit"===t?e.presenceContext?.custom:void 0);if(n){const{transition:e,transitionEnd:t,...r}=n;s={...s,...r,...t}}return s};function a(a){const{props:i}=e,o=Yd(e.parent)||{},l=[],c=new Set;let d={},u=1/0;for(let t=0;t<Xd;t++){const m=Qd[t],h=s[m],p=void 0!==i[m]?i[m]:o[m],f=mc(p),g=m===a?h.isActive:null;!1===g&&(u=t);let x=p===o[m]&&p!==i[m]&&f;if(x&&r&&e.manuallyAnimateOnMount&&(x=!1),h.protectedKeys={...d},!h.isActive&&null===g||!p&&!h.prevProp||uc(p)||"boolean"==typeof p)continue;const v=tu(h.prevProp,p);let b=v||m===a&&h.isActive&&!x&&f||t>u&&f,y=!1;const j=Array.isArray(p)?p:[p];let w=j.reduce(n(m),{});!1===g&&(w={});const{prevResolvedValues:N={}}=h,_={...N,...w},k=t=>{b=!0,c.has(t)&&(y=!0,c.delete(t)),h.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in _){const t=w[e],s=N[e];if(d.hasOwnProperty(e))continue;let r=!1;r=Id(t)&&Id(s)?!Gd(t,s):t!==s,r?null!=t?k(e):c.add(e):void 0!==t&&c.has(e)?k(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=w,h.isActive&&(d={...d,...w}),r&&e.blockInitialAnimation&&(b=!1);const S=x&&v;b&&(!S||y)&&l.push(...j.map(t=>{const s={type:m};if("string"==typeof t&&r&&!S&&e.manuallyAnimateOnMount&&e.parent){const{parent:r}=e,n=Pd(r,t);if(r.enteringChildren&&n){const{delayChildren:t}=n.transition||{};s.delay=Zd(r.enteringChildren,e,t)}}return{animation:t,options:s}}))}if(c.size){const t={};if("boolean"!=typeof i.initial){const s=Pd(e,Array.isArray(i.initial)?i.initial[0]:i.initial);s&&s.transition&&(t.transition=s.transition)}c.forEach(s=>{const r=e.getBaseTarget(s),n=e.getValue(s);n&&(n.liveStyle=!0),t[s]=r??null}),l.push({animation:t})}let m=Boolean(l.length);return!r||!1!==i.initial&&i.initial!==i.animate||e.manuallyAnimateOnMount||(m=!1),r=!1,m?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,r){if(s[t].isActive===r)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,r)),s[t].isActive=r;const n=a(t);for(const e in s)s[e].protectedKeys={};return n},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=ru()}}}function tu(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!Gd(t,e)}function su(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ru(){return{animate:su(!0),whileInView:su(),whileHover:su(),whileTap:su(),whileDrag:su(),whileFocus:su(),exit:su()}}class nu{constructor(e){this.isMounted=!1,this.node=e}update(){}}let au=0;const iu={animation:{Feature:class extends nu{constructor(e){super(e),e.animationState||(e.animationState=eu(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();uc(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends nu{constructor(){super(...arguments),this.id=au++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function ou(e,t,s,r={passive:!0}){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s)}function lu(e){return{point:{x:e.pageX,y:e.pageY}}}function cu(e,t,s,r){return ou(e,t,(e=>t=>Ol(t)&&e(t,lu(t)))(s),r)}function du(e){return e.max-e.min}function uu(e,t,s,r=.5){e.origin=r,e.originPoint=Ni(t.min,t.max,e.origin),e.scale=du(s)/du(t),e.translate=Ni(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function mu(e,t,s,r){uu(e.x,t.x,s.x,r?r.originX:void 0),uu(e.y,t.y,s.y,r?r.originY:void 0)}function hu(e,t,s){e.min=s.min+t.min,e.max=e.min+du(t)}function pu(e,t,s){e.min=t.min-s.min,e.max=e.min+du(t)}function fu(e,t,s){pu(e.x,t.x,s.x),pu(e.y,t.y,s.y)}function gu(e){return[e("x"),e("y")]}const xu=({current:e})=>e?e.ownerDocument.defaultView:null,vu=(e,t)=>Math.abs(e-t);class bu{constructor(e,t,{transformPagePoint:s,contextWindow:r=window,dragSnapToOrigin:n=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=wu(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=vu(e.x,t.x),r=vu(e.y,t.y);return Math.sqrt(s**2+r**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!s)return;const{point:r}=e,{timestamp:n}=Oa;this.history.push({...r,timestamp:n});const{onStart:a,onMove:i}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=yu(t,this.transformPagePoint),Da.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:r,resumeAnimation:n}=this.handlers;if(this.dragSnapToOrigin&&n&&n(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=wu("pointercancel"===e.type?this.lastMoveEventInfo:yu(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,a),r&&r(e,a)},!Ol(e))return;this.dragSnapToOrigin=n,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=r||window;const i=yu(lu(e),this.transformPagePoint),{point:o}=i,{timestamp:l}=Oa;this.history=[{...o,timestamp:l}];const{onSessionStart:c}=t;c&&c(e,wu(i,this.history)),this.removeListeners=la(cu(this.contextWindow,"pointermove",this.handlePointerMove),cu(this.contextWindow,"pointerup",this.handlePointerUp),cu(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),La(this.updatePoint)}}function yu(e,t){return t?{point:t(e.point)}:e}function ju(e,t){return{x:e.x-t.x,y:e.y-t.y}}function wu({point:e},t){return{point:e,delta:ju(e,_u(t)),offset:ju(e,Nu(t)),velocity:ku(t,.1)}}function Nu(e){return e[0]}function _u(e){return e[e.length-1]}function ku(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,r=null;const n=_u(e);for(;s>=0&&(r=e[s],!(n.timestamp-r.timestamp>ua(t)));)s--;if(!r)return{x:0,y:0};const a=ma(n.timestamp-r.timestamp);if(0===a)return{x:0,y:0};const i={x:(n.x-r.x)/a,y:(n.y-r.y)/a};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function Su(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function Eu(e,t){let s=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,r]=[r,s]),{min:s,max:r}}const Ru=.35;function Cu(e,t,s){return{min:Au(e,t),max:Au(e,s)}}function Au(e,t){return"number"==typeof e?e:e[t]||0}const Tu=new WeakMap;class Pu{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:n}=this.getProps();this.panSession=new bu(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(lu(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:r,onDragStart:n}=this.getProps();if(s&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=s)||"y"===a?Tl[a]?null:(Tl[a]=!0,()=>{Tl[a]=!1}):Tl.x||Tl.y?null:(Tl.x=Tl.y=!0,()=>{Tl.x=Tl.y=!1}),!this.openDragLock))return;var a;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),gu(e=>{let t=this.getAxisMotionValue(e).get()||0;if(ai.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const r=s.layout.layoutBox[e];if(r){t=du(r)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),n&&Da.postRender(()=>n(e,t)),Od(this.visualElement,"transform");const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:s,dragDirectionLock:r,onDirectionLock:n,onDrag:a}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:i}=t;if(r&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(i),void(null!==this.currentDirection&&n&&n(this.currentDirection));this.updateAxis("x",t.point,i),this.updateAxis("y",t.point,i),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>gu(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play())},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:n,distanceThreshold:s,contextWindow:xu(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,r=t||this.latestPanInfo,n=this.isDragging;if(this.cancel(),!n||!r||!s)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:i}=this.getProps();i&&Da.postRender(()=>i(s,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:r}=this.getProps();if(!s||!Iu(e,r,this.currentDirection))return;const n=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:s},r){return void 0!==t&&e<t?e=r?Ni(t,e,r.min):Math.max(e,t):void 0!==s&&e>s&&(e=r?Ni(s,e,r.max):Math.min(e,s)),e}(a,this.constraints[e],this.elastic[e])),n.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&Hc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!s)&&function(e,{top:t,left:s,bottom:r,right:n}){return{x:Su(e.x,s,n),y:Su(e.y,t,r)}}(s.layoutBox,e),this.elastic=function(e=Ru){return!1===e?e=0:!0===e&&(e=Ru),{x:Cu(e,"left","right"),y:Cu(e,"top","bottom")}}(t),r!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&gu(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(s.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Hc(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const n=function(e,t,s){const r=vd(e,s),{scroll:n}=t;return n&&(fd(r.x,n.offset.x),fd(r.y,n.offset.y)),r}(s,r.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Eu(e.x,t.x),y:Eu(e.y,t.y)}}(r.layout.layoutBox,n);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=rd(e))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:r,dragTransition:n,dragSnapToOrigin:a,onDragTransitionEnd:i}=this.getProps(),o=this.constraints||{},l=gu(i=>{if(!Iu(i,t,this.currentDirection))return;let l=o&&o[i]||{};a&&(l={min:0,max:0});const c=r?200:1e6,d=r?40:1e7,u={type:"inertia",velocity:s?e[i]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...n,...l};return this.startAxisValueAnimation(i,u)});return Promise.all(l).then(i)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Od(this.visualElement,e),s.start(Fd(e,s,0,t,this.visualElement,!1))}stopAnimation(){gu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){gu(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[t];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){gu(t=>{const{drag:s}=this.getProps();if(!Iu(t,s,this.currentDirection))return;const{projection:r}=this.visualElement,n=this.getAxisMotionValue(t);if(r&&r.layout){const{min:s,max:a}=r.layout.layoutBox[t];n.set(e[t]-Ni(s,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Hc(t)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};gu(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();r[e]=function(e,t){let s=.5;const r=du(e),n=du(t);return n>r?s=ca(t.min,t.max-r,e.min):r>n&&(s=ca(e.min,e.max-n,t.min)),ea(0,1,s)}({min:s,max:s},this.constraints[e])}});const{transformTemplate:n}=this.visualElement.getProps();this.visualElement.current.style.transform=n?n({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),gu(t=>{if(!Iu(t,e,null))return;const s=this.getAxisMotionValue(t),{min:n,max:a}=this.constraints[t];s.set(Ni(n,a,r[t]))})}addListeners(){if(!this.visualElement.current)return;Tu.set(this.visualElement,this);const e=cu(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();Hc(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,r=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Da.read(t);const n=ou(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(gu(t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))}),this.visualElement.render())});return()=>{n(),e(),r(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:n=!1,dragElastic:a=Ru,dragMomentum:i=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:r,dragConstraints:n,dragElastic:a,dragMomentum:i}}}function Iu(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const Du=e=>(t,s)=>{e&&Da.postRender(()=>e(t,s))};const Lu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Ou(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Mu={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!ii.test(e))return e;e=parseFloat(e)}return`${Ou(e,t.target.x)}% ${Ou(e,t.target.y)}%`}},Vu={correct:(e,{treeScale:t,projectionDelta:s})=>{const r=e,n=yi.parse(e);if(n.length>5)return r;const a=yi.createTransformer(e),i="number"!=typeof n[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;n[0+i]/=o,n[1+i]/=l;const c=Ni(o,l,.5);return"number"==typeof n[2+i]&&(n[2+i]/=c),"number"==typeof n[3+i]&&(n[3+i]/=c),a(n)}};let qu=!1;class Bu extends s.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:r}=this.props,{projection:n}=e;!function(e){for(const t in e)bc[t]=e[t],Ua(t)&&(bc[t].isCSSVariable=!0)}(Uu),n&&(t.group&&t.group.add(n),s&&s.register&&r&&s.register(n),qu&&n.root.didUpdate(),n.addEventListener("animationComplete",()=>{this.safeToRemove()}),n.setOptions({...n.options,onExitComplete:()=>this.safeToRemove()})),Lu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:r,isPresent:n}=this.props,{projection:a}=s;return a?(a.isPresent=n,qu=!0,r||e.layoutDependency!==t||void 0===t||e.isPresent!==n?a.willUpdate():this.safeToRemove(),e.isPresent!==n&&(n?a.promote():a.relegate()||Da.postRender(()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Cl.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:r}=e;qu=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function zu(e){const[t,n]=Jl(),a=s.useContext(Hn);return r.jsx(Bu,{...e,layoutGroup:a,switchLayoutGroup:s.useContext(Qc),isPresent:t,safeToRemove:n})}const Uu={borderRadius:{...Mu,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Mu,borderTopRightRadius:Mu,borderBottomLeftRadius:Mu,borderBottomRightRadius:Mu,boxShadow:Vu};const Fu=(e,t)=>e.depth-t.depth;class $u{constructor(){this.children=[],this.isDirty=!1}add(e){Xn(this.children,e),this.isDirty=!0}remove(e){Jn(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Fu),this.isDirty=!1,this.children.forEach(e)}}const Wu=["TopLeft","TopRight","BottomLeft","BottomRight"],Zu=Wu.length,Hu=e=>"string"==typeof e?parseFloat(e):e,Gu=e=>"number"==typeof e||ii.test(e);function Ku(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Yu=Xu(0,.5,Na),Qu=Xu(.5,.95,ia);function Xu(e,t,s){return r=>r<e?0:r>t?1:s(ca(e,t,r))}function Ju(e,t){e.min=t.min,e.max=t.max}function em(e,t){Ju(e.x,t.x),Ju(e.y,t.y)}function tm(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function sm(e,t,s,r,n){return e=cd(e-=t,1/s,r),void 0!==n&&(e=cd(e,1/n,r)),e}function rm(e,t,[s,r,n],a,i){!function(e,t=0,s=1,r=.5,n,a=e,i=e){ai.test(t)&&(t=parseFloat(t),t=Ni(i.min,i.max,t/100)-i.min);if("number"!=typeof t)return;let o=Ni(a.min,a.max,r);e===a&&(o-=t),e.min=sm(e.min,t,s,o,n),e.max=sm(e.max,t,s,o,n)}(e,t[s],t[r],t[n],t.scale,a,i)}const nm=["x","scaleX","originX"],am=["y","scaleY","originY"];function im(e,t,s,r){rm(e.x,t,nm,s?s.x:void 0,r?r.x:void 0),rm(e.y,t,am,s?s.y:void 0,r?r.y:void 0)}function om(e){return 0===e.translate&&1===e.scale}function lm(e){return om(e.x)&&om(e.y)}function cm(e,t){return e.min===t.min&&e.max===t.max}function dm(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function um(e,t){return dm(e.x,t.x)&&dm(e.y,t.y)}function mm(e){return du(e.x)/du(e.y)}function hm(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class pm{constructor(){this.members=[]}add(e){Xn(this.members,e),e.scheduleRender()}remove(e){if(Jn(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let s;for(let r=t;r>=0;r--){const e=this.members[r];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const fm=["","X","Y","Z"];let gm=0;function xm(e,t,s,r){const{latestValues:n}=t;n[e]&&(s[e]=n[e],t.setStaticValue(e,0),r&&(r[e]=0))}function vm(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=Md(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Da,!(t||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&vm(r)}function bm({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(e={},s=t?.()){this.id=gm++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(wm),this.nodes.forEach(Cm),this.nodes.forEach(Am),this.nodes.forEach(Nm)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new $u)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new da),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var s;this.isSVG=Fl(t)&&!(Fl(s=t)&&"svg"===s.tagName),this.instance=t;const{layoutId:r,layout:n,visualElement:a}=this.options;if(a&&!a.current&&a.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(n||r)&&(this.isLayoutDirty=!0),e){let s,r=0;const n=()=>this.root.updateBlockedByResize=!1;Da.read(()=>{r=window.innerWidth}),e(t,()=>{const e=window.innerWidth;e!==r&&(r=e,this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Ba.now(),r=({timestamp:n})=>{const a=n-s;a>=t&&(La(r),e(a-t))};return Da.setup(r,!0),()=>La(r)}(n,250),Lu.hasAnimatedSinceResize&&(Lu.hasAnimatedSinceResize=!1,this.nodes.forEach(Rm)))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||n)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:s,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const n=this.options.transition||a.getDefaultTransition()||Om,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=a.getProps(),l=!this.targetLayout||!um(this.targetLayout,r),c=!t&&s;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...ll(n,"layout"),onPlay:i,onComplete:o};(a.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||Rm(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),La(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Tm),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&vm(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let n=0;n<this.path.length;n++){const e=this.path[n];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(km);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(Sm);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Em),this.nodes.forEach(ym),this.nodes.forEach(jm)):this.nodes.forEach(Sm),this.clearAllSnapshots();const e=Ba.now();Oa.delta=ea(0,1e3/60,e-Oa.timestamp),Oa.timestamp=e,Oa.isProcessing=!0,Ma.update.process(Oa),Ma.preRender.process(Oa),Ma.render.process(Oa),Oa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Cl.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(_m),this.sharedNodes.forEach(Pm)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Da.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Da.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||du(this.snapshot.measuredBox.x)||du(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!n)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!lm(this.projectionDelta),s=this.getTransformTemplate(),r=s?s(this.latestValues,""):void 0,a=r!==this.prevTransformTemplateValue;e&&this.instance&&(t||id(this.latestValues)||a)&&(n(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var r;return e&&(s=this.removeTransform(s)),qm((r=s).x),qm(r.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(zm))){const{scroll:e}=this.root;e&&(fd(t.x,e.offset.x),fd(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(em(t,e),this.scroll?.wasRoot)return t;for(let s=0;s<this.path.length;s++){const r=this.path[s],{scroll:n,options:a}=r;r!==this.root&&n&&a.layoutScroll&&(n.wasRoot&&em(t,e),fd(t.x,n.offset.x),fd(t.y,n.offset.y))}return t}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};em(s,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&xd(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),id(e.latestValues)&&xd(s,e.latestValues)}return id(this.latestValues)&&xd(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};em(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!id(e.latestValues))continue;ad(e.latestValues)&&e.updateSnapshot();const r=bd();em(r,e.measurePageBox()),im(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,r)}return id(this.latestValues)&&im(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Oa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const s=Boolean(this.resumingFrom)||this!==t;if(!(e||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:n}=this.options;if(this.layout&&(r||n)){if(this.resolvedRelativeTargetAt=Oa.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},fu(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),em(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var a,i,o;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),a=this.target,i=this.relativeTarget,o=this.relativeParent.target,hu(a.x,i.x,o.x),hu(a.y,i.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):em(this.target,this.layout.layoutBox),md(this.target,this.targetDelta)):em(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},fu(this.relativeTargetOrigin,this.target,e.target),em(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!ad(this.parent.latestValues)&&!od(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===Oa.timestamp&&(s=!1),s)return;const{layout:r,layoutId:n}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!n)return;em(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,i=this.treeScale.y;!function(e,t,s,r=!1){const n=s.length;if(!n)return;let a,i;t.x=t.y=1;for(let o=0;o<n;o++){a=s[o],i=a.projectionDelta;const{visualElement:n}=a.options;n&&n.props.style&&"contents"===n.props.style.display||(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&xd(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,md(e,i)),r&&id(a.latestValues)&&xd(e,a.latestValues))}t.x<pd&&t.x>hd&&(t.x=1),t.y<pd&&t.y>hd&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(tm(this.prevProjectionDelta.x,this.projectionDelta.x),tm(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),mu(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===a&&this.treeScale.y===i&&hm(this.projectionDelta.x,this.prevProjectionDelta.x)&&hm(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,r=s?s.latestValues:{},n={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const i={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Lm));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var l,m,h,p,f,g;Im(a.x,e.x,s),Im(a.y,e.y,s),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(fu(i,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h=this.relativeTarget,p=this.relativeTargetOrigin,f=i,g=s,Dm(h.x,p.x,f.x,g),Dm(h.y,p.y,f.y,g),u&&(l=this.relativeTarget,m=u,cm(l.x,m.x)&&cm(l.y,m.y))&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),em(u,this.relativeTarget)),o&&(this.animationValues=n,function(e,t,s,r,n,a){n?(e.opacity=Ni(0,s.opacity??1,Yu(r)),e.opacityExit=Ni(t.opacity??1,0,Qu(r))):a&&(e.opacity=Ni(t.opacity??1,s.opacity??1,r));for(let i=0;i<Zu;i++){const n=`border${Wu[i]}Radius`;let a=Ku(t,n),o=Ku(s,n);void 0===a&&void 0===o||(a||(a=0),o||(o=0),0===a||0===o||Gu(a)===Gu(o)?(e[n]=Math.max(Ni(Hu(a),Hu(o),r),0),(ai.test(o)||ai.test(a))&&(e[n]+="%")):e[n]=o)}(t.rotate||s.rotate)&&(e.rotate=Ni(t.rotate||0,s.rotate||0,r))}(n,r,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(La(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Da.update(()=>{Lu.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Rl(0)),this.currentAnimation=function(e,t,s){const r=$l(e)?e:Rl(e);return r.start(Fd("",r,t,s)),r.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:r,latestValues:n}=e;if(t&&s&&r){if(this!==e&&this.layout&&r&&Bm(this.options.animationType,this.layout.layoutBox,r.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=du(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const r=du(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+r}em(t,s),xd(t,n),mu(this.projectionDeltaWithTransform,this.layoutCorrected,t,n)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new pm);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const r=this.getStack();r&&r.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const r={};s.z&&xm("z",e,r,this.animationValues);for(let n=0;n<fm.length;n++)xm(`rotate${fm[n]}`,e,r,this.animationValues),xm(`skew${fm[n]}`,e,r,this.animationValues);e.render();for(const n in r)e.setStaticValue(n,r[n]),this.animationValues&&(this.animationValues[n]=r[n]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=qc(t?.pointerEvents)||"",void(e.transform=s?s(this.latestValues,""):"none");const r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=qc(t?.pointerEvents)||""),void(this.hasProjected&&!id(this.latestValues)&&(e.transform=s?s({},""):"none",this.hasProjected=!1));e.visibility="";const n=r.animationValues||r.latestValues;this.applyTransformsToTarget();let a=function(e,t,s){let r="";const n=e.x.translate/t.x,a=e.y.translate/t.y,i=s?.z||0;if((n||a||i)&&(r=`translate3d(${n}px, ${a}px, ${i}px) `),1===t.x&&1===t.y||(r+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:n,rotateY:a,skewX:i,skewY:o}=s;e&&(r=`perspective(${e}px) ${r}`),t&&(r+=`rotate(${t}deg) `),n&&(r+=`rotateX(${n}deg) `),a&&(r+=`rotateY(${a}deg) `),i&&(r+=`skewX(${i}deg) `),o&&(r+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(r+=`scale(${o}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,n);s&&(a=s(n,a)),e.transform=a;const{x:i,y:o}=this.projectionDelta;e.transformOrigin=`${100*i.origin}% ${100*o.origin}% 0`,r.animationValues?e.opacity=r===this?n.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:n.opacityExit:e.opacity=r===this?void 0!==n.opacity?n.opacity:"":void 0!==n.opacityExit?n.opacityExit:0;for(const l in bc){if(void 0===n[l])continue;const{correct:t,applyTo:s,isCSSVariable:i}=bc[l],o="none"===a?n[l]:t(n[l],r);if(s){const t=s.length;for(let r=0;r<t;r++)e[s[r]]=o}else i?this.options.visualElement.renderState.vars[l]=o:e[l]=o}this.options.layoutId&&(e.pointerEvents=r===this?qc(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(km),this.root.sharedNodes.clear()}}}function ym(e){e.updateLayout()}function jm(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=e.layout,{animationType:n}=e.options,a=t.source!==e.layout.source;"size"===n?gu(e=>{const r=a?t.measuredBox[e]:t.layoutBox[e],n=du(r);r.min=s[e].min,r.max=r.min+n}):Bm(n,t.layoutBox,s)&&gu(r=>{const n=a?t.measuredBox[r]:t.layoutBox[r],i=du(s[r]);n.max=n.min+i,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+i)});const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};mu(i,s,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?mu(o,e.applyTransform(r,!0),t.measuredBox):mu(o,s,t.layoutBox);const l=!lm(i);let c=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:n,layout:a}=r;if(n&&a){const i={x:{min:0,max:0},y:{min:0,max:0}};fu(i,t.layoutBox,n.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};fu(o,s,a.layoutBox),um(i,o)||(c=!0),r.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=i,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:o,layoutDelta:i,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function wm(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Nm(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function _m(e){e.clearSnapshot()}function km(e){e.clearMeasurements()}function Sm(e){e.isLayoutDirty=!1}function Em(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Rm(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Cm(e){e.resolveTargetDelta()}function Am(e){e.calcProjection()}function Tm(e){e.resetSkewAndRotation()}function Pm(e){e.removeLeadSnapshot()}function Im(e,t,s){e.translate=Ni(t.translate,0,s),e.scale=Ni(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Dm(e,t,s,r){e.min=Ni(t.min,s.min,r),e.max=Ni(t.max,s.max,r)}function Lm(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Om={duration:.45,ease:[.4,0,.1,1]},Mm=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Vm=Mm("applewebkit/")&&!Mm("chrome/")?Math.round:ia;function qm(e){e.min=Vm(e.min),e.max=Vm(e.max)}function Bm(e,t,s){return"position"===e||"preserve-aspect"===e&&(r=mm(t),n=mm(s),a=.2,!(Math.abs(r-n)<=a));var r,n,a}function zm(e){return e!==e.root&&e.scroll?.wasRoot}const Um=bm({attachResizeListener:(e,t)=>ou(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Fm={current:void 0},$m=bm({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Fm.current){const e=new Um({});e.mount(window),e.setOptions({layoutScroll:!0}),Fm.current=e}return Fm.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Wm={pan:{Feature:class extends nu{constructor(){super(...arguments),this.removePointerDownListener=ia}onPointerDown(e){this.session=new bu(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:xu(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:Du(e),onStart:Du(t),onMove:s,onEnd:(e,t)=>{delete this.session,r&&Da.postRender(()=>r(e,t))}}}mount(){this.removePointerDownListener=cu(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends nu{constructor(e){super(e),this.removeGroupControls=ia,this.removeListeners=ia,this.controls=new Pu(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ia}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:$m,MeasureLayout:zu}};function Zm(e,t,s){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===s);const n=r["onHover"+s];n&&Da.postRender(()=>n(t,lu(t)))}function Hm(e,t,s){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===s);const n=r["onTap"+("End"===s?"":s)];n&&Da.postRender(()=>n(t,lu(t)))}const Gm=new WeakMap,Km=new WeakMap,Ym=e=>{const t=Gm.get(e.target);t&&t(e)},Qm=e=>{e.forEach(Ym)};function Xm(e,t,s){const r=function({root:e,...t}){const s=e||document;Km.has(s)||Km.set(s,{});const r=Km.get(s),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver(Qm,{root:e,...t})),r[n]}(t);return Gm.set(e,s),r.observe(e),()=>{Gm.delete(e),r.unobserve(e)}}const Jm={some:0,all:1};const eh=sd({...iu,...{inView:{Feature:class extends nu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:r="some",once:n}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof r?r:Jm[r]};return Xm(this.node.current,a,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,n&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:r}=this.node.getProps(),a=t?s:r;a&&a(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends nu{mount(){const{current:e}=this.node;e&&(this.unmount=Ul(e,(e,t)=>(Hm(this.node,t,"Start"),(e,{success:t})=>Hm(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends nu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=la(ou(this.node.current,"focus",()=>this.onFocus()),ou(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends nu{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[r,n,a]=Il(e,s),i=e=>{if(!Dl(e))return;const{target:s}=e,r=t(s,e);if("function"!=typeof r||!s)return;const a=e=>{Dl(e)&&(r(e),s.removeEventListener("pointerleave",a))};s.addEventListener("pointerleave",a,n)};return r.forEach(e=>{e.addEventListener("pointerenter",i,n)}),a}(e,(e,t)=>(Zm(this.node,t,"Start"),e=>Zm(this.node,e,"End"))))}unmount(){}}}},...Wm,...{layout:{ProjectionNode:$m,MeasureLayout:zu}}},Td);function th(){const{t:e}=Tn();return r.jsx("section",{className:"w-full py-32 md:py-40 px-4",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsx(eh.h2,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},className:"text-5xl md:text-6xl font-serif font-semibold text-white text-center mb-24",children:e.landing.valueSection.title}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 mb-16",children:[r.jsxs(eh.div,{initial:{opacity:0,x:-30,scale:.92},whileInView:{opacity:1,x:0,scale:.92},viewport:{once:!0},transition:{duration:.6,delay:.2},whileHover:{rotate:-2,scale:.9},className:"lg:col-span-4 space-y-6 rounded-[3rem] p-8 backdrop-blur-[40px] backdrop-saturate-[180%] border border-white/20 relative group",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05))",boxShadow:"\n                0 8px 32px rgba(31, 38, 135, 0.15),\n                0 30px 60px rgba(0,0,0,0.12),\n                inset 0 0 0 1px rgba(255,255,255,0.05)\n              "},children:[r.jsx("h3",{className:"text-2xl font-medium text-white/90 mb-6",children:e.landing.valueSection.withoutTitle}),r.jsx("div",{className:"space-y-4",children:[e.landing.valueSection.without1,e.landing.valueSection.without2,e.landing.valueSection.without3].map((e,t)=>r.jsxs(eh.div,{initial:{opacity:0,x:-10},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{delay:.3+.1*t},className:"flex items-start gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center flex-shrink-0 mt-0.5",children:r.jsx(R,{className:"w-4 h-4 text-white/60"})}),r.jsx("p",{className:"text-base text-white/70 leading-relaxed",children:e})]},t))})]}),r.jsxs(eh.div,{initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.7,delay:.3},whileHover:{y:-16,transition:{duration:.3}},className:"lg:col-span-8 space-y-6 rounded-[3rem] p-12 relative z-10 group",style:{background:"\n                linear-gradient(135deg, #A67B5B 0%, #C4A287 50%, #E8DCC8 100%),\n                radial-gradient(circle at top right, rgba(255,255,255,0.3), transparent)\n              ",backgroundBlendMode:"normal, overlay",boxShadow:"\n                0 50px 100px -20px rgba(166,123,91,0.5),\n                0 30px 60px -30px rgba(166,123,91,0.35),\n                0 0 0 1px rgba(255,255,255,0.1) inset\n              "},children:[r.jsx("div",{className:"absolute inset-0 rounded-[3rem] opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:"radial-gradient(circle at center, rgba(255,255,255,0.2), transparent)",pointerEvents:"none"}}),r.jsx("h3",{className:"text-3xl font-semibold text-white mb-8 relative z-10",children:e.landing.valueSection.withTitle}),r.jsx("div",{className:"space-y-5 relative z-10",children:[e.landing.valueSection.with1,e.landing.valueSection.with2,e.landing.valueSection.with3].map((e,t)=>r.jsxs(eh.div,{initial:{opacity:0,x:20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{delay:.4+.1*t},className:"flex items-start gap-4",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center flex-shrink-0 shadow-lg",children:r.jsx(y,{className:"w-5 h-5 text-[#A67B5B]"})}),r.jsx("p",{className:"text-lg text-white font-medium leading-relaxed",children:e})]},t))})]})]}),r.jsx(eh.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.7,delay:.5},className:"flex justify-center",children:r.jsx("div",{className:"rounded-full px-12 py-8 max-w-5xl relative",style:{background:"white",border:"double 4px transparent",backgroundImage:"linear-gradient(white, white), linear-gradient(135deg, #A67B5B, #C4A287)",backgroundOrigin:"border-box",backgroundClip:"padding-box, border-box",boxShadow:"0 20px 60px rgba(0,0,0,0.08)"},children:r.jsx("div",{className:"flex flex-wrap items-center justify-center gap-3 md:gap-4",children:["Lire 30 pages","Rpondre aux questions","Valider son segment","Continuer l'aventure"].map((e,t)=>r.jsxs(eh.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.6+.1*t,duration:.4},className:"inline-flex items-center gap-2 px-5 py-2.5 bg-[#A67B5B]/10 border border-[#A67B5B]/20 rounded-full relative",style:{marginLeft:t>0?"-8px":"0",zIndex:4-t},children:[r.jsx("span",{className:"text-sm font-medium text-[#A67B5B]",children:e}),t<3&&r.jsx(C,{className:"w-4 h-4 text-[#A67B5B]/60"})]},t))})})})]})})}function sh(){const{t:e}=Tn(),{user:t}=kn(),[n,a]=s.useState(!1),[i,o]=s.useState(!1),l=s.useRef(null),[c,d]=s.useState({x:0,y:0}),[u,m]=s.useState("");s.useEffect(()=>{const e=()=>{o(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),s.useEffect(()=>{if(t){const e=jn(t.user_metadata?.username||t.username,t.email,t.id);m(e)}},[t]),s.useEffect(()=>{const e=e=>{if(!l.current)return;const t=l.current.getBoundingClientRect(),s=e.clientX-t.left-t.width/2,r=e.clientY-t.top-t.height/2,n=Math.sqrt(s*s+r*r);if(n<150){const e=(150-n)/150;d({x:s*e*.15,y:r*e*.15})}else d({x:0,y:0})};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]);const h=["D","E","U","X","L","I","V","R","E","S"],p=["#8B4513","#A0522D","#8B7355","#996633","#8B6F47","#704214","#9C6644","#A67B5B","#8B6F47","#B85C38"],f=()=>{Dn({particleCount:200,spread:70,origin:{y:.6},colors:["#10b981","#3b82f6","#f59e0b"]}),window.confetti&&setTimeout(()=>{window.confetti({particleCount:100,angle:60,spread:55,origin:{x:0}})},500)};return r.jsxs(r.Fragment,{children:[r.jsx("style",{children:"\n        @keyframes gradient-shift {\n          0%, 100% {\n            background-position: 0% 50%;\n          }\n          50% {\n            background-position: 100% 50%;\n          }\n        }\n      "}),r.jsxs(A,{children:[r.jsx("title",{children:e.landing.title}),r.jsx("meta",{name:"description",content:e.landing.description})]}),r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-primary to-reed-secondary flex flex-col overflow-x-hidden md:overflow-x-visible",children:[r.jsx("div",{className:"absolute top-4 right-4 z-50",children:r.jsx(Zn,{})}),t&&r.jsx(T,{to:"/home",className:"absolute top-4 left-4 z-50",children:r.jsxs("div",{className:"flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-2 rounded-full border border-white/20 shadow-lg hover:bg-white/20 transition-colors",children:[r.jsx(P,{className:"w-4 h-4 text-white"}),r.jsx("span",{className:"text-sm font-bold text-white tracking-wide truncate max-w-[150px]",children:u})]})}),r.jsx("div",{className:"flex-1 flex items-center justify-center px-4 md:px-6 py-8 w-full",children:r.jsxs("div",{className:"w-full max-w-4xl space-y-8 text-center flex flex-col items-center",children:[r.jsxs("div",{className:"relative inline-block mb-6",children:[r.jsx("div",{className:"absolute inset-0 bg-white/20 blur-3xl animate-pulse"}),r.jsx("div",{className:"relative bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-10 border-2 border-white/20 shadow-2xl",children:r.jsx(Pn,{size:120,className:"md:w-[140px]"})})]}),r.jsxs("h1",{className:"text-hero text-white font-serif text-center w-full",children:[e.landing.heroTitle1,r.jsx("br",{}),e.landing.heroTitle2,r.jsx("br",{}),e.landing.heroTitle3]}),r.jsxs("div",{className:"py-8 flex flex-col items-center w-full",children:[r.jsxs("div",{className:"relative mx-auto",style:{width:"200px",height:"300px"},children:[[0,1,2,3,4,5,6,7,8,9].map(t=>{const s=8===t,a=s||9===t;return r.jsxs("div",{className:"absolute left-0 right-0 transition-all duration-700",style:{bottom:n?a?s?"0px":"60px":"-120px":26*(9-t)+"px",opacity:n&&!a?0:1},children:[r.jsxs("div",{className:"w-full h-14 rounded-xl flex items-center justify-center relative border-2 transition-all duration-700",style:{backgroundColor:a&&n?"#FFFFFF":p[t],borderColor:a&&n?"#EEDCC8":"rgba(255,255,255,0.2)",boxShadow:a&&n?"0 15px 60px rgba(166,123,91,0.6), 0 0 100px rgba(166,123,91,0.4)":"0 5px 20px rgba(0,0,0,0.4)"},children:[!n&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"absolute top-3 left-4 right-4 h-px bg-white/20"}),r.jsx("div",{className:"absolute bottom-3 left-4 right-4 h-px bg-white/20"})]}),r.jsx("span",{className:"font-bold transition-all duration-700",style:{color:a&&n?"#B85C38":"#FFFFFF",textShadow:n?"none":"0 3px 8px rgba(0,0,0,0.7)",fontSize:n&&a?"32px":"56px",letterSpacing:n&&a?"-1px":"0px"},children:n&&a?s?e.landing.twoBooks.split(" ")[1]:e.landing.twoBooks.split(" ")[0]:h[t]}),a&&n&&r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/60 via-transparent to-transparent rounded-xl pointer-events-none"})]}),r.jsx("div",{className:"absolute -right-2.5 top-0 w-2.5 h-14 rounded-r-xl transition-all duration-700",style:{backgroundColor:a&&n?"#F5E6D3":p[t],opacity:n&&!a?0:1,boxShadow:"3px 0 10px rgba(0,0,0,0.4)"}})]},t)}),r.jsx("div",{className:"absolute left-0 right-0 cursor-pointer z-50 hover:bg-white/5 transition-colors rounded-xl",style:{bottom:"0px",height:"100px"},onClick:()=>{a(!0),f()},onTouchStart:e=>{e.preventDefault(),a(!0),f()}})]}),!n&&r.jsx("p",{className:"text-white/60 text-body-sm mt-10 animate-bounce text-center w-full",children:i?e.landing.touchToReveal:e.landing.clickToReveal}),n&&r.jsx("button",{onClick:e=>{e.stopPropagation(),a(!1)},className:"text-white/70 hover:text-white text-body-sm underline underline-offset-4 mt-10 transition-colors",children:e.landing.restart})]}),r.jsxs("h2",{className:"text-hero text-white font-serif text-center w-full",children:[e.landing.finalTitle1,r.jsx("br",{}),e.landing.finalTitle2]}),r.jsx(eh.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6,delay:.2},className:"pt-16 w-full flex flex-col items-center gap-6",children:r.jsxs(T,{ref:l,to:t?"/home":"/auth",className:"relative inline-flex items-center gap-3 px-16 py-6 text-2xl font-serif font-bold text-white rounded-full overflow-hidden group transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-[#A67B5B]/20 focus:ring-offset-4",style:{background:"linear-gradient(135deg, #A67B5B, #8B6F47, #A67B5B)",backgroundSize:"200% 200%",animation:"gradient-shift 3s ease infinite",boxShadow:"\n                    0 20px 60px rgba(166,123,91,0.4),\n                    0 10px 30px rgba(166,123,91,0.3)\n                  ",transform:`translate(${c.x}px, ${c.y}px)`,textShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:[r.jsx("span",{className:"relative z-10",children:t?"CONTINUER MA LECTURE":e.landing.cta}),r.jsx(eh.div,{animate:{x:[0,4,0]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:r.jsx(C,{className:"w-6 h-6 relative z-10"})}),r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),r.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500",children:[...Array(8)].map((e,t)=>r.jsx(eh.div,{className:"absolute w-1 h-1 bg-white rounded-full",initial:{opacity:0,scale:0},animate:{opacity:[0,1,0],scale:[0,1,0],x:[0,40*Math.cos(45*t*Math.PI/180)],y:[0,40*Math.sin(45*t*Math.PI/180)]},transition:{duration:1.5,repeat:1/0,delay:.1*t},style:{left:"50%",top:"50%"}},t))})]})}),r.jsx(th,{}),r.jsxs(eh.div,{initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{duration:1},className:"pt-8 pb-20 w-full flex justify-center px-4 relative",children:[r.jsx(eh.div,{animate:{scale:[1,1.1,1],rotate:[0,5,0]},transition:{duration:8,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{filter:"blur(60px)"},children:r.jsx("div",{className:"w-[600px] h-[400px]",style:{background:"radial-gradient(circle, rgba(166,123,91,0.15), transparent)",borderRadius:"60% 40% 30% 70% / 60% 30% 70% 40%"}})}),r.jsxs(eh.h2,{initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.8,delay:.2},className:"relative text-6xl md:text-7xl font-extrabold text-center leading-tight max-w-5xl",style:{background:"linear-gradient(135deg, #FFFFFF, #E8DCC8)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"\n                    0 1px 0 #C4A287,\n                    0 2px 0 #B5977D,\n                    0 3px 0 #A67B5B,\n                    0 6px 12px rgba(0,0,0,0.15),\n                    0 12px 24px rgba(0,0,0,0.1)\n                  "},children:[r.jsxs("span",{className:"block",children:[e.landing.sloganPart1," ",r.jsx("span",{className:"font-black",children:e.landing.sloganPart2})]}),r.jsx("span",{className:"block",children:e.landing.sloganPart3}),r.jsx("span",{className:"block",children:e.landing.sloganPart4})]})]})]})}),r.jsx("footer",{className:"py-12 border-t border-white/10 w-full",children:r.jsxs("nav",{className:"flex flex-wrap items-center justify-center gap-6 md:gap-12 text-body-sm px-4",children:[r.jsx(T,{to:"/blog",className:"text-white/50 hover:text-white transition-colors",children:e.nav.blog}),r.jsx("span",{className:"text-white/30 text-xl md:text-2xl",children:""}),r.jsx(T,{to:"/press",className:"text-white/50 hover:text-white transition-colors",children:e.nav.press}),r.jsx("span",{className:"text-white/30 text-xl md:text-2xl",children:""}),r.jsx(T,{to:"/about",className:"text-white/50 hover:text-white transition-colors",children:e.nav.contact})]})})]})]})}let rh;if("undefined"!=typeof window){const e=()=>{rh="undefined"!=typeof window&&window.matchMedia("(max-width: 768px)").matches};e();try{window.matchMedia("(max-width: 767px)").addEventListener("change",e)}catch(V_){window.addEventListener("resize",e)}}function nh(){const[e,t]=s.useState(()=>void 0!==rh&&rh);return s.useEffect(()=>{if("undefined"==typeof window)return;t(rh||!1);const s=()=>{rh!==e&&t(rh||!1)};let r=null;const n=()=>{"visible"===document.visibilityState?r=window.setInterval(s,1e3):r&&(clearInterval(r),r=null)};return document.addEventListener("visibilitychange",n),n(),()=>{r&&clearInterval(r),document.removeEventListener("visibilitychange",n)}},[e]),e}const ah=q,ih=B,oh=V,lh=s.forwardRef(({className:e,...t},s)=>r.jsx(I,{className:zr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));lh.displayName=I.displayName;const ch=Mn("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),dh=s.forwardRef(({side:e="right",className:t,children:s,...n},a)=>r.jsxs(oh,{children:[r.jsx(lh,{}),r.jsxs(D,{ref:a,className:zr(ch({side:e}),t),...n,children:[s,r.jsxs(L,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[r.jsx(R,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));dh.displayName=D.displayName;const uh=({className:e,...t})=>r.jsx("div",{className:zr("flex flex-col space-y-2 text-center sm:text-left",e),...t});uh.displayName="SheetHeader";const mh=s.forwardRef(({className:e,...t},s)=>r.jsx(O,{ref:s,className:zr("text-lg font-semibold text-foreground",e),...t}));mh.displayName=O.displayName;function hh(e={}){const{isPremium:t,t:s}=e,r=s?.nav||{home:"Accueil",explore:"Explorer",achievements:"Rcompenses",requestBook:"Demander un livre",premium:"Premium",readingList:"Ma liste",discover:"Lecteurs",feedback:"Feedback"};return[{to:"/home",label:r.home,icon:z,ariaLabel:`${r.home}`},{to:"/explore",label:r.explore,icon:U,ariaLabel:`${r.explore}`},{to:"/achievements",label:r.achievements,icon:F,ariaLabel:`${r.achievements}`},{to:"/request-book",label:r.requestBook,icon:$,ariaLabel:r.requestBook},{to:"/reading-list",label:r.readingList,icon:U,ariaLabel:`${r.readingList}`},{to:"/discover",label:r.discover,icon:W,ariaLabel:`${r.discover}`},{to:"/feedback",label:r.feedback,icon:Z,ariaLabel:r.feedback}]}s.forwardRef(({className:e,...t},s)=>r.jsx(M,{ref:s,className:zr("text-sm text-muted-foreground",e),...t})).displayName=M.displayName;const ph=({isAdmin:e,isPremium:t})=>{const{t:n}=Tn(),a=hh({isAdmin:e,isPremium:t,t:n}),i=H(),[o,l]=s.useState(!1),c=e=>{l(!1),i(e)};return r.jsxs(ah,{open:o,onOpenChange:l,children:[r.jsx(ih,{asChild:!0,children:r.jsxs(qn,{variant:"ghost",size:"icon",className:"md:hidden focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2","aria-label":n.nav.menu,"aria-expanded":o,"aria-controls":"mobile-menu",children:[r.jsx(G,{className:"h-5 w-5"}),r.jsx("span",{className:"sr-only",children:n.nav.menu})]})}),r.jsxs(dh,{side:"left",className:"w-72 overflow-y-auto focus-visible:outline-none",id:"mobile-menu",onOpenAutoFocus:e=>{e.preventDefault();const t=e.currentTarget.querySelector('[role="button"]');t&&t.focus()},children:[r.jsx(uh,{className:"pb-4",children:r.jsx(mh,{className:"text-left text-h4",children:n.nav.menu})}),r.jsx("nav",{className:"mt-4",role:"navigation","aria-label":"Navigation principale",children:r.jsx("ul",{className:"space-y-1",role:"list",children:a.map(({to:e,label:s,icon:n,ariaLabel:a})=>r.jsx("li",{role:"listitem",children:r.jsxs(qn,{variant:"ghost",className:"mobile-nav-item focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2",onClick:()=>c(e),onKeyDown:t=>{return r=()=>c(e),void("Enter"!==(s=t).key&&" "!==s.key||(s.preventDefault(),r()));var s,r},tabIndex:0,role:"button","aria-label":a??s,children:[n&&r.jsx(n,{className:"h-5 w-5 mr-3","aria-hidden":"true"}),s,"/request-book"===e&&!t&&r.jsx("span",{className:"ml-auto text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:"Premium"})]})},e))})})]})]})},fh=({isAdmin:e,isPremium:t})=>{const{t:s}=Tn(),n=hh({isAdmin:e,isPremium:t,t:s});return r.jsx("nav",{className:"hidden md:flex items-center space-x-6 text-body-sm font-medium flex-1",children:n.map(({to:e,label:s,icon:n,ariaLabel:a})=>r.jsx(T,{to:e,children:r.jsxs(qn,{variant:"ghost",className:"hover:text-logo-accent gap-2","aria-label":a??s,children:[n&&r.jsx(n,{className:"h-4 w-4"}),s,"/request-book"===e&&!t&&r.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:"Premium"})]})},e))})},gh=({size:e="md",variant:t="full",className:s})=>r.jsxs("div",{className:zr("inline-flex items-center rounded-full font-semibold","bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600","text-gray-900 shadow-lg","animate-in fade-in zoom-in duration-300","hover:scale-105 transition-transform","border-2 border-amber-300/50",{sm:"text-xs px-2 py-0.5 gap-1",md:"text-sm px-3 py-1 gap-1.5",lg:"text-base px-4 py-1.5 gap-2"}[e],s),children:[r.jsx(K,{className:zr({sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[e],"fill-gray-900")}),"full"===t&&r.jsx("span",{children:"Premium"})]}),xh=s.forwardRef(({className:e,...t},s)=>r.jsx(Y,{ref:s,className:zr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));xh.displayName=Y.displayName;const vh=s.forwardRef(({className:e,...t},s)=>r.jsx(Q,{ref:s,className:zr("aspect-square h-full w-full",e),...t}));vh.displayName=Q.displayName;const bh=s.forwardRef(({className:e,...t},s)=>r.jsx(X,{ref:s,className:zr("flex h-full w-full items-center justify-center rounded-full bg-muted text-muted-foreground font-medium",e),...t}));bh.displayName=X.displayName;const yh=s.forwardRef(({src:e,alt:t,fallbackText:s,className:n,size:a="md"},i)=>{const o=s?function(e){if(!e||"string"!=typeof e)return"??";const t=e.trim().split(/\s+/).filter(Boolean);return 0===t.length?"??":1===t.length?t[0][0].toUpperCase():t[0][0].toUpperCase()+t[t.length-1][0].toUpperCase()}(s):"U";return r.jsxs(xh,{ref:i,className:zr({sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-16 w-16 text-xl",xl:"h-24 w-24 text-2xl"}[a],n),children:[r.jsx(vh,{src:e??void 0,alt:t}),r.jsx(bh,{className:"bg-muted/50 text-muted-foreground border border-border/20",children:o})]})});yh.displayName="EnhancedAvatar";const jh="Accueil",wh="Administration",Nh="Profil",_h="Paramtres",kh="Recherche en cours...",Sh="Validation des livres",Eh="Tableau d'administration",Rh="Section en cours de dveloppement",Ch="Les paramtres d'administration seront bientt disponibles",Ah="Exporter les donnes",Th=()=>{const e=H(),{user:t,isAdmin:s,isPremium:n}=kn();return t?r.jsxs(Bn,{children:[r.jsx(zn,{asChild:!0,children:r.jsx(qn,{variant:"ghost",className:"relative h-10 w-10 rounded-full hover:ring-2 hover:ring-logo-accent",children:r.jsx(yh,{src:"/avatar.png",alt:"Avatar",fallbackText:t?.email||"Utilisateur",size:"sm",className:"border border-logo-accent"})})}),r.jsxs(Un,{className:"w-56 bg-background border border-border",align:"end",forceMount:!0,children:[r.jsx($n,{className:"font-normal",children:r.jsxs("div",{className:"flex flex-col space-y-2",children:[r.jsx("p",{className:"text-body-sm font-medium leading-none",children:t.email}),r.jsx("p",{className:"text-caption leading-none text-muted-foreground",children:t.email}),n&&r.jsx("div",{className:"pt-1",children:r.jsx(gh,{size:"sm",variant:"full"})})]})}),r.jsx(Wn,{}),r.jsxs(Fn,{onClick:()=>e("/profile"),className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[r.jsx(P,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:Nh})]}),r.jsxs(Fn,{onClick:()=>e("/admin"),className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[r.jsx(J,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:wh})]}),r.jsx(Wn,{}),r.jsxs(Fn,{onClick:async()=>{try{const{error:t}=await en.auth.signOut();if(t)return void mn.error("Erreur lors de la dconnexion");mn.success("Dconnexion russie"),setTimeout(()=>{e("/")},100)}catch(V_){mn.error("Erreur inattendue lors de la dconnexion")}},className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[r.jsx(ee,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:"Dconnexion"})]})]})]}):null},Ph=()=>r.jsxs(T,{to:"/home",className:"flex items-center gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2 rounded-md","aria-label":"VREAD - Retour  l'accueil",children:[r.jsx(Pn,{size:32,className:"h-8 w-8"}),r.jsx("span",{className:"text-xl font-medium text-logo-text",children:"VREAD"})]}),Ih=Mn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Dh({className:e,variant:t,...s}){return r.jsx("div",{className:zr(Ih({variant:t}),e),...s})}const Lh=ne,Oh=s.forwardRef(({className:e,...t},s)=>r.jsx(te,{ref:s,className:zr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));Oh.displayName=te.displayName;const Mh=s.forwardRef(({className:e,...t},s)=>r.jsx(se,{ref:s,className:zr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Mh.displayName=se.displayName;const Vh=s.forwardRef(({className:e,...t},s)=>r.jsx(re,{ref:s,className:zr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Vh.displayName=re.displayName;const qh=s.forwardRef(({className:e,children:t,...s},n)=>r.jsxs(ae,{ref:n,className:zr("relative overflow-hidden",e),...s,children:[r.jsx(ie,{className:"h-full w-full rounded-[inherit]",children:t}),r.jsx(Bh,{}),r.jsx(oe,{})]}));qh.displayName=ae.displayName;const Bh=s.forwardRef(({className:e,orientation:t="vertical",...s},n)=>r.jsx(le,{ref:n,orientation:t,className:zr("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:r.jsx(ce,{className:"relative flex-1 rounded-full bg-border"})}));function zh({notifications:e,loading:t,onMarkAsRead:n}){const[a,i]=s.useState(null),o=H(),l=e.filter(e=>["streak_nudge","streak_kept","streak_lost"].includes(e.type)),c=e.filter(e=>["booky_received","friend_finished"].includes(e.type)),d=e.filter(e=>"weekly_digest"===e.type),u=async e=>{if(!e.read_at&&a!==e.id){i(e.id);try{await async function(e){const{error:t}=await en.from("notifications").update({read_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}(e.id),n(e.id)}catch(t){}finally{i(null)}}},m=e=>{switch(e){case"streak_nudge":case"streak_kept":case"streak_lost":return r.jsx(ue,{className:"h-4 w-4 text-orange-500"});case"booky_received":return r.jsx(me,{className:"h-4 w-4",style:{color:"#AE6841"}});case"friend_finished":return r.jsx(xe,{className:"h-4 w-4 text-green-600"});case"weekly_digest":return r.jsx(ge,{className:"h-4 w-4 text-blue-500"});default:return r.jsx(de,{className:"h-4 w-4 text-gray-500"})}},h=e=>{switch(e.type){case"booky_received":return r.jsxs("span",{children:[r.jsx("strong",{children:e.actor?.username||"Quelqu'un"})," t'a donn un Booky pour"," ",r.jsx("strong",{children:e.book_title})]});case"friend_finished":return r.jsxs("span",{children:[r.jsx("strong",{children:e.actor?.username||"Quelqu'un"})," a termin"," ",r.jsx("strong",{children:e.book_title})]});case"streak_nudge":case"streak_kept":case"streak_lost":return e.meta?.msg||"Notification de srie";case"weekly_digest":return e.meta?.msg||"Ton rsum hebdomadaire est prt";default:return"Notification"}},p=({notification:e})=>{const t=!!e.read_at,s=he(new Date(e.created_at),{addSuffix:!0,locale:pe}),n=(e=>{switch(e.type){case"friend_finished":case"booky_received":return e.book_id?"Voir l'activit":null;case"streak_nudge":return"Lire maintenant";case"weekly_digest":return"Voir les stats";default:return null}})(e);return r.jsx("div",{className:"p-3 border-b border-border last:border-b-0 transition-colors "+(t?"opacity-60":"bg-muted/30"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"mt-1 flex-shrink-0",children:m(e.type)}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm text-foreground",children:h(e)}),r.jsxs("div",{className:"flex items-center justify-between mt-2",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:s}),r.jsxs("div",{className:"flex items-center gap-2",children:[n&&r.jsx(qn,{size:"sm",variant:"outline",onClick:()=>(e=>{switch(e.type){case"friend_finished":case"booky_received":o("/discover");break;case"streak_nudge":o("/reading-list");break;case"weekly_digest":o("/achievements")}})(e),className:"text-xs h-7",children:n}),!t&&r.jsx(qn,{size:"sm",variant:"ghost",onClick:()=>u(e),disabled:a===e.id,className:"text-xs h-7",children:a===e.id?r.jsx(fe,{className:"h-3 w-3 animate-spin"}):r.jsx(fe,{className:"h-3 w-3"})})]})]})]})]})})};if(t)return r.jsx("div",{className:"p-4",children:r.jsx("div",{className:"space-y-3",children:[...Array(3)].map((e,t)=>r.jsx("div",{className:"h-16 bg-muted rounded-lg animate-pulse"},t))})});const f=e.filter(e=>!e.read_at).length,g=l.filter(e=>!e.read_at).length,x=c.filter(e=>!e.read_at).length;return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"p-4 border-b border-border",children:[r.jsx("h3",{className:"font-medium text-foreground",children:"Notifications"}),f>0&&r.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[f," non lue",f>1?"s":""]})]}),r.jsxs(Lh,{defaultValue:"all",className:"w-full",children:[r.jsxs(Oh,{className:"grid w-full grid-cols-3 rounded-none",children:[r.jsxs(Mh,{value:"all",className:"text-xs relative",children:["Tous",f>0&&r.jsx(Dh,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:f>9?"9+":f})]}),r.jsxs(Mh,{value:"streaks",className:"text-xs relative",children:["Sries",g>0&&r.jsx(Dh,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:g})]}),r.jsxs(Mh,{value:"social",className:"text-xs relative",children:["Social",x>0&&r.jsx(Dh,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:x})]})]}),r.jsx(Vh,{value:"all",className:"m-0",children:r.jsx(qh,{className:"h-96",children:0===e.length?r.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[r.jsx(de,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-sm",children:"Aucune notification"})]}):r.jsx("div",{children:e.map(e=>r.jsx(p,{notification:e},e.id))})})}),r.jsx(Vh,{value:"streaks",className:"m-0",children:r.jsx(qh,{className:"h-96",children:0===l.length?r.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[r.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-sm",children:"Aucune notification de srie"})]}):r.jsx("div",{children:l.map(e=>r.jsx(p,{notification:e},e.id))})})}),r.jsx(Vh,{value:"social",className:"m-0",children:r.jsx(qh,{className:"h-96",children:0===[...c,...d].length?r.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[r.jsx(me,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-sm",children:"Aucune notification sociale"})]}):r.jsx("div",{children:[...c,...d].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).map(e=>r.jsx(p,{notification:e},e.id))})})})]})]})}Bh.displayName=le.displayName;const Uh=ye,Fh=je,$h=s.forwardRef(({className:e,align:t="center",sideOffset:s=4,...n},a)=>r.jsx(ve,{children:r.jsx(be,{ref:a,align:t,sideOffset:s,className:zr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));function Wh(){const[e,t]=s.useState([]),[n,a]=s.useState(0),[i,o]=s.useState(!1),[l,c]=s.useState(!0);s.useEffect(()=>{(async()=>{try{const e=await async function(){const{data:e,error:t}=await en.from("notifications").select("*, actor:actor_id(id, username, avatar_url)").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return e}();t(e),a(e.filter(e=>!e.read_at).length)}catch(e){}finally{c(!1)}})()},[]),s.useEffect(()=>{let e=null;return(async()=>{const{unsubscribe:s}=await async function(e){const{data:t}=await en.auth.getSession(),s=t?.session?.user?.id;if(!s)return{unsubscribe:()=>{}};const r=en.channel("notif-"+s).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s}`},t=>e(t.new)).subscribe();return{unsubscribe:()=>en.removeChannel(r)}}(e=>{t(t=>[e,...t]),a(e=>e+1);const s="booky_received"===e.type?`${e.actor?.username??"Quelqu'un"} t'a donn un Booky pour ${e.book_title}`:"friend_finished"===e.type?`${e.actor?.username??"Quelqu'un"} a termin ${e.book_title}`:"streak_nudge"===e.type?e.meta?.msg??"Tu n'as pas valid aujourd'hui. Garde ta srie.":"streak_kept"===e.type?e.meta?.msg??"Srie maintenue. Continue.":"streak_lost"===e.type?e.meta?.msg??"Srie interrompue. On relance ce soir.":"weekly_digest"===e.type?e.meta?.msg??"Ton rsum hebdomadaire est prt":"Nouvelle notification";mn.success(s,{description:" Notification"})});e=s})(),()=>{e&&e()}},[]);return r.jsxs(Uh,{open:i,onOpenChange:o,children:[r.jsx(Fh,{asChild:!0,children:r.jsxs(qn,{variant:"ghost",size:"sm",className:"relative","aria-label":"Notifications "+(n>0?`(${n} non lues)`:""),children:[r.jsx(we,{className:"h-5 w-5"}),n>0&&r.jsx(Dh,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:n>99?"99+":n})]})}),r.jsx($h,{className:"w-96 p-0",align:"end",sideOffset:8,children:r.jsx(zh,{notifications:e,loading:l,onMarkAsRead:e=>{t(t=>t.map(t=>t.id===e?{...t,read_at:(new Date).toISOString()}:t)),a(e=>Math.max(0,e-1))}})})]})}function Zh(){const e=nh(),{user:t,isAdmin:s,isPremium:n}=kn(),{t:a}=Tn();return r.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-logo-accent/20 bg-logo-background/95 backdrop-blur supports-[backdrop-filter]:bg-logo-background/60",role:"banner",children:r.jsxs("div",{className:"mx-auto w-full px-4 max-w-none flex h-16 sm:h-14 items-center gap-4",children:[e&&r.jsx("div",{role:"navigation","aria-label":"Menu mobile",children:r.jsx(ph,{isAdmin:s,isPremium:n})}),r.jsx(Ph,{}),r.jsx("nav",{role:"navigation","aria-label":"Navigation principale",className:"hidden md:block",children:r.jsx(fh,{isAdmin:s,isPremium:n})}),t?r.jsxs("div",{role:"navigation","aria-label":"Menu utilisateur",className:"flex items-center gap-2",children:[r.jsx(Zn,{}),r.jsx(Wh,{}),"tanguy.warsmann@gmail.com"===t.email&&r.jsx("button",{onClick:()=>window.location.reload(),className:"px-2 py-1 text-xs bg-destructive text-destructive-foreground rounded hover:bg-destructive/90",title:"Force reload de l'app","aria-label":"Recharger l'application",children:""}),r.jsx(Th,{})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Zn,{}),r.jsx(qn,{variant:"default",className:"bg-logo-accent hover:bg-logo-accent/90 text-logo-background focus:ring-2 focus:ring-logo-accent focus:ring-offset-2",asChild:!0,children:r.jsx(T,{to:"/","aria-label":"Se connecter  votre compte VREAD",children:a.auth.signIn})})]})]})})}function Hh({children:e}){const t=H(),{user:n,isLoading:a,isInitialized:i}=kn();return s.useEffect(()=>{!i||a||n||t("/auth",{replace:!0})},[i,a,n,t]),!i||a?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):n?r.jsx(r.Fragment,{children:e}):r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Redirection..."})]})})}$h.displayName=be.displayName;const Gh=new Set,Kh=()=>Array.from(Gh);const Yh=new class{constructor(){t(this,"events",[])}trackAddToReadingList(e){const t={...e,timestamp:(new Date).toISOString()};this.events.push(t)}getEvents(){return[...this.events]}clearEvents(){this.events=[]}},Qh=(e,t,s={})=>{Yh.trackAddToReadingList({book_id:e,book_title:s.bookTitle,outcome:t,error_code:s.errorCode,user_id:s.userId})};class Xh extends Error{constructor(e,t){super(e),this.code=t,this.name="ReadingListError"}}class Jh extends Xh{constructor(e){super(`Le livre "${e}" est dj dans votre liste de lecture`,"ALREADY_EXISTS"),this.name="AlreadyInListError"}}class ep extends Xh{constructor(e){super(`Livre invalide: ${e}`,"INVALID_BOOK"),this.name="InvalidBookError"}}class tp extends Xh{constructor(){super("Vous devez tre connect pour ajouter un livre  votre liste","AUTH_REQUIRED"),this.name="AuthenticationRequiredError"}}const sp=e=>(e=>e instanceof Xh)(e)||e instanceof Error?e.message:"Une erreur inattendue est survenue";var rp,np,ap;(np=rp||(rp={})).assertEqual=e=>e,np.assertIs=function(e){},np.assertNever=function(e){throw new Error},np.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},np.getValidEnumValues=e=>{const t=np.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),s={};for(const r of t)s[r]=e[r];return np.objectValues(s)},np.objectValues=e=>np.objectKeys(e).map(function(t){return e[t]}),np.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},np.find=(e,t)=>{for(const s of e)if(t(s))return s},np.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,np.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},np.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(ap||(ap={})).mergeShapes=(e,t)=>({...e,...t});const ip=rp.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),op=e=>{switch(typeof e){case"undefined":return ip.undefined;case"string":return ip.string;case"number":return isNaN(e)?ip.nan:ip.number;case"boolean":return ip.boolean;case"function":return ip.function;case"bigint":return ip.bigint;case"symbol":return ip.symbol;case"object":return Array.isArray(e)?ip.array:null===e?ip.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?ip.promise:"undefined"!=typeof Map&&e instanceof Map?ip.map:"undefined"!=typeof Set&&e instanceof Set?ip.set:"undefined"!=typeof Date&&e instanceof Date?ip.date:ip.object;default:return ip.unknown}},lp=rp.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class cp extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},s={_errors:[]},r=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(r);else if("invalid_return_type"===n.code)r(n.returnTypeError);else if("invalid_arguments"===n.code)r(n.argumentsError);else if(0===n.path.length)s._errors.push(t(n));else{let e=s,r=0;for(;r<n.path.length;){const s=n.path[r];r===n.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(n))):e[s]=e[s]||{_errors:[]},e=e[s],r++}}};return r(this),s}static assert(e){if(!(e instanceof cp))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,rp.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}cp.create=e=>new cp(e);const dp=(e,t)=>{let s;switch(e.code){case lp.invalid_type:s=e.received===ip.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case lp.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,rp.jsonStringifyReplacer)}`;break;case lp.unrecognized_keys:s=`Unrecognized key(s) in object: ${rp.joinValues(e.keys,", ")}`;break;case lp.invalid_union:s="Invalid input";break;case lp.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${rp.joinValues(e.options)}`;break;case lp.invalid_enum_value:s=`Invalid enum value. Expected ${rp.joinValues(e.options)}, received '${e.received}'`;break;case lp.invalid_arguments:s="Invalid function arguments";break;case lp.invalid_return_type:s="Invalid function return type";break;case lp.invalid_date:s="Invalid date";break;case lp.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:rp.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case lp.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case lp.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case lp.custom:s="Invalid input";break;case lp.invalid_intersection_types:s="Intersection results could not be merged";break;case lp.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case lp.not_finite:s="Number must be finite";break;default:s=t.defaultError,rp.assertNever(e)}return{message:s}};let up=dp;function mp(){return up}const hp=e=>{const{data:t,path:s,errorMaps:r,issueData:n}=e,a=[...s,...n.path||[]],i={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";const l=r.filter(e=>!!e).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...n,path:a,message:o}};function pp(e,t){const s=mp(),r=hp({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===dp?void 0:dp].filter(e=>!!e)});e.common.issues.push(r)}class fp{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if("aborted"===r.status)return gp;"dirty"===r.status&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const e=await r.key,t=await r.value;s.push({key:e,value:t})}return fp.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:t,value:n}=r;if("aborted"===t.status)return gp;if("aborted"===n.status)return gp;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!r.alwaysSet||(s[t.value]=n.value)}return{status:e.value,value:s}}}const gp=Object.freeze({status:"aborted"}),xp=e=>({status:"dirty",value:e}),vp=e=>({status:"valid",value:e}),bp=e=>"aborted"===e.status,yp=e=>"dirty"===e.status,jp=e=>"valid"===e.status,wp=e=>"undefined"!=typeof Promise&&e instanceof Promise;function Np(e,t,s,r){if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function _p(e,t,s,r,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}var kp,Sp,Ep,Rp;"function"==typeof SuppressedError&&SuppressedError,(Sp=kp||(kp={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},Sp.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class Cp{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ap=(e,t)=>{if(jp(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new cp(e.common.issues);return this._error=t,this._error}}};function Tp(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:r,description:n}=e;if(t&&(s||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{var a,i;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(a=null!=o?o:r)&&void 0!==a?a:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(i=null!=o?o:s)&&void 0!==i?i:n.defaultError}},description:n}}class Pp{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return op(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:op(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new fp,ctx:{common:e.parent.common,data:e.data,parsedType:op(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(wp(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const r={common:{issues:[],async:null!==(s=null==t?void 0:t.async)&&void 0!==s&&s,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:op(e)},n=this._parseSync({data:e,path:r.path,parent:r});return Ap(r,n)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:op(e)},r=this._parse({data:e,path:s.path,parent:s}),n=await(wp(r)?r:Promise.resolve(r));return Ap(s,n)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const n=e(t),a=()=>r.addIssue({code:lp.custom,...s(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((s,r)=>!!e(s)||(r.addIssue("function"==typeof t?t(s,r):t),!1))}_refinement(e){return new Cf({schema:this,typeName:zf.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Af.create(this,this._def)}nullable(){return Tf.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return df.create(this,this._def)}promise(){return Rf.create(this,this._def)}or(e){return hf.create([this,e],this._def)}and(e){return xf.create(this,e,this._def)}transform(e){return new Cf({...Tp(this._def),schema:this,typeName:zf.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Pf({...Tp(this._def),innerType:this,defaultValue:t,typeName:zf.ZodDefault})}brand(){return new Of({typeName:zf.ZodBranded,type:this,...Tp(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new If({...Tp(this._def),innerType:this,catchValue:t,typeName:zf.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Mf.create(this,e)}readonly(){return Vf.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ip=/^c[^\s-]{8,}$/i,Dp=/^[0-9a-z]+$/,Lp=/^[0-9A-HJKMNP-TV-Z]{26}$/,Op=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Mp=/^[a-z0-9_-]{21}$/i,Vp=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qp=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Bp;const zp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Up=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Fp=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$p="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wp=new RegExp(`^${$p}$`);function Zp(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function Hp(e){return new RegExp(`^${Zp(e)}$`)}function Gp(e){let t=`${$p}T${Zp(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function Kp(e,t){return!("v4"!==t&&t||!zp.test(e))||!("v6"!==t&&t||!Up.test(e))}class Yp extends Pp{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==ip.string){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.string,received:t.parsedType}),gp}const t=new fp;let s;for(const n of this._def.checks)if("min"===n.kind)e.data.length<n.value&&(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("max"===n.kind)e.data.length>n.value&&(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("length"===n.kind){const r=e.data.length>n.value,a=e.data.length<n.value;(r||a)&&(s=this._getOrReturnCtx(e,s),r?pp(s,{code:lp.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&pp(s,{code:lp.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),t.dirty())}else if("email"===n.kind)qp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"email",code:lp.invalid_string,message:n.message}),t.dirty());else if("emoji"===n.kind)Bp||(Bp=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Bp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"emoji",code:lp.invalid_string,message:n.message}),t.dirty());else if("uuid"===n.kind)Op.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"uuid",code:lp.invalid_string,message:n.message}),t.dirty());else if("nanoid"===n.kind)Mp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"nanoid",code:lp.invalid_string,message:n.message}),t.dirty());else if("cuid"===n.kind)Ip.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"cuid",code:lp.invalid_string,message:n.message}),t.dirty());else if("cuid2"===n.kind)Dp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"cuid2",code:lp.invalid_string,message:n.message}),t.dirty());else if("ulid"===n.kind)Lp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"ulid",code:lp.invalid_string,message:n.message}),t.dirty());else if("url"===n.kind)try{new URL(e.data)}catch(r){s=this._getOrReturnCtx(e,s),pp(s,{validation:"url",code:lp.invalid_string,message:n.message}),t.dirty()}else if("regex"===n.kind){n.regex.lastIndex=0;n.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"regex",code:lp.invalid_string,message:n.message}),t.dirty())}else if("trim"===n.kind)e.data=e.data.trim();else if("includes"===n.kind)e.data.includes(n.value,n.position)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),t.dirty());else if("toLowerCase"===n.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===n.kind)e.data=e.data.toUpperCase();else if("startsWith"===n.kind)e.data.startsWith(n.value)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:{startsWith:n.value},message:n.message}),t.dirty());else if("endsWith"===n.kind)e.data.endsWith(n.value)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:{endsWith:n.value},message:n.message}),t.dirty());else if("datetime"===n.kind){Gp(n).test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:"datetime",message:n.message}),t.dirty())}else if("date"===n.kind){Wp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:"date",message:n.message}),t.dirty())}else if("time"===n.kind){Hp(n).test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.invalid_string,validation:"time",message:n.message}),t.dirty())}else"duration"===n.kind?Vp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"duration",code:lp.invalid_string,message:n.message}),t.dirty()):"ip"===n.kind?Kp(e.data,n.version)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"ip",code:lp.invalid_string,message:n.message}),t.dirty()):"base64"===n.kind?Fp.test(e.data)||(s=this._getOrReturnCtx(e,s),pp(s,{validation:"base64",code:lp.invalid_string,message:n.message}),t.dirty()):rp.assertNever(n);return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:lp.invalid_string,...kp.errToObj(s)})}_addCheck(e){return new Yp({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...kp.errToObj(e)})}url(e){return this._addCheck({kind:"url",...kp.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...kp.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...kp.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...kp.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...kp.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...kp.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...kp.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...kp.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...kp.errToObj(e)})}datetime(e){var t,s;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(s=null==e?void 0:e.local)&&void 0!==s&&s,...kp.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...kp.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...kp.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...kp.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...kp.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...kp.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...kp.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...kp.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...kp.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...kp.errToObj(t)})}nonempty(e){return this.min(1,kp.errToObj(e))}trim(){return new Yp({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yp({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yp({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Qp(e,t){const s=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=s>r?s:r;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}Yp.create=e=>{var t;return new Yp({checks:[],typeName:zf.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Tp(e)})};class Xp extends Pp{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==ip.number){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.number,received:t.parsedType}),gp}let t;const s=new fp;for(const r of this._def.checks)if("int"===r.kind)rp.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else"multipleOf"===r.kind?0!==Qp(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.not_finite,message:r.message}),s.dirty()):rp.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,kp.toString(t))}gt(e,t){return this.setLimit("min",e,!1,kp.toString(t))}lte(e,t){return this.setLimit("max",e,!0,kp.toString(t))}lt(e,t){return this.setLimit("max",e,!1,kp.toString(t))}setLimit(e,t,s,r){return new Xp({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:kp.toString(r)}]})}_addCheck(e){return new Xp({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:kp.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:kp.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:kp.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:kp.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:kp.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:kp.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:kp.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:kp.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:kp.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&rp.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Xp.create=e=>new Xp({checks:[],typeName:zf.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Tp(e)});class Jp extends Pp{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==ip.bigint){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.bigint,received:t.parsedType}),gp}let t;const s=new fp;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),pp(t,{code:lp.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):rp.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,kp.toString(t))}gt(e,t){return this.setLimit("min",e,!1,kp.toString(t))}lte(e,t){return this.setLimit("max",e,!0,kp.toString(t))}lt(e,t){return this.setLimit("max",e,!1,kp.toString(t))}setLimit(e,t,s,r){return new Jp({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:kp.toString(r)}]})}_addCheck(e){return new Jp({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:kp.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:kp.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:kp.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:kp.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:kp.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Jp.create=e=>{var t;return new Jp({checks:[],typeName:zf.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Tp(e)})};class ef extends Pp{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==ip.boolean){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.boolean,received:t.parsedType}),gp}return vp(e.data)}}ef.create=e=>new ef({typeName:zf.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Tp(e)});class tf extends Pp{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==ip.date){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.date,received:t.parsedType}),gp}if(isNaN(e.data.getTime())){return pp(this._getOrReturnCtx(e),{code:lp.invalid_date}),gp}const t=new fp;let s;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(s=this._getOrReturnCtx(e,s),pp(s,{code:lp.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):rp.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tf({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:kp.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:kp.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}tf.create=e=>new tf({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:zf.ZodDate,...Tp(e)});class sf extends Pp{_parse(e){if(this._getType(e)!==ip.symbol){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.symbol,received:t.parsedType}),gp}return vp(e.data)}}sf.create=e=>new sf({typeName:zf.ZodSymbol,...Tp(e)});class rf extends Pp{_parse(e){if(this._getType(e)!==ip.undefined){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.undefined,received:t.parsedType}),gp}return vp(e.data)}}rf.create=e=>new rf({typeName:zf.ZodUndefined,...Tp(e)});class nf extends Pp{_parse(e){if(this._getType(e)!==ip.null){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.null,received:t.parsedType}),gp}return vp(e.data)}}nf.create=e=>new nf({typeName:zf.ZodNull,...Tp(e)});class af extends Pp{constructor(){super(...arguments),this._any=!0}_parse(e){return vp(e.data)}}af.create=e=>new af({typeName:zf.ZodAny,...Tp(e)});class of extends Pp{constructor(){super(...arguments),this._unknown=!0}_parse(e){return vp(e.data)}}of.create=e=>new of({typeName:zf.ZodUnknown,...Tp(e)});class lf extends Pp{_parse(e){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.never,received:t.parsedType}),gp}}lf.create=e=>new lf({typeName:zf.ZodNever,...Tp(e)});class cf extends Pp{_parse(e){if(this._getType(e)!==ip.undefined){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.void,received:t.parsedType}),gp}return vp(e.data)}}cf.create=e=>new cf({typeName:zf.ZodVoid,...Tp(e)});class df extends Pp{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==ip.array)return pp(t,{code:lp.invalid_type,expected:ip.array,received:t.parsedType}),gp;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,n=t.data.length<r.exactLength.value;(e||n)&&(pp(t,{code:e?lp.too_big:lp.too_small,minimum:n?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(pp(t,{code:lp.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(pp(t,{code:lp.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>r.type._parseAsync(new Cp(t,e,t.path,s)))).then(e=>fp.mergeArray(s,e));const n=[...t.data].map((e,s)=>r.type._parseSync(new Cp(t,e,t.path,s)));return fp.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new df({...this._def,minLength:{value:e,message:kp.toString(t)}})}max(e,t){return new df({...this._def,maxLength:{value:e,message:kp.toString(t)}})}length(e,t){return new df({...this._def,exactLength:{value:e,message:kp.toString(t)}})}nonempty(e){return this.min(1,e)}}function uf(e){if(e instanceof mf){const t={};for(const s in e.shape){const r=e.shape[s];t[s]=Af.create(uf(r))}return new mf({...e._def,shape:()=>t})}return e instanceof df?new df({...e._def,type:uf(e.element)}):e instanceof Af?Af.create(uf(e.unwrap())):e instanceof Tf?Tf.create(uf(e.unwrap())):e instanceof vf?vf.create(e.items.map(e=>uf(e))):e}df.create=(e,t)=>new df({type:e,minLength:null,maxLength:null,exactLength:null,typeName:zf.ZodArray,...Tp(t)});class mf extends Pp{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=rp.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ip.object){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.object,received:t.parsedType}),gp}const{status:t,ctx:s}=this._processInputParams(e),{shape:r,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof lf&&"strip"===this._def.unknownKeys))for(const o in s.data)n.includes(o)||a.push(o);const i=[];for(const o of n){const e=r[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new Cp(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof lf){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of a)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)a.length>0&&(pp(s,{code:lp.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const r=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new Cp(s,r,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const s=await t.key,r=await t.value;e.push({key:s,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>fp.mergeObjectSync(t,e)):fp.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return kp.errToObj,new mf({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{var r,n,a,i;const o=null!==(a=null===(n=(r=this._def).errorMap)||void 0===n?void 0:n.call(r,t,s).message)&&void 0!==a?a:s.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=kp.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new mf({...this._def,unknownKeys:"strip"})}passthrough(){return new mf({...this._def,unknownKeys:"passthrough"})}extend(e){return new mf({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new mf({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:zf.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new mf({...this._def,catchall:e})}pick(e){const t={};return rp.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new mf({...this._def,shape:()=>t})}omit(e){const t={};return rp.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new mf({...this._def,shape:()=>t})}deepPartial(){return uf(this)}partial(e){const t={};return rp.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}),new mf({...this._def,shape:()=>t})}required(e){const t={};return rp.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof Af;)e=e._def.innerType;t[s]=e}}),new mf({...this._def,shape:()=>t})}keyof(){return kf(rp.objectKeys(this.shape))}}mf.create=(e,t)=>new mf({shape:()=>e,unknownKeys:"strip",catchall:lf.create(),typeName:zf.ZodObject,...Tp(t)}),mf.strictCreate=(e,t)=>new mf({shape:()=>e,unknownKeys:"strict",catchall:lf.create(),typeName:zf.ZodObject,...Tp(t)}),mf.lazycreate=(e,t)=>new mf({shape:e,unknownKeys:"strip",catchall:lf.create(),typeName:zf.ZodObject,...Tp(t)});class hf extends Pp{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const s=e.map(e=>new cp(e.ctx.common.issues));return pp(t,{code:lp.invalid_union,unionErrors:s}),gp});{let e;const r=[];for(const a of s){const s={...t,common:{...t.common,issues:[]},parent:null},n=a._parseSync({data:t.data,path:t.path,parent:s});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:s}),s.common.issues.length&&r.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=r.map(e=>new cp(e));return pp(t,{code:lp.invalid_union,unionErrors:n}),gp}}get options(){return this._def.options}}hf.create=(e,t)=>new hf({options:e,typeName:zf.ZodUnion,...Tp(t)});const pf=e=>e instanceof Nf?pf(e.schema):e instanceof Cf?pf(e.innerType()):e instanceof _f?[e.value]:e instanceof Sf?e.options:e instanceof Ef?rp.objectValues(e.enum):e instanceof Pf?pf(e._def.innerType):e instanceof rf?[void 0]:e instanceof nf?[null]:e instanceof Af?[void 0,...pf(e.unwrap())]:e instanceof Tf?[null,...pf(e.unwrap())]:e instanceof Of||e instanceof Vf?pf(e.unwrap()):e instanceof If?pf(e._def.innerType):[];class ff extends Pp{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ip.object)return pp(t,{code:lp.invalid_type,expected:ip.object,received:t.parsedType}),gp;const s=this.discriminator,r=t.data[s],n=this.optionsMap.get(r);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(pp(t,{code:lp.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),gp)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const r=new Map;for(const n of t){const t=pf(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,n)}}return new ff({typeName:zf.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...Tp(s)})}}function gf(e,t){const s=op(e),r=op(t);if(e===t)return{valid:!0,data:e};if(s===ip.object&&r===ip.object){const s=rp.objectKeys(t),r=rp.objectKeys(e).filter(e=>-1!==s.indexOf(e)),n={...e,...t};for(const a of r){const s=gf(e[a],t[a]);if(!s.valid)return{valid:!1};n[a]=s.data}return{valid:!0,data:n}}if(s===ip.array&&r===ip.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<e.length;r++){const n=gf(e[r],t[r]);if(!n.valid)return{valid:!1};s.push(n.data)}return{valid:!0,data:s}}return s===ip.date&&r===ip.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class xf extends Pp{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=(e,r)=>{if(bp(e)||bp(r))return gp;const n=gf(e.value,r.value);return n.valid?((yp(e)||yp(r))&&t.dirty(),{status:t.value,value:n.data}):(pp(s,{code:lp.invalid_intersection_types}),gp)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}xf.create=(e,t,s)=>new xf({left:e,right:t,typeName:zf.ZodIntersection,...Tp(s)});class vf extends Pp{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ip.array)return pp(s,{code:lp.invalid_type,expected:ip.array,received:s.parsedType}),gp;if(s.data.length<this._def.items.length)return pp(s,{code:lp.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),gp;!this._def.rest&&s.data.length>this._def.items.length&&(pp(s,{code:lp.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...s.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Cp(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(r).then(e=>fp.mergeArray(t,e)):fp.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new vf({...this._def,rest:e})}}vf.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new vf({items:e,typeName:zf.ZodTuple,rest:null,...Tp(t)})};class bf extends Pp{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ip.object)return pp(s,{code:lp.invalid_type,expected:ip.object,received:s.parsedType}),gp;const r=[],n=this._def.keyType,a=this._def.valueType;for(const i in s.data)r.push({key:n._parse(new Cp(s,i,s.path,i)),value:a._parse(new Cp(s,s.data[i],s.path,i)),alwaysSet:i in s.data});return s.common.async?fp.mergeObjectAsync(t,r):fp.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return new bf(t instanceof Pp?{keyType:e,valueType:t,typeName:zf.ZodRecord,...Tp(s)}:{keyType:Yp.create(),valueType:e,typeName:zf.ZodRecord,...Tp(t)})}}class yf extends Pp{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ip.map)return pp(s,{code:lp.invalid_type,expected:ip.map,received:s.parsedType}),gp;const r=this._def.keyType,n=this._def.valueType,a=[...s.data.entries()].map(([e,t],a)=>({key:r._parse(new Cp(s,e,s.path,[a,"key"])),value:n._parse(new Cp(s,t,s.path,[a,"value"]))}));if(s.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const s of a){const r=await s.key,n=await s.value;if("aborted"===r.status||"aborted"===n.status)return gp;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}})}{const e=new Map;for(const s of a){const r=s.key,n=s.value;if("aborted"===r.status||"aborted"===n.status)return gp;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}}}}yf.create=(e,t,s)=>new yf({valueType:t,keyType:e,typeName:zf.ZodMap,...Tp(s)});class jf extends Pp{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ip.set)return pp(s,{code:lp.invalid_type,expected:ip.set,received:s.parsedType}),gp;const r=this._def;null!==r.minSize&&s.data.size<r.minSize.value&&(pp(s,{code:lp.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&s.data.size>r.maxSize.value&&(pp(s,{code:lp.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const n=this._def.valueType;function a(e){const s=new Set;for(const r of e){if("aborted"===r.status)return gp;"dirty"===r.status&&t.dirty(),s.add(r.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map((e,t)=>n._parse(new Cp(s,e,s.path,t)));return s.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new jf({...this._def,minSize:{value:e,message:kp.toString(t)}})}max(e,t){return new jf({...this._def,maxSize:{value:e,message:kp.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}jf.create=(e,t)=>new jf({valueType:e,minSize:null,maxSize:null,typeName:zf.ZodSet,...Tp(t)});class wf extends Pp{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ip.function)return pp(t,{code:lp.invalid_type,expected:ip.function,received:t.parsedType}),gp;function s(e,s){return hp({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,mp(),dp].filter(e=>!!e),issueData:{code:lp.invalid_arguments,argumentsError:s}})}function r(e,s){return hp({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,mp(),dp].filter(e=>!!e),issueData:{code:lp.invalid_return_type,returnTypeError:s}})}const n={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Rf){const e=this;return vp(async function(...t){const i=new cp([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(s(t,e)),i}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(r(l,e)),i})})}{const e=this;return vp(function(...t){const i=e._def.args.safeParse(t,n);if(!i.success)throw new cp([s(t,i.error)]);const o=Reflect.apply(a,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new cp([r(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new wf({...this._def,args:vf.create(e).rest(of.create())})}returns(e){return new wf({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new wf({args:e||vf.create([]).rest(of.create()),returns:t||of.create(),typeName:zf.ZodFunction,...Tp(s)})}}class Nf extends Pp{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Nf.create=(e,t)=>new Nf({getter:e,typeName:zf.ZodLazy,...Tp(t)});class _f extends Pp{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return pp(t,{received:t.data,code:lp.invalid_literal,expected:this._def.value}),gp}return{status:"valid",value:e.data}}get value(){return this._def.value}}function kf(e,t){return new Sf({values:e,typeName:zf.ZodEnum,...Tp(t)})}_f.create=(e,t)=>new _f({value:e,typeName:zf.ZodLiteral,...Tp(t)});class Sf extends Pp{constructor(){super(...arguments),Ep.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return pp(t,{expected:rp.joinValues(s),received:t.parsedType,code:lp.invalid_type}),gp}if(Np(this,Ep)||_p(this,Ep,new Set(this._def.values)),!Np(this,Ep).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return pp(t,{received:t.data,code:lp.invalid_enum_value,options:s}),gp}return vp(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Sf.create(e,{...this._def,...t})}exclude(e,t=this._def){return Sf.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Ep=new WeakMap,Sf.create=kf;class Ef extends Pp{constructor(){super(...arguments),Rp.set(this,void 0)}_parse(e){const t=rp.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==ip.string&&s.parsedType!==ip.number){const e=rp.objectValues(t);return pp(s,{expected:rp.joinValues(e),received:s.parsedType,code:lp.invalid_type}),gp}if(Np(this,Rp)||_p(this,Rp,new Set(rp.getValidEnumValues(this._def.values))),!Np(this,Rp).has(e.data)){const e=rp.objectValues(t);return pp(s,{received:s.data,code:lp.invalid_enum_value,options:e}),gp}return vp(e.data)}get enum(){return this._def.values}}Rp=new WeakMap,Ef.create=(e,t)=>new Ef({values:e,typeName:zf.ZodNativeEnum,...Tp(t)});class Rf extends Pp{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ip.promise&&!1===t.common.async)return pp(t,{code:lp.invalid_type,expected:ip.promise,received:t.parsedType}),gp;const s=t.parsedType===ip.promise?t.data:Promise.resolve(t.data);return vp(s.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Rf.create=(e,t)=>new Rf({type:e,typeName:zf.ZodPromise,...Tp(t)});class Cf extends Pp{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===zf.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,n={addIssue:e=>{pp(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===r.type){const e=r.transform(s.data,n);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return gp;const r=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===r.status?gp:"dirty"===r.status||"dirty"===t.value?xp(r.value):r});{if("aborted"===t.value)return gp;const r=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===r.status?gp:"dirty"===r.status||"dirty"===t.value?xp(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,n);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const r=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===r.status?gp:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?gp:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))))}if("transform"===r.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!jp(e))return e;const a=r.transform(e.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>jp(e)?Promise.resolve(r.transform(e.value,n)).then(e=>({status:t.value,value:e})):e)}rp.assertNever(r)}}Cf.create=(e,t,s)=>new Cf({schema:e,typeName:zf.ZodEffects,effect:t,...Tp(s)}),Cf.createWithPreprocess=(e,t,s)=>new Cf({schema:t,effect:{type:"preprocess",transform:e},typeName:zf.ZodEffects,...Tp(s)});class Af extends Pp{_parse(e){return this._getType(e)===ip.undefined?vp(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Af.create=(e,t)=>new Af({innerType:e,typeName:zf.ZodOptional,...Tp(t)});class Tf extends Pp{_parse(e){return this._getType(e)===ip.null?vp(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Tf.create=(e,t)=>new Tf({innerType:e,typeName:zf.ZodNullable,...Tp(t)});class Pf extends Pp{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===ip.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Pf.create=(e,t)=>new Pf({innerType:e,typeName:zf.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Tp(t)});class If extends Pp{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return wp(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new cp(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new cp(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}If.create=(e,t)=>new If({innerType:e,typeName:zf.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Tp(t)});class Df extends Pp{_parse(e){if(this._getType(e)!==ip.nan){const t=this._getOrReturnCtx(e);return pp(t,{code:lp.invalid_type,expected:ip.nan,received:t.parsedType}),gp}return{status:"valid",value:e.data}}}Df.create=e=>new Df({typeName:zf.ZodNaN,...Tp(e)});const Lf=Symbol("zod_brand");class Of extends Pp{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Mf extends Pp{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?gp:"dirty"===e.status?(t.dirty(),xp(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?gp:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new Mf({in:e,out:t,typeName:zf.ZodPipeline})}}class Vf extends Pp{_parse(e){const t=this._def.innerType._parse(e),s=e=>(jp(e)&&(e.value=Object.freeze(e.value)),e);return wp(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}function qf(e,t={},s){return e?af.create().superRefine((r,n)=>{var a,i;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,o=null===(i=null!==(a=e.fatal)&&void 0!==a?a:s)||void 0===i||i,l="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...l,fatal:o})}}):af.create()}Vf.create=(e,t)=>new Vf({innerType:e,typeName:zf.ZodReadonly,...Tp(t)});const Bf={object:mf.lazycreate};var zf,Uf;(Uf=zf||(zf={})).ZodString="ZodString",Uf.ZodNumber="ZodNumber",Uf.ZodNaN="ZodNaN",Uf.ZodBigInt="ZodBigInt",Uf.ZodBoolean="ZodBoolean",Uf.ZodDate="ZodDate",Uf.ZodSymbol="ZodSymbol",Uf.ZodUndefined="ZodUndefined",Uf.ZodNull="ZodNull",Uf.ZodAny="ZodAny",Uf.ZodUnknown="ZodUnknown",Uf.ZodNever="ZodNever",Uf.ZodVoid="ZodVoid",Uf.ZodArray="ZodArray",Uf.ZodObject="ZodObject",Uf.ZodUnion="ZodUnion",Uf.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Uf.ZodIntersection="ZodIntersection",Uf.ZodTuple="ZodTuple",Uf.ZodRecord="ZodRecord",Uf.ZodMap="ZodMap",Uf.ZodSet="ZodSet",Uf.ZodFunction="ZodFunction",Uf.ZodLazy="ZodLazy",Uf.ZodLiteral="ZodLiteral",Uf.ZodEnum="ZodEnum",Uf.ZodEffects="ZodEffects",Uf.ZodNativeEnum="ZodNativeEnum",Uf.ZodOptional="ZodOptional",Uf.ZodNullable="ZodNullable",Uf.ZodDefault="ZodDefault",Uf.ZodCatch="ZodCatch",Uf.ZodPromise="ZodPromise",Uf.ZodBranded="ZodBranded",Uf.ZodPipeline="ZodPipeline",Uf.ZodReadonly="ZodReadonly";const Ff=Yp.create,$f=Xp.create,Wf=Df.create,Zf=Jp.create,Hf=ef.create,Gf=tf.create,Kf=sf.create,Yf=rf.create,Qf=nf.create,Xf=af.create,Jf=of.create,eg=lf.create,tg=cf.create,sg=df.create,rg=mf.create,ng=mf.strictCreate,ag=hf.create,ig=ff.create,og=xf.create,lg=vf.create,cg=bf.create,dg=yf.create,ug=jf.create,mg=wf.create,hg=Nf.create,pg=_f.create,fg=Sf.create,gg=Ef.create,xg=Rf.create,vg=Cf.create,bg=Af.create,yg=Tf.create,jg=Cf.createWithPreprocess,wg=Mf.create,Ng={string:e=>Yp.create({...e,coerce:!0}),number:e=>Xp.create({...e,coerce:!0}),boolean:e=>ef.create({...e,coerce:!0}),bigint:e=>Jp.create({...e,coerce:!0}),date:e=>tf.create({...e,coerce:!0})},_g=gp;var kg=Object.freeze({__proto__:null,defaultErrorMap:dp,setErrorMap:function(e){up=e},getErrorMap:mp,makeIssue:hp,EMPTY_PATH:[],addIssueToContext:pp,ParseStatus:fp,INVALID:gp,DIRTY:xp,OK:vp,isAborted:bp,isDirty:yp,isValid:jp,isAsync:wp,get util(){return rp},get objectUtil(){return ap},ZodParsedType:ip,getParsedType:op,ZodType:Pp,datetimeRegex:Gp,ZodString:Yp,ZodNumber:Xp,ZodBigInt:Jp,ZodBoolean:ef,ZodDate:tf,ZodSymbol:sf,ZodUndefined:rf,ZodNull:nf,ZodAny:af,ZodUnknown:of,ZodNever:lf,ZodVoid:cf,ZodArray:df,ZodObject:mf,ZodUnion:hf,ZodDiscriminatedUnion:ff,ZodIntersection:xf,ZodTuple:vf,ZodRecord:bf,ZodMap:yf,ZodSet:jf,ZodFunction:wf,ZodLazy:Nf,ZodLiteral:_f,ZodEnum:Sf,ZodNativeEnum:Ef,ZodPromise:Rf,ZodEffects:Cf,ZodTransformer:Cf,ZodOptional:Af,ZodNullable:Tf,ZodDefault:Pf,ZodCatch:If,ZodNaN:Df,BRAND:Lf,ZodBranded:Of,ZodPipeline:Mf,ZodReadonly:Vf,custom:qf,Schema:Pp,ZodSchema:Pp,late:Bf,get ZodFirstPartyTypeKind(){return zf},coerce:Ng,any:Xf,array:sg,bigint:Zf,boolean:Hf,date:Gf,discriminatedUnion:ig,effect:vg,enum:fg,function:mg,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>qf(t=>t instanceof e,t),intersection:og,lazy:hg,literal:pg,map:dg,nan:Wf,nativeEnum:gg,never:eg,null:Qf,nullable:yg,number:$f,object:rg,oboolean:()=>Hf().optional(),onumber:()=>$f().optional(),optional:bg,ostring:()=>Ff().optional(),pipeline:wg,preprocess:jg,promise:xg,record:cg,set:ug,strictObject:ng,string:Ff,symbol:Kf,transformer:vg,tuple:lg,undefined:Yf,union:ag,unknown:Jf,void:tg,NEVER:_g,ZodIssueCode:lp,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:cp});const Sg=kg.object({id:kg.string().min(1,"L'ID du livre ne peut pas tre vide"),title:kg.string().min(1,"Le titre ne peut pas tre vide"),author:kg.string().optional(),slug:kg.string().optional()}).refine(e=>{const t=e.id&&e.id.trim().length>0,s=e.slug&&e.slug.trim().length>0;return t||s},{message:"Le livre doit avoir un ID ou un slug valide",path:["id"]});function Eg(e){if(!e)throw new ep("Le livre ne peut pas tre null ou undefined");try{Sg.parse(e)}catch(t){if(t instanceof kg.ZodError){const e=t.errors[0];throw new ep(e?.message||"Livre invalide")}throw new ep("Validation du livre choue")}}async function Rg(e,t){try{const{count:s,error:r}=await en.from("reading_validations").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("book_id",t);return r?0:s||0}catch(s){return 0}}async function Cg(e,t){if(!e||0===t.length)return{};try{const{data:s,error:r}=await en.from("reading_validations").select("book_id, segment").eq("user_id",e).in("book_id",t);if(r)return{};const n={};return s&&s.forEach(e=>{const t=e.book_id;n[t]=(n[t]||0)+1}),n}catch(s){return{}}}const Ag=Object.freeze(Object.defineProperty({__proto__:null,getAllValidatedSegmentCounts:Cg,getValidatedSegmentCount:Rg},Symbol.toStringTag,{value:"Module"}));function Tg(e){const t=e.filter(e=>"completed"===e.status),s=e.filter(e=>"in_progress"===e.status),r=e.filter(e=>"to_read"===e.status);return{toRead:r,inProgress:s,completed:t,toReadCount:r.length,inProgressCount:s.length,completedCount:t.length}}async function Pg(e){const{data:t,error:s}=await en.from("reading_progress").select("\n      id,\n      user_id,\n      book_id,\n      current_page,\n      total_pages,\n      status,\n      updated_at,\n      started_at,\n      books:books_public(\n        id, slug, title, author, cover_url, total_chapters, expected_segments\n      )\n    ").eq("user_id",e).order("updated_at",{ascending:!1});return Tg(s?[]:t??[])}const Ig=async(e,t,s)=>{if(!e||!s)return[];if(e.toRead&&e.inProgress&&e.completed){const r={to_read:e.toRead,in_progress:e.inProgress,completed:e.completed}[t]||[],n=r.map(e=>e.book_id),a=await Cg(s,n);return Promise.all(r.map(async e=>{const s=a[e.book_id]||0,r=e.books?.expected_segments||e.books?.total_chapters||10,n=Math.round(s/(r||1)*100);return{id:e.books?.id||e.book_id,title:e.books?.title||"Titre inconnu",author:e.books?.author||"Auteur inconnu",description:e.books?.description||"",coverImage:e.books?.cover_url||"",cover_url:e.books?.cover_url||"",pages:e.books?.total_pages||0,categories:e.books?.tags||[],tags:e.books?.tags||[],totalChapters:r,chaptersRead:s,currentSegment:s,progressPercent:n,expectedSegments:r,language:"fr",publicationYear:(new Date).getFullYear(),slug:e.books?.slug||e.books?.id||e.book_id,isCompleted:"completed"===t}}))}return[]};const Dg=()=>{const[e,t]=s.useState([]),[r,n]=s.useState([]),[a,i]=s.useState([]),[o,l]=s.useState(!0),[c,d]=s.useState(null),[u,m]=s.useState(!1),{sortBy:h,setSortBy:p,sortBooks:f}=function(){const[e,t]=s.useState("date");return{sortBy:e,setSortBy:t,sortBooks:s.useCallback((e,t)=>e&&Array.isArray(e)?[...e].sort((e,s)=>{switch(t){case"author":return(e.author||"").localeCompare(s.author||"");case"pages":return(s.pages||0)-(e.pages||0);default:return s.id.localeCompare(e.id)}}):[],[])}}(),g=s.useRef(!0);s.useEffect(()=>()=>{g.current=!1},[]);return{books:{toRead:e,inProgress:r,completed:a},sortState:{sortBy:h,setSortBy:p},loading:{isLoading:o,setIsLoading:l,isFetching:u,setIsFetching:m},error:{current:c,setError:d},updateBooks:(e,s,r)=>{g.current&&(t(f(e,h)),n(f(s,h)),i(f(r,h)))},isMounted:g}},Lg={};function Og(e,t){Lg[e]=t}function Mg(){Object.keys(Lg).forEach(e=>{delete Lg[e]})}function Vg(e){const t=s.useRef(e);return t.current=e,s.useCallback((...e)=>t.current(...e),[])}class qg{static reportError(e,t,s){const r={error:e,info:t,timestamp:Date.now(),component:s};this.errors.push(r)}static getErrorHistory(){return this.errors}static clearErrors(){this.errors=[]}}t(qg,"errors",[]);const Bg=(e,t)=>(...s)=>{try{return e(...s)}catch(r){throw qg.reportError(r,{componentStack:t,errorBoundary:t},t),r}};const zg=new class{constructor(){t(this,"dbName","ReadAppCache"),t(this,"dbVersion",1),t(this,"storeName","cache"),t(this,"db",null)}async init(){if(!this.db)return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=()=>{const e=s.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName)}})}async set(e,t,s=3e5){if(await this.init(),!this.db)return;const r={data:t,timestamp:Date.now(),ttl:s};return new Promise((t,s)=>{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(r,e);n.onerror=()=>s(n.error),n.onsuccess=()=>t()})}async get(e){return await this.init(),this.db?new Promise((t,s)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onerror=()=>s(r.error),r.onsuccess=()=>{const s=r.result;if(s)return Date.now()-s.timestamp>s.ttl?(this.delete(e),void t(null)):void t(s.data);t(null)}}):null}async delete(e){if(await this.init(),this.db)return new Promise((t,s)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onerror=()=>s(r.error),r.onsuccess=()=>t()})}async clear(){if(await this.init(),this.db)return new Promise((e,t)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onerror=()=>t(s.error),s.onsuccess=()=>e()})}},Ug=()=>{const e=_e(),{user:t}=kn(),r=s.useRef(!1),n=s.useRef(0),a=s.useRef(!1),i=function(e,t){const[r,n]=s.useState(e);return s.useEffect(()=>{const s=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(s)}},[e,t]),r}(t?.id,300),{books:o,sortState:l,loading:{isLoading:c,setIsLoading:d,isFetching:u,setIsFetching:m},error:{current:h,setError:p},updateBooks:f,isMounted:g}=Dg(),x=s.useMemo(()=>({queryKey:["reading_list",i],queryFn:async()=>{const e=`reading_list_${i}`;performance.now();try{const t=await zg.get(e);if(t)return t}catch(s){}const t=await Pg(i||"");try{await zg.set(e,t,3e5)}catch(s){}return t},enabled:!!i,staleTime:3e5,refetchOnMount:!r.current,refetchOnReconnect:!1,refetchOnWindowFocus:!1,retry:2,gcTime:6e5}),[i]),{data:v,isLoading:b,error:y,isSuccess:j,refetch:w}=ke(x);s.useEffect(()=>{j&&!r.current&&(r.current=!0)},[j]),s.useEffect(()=>{if(i)Mg(),e.invalidateQueries({queryKey:["reading_list"]});else{e.resetQueries({queryKey:["reading_list"]}),n.current=0,r.current=!1,Mg();[`reading_list_${i}`,"reading_progress","books_by_status"].forEach(e=>{try{zg.delete(e)}catch(t){}})}},[i,e]);const N=Vg(Bg(async t=>{if(!i||!v)return[];if("completed"===t){const s=await Ig(v,t,i);return Og(t,s),e.setQueryData(["books_by_status",i,t],s),s}const s=function(e){return Lg[e]}(t);if(s&&s.length>0)return s;const r=e.getQueryData(["books_by_status",i,t]);if(r&&r.length>0)return Og(t,r),r;const n=await Ig(v,t,i);return Og(t,n),e.setQueryData(["books_by_status",i,t],n),n},"useReadingList.getBooksByStatus")),_=Vg(Bg(async t=>{if(!i)return mn.error("Vous devez tre connect pour ajouter un livre  votre liste"),!1;if(!t?.id)return mn.error("Erreur: livre invalide"),!1;try{const s=await(async e=>{Eg(e);try{const{data:{user:t}}=await en.auth.getUser();if(!t)return Qh(e.id,"auth_required",{bookTitle:e.title}),!1;const{data:s,error:r}=await en.from("reading_progress").select("*").eq("user_id",t.id).eq("book_id",e.id).maybeSingle();if(r)return Qh(e.id,"error",{bookTitle:e.title,errorCode:r.code}),!1;if(s)throw Qh(e.id,"already_exists",{bookTitle:e.title}),new Jh(e.title);const{data:n,error:a}=await en.from("reading_progress").insert([{user_id:t.id,book_id:e.id,status:"to_read",current_page:0,total_pages:e.pages||0}]).select().single();return a?(Qh(e.id,"error",{bookTitle:e.title,errorCode:a.code}),!1):(Qh(e.id,"success",{bookTitle:e.title,userId:t.id}),!0)}catch(h){if(h instanceof Jh)throw h;return h instanceof ep&&Qh(e.id,"invalid_book",{bookTitle:e.title,errorCode:h.code}),!1}})(t);return s?(await Promise.all([e.invalidateQueries({queryKey:["reading_list"]}),e.invalidateQueries({queryKey:["books_by_status"]})]),w(),mn.success(`"${t.title}" ajout  votre liste de lecture`),!0):(mn.error(`Impossible d'ajouter "${t.title}"  votre liste`),!1)}catch(s){const e=s instanceof Error?s.message:"Une erreur est survenue";return mn.error(`Erreur: ${e}`),!1}},"useReadingList.addToReadingList"));s.useEffect(()=>{if(!i||!v||a.current||u)return;if(o.inProgress.length>0&&r.current&&j)return;(async()=>{try{a.current=!0;const[e,t,s]=await Promise.all([N("to_read"),N("in_progress"),N("completed")]);g.current&&(f(e,t,s),Og("to_read",e),Og("in_progress",t),Og("completed",s))}catch(e){g.current&&(p(e),n.current<2&&(mn.error("Erreur lors du chargement de vos livres"),n.current++))}finally{g.current&&(a.current=!1)}})()},[i,v,j]),y&&0===n.current&&(mn.error("Impossible de rcuprer votre liste de lecture",{id:"reading-list-error"}),n.current++);const k=Vg(()=>{Mg(),e.invalidateQueries({queryKey:["reading_list"]}),e.invalidateQueries({queryKey:["books_by_status"]}),w()}),S=Vg(Bg(async()=>{if(i&&v){Mg();try{e.removeQueries({queryKey:["books_by_status",i,"completed"]});const t=await Ig(v,"completed",i);g.current&&f(o.toRead,o.inProgress,t)}catch(t){}}},"useReadingList.syncCompletedBooks"));return s.useMemo(()=>({...o,isLoadingReadingList:b,readingListError:y,sortBy:l.sortBy,setSortBy:l.setSortBy,isLoading:c,error:h,readingList:v,userId:i,getFailedBookIds:()=>Kh(),hasFetchedInitialData:()=>r.current,getBooksByStatus:N,addToReadingList:_,forceRefresh:k,syncCompletedBooks:S}),[o,b,y,l.sortBy,l.setSortBy,c,h,v,i,N,_,k,S])},Fg=s.forwardRef(({className:e,value:t,indicatorClassName:s,...n},a)=>r.jsx(Se,{ref:a,className:zr("relative h-2 w-full overflow-hidden rounded-full bg-brand-100",e),...n,children:r.jsx(Ee,{className:zr("h-full w-full flex-1 bg-gradient-to-r from-brand-600 to-brand-500 transition-all duration-1000 ease-out relative overflow-hidden",s),style:{transform:`translateX(-${100-(t||0)}%)`},children:r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"})})}));Fg.displayName=Se.displayName;const $g=({src:e,alt:t,className:n,priority:a=!1,sizes:i,...o})=>{const[l,c]=s.useState(!1),[d,u]=s.useState(!1);if(e.startsWith("http")||e.startsWith("data:"))return r.jsx("img",{src:e,alt:t,className:n,loading:a?"eager":"lazy",decoding:"async",sizes:i,onError:()=>u(!0),...o});const{avif:m,webp:h}=(e=>{const t=e.lastIndexOf(".");if(-1===t)return{avif:null,webp:null};const s=e.substring(0,t),r=e.substring(t);return[".jpg",".jpeg",".png"].includes(r.toLowerCase())?{avif:`${s}.avif`,webp:`${s}.webp`}:{avif:null,webp:null}})(e);if(l||d)return r.jsx("img",{src:e,alt:t,className:n,loading:a?"eager":"lazy",decoding:"async",sizes:i,onError:()=>{u(!0)},...o});const p=()=>{c(!0)},f=!e.includes("lovable-uploads");return(m||h)&&f?r.jsxs("picture",{children:[m&&r.jsx("source",{srcSet:m,type:"image/avif",sizes:i}),h&&r.jsx("source",{srcSet:h,type:"image/webp",sizes:i}),r.jsx("img",{src:e,alt:t,className:n,loading:a?"eager":"lazy",decoding:"async",sizes:i,onError:p,...o})]}):r.jsx("img",{src:e,alt:t,className:n,loading:a?"eager":"lazy",decoding:"async",sizes:i,onError:()=>{u(!0)},...o})},Wg=({book:e,showProgress:t,size:s="md",image:n,title:a,priority:i=!1,className:o,fluid:l=!1})=>{const c=n||e?.coverImage||e?.cover_url||e?.book_cover,d=a||e?.title||"Unknown",u=e?e.chaptersRead/e.totalChapters*100:0,m=e?Math.floor(e.pages/e.totalChapters*e.chaptersRead):0;return r.jsxs("div",{className:`book-cover bg-coffee-medium relative aspect-[2/3] ${l?"w-full":{sm:"w-24 h-36",md:"w-32 h-48",lg:"w-40 h-60"}[s]} ${o||""}`,children:[c?r.jsx($g,{src:c,alt:d,className:"absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",priority:i,sizes:l?"(max-width: 768px) 50vw, 25vw":{sm:"(max-width: 768px) 80px, 96px",md:"(max-width: 768px) 120px, 128px",lg:"(max-width: 768px) 140px, 160px"}[s]}):r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-coffee-medium",children:r.jsx("span",{className:"text-white font-serif italic text-h4",children:d.substring(0,1)})}),t&&e&&e.chaptersRead>0&&r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/50 p-2",children:[r.jsx(Fg,{value:u,className:"h-2"}),r.jsxs("p",{className:"text-white text-caption mt-1 text-center",children:[m," / ",e.pages," pages"]})]})]})},Zg=({book:e,isAdding:t,showAddButton:s,showDeleteButton:n,actionLabel:a,onAdd:i,onDelete:o,onAction:l})=>r.jsxs(r.Fragment,{children:[a&&r.jsxs(qn,{size:"sm",variant:"outline",className:"mt-3 w-full border-coffee-medium text-coffee-darker hover:bg-coffee-light/20",onClick:l,disabled:t,children:[e.isCompleted?r.jsx(Re,{className:"h-4 w-4 mr-1"}):r.jsx(Ce,{className:"h-4 w-4 mr-1"}),a]}),s&&r.jsx(qn,{"data-testid":"add-to-reading-list-button",size:"sm",variant:"outline",className:"mt-3 w-full border-coffee-medium text-coffee-darker hover:bg-coffee-light/20",onClick:i,disabled:t,children:t?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"h-4 w-4 mr-1 animate-spin"}),"Ajout en cours..."]}):r.jsxs(r.Fragment,{children:[r.jsx($,{className:"h-4 w-4 mr-1"}),"Ajouter  ma liste"]})}),n&&r.jsxs(qn,{size:"sm",variant:"outline",className:"mt-2 w-full border-destructive text-destructive hover:bg-destructive/10",onClick:o,children:[r.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Retirer"]})]});function Hg({book:e,showProgress:t=!1,showDate:n=!1,showAddButton:a=!1,showDeleteButton:i=!1,actionLabel:o,onAction:l}){const[c,d]=s.useState(!1),{user:u}=kn(),{addToReadingList:m}=Ug();if(!e)return null;try{Eg(e)}catch(f){return null}const h=e.id||e.slug||"",p=()=>e.isCompleted?"Termin":e.chaptersRead&&e.chaptersRead>0?"En cours de lecture":" lire";return r.jsx(T,{"data-testid":"book-card",to:`/books/${h}`,className:"block h-full group focus:outline-none focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2 rounded-md transition-all duration-200","aria-label":`${e.title} par ${e.author}. Statut: ${p()}. Appuyez sur Entre pour ouvrir.`,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.preventDefault()},tabIndex:0,role:"link",children:r.jsxs("article",{className:"book-card flex flex-col h-full min-h-[520px] sm:min-h-[540px] bg-white border border-coffee-light rounded-md overflow-hidden transition-all duration-300 hover:shadow-md relative transform hover:scale-[1.02] hover:border-coffee-medium focus-within:ring-2 focus-within:ring-coffee-dark focus-within:ring-offset-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx(Wg,{book:e,showProgress:t,fluid:!0,className:"w-full"}),e.isCompleted?r.jsx(fe,{className:"h-5 w-5 text-green-600 absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}):e.chaptersRead&&e.chaptersRead>0?r.jsx(xe,{className:"h-5 w-5 text-coffee-dark absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}):r.jsx(Te,{className:"h-5 w-5 text-coffee-medium absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:p()})]}),r.jsxs("div",{className:"p-3 flex-grow flex flex-col",children:[r.jsx("h3",{className:"font-medium text-coffee-darker mb-1 line-clamp-2 min-h-[3.25rem] focus:outline-none",children:((e,t=50)=>e?e.length<=t?e:e.substring(0,t)+"...":"Titre inconnu")(e.title)}),r.jsx("p",{className:"text-body-sm text-muted-foreground line-clamp-1 min-h-[1.25rem]",children:e.author||"Auteur inconnu"}),r.jsx("div",{className:"mt-2 flex flex-wrap gap-1 min-h-[36px] overflow-hidden",children:(e.categories||[]).slice(0,3).map((e,t)=>r.jsx(Dh,{variant:"outline",className:"text-caption border-coffee-light","aria-label":`Catgorie: ${e}`,children:e},t))}),r.jsx("div",{className:"mt-auto pt-2",children:r.jsx(Zg,{book:e,isAdding:c,showAddButton:a,showDeleteButton:i,actionLabel:o,onAdd:async t=>{if(t.preventDefault(),t.stopPropagation(),!u?.id){const e=new tp;return void mn.error(e.message)}if(!c)try{d(!0);await m(e)}catch(f){const t=(e=>e instanceof Jh?"info":"error")(f),s=sp(f);"info"===t?mn.info(s):mn.error(s)}finally{d(!1)}},onDelete:e=>{e.preventDefault(),e.stopPropagation(),mn.info("Fonction de suppression  implmenter")},onAction:e=>{e.preventDefault(),e.stopPropagation(),u?.id?l?.():mn.error("Vous devez tre connect pour effectuer cette action")}})})]})]})})}const Gg=(e,t={})=>{const{initialPageSize:r=12,pageSize:n=8}=t,[a,i]=s.useState(1),o=s.useMemo(()=>{const t=r+(a-1)*n;return e.slice(0,t)},[e,a,r,n]),l=o.length<e.length,c=Math.ceil((e.length-r)/n)+1;return{paginatedBooks:o,hasMore:l,isLoading:!1,loadMore:()=>{l&&i(e=>e+1)},reset:()=>{i(1)},currentPage:a,totalPages:c,totalItems:e.length,showingItems:o.length}},Kg=({onLoadMore:e,hasMore:t,isLoading:s=!1,showingCount:n,totalCount:a,className:i=""})=>t?r.jsxs("div",{className:`flex flex-col items-center space-y-3 ${i}`,children:[r.jsx(qn,{variant:"outline",onClick:e,disabled:s,className:"min-w-[200px] bg-white hover:bg-coffee-light/20 border-coffee-medium text-coffee-dark",children:s?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}),"Chargement..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Voir plus de livres"]})}),r.jsxs("p",{className:"text-body-sm text-muted-foreground",children:[n," sur ",a," livres affichs"]})]}):null;function Yg({books:e,title:t,description:s,showProgress:n=!1,showDate:a=!1,showAddButton:i=!1,showDeleteButton:o=!1,actionLabel:l,onAction:c,enablePagination:d=!1,initialPageSize:u=12,pageSize:m=8}){H();const{paginatedBooks:h,hasMore:p,loadMore:f,showingItems:g,totalItems:x}=Gg(e,{initialPageSize:u,pageSize:m}),v=d?h:e;return e.length?r.jsxs("div",{className:"space-y-4",children:[t&&r.jsxs("div",{className:"mb-4",children:[r.jsx("h2",{className:"text-h4 font-serif text-coffee-darker",children:t}),s&&r.jsx("p",{className:"text-muted-foreground text-body-sm mt-1",children:s})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 2xl:grid-cols-8 gap-4 md:gap-6",children:v.map(e=>{const t=e.id||e.slug||"";return r.jsx("div",{className:"h-full",children:r.jsx(Hg,{book:e,showProgress:n,showDate:a,showAddButton:i,showDeleteButton:o,actionLabel:l,onAction:()=>c?.(t)})},t)})}),d&&r.jsx(Kg,{onLoadMore:f,hasMore:p,showingCount:g,totalCount:x,className:"mt-8"})]}):r.jsxs("div",{className:"text-center p-8 border border-dashed border-coffee-light rounded-lg bg-muted/50",children:[r.jsx("h3",{className:"text-h4 font-medium text-coffee-darker mb-2",children:"Aucun livre trouv"}),r.jsx("p",{className:"text-muted-foreground",children:"Essayez une autre recherche ou explorez notre catalogue"})]})}function Qg({searchResults:e,onReset:t,redirecting:s=!1}){return H(),e?r.jsxs("div",{className:"space-y-6 "+(s?"opacity-80 transition-opacity duration-300":""),children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-h4 font-serif font-medium text-coffee-darker",children:e.length>0?`Rsultats de recherche (${e.length})`:"Aucun rsultat trouv"}),r.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker font-medium flex items-center",onClick:t,disabled:s,children:"Retour  l'accueil"})]}),e.length>0?r.jsx(Yg,{books:e,showAddButton:!0}):r.jsxs("div",{className:"text-center p-8 border border-dashed border-coffee-light rounded-lg bg-muted/50",children:[r.jsx("h3",{className:"text-h4 font-medium text-coffee-darker mb-2",children:"Aucun livre trouv"}),r.jsx("p",{className:"text-muted-foreground",children:"Essayez une autre recherche ou explorez notre catalogue"})]})]}):null}const Xg=s.memo(function({currentReading:e,isLoading:t,onContinueReading:s}){const n=H(),{t:a}=Tn();if(t)return r.jsx("div",{className:"animate-fade-in",children:r.jsx("div",{className:"bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl p-8 md:p-10 min-h-[320px] flex items-center justify-center",children:r.jsxs("div",{className:"animate-pulse space-y-4 w-full",children:[r.jsx("div",{className:"h-48 w-36 bg-muted rounded-xl mx-auto"}),r.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mx-auto"}),r.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"})]})})});if(!e)return r.jsx("div",{className:"animate-fade-in",children:r.jsxs("div",{className:"bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 p-10 md:p-14 min-h-[320px] flex flex-col items-center justify-center text-center space-y-6",children:[r.jsxs("div",{className:"relative animate-float",children:[r.jsx("div",{className:"absolute inset-0 bg-brand-500/20 blur-2xl rounded-full"}),r.jsx(Ie,{className:"relative h-20 w-20 text-brand-600"}),r.jsx(De,{className:"h-7 w-7 text-brand-500 absolute -top-2 -right-2 animate-glow"})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("h2",{className:"text-h1 font-serif font-semibold text-brand-900",children:a.home.startLiteraryJourney}),r.jsx("p",{className:"text-body-lg text-muted-foreground max-w-md",children:a.home.discoverCollection})]}),r.jsx(qn,{onClick:()=>n("/explore?cat=litterature"),variant:"premium",size:"lg",className:"px-10 py-6 text-lg",children:r.jsx("span",{className:"relative z-10",children:a.home.discoverBooks})})]})});const i=e.cover_url||e.book_cover,o=Math.round(e.chaptersRead/(e.totalChapters||e.total_chapters||100)*100);return r.jsx("div",{className:"animate-fade-in",children:r.jsxs("div",{className:"bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 p-8 md:p-10 min-h-[320px]",children:[r.jsx("h2",{className:"text-h2 font-serif font-medium text-brand-900 mb-8",children:a.home.currentReading}),r.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8",children:[r.jsx("div",{className:"flex-shrink-0 group cursor-pointer relative",onClick:s,children:i?r.jsxs("div",{className:"relative",children:[r.jsx($g,{src:i,alt:e.title,className:"w-36 h-54 object-cover rounded-xl shadow-2xl group-hover:scale-[1.03] transition-transform duration-300",priority:!0,sizes:"144px"}),r.jsx("div",{className:"absolute -bottom-4 left-0 right-0 h-20 bg-gradient-to-b from-black/5 to-transparent blur-xl"})]}):r.jsx("div",{className:"w-36 h-54 flex items-center justify-center bg-muted rounded-xl shadow-2xl",children:r.jsx("span",{className:"text-5xl font-serif italic text-brand-600",children:e.title.substring(0,1)})})}),r.jsxs("div",{className:"flex-1 w-full space-y-5",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-h2 font-serif font-semibold text-brand-900 mb-2 cursor-pointer hover:text-brand-700 transition-colors",onClick:s,children:e.title}),r.jsx("p",{className:"text-body-lg text-muted-foreground",children:e.author})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-body-sm text-muted-foreground",children:[r.jsx("span",{children:a.home.progression}),r.jsxs("span",{className:"font-semibold text-brand-700 text-body",children:[o,"%"]})]}),r.jsx(Fg,{value:o,className:"h-3"}),r.jsxs("p",{className:"text-body-sm text-muted-foreground",children:[Math.floor(e.chaptersRead)," / ",e.totalChapters||e.total_chapters||0," ",a.home.segmentsValidated]})]}),r.jsx(qn,{onClick:s,variant:"premium",className:"w-full py-7 text-lg font-semibold",children:r.jsx("span",{className:"relative z-10",children:a.home.continueReading})})]})]})]})})}),Jg=s.forwardRef(({className:e,type:t,...s},n)=>r.jsx("input",{type:t,className:zr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...s}));function ex({onSearch:e,placeholder:t="Rechercher un livre par titre, auteur...",isSearching:n=!1}){const[a,i]=s.useState("");return r.jsxs("form",{onSubmit:t=>{t.preventDefault(),e(a)},className:"relative w-full",children:[r.jsx(Jg,{type:"search",placeholder:t,value:a,onChange:e=>i(e.target.value),className:"pr-12 border-coffee-light focus-visible:ring-coffee-dark bg-white h-12 text-md"}),r.jsxs(qn,{type:"submit",size:"icon",className:"absolute right-1 top-1 h-10 w-10 bg-coffee-dark hover:bg-coffee-darker",disabled:n,children:[n?r.jsx(Ne,{className:"h-5 w-5 animate-spin"}):r.jsx(Le,{className:"h-5 w-5"}),r.jsx("span",{className:"sr-only",children:n?"Recherche en cours...":"Rechercher"})]})]})}Jg.displayName="Input";const tx=s.memo(function({onSearch:e,isSearching:t}){const{t:n}=Tn(),{isPremium:a}=kn(),[i,o]=s.useState(!1),l=H();return r.jsx("div",{className:"animate-fade-in",children:r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm hover:shadow-md transition-shadow overflow-hidden",children:[r.jsxs("button",{onClick:()=>o(!i),className:"w-full p-6 flex items-center justify-between hover:bg-accent/5 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Le,{className:"h-5 w-5 text-coffee-dark"}),r.jsx("h2",{className:"text-xl md:text-2xl font-serif font-medium text-coffee-darker",children:n.explore.title})]}),i?r.jsx(Oe,{className:"h-5 w-5 text-muted-foreground"}):r.jsx(Me,{className:"h-5 w-5 text-muted-foreground"})]}),r.jsx("div",{className:`transition-all duration-300 ease-in-out ${i?"max-h-[300px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`,children:r.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[r.jsx(ex,{onSearch:e,isSearching:t,placeholder:n.common.searchPlaceholder}),r.jsx("div",{className:"flex items-center justify-center pt-2",children:r.jsxs(qn,{variant:"ghost",onClick:()=>{l(a?"/request-book":"/premium")},className:"text-coffee-dark hover:text-coffee-darker hover:bg-accent/10 transition-colors",children:[r.jsx($,{className:"h-4 w-4 mr-2"}),n.explore.requestBook]})})]})})]})})});async function sx(e){try{const{data:t,error:s}=await en.from("user_companion").select("*").eq("user_id",e).maybeSingle();if(s){if(wn("getCompanion",s).isAuthExpired)throw s;return null}return t}catch(t){return null}}async function rx(e){const{data:t,error:s}=await en.from("user_companion").insert({user_id:e,current_stage:1,total_reading_days:0,current_streak:0,longest_streak:0,last_reading_date:null,segments_this_week:0,has_seen_birth_ritual:!1,has_seen_week_ritual:!1,has_seen_return_ritual:!1}).select().single();if(s){const e=wn("createCompanion",s);throw new Error(e.userMessage)}return t}const nx=q,ax=B,ix=V,ox=s.forwardRef(({className:e,...t},s)=>r.jsx(I,{ref:s,className:zr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));ox.displayName=I.displayName;const lx=s.forwardRef(({className:e,children:t,...s},n)=>r.jsxs(ix,{children:[r.jsx(ox,{}),r.jsxs(D,{ref:n,className:zr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[t,r.jsxs(L,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(R,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));lx.displayName=D.displayName;const cx=({className:e,...t})=>r.jsx("div",{className:zr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});cx.displayName="DialogHeader";const dx=({className:e,...t})=>r.jsx("div",{className:zr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});dx.displayName="DialogFooter";const ux=s.forwardRef(({className:e,...t},s)=>r.jsx(O,{ref:s,className:zr("text-lg font-semibold leading-none tracking-tight",e),...t}));ux.displayName=O.displayName;const mx=s.forwardRef(({className:e,...t},s)=>r.jsx(M,{ref:s,className:zr("text-sm text-muted-foreground",e),...t}));mx.displayName=M.displayName;const hx=s.memo(function({companion:e,isOpen:t,onClose:s}){const n=1===e.current_stage,a=e.current_streak>=7,i=[{icon:Ve,label:"Jours de lecture",value:e.total_reading_days,color:"text-blue-500"},{icon:ue,label:"Srie actuelle",value:`${e.current_streak} jours`,color:"text-orange-500"},{icon:F,label:"Meilleure srie",value:`${e.longest_streak} jours`,color:"text-yellow-500"},{icon:xe,label:"Cette semaine",value:`${e.segments_this_week} segments`,color:"text-primary"}];return r.jsx(nx,{open:t,onOpenChange:s,children:r.jsxs(lx,{className:"sm:max-w-md",children:[r.jsx(cx,{children:r.jsx(ux,{className:"text-center",children:"Statistiques de Booky"})}),r.jsxs("div",{className:"space-y-6 py-4",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-primary/10 to-accent/10 flex items-center justify-center text-7xl shadow-lg",children:n?"":a?"":""})}),r.jsx("p",{className:"text-center text-muted-foreground text-sm",children:n?"Continue de lire pour voir ton compagnon clore !":a?"Ton renardeau studieux est fier de toi ! ":"Ton renardeau grandit avec chaque lecture ! "}),r.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(e=>r.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(e.icon,{className:`w-5 h-5 ${e.color}`}),r.jsx("span",{className:"text-xs text-muted-foreground",children:e.label})]}),r.jsx("p",{className:"text-2xl font-semibold text-foreground",children:e.value})]},e.label))}),0===e.current_streak?r.jsx("div",{className:"bg-primary/5 rounded-lg p-4 text-center",children:r.jsx("p",{className:"text-sm text-foreground/80",children:"Valide un segment aujourd'hui pour dmarrer une nouvelle srie ! "})}):e.current_streak<7?r.jsx("div",{className:"bg-primary/5 rounded-lg p-4 text-center",children:r.jsxs("p",{className:"text-sm text-foreground/80",children:["Plus que ",7-e.current_streak," jours pour que Booky gagne ses lunettes ! "]})}):r.jsx("div",{className:"bg-primary/5 rounded-lg p-4 text-center",children:r.jsx("p",{className:"text-sm text-foreground/80",children:"Continue comme a, tu es sur une belle lance ! "})})]})]})})}),px=s.memo(function(){const{user:e}=kn(),t=_e(),[n,a]=s.useState(!1),{data:i,isLoading:o}=ke({queryKey:["companion",e?.id],queryFn:()=>e?.id?sx(e.id):null,enabled:!!e?.id});if(s.useEffect(()=>{e?.id&&(o||i||(async()=>{try{const s=await async function(e){let t=await sx(e);if(t)return t;try{return await rx(e)}catch(s){throw s}}(e.id);t.setQueryData(["companion",e.id],s)}catch(s){}})())},[e?.id,o,i,t]),o)return null;const l="tanguy.warsmann@gmail.com"===e?.email,c=()=>l?r.jsxs("div",{className:"mt-2 border-t border-dashed border-neutral-300 pt-2 px-4 pb-4",children:[r.jsxs("div",{className:"text-xs font-semibold text-neutral-700 mb-2 flex items-center justify-between",children:[r.jsx("span",{children:" DEBUG BOOKY"}),r.jsx("button",{onClick:()=>t.invalidateQueries({queryKey:["companion",e.id]}),className:"text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",children:"Refresh"})]}),i?r.jsx("pre",{className:"text-xs text-neutral-600 whitespace-pre-wrap break-words bg-neutral-50 p-2 rounded",children:JSON.stringify({user_id:i.user_id?.slice(0,8)+"...",current_stage:i.current_stage,total_reading_days:i.total_reading_days,current_streak:i.current_streak,longest_streak:i.longest_streak,last_reading_date:i.last_reading_date,segments_this_week:i.segments_this_week,has_seen_birth_ritual:i.has_seen_birth_ritual,has_seen_week_ritual:i.has_seen_week_ritual,has_seen_return_ritual:i.has_seen_return_ritual},null,2)}):r.jsx("div",{className:"text-xs text-orange-600",children:" Aucun companion en DB pour cet utilisateur"})]}):null;if(!i)return r.jsxs("div",{children:[r.jsx(eh.div,{className:"relative cursor-pointer group",onClick:()=>a(!0),whileHover:{scale:1.02},animate:{y:[0,-4,0]},transition:{y:{duration:2,repeat:1/0,ease:"easeInOut"}},children:r.jsx("div",{className:"bg-gradient-to-br from-primary/5 via-accent/5 to-secondary/5 backdrop-blur-sm rounded-2xl p-6 border border-border/40 shadow-sm hover:shadow-md transition-shadow",children:r.jsxs("div",{className:"flex items-center gap-6",children:[r.jsxs("div",{className:"relative flex-shrink-0",children:[r.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-accent/10 flex items-center justify-center text-5xl",children:""}),r.jsx("div",{className:"absolute inset-0 rounded-full bg-primary/5 blur-xl -z-10 opacity-0 group-hover:opacity-100 transition-opacity"})]}),r.jsx("div",{className:"flex-1",children:r.jsx("p",{className:"text-sm text-foreground/70 italic",children:"Il se passe quelque chose quand tu lis"})}),r.jsx("div",{className:"text-muted-foreground/50 group-hover:text-muted-foreground transition-colors",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("polyline",{points:"9 18 15 12 9 6"})})})]})})}),r.jsx(c,{})]});const d=1===i.current_stage,u=i.current_streak>=7;return r.jsxs("div",{children:[r.jsx(eh.div,{className:"relative cursor-pointer group",onClick:()=>a(!0),whileHover:{scale:1.02},animate:{y:[0,-4,0]},transition:{y:{duration:2,repeat:1/0,ease:"easeInOut"}},children:r.jsx("div",{className:"bg-gradient-to-br from-primary/5 via-accent/5 to-secondary/5 backdrop-blur-sm rounded-2xl p-6 border border-border/40 shadow-sm hover:shadow-md transition-shadow",children:r.jsxs("div",{className:"flex items-center gap-6",children:[r.jsxs("div",{className:"relative flex-shrink-0",children:[r.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/10 to-accent/10 flex items-center justify-center text-5xl",children:d?"":u?"":""}),r.jsx("div",{className:"absolute inset-0 rounded-full bg-primary/5 blur-xl -z-10 opacity-0 group-hover:opacity-100 transition-opacity"})]}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-foreground/80",children:[r.jsx(ue,{className:"w-4 h-4 text-orange-500"}),r.jsxs("span",{className:"font-medium",children:[i.current_streak," jours"]})]}),r.jsxs("div",{className:"flex items-center gap-2 text-foreground/60 text-sm",children:[r.jsx(xe,{className:"w-4 h-4 text-primary"}),r.jsxs("span",{children:[i.segments_this_week," segments cette semaine"]})]})]}),r.jsx("div",{className:"text-muted-foreground/50 group-hover:text-muted-foreground transition-colors",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("polyline",{points:"9 18 15 12 9 6"})})})]})})}),r.jsx(c,{}),r.jsx(hx,{companion:i,isOpen:n,onClose:()=>a(!1)})]})}),fx=s.memo(function({searchResults:e,onResetSearch:t,readingProgress:n,isLoading:a,isSearching:i=!1,isRedirecting:o=!1,onProgressUpdate:l,currentReading:c,isLoadingCurrentBook:d,onContinueReading:u,onSearch:m}){const h=s.useMemo(()=>r.jsx("div",{className:"flex items-center justify-center p-8",children:r.jsxs("div",{className:"text-center space-y-2",children:[r.jsx("div",{className:"animate-pulse flex justify-center",children:r.jsx(Le,{className:"h-8 w-8 text-coffee-dark"})}),r.jsx("p",{className:"text-coffee-dark",children:kh})]})}),[]);return i?h:e?r.jsx(Qg,{searchResults:e,onReset:t}):r.jsxs("div",{className:"space-y-8 md:space-y-12",children:[r.jsx(Xg,{currentReading:c,isLoading:d,onContinueReading:u}),r.jsx(px,{}),r.jsx(tx,{onSearch:m,isSearching:i})]})}),gx=e=>({id:e.id||"",title:e.title||"",author:e.author||"",coverImage:e.cover_url||void 0,description:e.description||"",totalChapters:("total_chapters"in e?e.total_chapters:null)||1,chaptersRead:0,isCompleted:!1,language:"fr",categories:e.tags||[],tags:e.tags||[],pages:("total_pages"in e?e.total_pages:null)||0,total_pages:("total_pages"in e?e.total_pages:null)||0,publicationYear:(new Date).getFullYear(),isPublished:!("is_published"in e)||!1!==e.is_published,slug:e.slug||"",expectedSegments:e.expected_segments||1,totalSegments:e.expected_segments||1}),xx=new Map,vx=async e=>{e?xx.delete(e):xx.clear()},bx=new Map,yx=async e=>{if(!e||"string"!=typeof e)return null;const t=e.trim();if(!t)return null;const s=bx.get(t);if(s&&Date.now()-s.timestamp<3e5)return s.data;try{const{data:e,error:s}=await en.from("books_public").select("*").eq("slug",t).maybeSingle();if(s&&s.code,e){const s=gx(e);return bx.set(t,{data:s,timestamp:Date.now()}),bx.set(s.id,{data:s,timestamp:Date.now()}),s}const r=(e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))(t);if(r){const{data:e,error:s}=await en.from("books_public").select("*").eq("id",t).maybeSingle();if(s&&s.code,e){const s=gx(e);return bx.set(t,{data:s,timestamp:Date.now()}),s.slug&&bx.set(s.slug,{data:s,timestamp:Date.now()}),s}}else{const{data:e,error:s}=await en.from("books_public").select("*").eq("slug",t).maybeSingle();if(s&&s.code,e){const s=gx(e);return bx.set(t,{data:s,timestamp:Date.now()}),s}}return null}catch(r){return null}};async function jx(e,t,s){const{total_pages:r,current_page:n,expected_segments:a,total_chapters:i}=e,o=void 0!==s?s:await Rg(t?.user_id||e.user_id,e.book_id||e.id),l=n>2*r,c=e.expected_segments??i??1,d=c,u=Math.min(o,d),m="completed"===t?.status||u>=d;return{...e,...t,coverImage:e.cover_url,expectedSegments:c,totalSegments:d,chaptersRead:u,progressPercent:Math.round(u/(d||1)*100),nextSegmentPage:l?8e3*(u+1):30*(u+1),currentSegment:u,isCompleted:m,book_id:e.book_id||e.id,book_title:e.title,book_author:e.author,book_cover:e.cover_url}}async function wx(e,t=2,s=1e3){try{return await async function(e,t=1e4){const s=new Promise((e,s)=>{setTimeout(()=>s(new Error(`Request timeout after ${t}ms`)),t)});return Promise.race([e,s])}(e())}catch(r){const n=r?.message?.includes("fetch")||r?.message?.includes("timeout")||"PGRST301"===r?.code||"429"===r?.code||500===r?.status||503===r?.status;if(t>0&&n)return await new Promise(e=>setTimeout(e,s)),wx(e,t-1,2*s);throw r}}const Nx=async(e,t)=>{if(!e)return[];if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return[];const s=t?.limit||t?.offset?`${e}-${t.limit}-${t.offset}`:e,r=xx.get(s);if(r&&Date.now()-r.timestamp<3e4)return r.data;try{const{data:r,error:n}=await wx(async()=>{let s=en.from("reading_progress").select("\n          *,\n          books:books_public(\n            id, slug, title, author, cover_url, total_chapters, expected_segments\n          )\n        ").eq("user_id",e);if(t?.limit&&(s=s.limit(t.limit)),t?.offset){const e=t.offset+(t.limit||10)-1;s=s.range(t.offset,e)}const r=await s;if(r.error)throw r.error;return r});if(n)return _x(e);if(!r||0===r.length)return[];const a=r.map(e=>e.book_id),{getAllValidatedSegmentCounts:i}=await _s(async()=>{const{getAllValidatedSegmentCounts:e}=await Promise.resolve().then(()=>Ag);return{getAllValidatedSegmentCounts:e}},void 0),o=await i(e,a);false;const l=await Promise.all(r.map(async e=>{const t=e.books,s={...e,...t,total_chapters:t?.total_chapters??t?.expected_segments??1,book_title:t?.title??"Titre inconnu",book_author:t?.author??"Auteur inconnu",book_slug:t?.slug??"slug inconnu",book_cover:t?.cover_url??"",validations:[]},r=o[e.book_id]||0;return await jx(s,void 0,r)}));return xx.set(s,{data:l,timestamp:Date.now()}),l}catch(n){return[]}},_x=async e=>{try{const{data:t,error:s}=await en.from("reading_progress").select("*").eq("user_id",e);if(s||!t)return[];return await Promise.all(t.map(async e=>{const t=await yx(e.book_id),s={...e,...t,total_chapters:t?.total_chapters??t?.expectedSegments??1,book_title:t?.title??"Titre inconnu",book_author:t?.author??"Auteur inconnu",book_slug:t?.slug??"slug inconnu",book_cover:t?.cover_url??"",validations:[]};return await jx(s)}))}catch(t){return[]}},kx=async(e,t)=>{if(!e)return null;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return null;try{const{data:s,error:r}=await wx(async()=>{const s=await en.from("reading_progress").select("\n          *,\n          books:books_public(\n            id, slug, title, author, cover_url, total_chapters, expected_segments\n          )\n        ").eq("user_id",e).eq("book_id",t).maybeSingle();if(s.error)throw s.error;return s});if(r)return Sx(e,t);if(!s)return null;const n=s.books;if(!n){const e=await yx(t);if(!e)return null;const r={...s,...e,total_chapters:e?.total_chapters??e?.expected_segments??1,book_title:e?.title??"Titre inconnu",book_author:e?.author??"Auteur inconnu",book_slug:e?.slug??"slug inconnu",book_cover:e?.cover_url??""};return await jx(r)}const a={...s,...n,total_chapters:n?.total_chapters??n?.expected_segments??1,book_title:n?.title??"Titre inconnu",book_author:n?.author??"Auteur inconnu",book_slug:n?.slug??"slug inconnu",book_cover:n?.cover_url??"",validations:[]};return await jx(a)}catch(s){return null}},Sx=async(e,t)=>{try{const{data:s,error:r}=await en.from("reading_progress").select("*").eq("user_id",e).eq("book_id",t).maybeSingle();if(r||!s)return null;const n=await yx(t);if(!n)return null;const a={...s,...n,total_chapters:n?.total_chapters??n?.expectedSegments??1,book_title:n?.title??"Titre inconnu",book_author:n?.author??"Auteur inconnu",book_slug:n?.slug??"slug inconnu",book_cover:n?.cover_url??"",validations:[]};return await jx(a)}catch(s){return null}},Ex={log:()=>{},info:()=>{},warn:()=>{},error:function(){}.bind(),debug:()=>{},group:()=>{},groupEnd:()=>{},table:()=>{}},Rx=e=>({log:(...t)=>Ex.log(`[${e}]`,...t),info:(...t)=>Ex.info(`[${e}]`,...t),warn:(...t)=>Ex.warn(`[${e}]`,...t),error:(...t)=>Ex.error(`[${e}]`,...t),debug:(...t)=>Ex.debug(`[${e}]`,...t)}),Cx=()=>{const{user:e,isInitialized:t,isLoading:r}=kn(),{inProgress:n}=Ug(),[a,i]=s.useState(null),[o,l]=s.useState(!0),c=s.useRef(!0),d=s.useRef(!1),u=s.useRef(null),m=s.useRef(0),h=s.useRef(n);s.useEffect(()=>{h.current=n},[n]);const p=s.useMemo(()=>{if(n&&n.length>0){const e=n.filter(e=>!e.isUnavailable);if(e.length>0)return e[0];if(n.length>0)return{...n[0],isStableUnavailable:!0}}return null},[n]);s.useEffect(()=>{if(c.current&&p){const e=a?.id;e===p.id&&a||i(p)}},[p,a]);const f=s.useCallback(async()=>{if(!e?.id||!t||r||d.current)return;const s=Date.now();if(s-m.current<6e4)Ex.debug("fetchCurrentReadingData: cooldown active");else if(h.current&&h.current.length>0&&!d.current)Ex.debug("fetchCurrentReadingData: already have inProgress data");else if(e.id===u.current&&u.current)l(!1);else try{d.current=!0,l(!0),m.current=s,Ex.debug("fetchCurrentReadingData: fetching inProgress books");const t=await(async(e,t)=>{if(!e)return[];try{const{data:s,error:r}=await en.from("reading_progress").select("\n        *,\n        books:books_public(\n          id, slug, title, author, cover_url, total_chapters, expected_segments\n        )\n      ").eq("user_id",e).eq("status",t);return r?[]:s&&0!==s.length?await Promise.all(s.map(async e=>{const t=e.books,s={...e,...t,total_chapters:t?.total_chapters??t?.expected_segments??1,book_title:t?.title??"Titre inconnu",book_author:t?.author??"Auteur inconnu",book_slug:t?.slug??"slug inconnu",book_cover:t?.cover_url??"",completed_at:null};return await jx(s)})):[]}catch(s){return[]}})(e.id,"in_progress");if(!c.current)return;if(t&&t.length>0){const e=t.filter(e=>!e.isUnavailable);if(e.length>0)i(e[0]);else if(t.length>0){const e={...t[0],isStableUnavailable:!0};i(e)}else i(null)}else i(null);u.current=e.id}catch(n){c.current&&(Ex.error("Erreur lors du chargement de la lecture en cours:",n),mn.error("Impossible de charger votre lecture en cours",{id:"current-reading-error"}))}finally{c.current&&(l(!1),d.current=!1)}},[e?.id,t,r]);return s.useEffect(()=>{e?.id&&c.current?p?l(!1):f():l(!1)},[e?.id,f,p,t,r]),s.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[]),{currentReading:a,isLoadingCurrentBook:o,refetch:f}},Ax=()=>{const{user:e,isInitialized:t,isLoading:r}=kn(),[n,a]=s.useState([]),[i,o]=s.useState(!0),[l,c]=s.useState(null),[d,u]=s.useState(0),m=s.useRef(!0),h=s.useRef(!1),p=s.useRef(!1),f=s.useRef(0),g=s.useRef(0),x=s.useRef([]);s.useEffect(()=>(m.current=!0,e?.id&&(h.current=!1,g.current=0),()=>{m.current=!1,x.current.forEach(clearTimeout),x.current=[]}),[e]);const v=s.useCallback(async(s=!1)=>{if(Ex.debug("=== FETCH PROGRESS START ===",{userId:e?.id,forceRefresh:s}),!e?.id||!t||r||!m.current||p.current)return void Ex.debug("Early return - conditions not met");const n=Date.now();if(!s&&n-f.current<500)Ex.debug("Early return - too soon since last fetch");else{f.current=n;try{p.current=!0,o(!0),c(null),s&&(Ex.debug("Clearing progress cache..."),await vx(e.id)),Ex.debug("Fetching user reading progress...");const t=await Nx(e.id);if(!m.current)return;const r=t.filter(e=>"in_progress"===e.status);Ex.debug("Filtered in-progress items:",r.length),a(r),h.current=!0,g.current=0,Ex.debug("=== FETCH PROGRESS SUCCESS ===")}catch(i){if(Ex.error("FETCH PROGRESS ERROR:",i),m.current){const e=wn("useReadingProgress",i);if(c(e.userMessage),e.isAuthExpired||g.current<3&&mn.error("Erreur lors du chargement de vos lectures en cours",{description:e.shouldRetry?"Nous ressayerons automatiquement":e.userMessage,duration:3e3}),g.current<5&&m.current&&e.shouldRetry){const e=Math.min(1e3*Math.pow(2,g.current),3e4);g.current++;const t=window.setTimeout(()=>{m.current&&v()},e);x.current.push(t)}}}finally{Ex.debug("=== FETCH PROGRESS END ==="),m.current&&(o(!1),p.current=!1)}}},[e,t,r]);s.useEffect(()=>{!e?.id||h.current||p.current||!t||r?e?.id||o(!1):v()},[e,v,t,r]),s.useEffect(()=>{d>0&&e?.id&&t&&!r&&v(!0)},[d,e?.id,v,t,r]);const b=s.useCallback(()=>{u(e=>e+1)},[]),y=s.useCallback(async()=>{if(e?.id)try{await vx(e.id),h.current=!1,u(e=>e+1),await v(!0),mn.success("Donnes rafrachies",{duration:2e3})}catch(t){mn.error("Erreur lors du rafrachissement")}},[e?.id,v]);return{readingProgress:n,isLoading:i,error:l,handleProgressUpdate:s.useCallback(async t=>{if(e?.id)try{await vx(e.id),o(!0),await v(!0),mn.success("Progression mise  jour",{duration:2e3})}catch(s){m.current&&mn.error("Erreur lors de la mise  jour de votre progression",{description:"Veuillez ressayer ultrieurement",duration:5e3})}finally{m.current&&o(!1)}else mn.error("Vous devez tre connect pour mettre  jour votre progression",{duration:5e3})},[e?.id,v]),refetch:v,forceRefresh:b,forceClearAndRefresh:y}};function Tx(){const e=Rx("Home"),t=s.useRef(!0);s.useEffect(()=>(e.info("Component mounted",{pathname:window.location.pathname}),()=>{e.info("Component unmounting")}),[e]);const{searchResults:n,setSearchResults:a,handleSearch:i,isSearching:o,isRedirecting:l}=(()=>{const[e,t]=s.useState(null),[r,n]=s.useState(!1),[a,i]=s.useState(!1),[o,l]=s.useState(null),c=H();return s.useEffect(()=>{const e="read_app_last_search";localStorage.getItem(e)&&localStorage.removeItem(e),t(null)},[]),{searchResults:e,setSearchResults:t,handleSearch:async e=>{if(!e?.trim())return t(null),void l(null);n(!0),i(!1),l(null);try{const{data:s,error:r}=await en.from("books_public").select("*").or(`title.ilike.%${e}%,author.ilike.%${e}%`);if(r)return l("Erreur lors de la recherche"),void mn.error("Erreur de recherche : Impossible d'effectuer votre recherche",{duration:3e3});const n=s?s.map(gx):[];1===n.length?(i(!0),t(n),setTimeout(()=>{c(`/books/${n[0].id}`)},300)):(t(n),0===n.length&&mn.info("Aucun livre ne correspond  votre recherche"))}catch(s){l(s.message||"Une erreur est survenue"),mn.error("Erreur de recherche : Une erreur est survenue pendant la recherche",{duration:3e3})}finally{n(!1)}},isSearching:r,isRedirecting:a,error:o,clearSearch:()=>{t(null),l(null)}}})(),{currentReading:c,isLoadingCurrentBook:d}=Cx(),{readingProgress:u,isLoading:m,handleProgressUpdate:h}=Ax(),p=H();s.useEffect(()=>{t.current&&(t.current=!1,e.info("Initial render completed",{pathname:window.location.pathname,hasSearchResults:!!n,isRedirecting:l}),n&&(e.info("Clearing search results on initial render to prevent auto-redirect"),a(null)))},[n,a,l,e]),s.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"WARM_CACHE"})},[]);const f=s.useCallback(()=>{if(c){if(c.isUnavailable)return void mn.error("Ce livre est actuellement indisponible",{id:"book-unavailable"});p(`/books/${c.id}?segment=${Math.floor(c.chaptersRead)}`)}},[c,p]),g=s.useMemo(()=>({searchResults:n,onResetSearch:()=>a(null),currentReading:c,isLoadingCurrentBook:d,readingProgress:u,isLoading:m,isSearching:o,isRedirecting:l,onProgressUpdate:h,onContinueReading:f,onSearch:i}),[n,a,c,d,u,m,o,l,h,f,i]);return r.jsx(Hh,{children:r.jsxs("div",{className:"relative isolate w-screen left-1/2 right-1/2 -translate-x-1/2 min-h-screen bg-[#FAFAF8] transition-all duration-300",children:[r.jsx("div",{className:"fixed inset-0 opacity-[0.02] pointer-events-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIiB4PSIwIiB5PSIwIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcj0idXJsKCNhKSIvPjwvc3ZnPg==')] bg-repeat"}),r.jsx(Zh,{}),r.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 space-y-8 md:space-y-12 animate-fade-in focus:outline-none",tabIndex:-1,children:[r.jsxs("h1",{className:"sr-only",children:[jh," - VREAD"]}),r.jsx(fx,{...g})]})]})})}const Px=s.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:zr("rounded-2xl border-0 bg-card text-card-foreground shadow-sm hover:shadow-md transition-all duration-300",e),...t}));Px.displayName="Card";const Ix=s.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:zr("flex flex-col space-y-1.5 p-6",e),...t}));Ix.displayName="CardHeader";const Dx=s.forwardRef(({className:e,...t},s)=>r.jsx("h3",{ref:s,className:zr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Dx.displayName="CardTitle";const Lx=s.forwardRef(({className:e,...t},s)=>r.jsx("p",{ref:s,className:zr("text-sm text-muted-foreground",e),...t}));Lx.displayName="CardDescription";const Ox=s.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:zr("p-6 pt-0",e),...t}));Ox.displayName="CardContent";s.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:zr("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";const Mx=Mn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Vx=s.forwardRef(({className:e,...t},s)=>r.jsx(qe,{ref:s,className:zr(Mx(),e),...t}));Vx.displayName=qe.displayName;const qx=()=>{const{isPremium:e}=kn(),{t:t}=Tn();return r.jsx("footer",{className:"border-t border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:r.jsx("div",{className:"container mx-auto px-4 py-6",children:r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[r.jsx(T,{to:"/a-propos",className:"hover:text-foreground transition-colors",children:" propos"}),r.jsx(T,{to:"/presse",className:"hover:text-foreground transition-colors",children:"Presse"}),r.jsx(T,{to:"/blog",className:"hover:text-foreground transition-colors",children:"Blog"}),r.jsx(T,{to:"/duolingo",className:"hover:text-foreground transition-colors",children:"VREAD vs Duolingo"}),r.jsx(T,{to:"/strava",className:"hover:text-foreground transition-colors",children:"Le Strava de la lecture"}),r.jsxs(T,{to:"/request-book",className:"hover:text-foreground transition-colors inline-flex items-center gap-2",children:[t.nav.requestBook,!e&&r.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:"Premium"})]}),r.jsx(T,{to:"/legal/privacy",className:"hover:text-foreground transition-colors",children:"Confidentialit"}),r.jsx(T,{to:"/legal/terms",className:"hover:text-foreground transition-colors",children:"CGU"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-caption text-muted-foreground italic",children:[r.jsx("span",{children:"v1.21"}),r.jsx("span",{"data-build":!0,className:"text-xs opacity-60",children:"2025-11-19T13:37:34.480Z"})]})]})})})};function Bx(){const[e]=Be(),t=H(),n="login"===e.get("mode")?"login":"signup",[a,i]=s.useState(n),{signUp:o,signIn:l,setError:c}=kn(),{t:d}=Tn(),[u,m]=s.useState(""),[h,p]=s.useState(""),[f,g]=s.useState(""),[x,v]=s.useState(!1),[b,y]=s.useState(null),[j,w]=s.useState(""),[N,_]=s.useState(""),[k,S]=s.useState(!1),[E,R]=s.useState(null);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsx("title",{children:d.auth.pageTitle}),r.jsx("meta",{name:"description",content:d.auth.pageDescription})]}),r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-primary via-reed-primary to-reed-secondary",children:[r.jsx("div",{className:"absolute top-4 right-4 z-50",children:r.jsx(Zn,{})}),r.jsx("section",{className:"px-4 py-16",children:r.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center text-center",children:[r.jsx("div",{className:"rounded-3xl border-4 border-[#EEDCC8] p-4 shadow-xl bg-white/5 backdrop-blur-sm",children:r.jsx(Pn,{size:72,className:"h-16 w-16"})}),r.jsx("h1",{className:"mt-6 font-serif text-3xl text-white",children:d.auth.welcome}),r.jsxs("p",{className:"mt-1 text-white/90",children:[d.auth.firstTimeHere," ",r.jsx("strong",{children:d.auth.createAccountIn30s})]}),r.jsx(Px,{className:"mt-8 w-full rounded-2xl bg-white/10 ring-1 ring-white/20 backdrop-blur-sm",children:r.jsx(Ox,{className:"pt-6",children:r.jsxs(Lh,{value:a,onValueChange:e=>i(e),className:"w-full",children:[r.jsxs(Oh,{className:"grid w-full grid-cols-2 rounded-xl bg-white/10 p-1",children:[r.jsx(Mh,{value:"signup",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:text-reed-primary data-[state=inactive]:text-white/90",children:d.auth.createAccount}),r.jsx(Mh,{value:"login",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:text-reed-primary data-[state=inactive]:text-white/90",children:d.auth.signIn})]}),r.jsx(Vh,{value:"signup",className:"mt-6",children:r.jsxs(Px,{className:"border-0 bg-transparent shadow-none",children:[r.jsxs(Ix,{className:"px-0",children:[r.jsx(Dx,{className:"text-left text-white",children:d.auth.createAccount}),r.jsx(Lx,{className:"text-left text-white/90",children:"Accde  VREAD en quelques secondes."})]}),r.jsx(Ox,{className:"px-0",children:r.jsxs("form",{id:"signup-form",onSubmit:async function(e){if(e.preventDefault(),y(null),c(null),h===f){v(!0);try{await o(u,h),t("/home")}catch(s){y(s?.message??d.auth.signupFailed)}finally{v(!1)}}else y(d.auth.passwordsDontMatch)},className:"space-y-4",children:[r.jsxs("div",{className:"text-left",children:[r.jsx(Vx,{htmlFor:"s-email",className:"text-white/90",children:d.auth.email}),r.jsx(Jg,{id:"s-email",name:"email",type:"email",value:u,onChange:e=>m(e.target.value),className:"bg-white",required:!0,autoComplete:"username",inputMode:"email",enterKeyHint:"next",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]}),r.jsxs("div",{className:"text-left",children:[r.jsx(Vx,{htmlFor:"s-pwd",className:"text-white/90",children:d.auth.password}),r.jsx(Jg,{id:"s-pwd",name:"password",type:"password",value:h,onChange:e=>p(e.target.value),className:"bg-white",required:!0,minLength:6,autoComplete:"new-password",enterKeyHint:"next",spellCheck:!1})]}),r.jsxs("div",{className:"text-left",children:[r.jsx(Vx,{htmlFor:"s-pwd2",className:"text-white/90",children:d.auth.confirmPassword}),r.jsx(Jg,{id:"s-pwd2",name:"confirmPassword",type:"password",value:f,onChange:e=>g(e.target.value),className:"bg-white",required:!0,minLength:6,autoComplete:"new-password",enterKeyHint:"done",spellCheck:!1})]}),b&&r.jsx("p",{className:"text-left text-sm text-red-200",children:b}),r.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[r.jsx(qn,{type:"submit",disabled:x,className:"w-full bg-white py-6 text-lg font-bold text-reed-primary hover:bg-reed-light hover:text-reed-darker disabled:opacity-60 shadow-lg",children:x?d.auth.signingUp:d.auth.createAccount}),r.jsx("button",{type:"button",onClick:()=>i("login"),className:"text-sm text-white/90 hover:text-white underline decoration-white/60 underline-offset-4 transition-colors",children:d.auth.alreadyRegistered})]})]})})]})}),r.jsx(Vh,{value:"login",className:"mt-6",children:r.jsxs(Px,{className:"border-0 bg-transparent shadow-none",children:[r.jsxs(Ix,{className:"px-0",children:[r.jsx(Dx,{className:"text-left text-white",children:d.auth.signIn}),r.jsx(Lx,{className:"text-left text-white/90",children:"Reprends ta lecture."})]}),r.jsx(Ox,{className:"px-0",children:r.jsxs("form",{id:"login-form",onSubmit:async function(e){e.preventDefault(),R(null),c(null),S(!0);try{await l(j,N),t("/home")}catch(s){R(s?.message??d.auth.loginFailed)}finally{S(!1)}},className:"space-y-4",children:[r.jsxs("div",{className:"text-left",children:[r.jsx(Vx,{htmlFor:"l-email",className:"text-white/90",children:d.auth.email}),r.jsx(Jg,{id:"l-email",name:"email",type:"email",value:j,onChange:e=>w(e.target.value),className:"bg-white",required:!0,autoComplete:"username",inputMode:"email",enterKeyHint:"next",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]}),r.jsxs("div",{className:"text-left",children:[r.jsx(Vx,{htmlFor:"l-pwd",className:"text-white/90",children:d.auth.password}),r.jsx(Jg,{id:"l-pwd",name:"password",type:"password",value:N,onChange:e=>_(e.target.value),className:"bg-white",required:!0,autoComplete:"current-password",enterKeyHint:"done",spellCheck:!1})]}),E&&r.jsx("p",{className:"text-left text-sm text-red-200",children:E}),r.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[r.jsx(qn,{type:"submit",disabled:k,className:"w-full bg-white py-6 text-lg font-bold text-reed-primary hover:bg-reed-light hover:text-reed-darker disabled:opacity-60 shadow-lg",children:k?d.auth.loggingIn:d.auth.signIn}),r.jsxs("button",{type:"button",onClick:()=>i("signup"),className:"text-sm text-white/90 hover:text-white underline decoration-white/60 underline-offset-4 transition-colors",children:[d.auth.firstTimeHere," ",d.auth.createAccount]})]})]})})]})})]})})}),r.jsx("p",{className:"mt-4 text-xs text-white/80",children:"En crant un compte, tu acceptes nos conditions d'utilisation."})]})})]}),r.jsx(qx,{})]})}const zx=Mn("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ux=s.forwardRef(({className:e,variant:t,...s},n)=>r.jsx("div",{ref:n,role:"alert",className:zr(zx({variant:t}),e),...s}));Ux.displayName="Alert";s.forwardRef(({className:e,...t},s)=>r.jsx("h5",{ref:s,className:zr("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const Fx=s.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:zr("text-sm [&_p]:leading-relaxed",e),...t}));function $x(){const[e,t]=s.useState(""),[n,a]=s.useState(""),[i,o]=s.useState(!1),[l,c]=s.useState(!1),[d,u]=s.useState(!1),[m,h]=s.useState(null),p=H();s.useEffect(()=>{const{data:{subscription:e}}=en.auth.onAuthStateChange((e,t)=>{"PASSWORD_RECOVERY"===e&&c(!0)});return en.auth.getSession().then(({data:{session:e}})=>{e&&c(!0)}),()=>{e.unsubscribe()}},[]);return d?r.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:r.jsx(Px,{className:"w-full max-w-md border-coffee-medium",children:r.jsx(Ox,{className:"pt-6",children:r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx(ze,{className:"w-16 h-16 text-green-600 mx-auto"}),r.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Mot de passe mis  jour !"}),r.jsx("p",{className:"text-gray-600",children:"Votre mot de passe a t mis  jour avec succs. Vous allez tre redirig vers la page de connexion."})]})})})}):l?r.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:r.jsxs("div",{className:"w-full max-w-md mx-auto",children:[r.jsxs("div",{className:"mb-8 text-center",children:[r.jsx($g,{src:"/branding/vread-logo.svg",alt:"VREAD Logo",className:"mx-auto mb-4 w-40 h-auto"}),r.jsx("p",{className:"text-logo-text text-lg mb-6",children:"Choisissez un nouveau mot de passe"})]}),r.jsxs(Px,{className:"border-coffee-medium",children:[r.jsxs(Ix,{children:[r.jsx(Dx,{className:"text-2xl text-center",children:"Nouveau mot de passe"}),r.jsx(Lx,{className:"text-center",children:"Saisissez votre nouveau mot de passe pour scuriser votre compte"})]}),r.jsx(Ox,{children:r.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),h(null),!e||!n)return void h("Veuillez remplir tous les champs");if(e!==n)return void h("Les mots de passe ne correspondent pas");const s=(e=>{if(e.length<8)return"Le mot de passe doit contenir au moins 8 caractres";const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),r=/[0-9]/.test(e);return t&&s&&r?null:"Le mot de passe doit contenir au moins une majuscule, une minuscule et un chiffre"})(e);if(s)h(s);else{o(!0);try{const{error:t}=await en.auth.updateUser({password:e});if(t){if(t.message.includes("expired")||t.message.includes("invalid"))throw new Error("Le lien de rinitialisation a expir. Veuillez relancer une nouvelle demande.");throw t}u(!0),mn.success("Mot de passe mis  jour avec succs!"),setTimeout(()=>{p("/auth")},2e3)}catch(r){h(r.message||"Erreur lors de la mise  jour. Veuillez ressayer."),mn.error(r.message||"Erreur lors de la mise  jour")}finally{o(!1)}}},className:"space-y-4",children:[m&&r.jsxs(Ux,{variant:"destructive",children:[r.jsx(de,{className:"h-4 w-4"}),r.jsx(Fx,{children:m})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"password",children:"Nouveau mot de passe"}),r.jsx(Jg,{id:"password",type:"password",value:e,onChange:e=>t(e.target.value),className:"border-coffee-medium",placeholder:"Minimum 8 caractres",minLength:8,required:!0}),r.jsx("p",{className:"text-xs text-gray-500",children:"Au moins 8 caractres avec une majuscule, une minuscule et un chiffre"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"confirm-password",children:"Confirmer le mot de passe"}),r.jsx(Jg,{id:"confirm-password",type:"password",value:n,onChange:e=>a(e.target.value),className:"border-coffee-medium",placeholder:"Rptez le mot de passe",minLength:8,required:!0})]}),r.jsx(qn,{type:"submit",className:"w-full bg-coffee-dark hover:bg-coffee-darker",disabled:i,children:i?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Mise  jour en cours..."]}):"Mettre  jour le mot de passe"})]})})]})]})}):r.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:r.jsx(Px,{className:"w-full max-w-md border-coffee-medium",children:r.jsx(Ox,{className:"pt-6",children:r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx(de,{className:"w-16 h-16 text-red-600 mx-auto"}),r.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Lien invalide ou expir"}),r.jsx("p",{className:"text-gray-600",children:"Le lien de rinitialisation est invalide ou a expir. Veuillez relancer une nouvelle demande de rinitialisation."}),r.jsx(qn,{onClick:()=>p("/auth"),className:"bg-coffee-dark hover:bg-coffee-darker",children:"Retour  la connexion"})]})})})})}async function Wx(e){try{const{data:t,error:s}=await en.from("followers").select("id",{count:"exact"}).eq("following_id",e);if(s)throw s;const{data:r,error:n}=await en.from("followers").select("id",{count:"exact"}).eq("follower_id",e);if(n)throw n;return{followers:t.length,following:r.length}}catch(t){return{followers:0,following:0}}}function Zx({targetUserId:e,onFollowChange:t,hideUnfollow:n=!1}){const[a,i]=s.useState(!1),[o,l]=s.useState(!1),{user:c}=kn();if(s.useEffect(()=>{c&&c.id!==e&&async function(){try{const t=await async function(e){try{const{data:t}=await en.auth.getSession(),s=t.session?.user?.id;if(!s)return!1;const{data:r,error:n}=await en.from("followers").select("id").match({follower_id:s,following_id:e}).maybeSingle();if(n)throw n;return!!r}catch(t){return!1}}(e);i(t)}catch(t){}}()},[e,c]),!c||c.id===e||a&&n)return null;return r.jsx(qn,{onClick:async()=>{l(!0);try{a?(await async function(e){try{const{data:t}=await en.auth.getSession(),s=t.session?.user?.id;if(!s)throw new Error("User not authenticated");const{error:r}=await en.from("followers").delete().match({follower_id:s,following_id:e});if(r)throw r}catch(t){const e=t instanceof Error?t.message:"Could not unfollow user";throw new Error(e)}}(e),mn.success("Vous ne suivez plus cet utilisateur.",{description:"Dsabonn"}),i(!1)):(await async function(e){try{const{data:s}=await en.auth.getSession(),r=s.session?.user?.id;if(!r)throw new Error("User not authenticated");const{error:n}=await en.from("followers").insert({follower_id:r,following_id:e});if(n)throw n;try{const{error:t}=await en.functions.invoke("send-follow-notification",{body:{followerId:r,followingId:e}})}catch(t){}}catch(s){const e=s instanceof Error?s.message:"Could not follow user";throw new Error(e)}}(e),mn.success("Vous suivez maintenant cet utilisateur.",{description:"Abonn"}),i(!0)),t&&t()}catch(s){mn.error(s.message||"Une erreur est survenue",{description:"Erreur"})}finally{l(!1)}},disabled:o,variant:a?"outline":"default",size:"sm",className:"flex items-center gap-1 transition-all duration-300","aria-label":a?"Se dsabonner":"S'abonner",children:a?r.jsxs(r.Fragment,{children:[r.jsx(Ue,{className:"h-4 w-4"}),r.jsx("span",{children:"Se dsabonner"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Fe,{className:"h-4 w-4"}),r.jsx("span",{children:"S'abonner"})]})})}Fx.displayName="AlertDescription";const Hx=We,Gx=s.createContext({}),Kx=({...e})=>r.jsx(Gx.Provider,{value:{name:e.name},children:r.jsx(Ze,{...e})}),Yx=()=>{const e=s.useContext(Gx),t=s.useContext(Qx),{getFieldState:r,formState:n}=$e(),a=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:i}=t;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...a}},Qx=s.createContext({}),Xx=s.forwardRef(({className:e,...t},n)=>{const a=s.useId();return r.jsx(Qx.Provider,{value:{id:a},children:r.jsx("div",{ref:n,className:zr("space-y-2",e),...t})})});Xx.displayName="FormItem";const Jx=s.forwardRef(({className:e,...t},s)=>{const{error:n,formItemId:a}=Yx();return r.jsx(Vx,{ref:s,className:zr(n&&"text-destructive",e),htmlFor:a,...t})});Jx.displayName="FormLabel";const ev=s.forwardRef(({...e},t)=>{const{error:s,formItemId:n,formDescriptionId:a,formMessageId:i}=Yx();return r.jsx(u,{ref:t,id:n,"aria-describedby":s?`${a} ${i}`:`${a}`,"aria-invalid":!!s,...e})});ev.displayName="FormControl";s.forwardRef(({className:e,...t},s)=>{const{formDescriptionId:n}=Yx();return r.jsx("p",{ref:s,id:n,className:zr("text-sm text-muted-foreground",e),...t})}).displayName="FormDescription";const tv=s.forwardRef(({className:e,children:t,...s},n)=>{const{error:a,formMessageId:i}=Yx(),o=a?String(a?.message):t;return o?r.jsx("p",{ref:n,id:i,className:zr("text-sm font-medium text-destructive",e),...s,children:o}):null});tv.displayName="FormMessage";const sv=(e,t,s)=>{if(e&&"reportValidity"in e){const r=He(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},rv=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?sv(r.ref,s,e):r.refs&&r.refs.forEach(t=>sv(t,s,e))}},nv=(e,t)=>{t.shouldUseNativeValidation&&rv(e,t);const s={};for(const r in e){const n=He(t.fields,r),a=Object.assign(e[r]||{},{ref:n&&n.ref});if(av(t.names||Object.keys(e),r)){const e=Object.assign({},He(s,r));Ge(e,"root",a),Ge(s,r,e)}else Ge(s,r,a)}return s},av=(e,t)=>e.some(e=>e.startsWith(t+"."));var iv=function(e,t){for(var s={};e.length;){var r=e[0],n=r.code,a=r.message,i=r.path.join(".");if(!s[i])if("unionErrors"in r){var o=r.unionErrors[0].errors[0];s[i]={message:o.message,type:o.code}}else s[i]={message:a,type:n};if("unionErrors"in r&&r.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var l=s[i].types,c=l&&l[r.code];s[i]=Ke(i,t,s,n,c?[].concat(c,r.message):r.message)}e.shift()}return s},ov=function(e,t,s){return void 0===s&&(s={}),function(r,n,a){try{return Promise.resolve(function(n,i){try{var o=Promise.resolve(e["sync"===s.mode?"parse":"parseAsync"](r,t)).then(function(e){return a.shouldUseNativeValidation&&rv({},a),{errors:{},values:s.raw?r:e}})}catch(l){return i(l)}return o&&o.then?o.then(void 0,i):o}(0,function(e){if(t=e,Array.isArray(null==t?void 0:t.errors))return{values:{},errors:nv(iv(e.errors,!a.shouldUseNativeValidation&&"all"===a.criteriaMode),a)};var t;throw e}))}catch(i){return Promise.reject(i)}}};const lv=kg.object({username:kg.string().min(3,"Le nom doit contenir au moins 3 caractres").max(50,"Le nom est trop long")});function cv({currentUsername:e,onSave:t}){const{user:n}=kn(),[a,i]=s.useState(!1),o=Ye({resolver:ov(lv),defaultValues:{username:e||""}});return r.jsx(Hx,{...o,children:r.jsxs("form",{onSubmit:o.handleSubmit(async e=>{if(n?.id){i(!0);try{const{error:s}=await en.from("profiles").update({username:e.username}).eq("id",n.id);if(s)throw s;mn.success("Votre nom public a t mis  jour avec succs.",{description:"Nom de profil enregistr"}),t()}catch(s){mn.error(s.message||"Une erreur est survenue lors de l'enregistrement du nom.",{description:"Erreur"})}finally{i(!1)}}}),className:"space-y-4",children:[r.jsx(Kx,{control:o.control,name:"username",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{className:"text-coffee-darker",children:"Nom de profil"}),r.jsx(ev,{children:r.jsx(Jg,{placeholder:"Choisissez un nom public",className:"bg-background",...e})}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce nom sera visible par les autres utilisateurs."}),r.jsx(tv,{})]})}),r.jsx(qn,{type:"submit",className:"w-full bg-coffee-dark hover:bg-coffee-darker",disabled:a,children:a?"Enregistrement...":"Enregistrer mon nom de profil"})]})})}const dv=s.forwardRef(({className:e,...t},s)=>r.jsx(Qe,{className:zr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:s,children:r.jsx(Xe,{className:zr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));dv.displayName=Qe.displayName;const uv=ut,mv=mt,hv=s.forwardRef(({className:e,children:t,...s},n)=>r.jsxs(Je,{ref:n,className:zr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,r.jsx(et,{asChild:!0,children:r.jsx(Me,{className:"h-4 w-4 opacity-50"})})]}));hv.displayName=Je.displayName;const pv=s.forwardRef(({className:e,...t},s)=>r.jsx(tt,{ref:s,className:zr("flex cursor-default items-center justify-center py-1",e),...t,children:r.jsx(Oe,{className:"h-4 w-4"})}));pv.displayName=tt.displayName;const fv=s.forwardRef(({className:e,...t},s)=>r.jsx(st,{ref:s,className:zr("flex cursor-default items-center justify-center py-1",e),...t,children:r.jsx(Me,{className:"h-4 w-4"})}));fv.displayName=st.displayName;const gv=s.forwardRef(({className:e,children:t,position:s="popper",...n},a)=>r.jsx(rt,{children:r.jsxs(nt,{ref:a,className:zr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...n,children:[r.jsx(pv,{}),r.jsx(at,{className:zr("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),r.jsx(fv,{})]})}));gv.displayName=nt.displayName;s.forwardRef(({className:e,...t},s)=>r.jsx(it,{ref:s,className:zr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=it.displayName;const xv=s.forwardRef(({className:e,children:t,...s},n)=>r.jsxs(ot,{ref:n,className:zr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(lt,{children:r.jsx(y,{className:"h-4 w-4"})})}),r.jsx(ct,{children:t})]}));xv.displayName=ot.displayName;var vv,bv;s.forwardRef(({className:e,...t},s)=>r.jsx(dt,{ref:s,className:zr("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=dt.displayName,(bv=vv||(vv={}))[bv.Sunday=1]="Sunday",bv[bv.Monday=2]="Monday",bv[bv.Tuesday=3]="Tuesday",bv[bv.Wednesday=4]="Wednesday",bv[bv.Thursday=5]="Thursday",bv[bv.Friday=6]="Friday",bv[bv.Saturday=7]="Saturday";const yv=As("LocalNotifications",{web:()=>_s(()=>import("./web-CBaHgju-.js"),__vite__mapDeps([4,1,2,3])).then(e=>new e.LocalNotificationsWeb)});async function jv(e=20,t=0){await yv.schedule({notifications:[{id:1001,title:"VREAD",body:"20 minutes de lecture ce soir ",schedule:{repeats:!0,on:{hour:e,minute:t}},smallIcon:"ic_stat_icon_config_sample"}]})}async function wv(){await yv.cancel({notifications:[{id:1001}]})}function Nv(){const[e,t]=s.useState(!1),[n,a]=s.useState("20:00"),[i,o]=s.useState(!1);s.useEffect(()=>{const e=!!window.Capacitor;o(e),e&&async function(){const{display:e}=await yv.checkPermissions();return"granted"===e}().then(t);const s=localStorage.getItem("reminder-time");s&&a(s)},[]);return i?r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(we,{className:"h-5 w-5 text-coffee-dark"}),"Rappels de lecture"]})}),r.jsxs(Ox,{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx(Vx,{htmlFor:"notifications-toggle",className:"text-coffee-darker font-medium",children:"Rappel quotidien"}),r.jsx("p",{className:"text-sm text-coffee-darker/80",children:"Recevez un rappel pour votre session de lecture"})]}),r.jsx(dv,{id:"notifications-toggle",checked:e,onCheckedChange:async e=>{if(i)try{if(e){await async function(){const{display:e}=await yv.checkPermissions();"granted"!==e&&await yv.requestPermissions()}();const[e,t]=n.split(":").map(Number);await jv(e,t),mn.success("Rappels de lecture activs")}else await wv(),mn.success("Rappels de lecture dsactivs");t(e)}catch(s){mn.error("Erreur lors de la configuration des notifications")}else mn.error("Les notifications ne sont disponibles que dans l'application mobile")}})]}),e&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"reminder-time",className:"text-coffee-darker font-medium",children:"Heure du rappel"}),r.jsxs(uv,{value:n,onValueChange:async t=>{if(a(t),localStorage.setItem("reminder-time",t),e&&i)try{await wv();const[e,s]=t.split(":").map(Number);await jv(e,s),mn.success("Heure du rappel mise  jour")}catch(s){mn.error("Erreur lors de la mise  jour du rappel")}},children:[r.jsx(hv,{className:"w-full",children:r.jsx(mv,{})}),r.jsxs(gv,{children:[r.jsx(xv,{value:"18:00",children:"18h00"}),r.jsx(xv,{value:"19:00",children:"19h00"}),r.jsx(xv,{value:"20:00",children:"20h00"}),r.jsx(xv,{value:"21:00",children:"21h00"}),r.jsx(xv,{value:"22:00",children:"22h00"})]})]})]})]})]}):r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(we,{className:"h-5 w-5 text-coffee-dark"}),"Notifications"]})}),r.jsx(Ox,{children:r.jsx("p",{className:"text-coffee-darker/80",children:"Les notifications de rappel sont disponibles uniquement dans l'application mobile VREAD."})})]})}function _v(){const e=H();return r.jsxs("div",{className:"space-y-6",children:[r.jsx(Nv,{}),r.jsxs(Px,{className:"border-coffee-light sticky top-20",children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(ht,{className:"h-5 w-5 text-coffee-dark"}),"Rglages"]})}),r.jsxs(Ox,{className:"space-y-4",children:[r.jsxs(qn,{variant:"outline",className:"w-full justify-start",children:[r.jsx(pt,{className:"h-4 w-4 mr-2"}),"Changer le mot de passe"]}),r.jsxs(qn,{variant:"outline",className:"w-full justify-start",onClick:()=>e("/legal/privacy"),children:[r.jsx(J,{className:"h-4 w-4 mr-2"}),"Politique de confidentialit"]}),r.jsxs(qn,{variant:"outline",className:"w-full justify-start",onClick:()=>e("/legal/terms"),children:[r.jsx(ft,{className:"h-4 w-4 mr-2"}),"Conditions d'utilisation"]}),r.jsxs(qn,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:()=>e("/settings/delete-account"),children:[r.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Supprimer mon compte"]}),r.jsxs(qn,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:async()=>{try{const{error:t}=await en.auth.signOut();if(t)return void mn.error("Erreur lors de la dconnexion");mn.success("Dconnexion russie"),e("/")}catch(t){mn.error("Erreur lors de la dconnexion")}},children:[r.jsx(ee,{className:"h-4 w-4 mr-2"}),"Se dconnecter"]})]})]})]})}let kv=null;const Sv=async()=>{if(kv)return kv;try{const{data:e,error:t}=await en.from("badges").select("id, slug, label, description, icon, color, rarity").order("created_at",{ascending:!0});return t?[]:(kv=e||[],kv)}catch(e){return[]}};let Ev=[];Sv().then(e=>{Ev=e});const Rv=async(e,t)=>{try{const{data:s,error:r}=await en.from("user_badges").select("id").eq("user_id",e).eq("badge_id",t).maybeSingle();return!r&&!!s}catch(s){return!1}},Cv=async(e,t)=>{try{const s=await Sv();if(!s.some(e=>e.id===t||e.slug===t))return!1;if(await Rv(e,t))return!0;const{data:r,error:n}=await en.from("user_badges").insert({user_id:e,badge_id:t,earned_at:(new Date).toISOString()}).select().single();if(n)return!1;const a=s.find(e=>e.id===t);return a&&mn.success(`Nouveau badge dbloqu : ${a.label}`),!0}catch(s){return!1}},Av=async e=>{try{const{data:t,error:s}=await en.from("user_badges").select("\n        badge_id,\n        earned_at,\n        badges:badge_id (\n          id,\n          slug,\n          label,\n          description,\n          icon,\n          color,\n          rarity,\n          category\n        )\n      ").eq("user_id",e);if(s)return[];return t.filter(e=>e.badges).map(e=>{const t=e.badges;return{id:t.id,slug:t.slug,label:t.label,description:t.description,icon:t.icon,color:t.color,rarity:t.rarity,category:t.category,dateEarned:new Date(e.earned_at).toLocaleDateString("fr-FR")}})}catch(t){return[]}};async function Tv(e){const{data:t,error:s}=await en.rpc("get_user_stats",{uid:e}).single();if(s)throw s;return{booksRead:t.books_read,pagesRead:t.pages_read,badgesCount:t.badges_count,streakCurrent:t.streak_current,streakBest:t.streak_best,questsDone:t.quests_done,xp:t.xp,lvl:t.lvl}}async function Pv(e){return(await Tv(e)).booksRead}async function Iv(e){return(await Tv(e)).pagesRead}async function Dv(e){const{count:t}=await en.from("reading_validations").select("id",{count:"exact",head:!0}).eq("user_id",e);return t||0}async function Lv(e){const t=2*(await Tv(e)).pagesRead;return Math.round(t/60)}function Ov(){const e=gt(),{user:t}=kn(),{t:n}=Tn(),[a,i]=s.useState(null),[o,l]=s.useState({followers:0,following:0}),[c,d]=s.useState([]),[u,m]=s.useState([]),[h,p]=s.useState([]),[f,g]=s.useState({booksRead:0,totalPages:0,segmentsValidated:0,readingTime:0}),[x,v]=s.useState(!0),[b,y]=s.useState(!1),[j,w]=s.useState("overview"),[N,_]=s.useState(!1),k=e.userId||t?.id,S=!e.userId||t&&t.id===e.userId;s.useEffect(()=>{if(!k)return;const e=new AbortController;let t=!0;return async function(){performance.now();try{v(!0);const[s,r]=await Promise.all([yn(k).catch(e=>(mn.error("Impossible de charger le profil"),null)),Wx(k).catch(e=>({followers:0,following:0}))]);if(!t||e.signal.aborted)return;i(s),l(r);const[n]=await Promise.all([Av(k).catch(e=>[])]);if(!t||e.signal.aborted)return;if(d(n.slice(0,6)),S){const[s,r,n,a]=await Promise.all([Pv(k).catch(e=>0),Iv(k).catch(e=>0),Dv(k).catch(e=>0),Lv(k).catch(e=>0)]);if(!t||e.signal.aborted)return;g({booksRead:s,totalPages:r,segmentsValidated:n,readingTime:a})}}catch(s){e.signal.aborted||mn.error("Erreur lors du chargement du profil")}finally{if(t){v(!1);performance.now()}}}(),()=>{t=!1,e.abort()}},[k,S]),s.useEffect(()=>{k&&!N&&("books"!==j&&"overview"!==j||async function(){try{const e=await Nx(k,{limit:10});if(e){const t=e.filter(e=>"in_progress"===e.status),s=e.filter(e=>"completed"===e.status||e.chaptersRead>=(e.totalChapters||e.expectedSegments||1)).slice(0,8);m(t),p(s),_(!0)}}catch(e){}}())},[j,k,N]);const E=jn(a?.username,a?.email||t?.email,k||"U");return x?r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("main",{className:"mx-auto w-full px-4 max-w-none py-8",children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-coffee-dark mx-auto"}),r.jsx("p",{className:"text-coffee-dark font-medium",children:"Chargement du profil..."})]})})})]})}):r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-coffee-light/20 via-background to-coffee-light/10",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-4 sm:py-8 px-4 sm:px-6 lg:px-8 space-y-6 sm:space-y-8",children:[r.jsx(Px,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm shadow-xl overflow-hidden",children:r.jsx(Ox,{className:"p-4 sm:p-6 lg:p-8",children:r.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[r.jsxs("div",{className:"flex flex-col items-center lg:items-start text-center lg:text-left flex-shrink-0",children:[r.jsx(yh,{src:a?.avatar,alt:E,fallbackText:E,size:"xl",className:"border-4 border-coffee-light shadow-lg mb-4"}),S&&!b&&r.jsxs(qn,{variant:"outline",size:"sm",className:"mb-4 border-coffee-light hover:bg-coffee-light/20 text-xs sm:text-sm",onClick:()=>y(!0),children:[r.jsx(xt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),r.jsx("span",{className:"hidden sm:inline",children:a?.username?"Modifier mon nom":"Ajouter un nom"}),r.jsx("span",{className:"sm:hidden",children:a?.username?"Modifier":"Ajouter"})]})]}),r.jsx("div",{className:"flex-1 min-w-0 space-y-4 sm:space-y-6",children:b&&S?r.jsxs("div",{className:"space-y-4",children:[r.jsx(cv,{currentUsername:a?.username,onSave:async()=>{if(k)try{const e=await yn(k);i(e),y(!1)}catch(e){}}}),r.jsx(qn,{variant:"ghost",onClick:()=>y(!1),className:"text-sm",children:"Annuler"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-serif font-bold text-coffee-darker mb-2 break-words",children:E}),r.jsx("p",{className:"text-coffee-medium text-sm sm:text-base lg:text-lg break-all",children:a?.email||t?.email})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 sm:gap-6",children:[r.jsxs(T,{to:`/followers/followers/${k}`,className:"flex items-center gap-2 group min-w-0",children:[r.jsx(W,{className:"h-4 w-4 sm:h-5 sm:w-5 text-coffee-dark flex-shrink-0"}),r.jsx("span",{className:"font-semibold text-coffee-darker text-sm sm:text-base lg:text-lg",children:o.followers}),r.jsx("span",{className:"text-coffee-medium group-hover:underline text-sm sm:text-base hidden sm:inline",children:"Abonns"}),r.jsx("span",{className:"text-coffee-medium group-hover:underline text-xs sm:hidden",children:"Abonns"})]}),r.jsxs(T,{to:`/followers/following/${k}`,className:"flex items-center gap-2 group min-w-0",children:[r.jsx(W,{className:"h-4 w-4 sm:h-5 sm:w-5 text-coffee-dark flex-shrink-0"}),r.jsx("span",{className:"font-semibold text-coffee-darker text-sm sm:text-base lg:text-lg",children:o.following}),r.jsx("span",{className:"text-coffee-medium group-hover:underline text-sm sm:text-base hidden sm:inline",children:"Abonnements"}),r.jsx("span",{className:"text-coffee-medium group-hover:underline text-xs sm:hidden",children:"Suivis"})]}),!S&&k&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx(Zx,{targetUserId:k})}),S&&r.jsx("div",{className:"flex-shrink-0",children:r.jsx(T,{to:"/settings/delete-account",className:"text-xs text-muted-foreground hover:text-destructive transition-colors underline-offset-4 hover:underline",children:"Supprimer mon compte"})})]}),S&&r.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[r.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[r.jsx(xe,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),r.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:f.booksRead}),r.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium break-words",children:"Livres termins"})]}),r.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[r.jsx(vt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),r.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:f.segmentsValidated}),r.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium",children:"Validations"})]}),r.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[r.jsx(bt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),r.jsxs("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:[Math.floor(f.readingTime/60),"h"]}),r.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium break-words",children:"Temps de lecture"})]}),r.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[r.jsx(yt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),r.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:f.totalPages}),r.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium",children:"Pages lues"})]})]})]})})]})})}),r.jsxs(Lh,{defaultValue:"overview",value:j,onValueChange:w,className:"space-y-4 sm:space-y-6 w-full",children:[r.jsx("div",{className:"w-full overflow-x-auto scrollbar-hide",children:r.jsxs(Oh,{className:"bg-white/80 backdrop-blur-sm border border-coffee-light/50 p-1 inline-flex min-w-full sm:min-w-0 justify-start sm:justify-center",children:[r.jsxs(Mh,{value:"overview",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:[r.jsx("span",{className:"hidden sm:inline",children:"Vue d'ensemble"}),r.jsx("span",{className:"sm:hidden",children:"Aperu"})]}),r.jsx(Mh,{value:"books",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:"Livres"}),r.jsx(Mh,{value:"badges",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:"Badges"}),S&&r.jsxs(Mh,{value:"settings",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:[r.jsx("span",{className:"hidden sm:inline",children:"Paramtres"}),r.jsx("span",{className:"sm:hidden",children:"Config"})]})]})}),r.jsxs(Vh,{value:"overview",className:"space-y-4 sm:space-y-6 mt-0",children:[u.length>0&&r.jsxs(Px,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[r.jsx(Ix,{className:"pb-3 sm:pb-4",children:r.jsxs(Dx,{className:"text-lg sm:text-xl font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(xe,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),r.jsx("span",{className:"break-words",children:"Lecture en cours"})]})}),r.jsx(Ox,{className:"pt-0",children:r.jsx("div",{className:"space-y-3 sm:space-y-4",children:u.slice(0,2).map(e=>r.jsxs("div",{className:"flex gap-3 sm:gap-4 p-3 sm:p-4 bg-coffee-light/10 rounded-lg overflow-hidden",children:[r.jsx("div",{className:"w-12 h-16 sm:w-16 sm:h-20 bg-coffee-light rounded flex-shrink-0"}),r.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[r.jsx("h4",{className:"font-medium text-coffee-darker text-sm sm:text-base break-words line-clamp-2",children:e.book_title}),r.jsx("p",{className:"text-xs sm:text-sm text-coffee-medium break-words line-clamp-1",children:e.book_author}),r.jsx(Fg,{value:e.progressPercent||0,className:"h-1.5 sm:h-2"}),r.jsxs("p",{className:"text-xs text-coffee-medium",children:[e.progressPercent||0,"% termin"]})]})]},e.id))})})]}),c.length>0&&r.jsxs(Px,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[r.jsxs(Ix,{className:"flex flex-row items-center justify-between space-y-0 pb-3 sm:pb-4",children:[r.jsxs(Dx,{className:"text-lg sm:text-xl font-serif text-coffee-darker flex items-center gap-2 min-w-0",children:[r.jsx(jt,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),r.jsx("span",{className:"break-words",children:n.common.recentBadges})]}),r.jsx(qn,{variant:"outline",size:"sm",asChild:!0,className:"flex-shrink-0 text-xs sm:text-sm",children:r.jsxs(T,{to:"/achievements",children:[r.jsx("span",{className:"hidden sm:inline",children:n.common.seeAll}),r.jsx("span",{className:"sm:hidden",children:n.common.seeAll})]})})]}),r.jsx(Ox,{className:"pt-0",children:r.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-3 sm:gap-4",children:c.map(e=>r.jsxs("div",{className:"text-center group",children:[r.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-coffee-light to-coffee-medium rounded-full mx-auto mb-2 flex items-center justify-center text-lg sm:text-2xl group-hover:scale-110 transition-transform",children:e.icon||""}),r.jsx("p",{className:"text-xs text-coffee-darker font-medium line-clamp-2 break-words",children:e.label})]},e.id))})})]})]}),r.jsx(Vh,{value:"books",className:"space-y-4 sm:space-y-6 mt-0",children:r.jsxs(Px,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[r.jsx(Ix,{className:"pb-3 sm:pb-4",children:r.jsxs(Dx,{className:"text-lg sm:text-xl font-serif text-coffee-darker break-words",children:["Livres termins (",h.length,")"]})}),r.jsx(Ox,{className:"pt-0",children:h.length>0?r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3 sm:gap-4",children:h.map(e=>r.jsxs(T,{to:`/books/${e.book_id}`,className:"group",children:[r.jsx("div",{className:"w-full aspect-[3/4] bg-coffee-light rounded-lg group-hover:scale-105 transition-transform"}),r.jsx("p",{className:"text-xs text-coffee-darker font-medium mt-2 line-clamp-2 break-words",children:e.book_title})]},e.id))}):r.jsx("div",{className:"text-center py-8 sm:py-12 text-coffee-medium",children:r.jsx("p",{className:"text-sm sm:text-base",children:"Aucun livre termin pour le moment"})})})]})}),r.jsx(Vh,{value:"badges",className:"mt-0",children:r.jsxs(Px,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[r.jsx(Ix,{className:"pb-3 sm:pb-4",children:r.jsxs(Dx,{className:"text-lg sm:text-xl font-serif text-coffee-darker break-words",children:["Tous les badges (",c.length,")"]})}),r.jsx(Ox,{className:"pt-0",children:c.length>0?r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6",children:c.map(e=>r.jsxs("div",{className:"text-center p-3 sm:p-4 bg-coffee-light/10 rounded-lg",children:[r.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-coffee-light to-coffee-medium rounded-full mx-auto mb-3 flex items-center justify-center text-2xl sm:text-3xl",children:e.icon||""}),r.jsx("h4",{className:"font-medium text-coffee-darker mb-1 text-sm sm:text-base break-words",children:e.label}),r.jsx("p",{className:"text-xs sm:text-sm text-coffee-medium line-clamp-2 break-words",children:e.description})]},e.id))}):r.jsx("div",{className:"text-center py-8 sm:py-12 text-coffee-medium",children:r.jsx("p",{className:"text-sm sm:text-base",children:"Aucun badge obtenu pour le moment"})})})]})}),S&&r.jsx(Vh,{value:"settings",className:"mt-0",children:r.jsx("div",{className:"overflow-hidden",children:r.jsx(_v,{})})})]})]})]})})}const Mv=({title:e})=>r.jsx(Ix,{children:r.jsx(Dx,{className:"text-h2 font-serif text-coffee-darker",children:e})}),Vv=({book:e})=>{const t=e?.coverImage||e?.cover_url||e?.book_cover;return r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"book-cover w-32 h-48 flex-shrink-0",children:t?r.jsx($g,{src:t,alt:e.title,className:"w-full h-full object-cover",sizes:"(max-width: 768px) 120px, 128px"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-chocolate-medium",children:r.jsx("span",{className:"text-white font-serif italic text-h1",children:e.title.substring(0,1)})})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-h4 font-medium text-coffee-darker",children:e.title}),r.jsx("p",{className:"text-body-sm text-muted-foreground",children:e.author}),r.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(e.categories||e.tags||[]).map((e,t)=>r.jsx("span",{className:"px-2 py-1 bg-coffee-light/30 text-coffee-darker rounded-full text-caption",children:e},t))})]})]})},qv=({description:e})=>r.jsx("p",{className:"text-body text-coffee-darker",children:e}),Bv=s.forwardRef(({progressPercent:e,jokersUsed:t=0,jokersAllowed:n=0},a)=>(s.useEffect(()=>{e>0&&a&&"function"!=typeof a&&a.current&&setTimeout(()=>{a.current?.scrollIntoView({behavior:"smooth",block:"center"})},350)},[e,a]),r.jsxs("div",{ref:a,className:"my-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Fg,{value:e}),r.jsxs("span",{className:"text-caption font-medium text-coffee-darker",children:[e,"%"]})]}),n>0&&r.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[r.jsx(De,{className:"h-3 w-3 text-amber-500"}),r.jsxs("span",{className:"text-caption text-muted-foreground",children:["Jokers : ",t," / ",n," utiliss"]})]}),e>0&&e<100&&r.jsx("div",{className:"flex justify-center mt-1 animate-bounce",children:r.jsx(Me,{className:"h-4 w-4 text-coffee-medium opacity-60"})})]})));Bv.displayName="BookProgressBar";const zv=s.forwardRef(({className:e,...t},s)=>r.jsx(wt,{ref:s,className:zr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:r.jsx(Nt,{className:zr("flex items-center justify-center text-current"),children:r.jsx(y,{className:"h-4 w-4"})})}));function Uv({remainingSeconds:e,onExpire:t}){const[n,a]=s.useState(e),i=s.useCallback(()=>{const e=Math.floor(n/3600),t=Math.floor(n%3600/60),s=n%60;let r;return r=e>0?`${e} heure${e>1?"s":""} et ${t} minute${t>1?"s":""}`:t>0?`${t} minute${t>1?"s":""} et ${s} seconde${s>1?"s":""}`:`${s} seconde${s>1?"s":""}`,r},[n]);s.useEffect(()=>{if(n<=0)return void t();const e=setInterval(()=>{a(s=>s<=1?(clearInterval(e),setTimeout(t,0),0):s-1)},1e3);return()=>clearInterval(e)},[n,t]);const o=i();return r.jsx(Ux,{className:"bg-amber-50 border-amber-200",children:r.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[r.jsx(bt,{className:"h-4 w-4"}),r.jsxs(Fx,{className:"text-body-sm",children:["Vous pourrez ressayer dans ",r.jsx("span",{className:"font-medium",children:o})]})]})})}function Fv({bookTitle:e,segment:t,isOpen:n,isValidating:a,isLocked:i=!1,remainingLockTime:o=null,jokersUsed:l=0,jokersAllowed:c=0,onClose:d,onValidate:u,onLockExpire:m}){const[h,p]=s.useState(!1);return r.jsx(nx,{open:n,onOpenChange:e=>{e||(p(!1),d())},"aria-labelledby":"validation-modal-title","aria-describedby":"validation-modal-description",children:r.jsxs(lx,{className:"sm:max-w-md border-coffee-medium",role:"dialog","aria-modal":"true",children:[r.jsxs(cx,{children:[r.jsxs(ux,{id:"validation-modal-title",className:"text-center text-coffee-darker font-serif",children:["Validation de lecture : pages ",30*(t-1)+1,"-",30*t]}),r.jsxs(mx,{id:"validation-modal-description",className:"text-center text-body-sm text-foreground/80",children:['Confirmez votre lecture de "',e,'"']})]}),r.jsxs("div",{className:"py-4 space-y-4",children:[r.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg border border-coffee-light",children:[r.jsxs("div",{className:"flex items-center gap-2 text-body-sm text-muted-foreground",children:[r.jsx(De,{className:"h-4 w-4"}),r.jsxs("span",{className:l>=c?"text-muted-foreground line-through":"","data-testid":"jokers-remaining",children:["Jokers disponibles : ",Math.max(0,c-l)," / ",c]})]}),0===c&&r.jsx("p",{className:"text-caption text-muted-foreground mt-1",children:"Jokers disponibles  partir de 3 segments"}),c>0&&l>=c&&r.jsx("p",{className:"text-caption text-muted-foreground mt-1",children:"Tous vos jokers ont t utiliss pour ce livre"})]}),i&&o&&o>0?r.jsx("div",{role:"status","aria-live":"polite",children:r.jsx(Uv,{remainingSeconds:o,onExpire:()=>m?.()})}):r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(zv,{id:"hasRead",checked:h,onCheckedChange:e=>p(e),"aria-describedby":"checkbox-description",className:"transition-all duration-200 data-[state=checked]:scale-110"}),r.jsxs("div",{className:"grid gap-1.5 leading-none",children:[r.jsx(Vx,{htmlFor:"hasRead",className:"text-body-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground",children:"J'ai lu ces pages"}),r.jsx("p",{id:"checkbox-description",className:"text-caption text-foreground/70",children:"Confirmez votre lecture avant de valider"})]})]})]}),r.jsxs(dx,{className:"sm:justify-center gap-2",children:[r.jsx(qn,{variant:"outline",onClick:d,className:"border-coffee-medium text-foreground hover:bg-muted","aria-label":"Annuler la validation de lecture",children:"Annuler"}),!i&&r.jsx(qn,{onClick:()=>{h&&u()},disabled:!h||a,className:"bg-coffee-dark hover:bg-coffee-darker text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":a?"Validation en cours":"Valider cette tape de lecture","aria-describedby":h?void 0:"validation-requirement",children:a?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"h-4 w-4 mr-2 animate-spin","aria-hidden":"true"}),r.jsx("span",{children:"Validation..."})]}):"Valider cette tape"}),!h&&r.jsx("div",{id:"validation-requirement",className:"sr-only","aria-live":"polite",children:"Vous devez cocher la case pour valider votre lecture"})]})]})})}zv.displayName=wt.displayName;const $v=s.forwardRef(({className:e,...t},s)=>r.jsx("textarea",{className:zr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));function Wv({bookTitle:e,chapterNumber:t,question:s,answer:n,attempts:a,maxAttempts:i,setAnswer:o}){return r.jsxs("div",{className:"py-4",children:[r.jsxs("p",{className:"text-body-sm text-foreground/80 mb-4 text-center",children:["Pour valider votre lecture du chapitre ",t,' de "',e,'", veuillez rpondre  la question suivante:']}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"font-medium text-foreground",id:"quiz-question",children:s}),r.jsxs("div",{className:"mt-2",children:[r.jsx(Vx,{htmlFor:"answer",className:"text-body-sm font-medium text-foreground",children:"Votre rponse"}),r.jsx($v,{id:"answer",placeholder:"Votre rponse...",rows:3,value:n,onChange:e=>o(e.target.value),className:"w-full border-coffee-medium resize-none mt-1 text-foreground bg-background","aria-describedby":"quiz-question attempts-counter","aria-required":"true"}),r.jsxs("p",{id:"attempts-counter",className:"text-caption text-foreground/70 mt-1","aria-live":"polite",children:["Tentatives: ",a,"/",i]})]})]})]})}function Zv({correctAnswer:e,segment:t,revealedAt:s,onContinue:n}){return r.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 shadow-sm",role:"status","aria-live":"polite","data-testid":"correct-answer-reveal",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"p-2 rounded-full bg-amber-200",children:r.jsx(De,{className:"h-5 w-5 text-amber-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-amber-800",children:"Bonne rponse rvle"}),r.jsxs("p",{className:"text-sm text-amber-700",children:["Segment ",t," valid avec un Joker"]})]})]}),r.jsxs("div",{className:"mb-4 p-4 bg-white rounded-lg border",children:[r.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"La bonne rponse tait :"}),r.jsx("p",{className:"text-lg font-semibold text-foreground","data-testid":"revealed-answer-text",children:e||"Rponse introuvable (vrifier answer en base et questionId/slug/segment)."})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-xs text-amber-600",children:["Rvl le ",new Date(s).toLocaleString("fr-FR")]}),r.jsxs(qn,{onClick:n,className:"bg-amber-600 hover:bg-amber-700 text-white","data-testid":"continue-after-reveal",children:[r.jsx(fe,{className:"h-4 w-4 mr-2"}),"Continuer la lecture"]})]})]})}async function Hv(e,t){try{const{data:s,error:r}=await en.from("reading_questions_public").select("id, book_slug, segment, question, book_id").eq("book_slug",e).eq("segment",t).maybeSingle();return r?null:s}catch(s){return null}}$v.displayName="Textarea";Number(3);function Gv(e=0){return!!Number.isFinite(e)}function Kv(e=0){return Math.floor((e||0)/10)+1}async function Yv(e){if(!Gv(e.expectedSegments??0))throw new Error("Joker indisponible: ncessite au moins 3 segments.");const t=await async function(e){const{bookId:t,questionId:s,userId:r,consume:n=!0}=e;if(!t||!s||!r)throw new Error("joker-reveal: missing bookId/questionId/userId");const{data:a}=await en.auth.getSession(),i=a?.session?.access_token,o=i?{Authorization:`Bearer ${i}`}:void 0,{data:l,error:c}=await en.functions.invoke("joker-reveal",{body:{bookId:t,questionId:s,userId:r,consume:n},headers:o});if(c)throw new Error(c.message||"joker-reveal failed");if(!l?.answer)throw new Error("joker-reveal: no answer returned");return l.answer}({bookId:e.bookId,questionId:e.questionId,userId:e.userId,consume:!0});return{answer:t}}async function Qv(e,t){try{let s,r;const n=await en.from("books_public").select("expected_segments").eq("id",e).maybeSingle();if(!n.error&&n.data)s=n.data,r=null;else{const t=await en.from("books").select("expected_segments, id").eq("slug",e).eq("is_published",!0).maybeSingle();!t.error&&t.data?(s=t.data,r=null,e=t.data.id):r=t.error||new Error("Book not found")}if(r||!s)return 0;const{data:a,error:i}=await en.from("reading_progress").select("id").eq("user_id",t).eq("book_id",e).single();if(i||!a)return 0;const o=Kv(s.expected_segments),{data:l,error:c}=await en.from("reading_validations").select("id").eq("progress_id",a.id).eq("used_joker",!0);if(c)return 0;const d=l?.length||0;return Math.max(0,o-d)}catch(s){return 0}}function Xv({bookId:e,userId:t,expectedSegments:r=0}){const[n,a]=s.useState(0),[i,o]=s.useState(0),[l,c]=s.useState(0),[d,u]=s.useState(!1);s.useEffect(()=>{(async()=>{if(!e||!t)return a(0),o(0),void c(0);u(!0);try{const s=await Qv(e,t),n=Kv(r),i=Math.max(0,n-s);a(s),o(n),c(i)}catch(s){a(0),o(0),c(0)}finally{u(!1)}})()},[e,t,r]);return{jokersRemaining:n,jokersAllowed:i,jokersUsed:l,isLoading:d,updateJokersInfo:async()=>{if(e&&t)try{const s=await Qv(e,t),n=Kv(r),i=Math.max(0,n-s);a(s),c(i)}catch(s){}}}}function Jv(e){switch(e){case 1:return 100;case 2:return 250;case 3:return 500;case 4:return 1e3;default:return 0}}async function eb(e){try{if(!e)return null;const{data:t,error:s}=await en.from("user_levels").select("*").eq("user_id",e).maybeSingle();return s?null:t||async function(e){try{const t={user_id:e,xp:0,level:1},{data:s,error:r}=await en.from("user_levels").insert(t).select().single();return r?null:s}catch(s){return null}}(e)}catch(t){return null}}async function tb(e,t){try{if(!e)return!1;if(t<=0)return!1;const{data:s,error:r}=await en.rpc("increment_user_xp",{p_user_id:e,p_amount:t});if(r)return!1;const n=s;if(n.new_level>n.old_level)mn.success(`Niveau ${n.new_level} atteint !`,{description:"Tu progresses, bravo !",duration:5e3,icon:""});else{const e=Jv(n.new_level)-n.new_xp;e>0&&e<=30&&mn(`Plus que ${e} XP pour le niveau ${n.new_level+1} !`,{description:"Continue comme a !",duration:3e3,icon:""})}return!0}catch(s){return!1}}function sb({bookTitle:e,chapterNumber:t,onComplete:n,onClose:a,question:i,expectedSegments:o=0,progressId:l,jokersRemaining:c=0,isUsingJoker:d=!1}){const[u,m]=s.useState(""),[h,p]=s.useState(0),[f,g]=s.useState(!1),[x,v]=s.useState(!1),[b,y]=s.useState(null),[j,w]=s.useState(null),[N,_]=s.useState(null),[k,S]=s.useState(!1),[E,R]=s.useState(!1);s.useRef(!1);const C=s.useRef(!1),A=s.useRef(null),{user:T}=kn(),P=function(){!jd.current&&wd();const[e]=s.useState(yd.current);return e}();s.useEffect(()=>(C.current=!1,()=>{C.current=!1,A.current?.abort()}),[i?.id]);const{jokersAllowed:I,jokersUsed:D,jokersRemaining:L,updateJokersInfo:O}=Xv({bookId:i.book_slug||l||null,userId:T?.id||null,expectedSegments:o}),M=c??L,V=()=>{A.current?.abort(),a()};return r.jsxs(r.Fragment,{children:[r.jsx(nx,{open:!f&&!x,onOpenChange:V,children:r.jsxs(lx,{className:"sm:max-w-md border-coffee-medium",children:[r.jsxs(cx,{children:[r.jsxs(ux,{id:"quiz-modal-title",className:"text-center text-coffee-darker font-serif",children:["Vrification de lecture: Chapitre ",t]}),r.jsx(mx,{id:"quiz-modal-description",className:"text-center text-body-sm text-foreground/80",children:"Rpondez par un mot pour valider votre comprhension."})]}),r.jsx(sc,{mode:"wait",children:r.jsxs(eh.div,{initial:{opacity:0,y:P?0:8},animate:{opacity:1,y:0},exit:{opacity:0,y:P?0:-8},transition:{duration:.18},children:[r.jsx(Wv,{bookTitle:e,chapterNumber:t,question:i.question,answer:u,attempts:h,maxAttempts:3,setAnswer:m,"data-testid":"quiz-answer-input"}),r.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:h>0&&3-h+" tentative(s) restante(s)"}),void 0,r.jsxs(dx,{className:"sm:justify-center gap-2",children:[r.jsx(qn,{variant:"outline",onClick:V,className:"border-coffee-medium text-foreground hover:bg-muted","aria-label":"Annuler le quiz de lecture",children:"Annuler"}),r.jsx(qn,{onClick:async()=>{if(u.trim()){if(!E){R(!0);try{if(!T?.id)return void mn.error("Vous devez tre connect pour valider");const{data:e,error:t}=await en.from("books").select("id").eq("slug",i.book_slug).maybeSingle();if(t||!e?.id)return void mn.error("Erreur lors de la recherche du livre.");A.current?.abort(),A.current=new AbortController;const s=await async function(e){if(e.questionId?.includes("fallback-"))return{ok:!1,blocked:!0,reason:"fallback_id"};if(!e.userId||!e.bookId||!e.questionId)throw new Error("Missing required parameters");let t=e.bookId;t.startsWith("fallback-")&&(t=t.replace("fallback-",""));let s=e.questionId;if(s?.startsWith("fallback-"))return{ok:!1,blocked:!0};try{const{data:n,error:a}=await en.rpc("force_validate_segment_beta",{p_book_id:t,p_question_id:s,p_answer:e.answer||"",p_user_id:e.userId,p_used_joker:Boolean(e.usedJoker),p_correct:e.correct??null});if(a)throw new Error(`RPC error: ${a.message}`);const i=n;if(i?.ok&&e.userId&&!e.usedJoker)try{await tb(e.userId,10)}catch(r){}return n}catch(n){throw n}}({bookId:e.id,questionId:i.id,answer:u.trim(),userId:T.id,usedJoker:!1,correct:null,signal:A.current.signal});if(s?.ok)mn.success(" Segment valid !",{description:"+10 XP  Prochain segment dans 30 pages",duration:4e3}),C.current||(C.current=!0,n({correct:!0,useJoker:!1}));else{const e=h+1;p(e),mn.error("Rponse incorrecte",{description:3-e+" tentative(s) restante(s)",duration:4e3});const t=Gv(o);e>=1&&M>0&&t&&!d?(_(Date.now()),g(!0)):t?e>=3&&(mn.error("Tentatives puises",{description:"Ressayez plus tard",duration:4e3}),C.current||(C.current=!0,n({correct:!1,useJoker:!1}))):(mn.error("Jokers indisponibles",{description:"Livre trop court (< 3 segments)",duration:4e3}),e>=3&&!C.current&&(C.current=!0,n({correct:!1,useJoker:!1})))}}catch(e){if("AbortError"===e?.name)return;const t=h+1;p(t);const s=Gv(o);s&&M>0&&!d&&t>=1?(_(Date.now()),g(!0)):s?t>=3?(mn.error("Nombre maximum de tentatives atteint. Ressayez plus tard."),C.current||(C.current=!0,n({correct:!1,useJoker:!1}))):mn.error(`Rponse incorrecte. Il vous reste ${3-t} tentative(s).`):(mn.error("Les jokers ne sont pas disponibles pour ce livre (moins de 3 segments)."),t>=3?C.current||(C.current=!0,n({correct:!1,useJoker:!1})):mn.error(`Rponse incorrecte. Il vous reste ${3-t} tentative(s).`))}finally{R(!1)}}}else mn.error("Veuillez entrer une rponse")},disabled:!u.trim()||x||k||E,className:"bg-coffee-dark hover:bg-coffee-darker text-white","aria-label":"Valider ma rponse au quiz","aria-describedby":u.trim()?void 0:"answer-requirement","data-testid":"submit-answer-button",children:E?"Validation...":"Valider ma rponse"}),!u.trim()&&r.jsx("div",{id:"answer-requirement",className:"sr-only","aria-live":"polite",children:"Vous devez saisir une rponse avant de valider"})]})]},"quiz-content")})]})}),r.jsx(nx,{open:x,onOpenChange:()=>v(!1),children:r.jsxs(lx,{className:"sm:max-w-md",children:[r.jsx(cx,{children:r.jsxs(ux,{className:"text-center font-serif",children:["Segment ",t," valid"]})}),b&&r.jsx(Zv,{correctAnswer:b,segment:t,revealedAt:j??(new Date).toISOString(),onContinue:()=>{v(!1),C.current||(C.current=!0,n({correct:!0,useJoker:!0}))}})]})}),r.jsx(nx,{open:f,onOpenChange:()=>g(!1),children:r.jsxs(lx,{className:"sm:max-w-md border-coffee-medium",children:[r.jsxs(cx,{children:[r.jsx(ux,{className:"text-center font-serif text-coffee-darker",children:"Utiliser un joker"}),r.jsx(mx,{className:"text-center text-body-sm text-foreground/80",children:"Rvle la bonne rponse pour ce segment en dpensant un joker."})]}),r.jsx(sc,{mode:"wait",children:r.jsxs(eh.div,{initial:{opacity:0,scale:P?1:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:P?1:.98},transition:{duration:.18},children:[r.jsxs("div",{className:"py-4 text-center space-y-4",children:[r.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:r.jsx("p",{className:"text-amber-800 text-body-sm",children:"Utiliser un joker rvlera immdiatement la bonne rponse et validera ce segment."})}),r.jsxs("div",{className:"text-body-sm text-muted-foreground",children:[r.jsxs("p",{children:["Jokers restants :"," ",r.jsx("span",{className:"font-semibold text-coffee-dark",children:M})]}),r.jsxs("p",{children:["Segment : ",t]})]})]}),r.jsxs(dx,{className:"sm:justify-center gap-2",children:[r.jsx(qn,{variant:"outline",onClick:()=>{g(!1),_(null),C.current||(C.current=!0,n({correct:!1,useJoker:!1}))},disabled:k,className:"border-coffee-medium text-foreground hover:bg-muted",children:"Annuler"}),r.jsx(qn,{onClick:async()=>{if(g(!1),!k){S(!0);try{if(i?.book_id){i.book_id}const r=await Yv({bookId:i.book_id,questionId:i.id,userId:T.id,expectedSegments:o}),n=("string"==typeof r?r:r?.answer??"").trim();if(!n)return void mn.error("Impossible d'afficher la bonne rponse (donnes manquantes).");if(y(n),w((new Date).toISOString()),v(!0),N)try{await(e={bookId:i.book_slug||"",segment:t,attemptsBefore:h,timeToJokerMs:Date.now()-N},void("undefined"!=typeof window&&window.gtag&&window.gtag("event","joker_used",{book_id:e.bookId,segment:e.segment,attempts_before:e.attemptsBefore,time_to_joker_ms:e.timeToJokerMs,event_category:"reading_validation",custom_parameters:{joker_usage:!0}}))),await function(e){"undefined"!=typeof window&&window.gtag&&window.gtag("event","answer_revealed",{book_id:e.bookId,segment:e.segment,answer_length:e.correctAnswerLength,event_category:"reading_validation",custom_parameters:{answer_revealed:!0,was_correct_before:!1}})}({bookId:i.book_slug||"",segment:t,correctAnswerLength:n.length})}catch(s){}await O(),mn.success("Joker utilis ! La bonne rponse est rvle.")}catch(r){403===r?.status||/trop court|moins de 3 segments/i.test(r?.message||"")?mn.error("Jokers indisponibles sur ce livre (moins de 3 segments)."):mn.error("Erreur lors de l'utilisation du joker. Veuillez ressayer.")}finally{S(!1)}var e}},disabled:k,className:"bg-amber-600 hover:bg-amber-700 text-white",children:k?"Rvlation...":"Utiliser le joker"})]})]},"joker-content")})]})})]})}const rb=s.createContext({showConfetti:()=>{}}),nb=({children:e})=>{const t=s.useRef(null),n=s.useRef(null);s.useEffect(()=>{"undefined"!=typeof window&&t.current&&(n.current=Dn.create(t.current,{resize:!0,useWorker:!0}))},[]);const a=s.useCallback(e=>{const t=n.current,s=e?.burst??"big";if(!t)return Dn({particleCount:"big"===s?200:100,spread:60,origin:{y:.6},colors:["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"]}),setTimeout(()=>{Dn({particleCount:"big"===s?120:60,angle:60,spread:55,origin:{x:0,y:.6}})},150),void setTimeout(()=>{Dn({particleCount:"big"===s?120:60,angle:120,spread:55,origin:{x:1,y:.6}})},300);t({particleCount:"big"===s?120:60,angle:60,spread:55,origin:{x:0,y:.6}}),t({particleCount:"big"===s?120:60,angle:120,spread:55,origin:{x:1,y:.6}}),t({particleCount:"big"===s?80:40,spread:70,startVelocity:35,origin:{y:.6}})},[]);return r.jsxs(rb.Provider,{value:{showConfetti:a},children:[r.jsx("div",{className:"pointer-events-none fixed inset-0 z-[9999]",children:r.jsx("canvas",{ref:t,className:"block h-full w-full"})}),e]})},ab=()=>s.useContext(rb);function ib({isOpen:e,onClose:t,segment:n,userId:a}){const{showConfetti:i}=ab(),[o,l]=s.useState(null);s.useEffect(()=>{e&&(requestAnimationFrame(()=>i({burst:"big"})),a&&eb(a).then(l).catch(console.error))},[e,i,a]);const c=n+1,d=o?Jv(o.level):100,u=o?Math.min(100,o.xp/d*100):0;return r.jsx(nx,{open:e,onOpenChange:()=>t&&t(),children:r.jsxs(lx,{className:"sm:max-w-md border-coffee-medium",children:[r.jsx(cx,{className:"pb-2",children:r.jsxs("div",{className:"flex flex-col items-center justify-center",children:[r.jsx(fe,{className:"w-16 h-16 text-green-500 mb-2 animate-scale-in"}),r.jsx(ux,{className:"text-h4 text-center font-serif text-coffee-darker",children:"Parfait !"}),r.jsx(mx,{className:"sr-only",children:"Votre lecture a t valide avec succs"})]})}),r.jsxs("div",{className:"py-4 text-center space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 animate-pulse",role:"status","aria-live":"polite","aria-label":"Vous avez gagn 10 points d'exprience",children:[r.jsx("span",{className:"text-3xl font-bold text-green-600",children:"+10 XP"}),o&&r.jsxs("span",{className:"text-sm text-muted-foreground",children:[" Niveau ",o.level]})]}),o&&o.level<5&&r.jsxs("div",{className:"space-y-2 px-4",children:[r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${u}%`}})}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.xp," / ",d," XP pour le niveau ",o.level+1]})]}),r.jsxs("div",{className:"text-sm text-muted-foreground mt-4",children:[r.jsxs("p",{className:"mb-1",children:["Prochain segment : ",r.jsx("strong",{children:c})]}),r.jsx("p",{className:"text-xs",children:"Rendez-vous dans 30 pages"})]})]}),r.jsx("div",{className:"flex justify-center mt-4",children:r.jsx(qn,{onClick:()=>t&&t(),className:"bg-coffee-dark hover:bg-coffee-darker",children:"Continuer ma lecture"})})]})})}function ob(e){return Number(e?.expectedSegments??e?.expected_segments??e?.totalSegments??e?.total_chapters??0)}function lb(e){return s.useMemo(()=>ob(e),[e])}const cb=s.memo(({book:e,showValidationModal:t,showQuizModal:s,showSuccessMessage:n=!1,validationSegment:a,currentQuestion:i,isValidating:o,isLocked:l=!1,remainingLockTime:c=null,jokersUsed:d=0,jokersAllowed:u=0,jokersRemaining:m=0,isUsingJoker:h=!1,userId:p,onValidationClose:f,onValidationConfirm:g,onQuizClose:x,onQuizComplete:v,onSuccessClose:b,onLockExpire:y})=>{const j=ob(e);return t||s||n?r.jsxs(r.Fragment,{children:[t&&a&&r.jsx(r.Fragment,{children:l&&c&&c>0?r.jsx(Fv,{bookTitle:e.title,segment:a,isOpen:t,isValidating:o,isLocked:!0,remainingLockTime:c,jokersUsed:d,jokersAllowed:u,onClose:f,onValidate:g,onLockExpire:y}):r.jsx(Fv,{bookTitle:e.title,segment:a,isOpen:t,isValidating:o,jokersUsed:d,jokersAllowed:u,onClose:f,onValidate:g})}),s&&i&&r.jsx(sb,{bookTitle:e.title,chapterNumber:i.segment||0,onComplete:v,onClose:x,question:i,expectedSegments:j,progressId:e.id,jokersRemaining:m,isUsingJoker:h}),n&&r.jsx(ib,{isOpen:n,onClose:b,segment:i?.segment||0,userId:p})]}):null});cb.displayName="BookValidationModals";const db={legendary:"border-4 border-yellow-400 shadow-lg shadow-yellow-300/30 bg-gradient-to-br from-yellow-100 to-white",epic:"border-2 border-purple-400 shadow-md shadow-purple-300/30 bg-gradient-to-br from-purple-100 to-white",rare:"border border-blue-300 shadow-sm shadow-blue-200/30 bg-gradient-to-br from-blue-50 to-white",common:"border border-gray-200 bg-white"};function ub({badge:e,isLocked:t=!1,className:s,isFavorite:n=!1,onFavoriteToggle:a,showFavoriteToggle:i=!1,isReadOnly:o=!1}){const{name:l,icon:c,description:d,rarity:u="common",dateEarned:m}=e,h=db[u]||db.common;return r.jsx(Ur,{children:r.jsxs(Fr,{children:[r.jsx($r,{asChild:!0,children:r.jsxs("div",{className:zr("flex flex-col items-center text-center space-y-3 transition-all duration-200 relative",t?"opacity-70":"hover:scale-105",s),children:[r.jsxs("div",{className:zr("w-20 h-20 rounded-full flex items-center justify-center relative",h,t?"shadow-sm grayscale":"shadow-md"),children:[r.jsx("span",{className:"text-h2",children:c}),t&&r.jsx("div",{className:"absolute inset-0 rounded-full bg-coffee-dark/20 flex items-center justify-center",children:r.jsx("span",{className:"text-h4",children:""})}),!t&&r.jsx("div",{className:"absolute -bottom-2 text-[10px] font-semibold px-2 py-0.5 rounded-full bg-white shadow text-coffee-dark border border-coffee-light",children:u})]}),!t&&i&&r.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),a?.()},className:"absolute -top-2 -right-2 z-10","aria-label":n?"Retirer des favoris":"Ajouter aux favoris",children:r.jsx(_t,{size:20,className:zr("transition-colors duration-300",n?"fill-yellow-400 text-yellow-500":"text-gray-400 hover:text-yellow-500")})}),r.jsxs("div",{className:"space-y-1 px-1",children:[r.jsx("h3",{className:zr("font-medium text-body-sm",t?"text-coffee-medium":"text-coffee-darker"),children:l}),r.jsx("p",{className:"text-caption text-muted-foreground line-clamp-2",children:d}),!t&&m&&r.jsxs("p",{className:"text-[10px] font-medium text-coffee-medium mt-1",children:["Obtenu le ",m]})]})]})}),r.jsx(Wr,{className:"max-w-[200px] text-body-sm",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"font-medium",children:l}),r.jsx("p",{className:"text-caption",children:d})]})})]})})}function mb({open:e,badges:t,setOpen:s}){return r.jsx(nx,{open:e,onOpenChange:s,children:r.jsxs(lx,{className:"sm:max-w-md border-coffee-medium animate-enter",children:[r.jsxs(cx,{children:[r.jsx(ux,{className:"text-center text-h4 font-serif text-coffee-darker",children:" Nouveau badge dbloqu !"}),r.jsx(mx,{className:"text-center",children:"Flicitations pour cette nouvelle tape dans votre parcours de lecture !"})]}),r.jsxs("div",{className:"py-6 flex flex-col items-center space-y-6",children:[t.map(e=>r.jsx("div",{className:"flex flex-col items-center space-y-3",children:r.jsx(ub,{badge:e,className:"scale-125 animate-scale-in"})},e.id)),r.jsx(qn,{onClick:()=>s(!1),className:"mt-4 bg-coffee-dark hover:bg-coffee-darker",children:"Super !"}),r.jsx(qn,{variant:"outline",className:"border-coffee-light",onClick:()=>{s(!1),window.location.href="/achievements"},children:"Voir tous mes badges"})]})]})})}function hb({open:e,quests:t,setOpen:s}){return r.jsx(nx,{open:e,onOpenChange:s,children:r.jsxs(lx,{className:"sm:max-w-md border-amber-500 border-2 animate-enter bg-gradient-to-br from-amber-50 to-yellow-50",children:[r.jsxs(cx,{children:[r.jsxs(ux,{className:"text-center text-h3 font-serif text-amber-900 flex items-center justify-center gap-2",children:[r.jsx(F,{className:"h-8 w-8 text-amber-600 animate-pulse"}),"Challenge Complt !",r.jsx(De,{className:"h-8 w-8 text-amber-600 animate-pulse"})]}),r.jsx(mx,{className:"text-center text-amber-800 font-medium",children:" Vous avez accompli un exploit rare et prestigieux !"})]}),r.jsxs("div",{className:"py-6 flex flex-col items-center space-y-6",children:[t.map(e=>r.jsx("div",{className:"w-full bg-white/80 backdrop-blur-sm border-2 border-amber-400 rounded-2xl p-6 shadow-2xl animate-scale-in",children:r.jsxs("div",{className:"flex flex-col items-center space-y-3 text-center",children:[r.jsx("div",{className:"text-5xl mb-2",children:"zap"===e.quest?.icon?r.jsx(kt,{className:"h-12 w-12 text-amber-600"}):""}),r.jsx("h3",{className:"font-serif text-h4 text-amber-900",children:e.quest?.title||e.quest_slug}),r.jsx("p",{className:"text-body text-amber-800",children:e.quest?.description||"Qute accomplie !"}),e.quest?.xp_reward&&r.jsx("div",{className:"mt-2 px-4 py-2 bg-gradient-to-r from-amber-400 to-yellow-400 rounded-full",children:r.jsxs("span",{className:"font-bold text-amber-900 flex items-center gap-1",children:[r.jsx(kt,{className:"h-4 w-4"}),"+",e.quest.xp_reward," XP"]})}),e.quest?.category&&r.jsx("div",{className:"text-caption text-amber-700 uppercase tracking-wider font-semibold",children:e.quest.category})]})},e.id)),r.jsx(qn,{onClick:()=>s(!1),className:"mt-4 bg-gradient-to-r from-amber-600 to-yellow-600 hover:from-amber-700 hover:to-yellow-700 text-white font-bold px-8 py-6 text-lg shadow-lg",children:" Fantastique !"}),r.jsx(qn,{variant:"outline",className:"border-2 border-amber-400 text-amber-900 hover:bg-amber-50",onClick:()=>{s(!1),window.location.href="/achievements"},children:"Voir toutes mes qutes"})]})]})})}var pb=Object.prototype.hasOwnProperty;const fb=new WeakMap,gb=()=>{},xb=gb(),vb=Object,bb=e=>e===xb,yb=e=>"function"==typeof e,jb=(e,t)=>({...e,...t}),wb={},Nb={},_b="undefined",kb=typeof window!=_b,Sb=typeof document!=_b,Eb=kb&&"Deno"in window;let Rb=!0;const[Cb,Ab]=kb&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[gb,gb],Tb={isOnline:()=>Rb,isVisible:()=>{const e=Sb&&document.visibilityState;return bb(e)||"hidden"!==e}},Pb={initFocus:e=>(Sb&&document.addEventListener("visibilitychange",e),Cb("focus",e),()=>{Sb&&document.removeEventListener("visibilitychange",e),Ab("focus",e)}),initReconnect:e=>{const t=()=>{Rb=!0,e()},s=()=>{Rb=!1};return Cb("online",t),Cb("offline",s),()=>{Ab("online",t),Ab("offline",s)}}};l.useId;const Ib=!kb||Eb,Db="undefined"!=typeof navigator&&navigator.connection,Lb=!Ib&&Db&&(["slow-2g","2g"].includes(Db.effectiveType)||Db.saveData),Ob=new WeakMap,Mb=(e,t)=>e===`[object ${t}]`;let Vb=0;const qb=e=>{const t=typeof e,s=(r=e,vb.prototype.toString.call(r));var r;const n=Mb(s,"Date"),a=Mb(s,"RegExp"),i=Mb(s,"Object");let o,l;if(vb(e)!==e||n||a)o=n?e.toJSON():"symbol"==t?e.toString():"string"==t?JSON.stringify(e):""+e;else{if(o=Ob.get(e),o)return o;if(o=++Vb+"~",Ob.set(e,o),Array.isArray(e)){for(o="@",l=0;l<e.length;l++)o+=qb(e[l])+",";Ob.set(e,o)}if(i){o="#";const t=vb.keys(e).sort();for(;!bb(l=t.pop());)bb(e[l])||(o+=l+":"+qb(e[l])+",");Ob.set(e,o)}}return o};let Bb=0;const zb=()=>++Bb;async function Ub(...e){const[t,s,r,n]=e,a=jb({populateCache:!0,throwOnError:!0},"boolean"==typeof n?{revalidate:n}:n||{});let i=a.populateCache;const o=a.rollbackOnError;let l=a.optimisticData;const c=a.throwOnError;if(yb(s)){const e=s,r=[],n=t.keys();for(const s of n)!/^\$(inf|sub)\$/.test(s)&&e(t.get(s)._k)&&r.push(s);return Promise.all(r.map(d))}return d(s);async function d(s){const[n]=(e=>{if(yb(e))try{e=e()}catch(s){e=""}const t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?qb(e):"",t]})(s);if(!n)return;const[d,u]=((e,t)=>{const s=fb.get(e);return[()=>!bb(t)&&e.get(t)||wb,r=>{if(!bb(t)){const n=e.get(t);t in Nb||(Nb[t]=n),s[5](t,jb(n,r),n||wb)}},s[6],()=>!bb(t)&&t in Nb?Nb[t]:!bb(t)&&e.get(t)||wb]})(t,n),[m,h,p,f]=fb.get(t),g=()=>{const e=m[n];return(yb(a.revalidate)?a.revalidate(d().data,s):!1!==a.revalidate)&&(delete p[n],delete f[n],e&&e[0])?e[0](2).then(()=>d().data):d().data};if(e.length<3)return g();let x,v=r,b=!1;const y=zb();h[n]=[y,0];const j=!bb(l),w=d(),N=w.data,_=w._c,k=bb(_)?N:_;if(j&&(l=yb(l)?l(k,N):l,u({data:l,_c:k})),yb(v))try{v=v(k)}catch(S){x=S,b=!0}if(v&&yb(v.then)){if(v=await v.catch(e=>{x=e,b=!0}),y!==h[n][0]){if(b)throw x;return v}b&&j&&(e=>"function"==typeof o?o(e):!1!==o)(x)&&(i=!0,u({data:k,_c:xb}))}if(i&&!b)if(yb(i)){const e=i(v,k);u({data:e,error:xb,_c:xb})}else u({data:v,error:xb,_c:xb});if(h[n][1]=zb(),Promise.resolve(g()).then(()=>{u({_c:xb})}),!b)return v;if(c)throw x}}const Fb=(e,t)=>{for(const s in e)e[s][0]&&e[s][0](t)},$b=function e(t,s){var r,n;if(t===s)return!0;if(t&&s&&(r=t.constructor)===s.constructor){if(r===Date)return t.getTime()===s.getTime();if(r===RegExp)return t.toString()===s.toString();if(r===Array){if((n=t.length)===s.length)for(;n--&&e(t[n],s[n]););return-1===n}if(!r||"object"==typeof t){for(r in n=0,t){if(pb.call(t,r)&&++n&&!pb.call(s,r))return!1;if(!(r in s)||!e(t[r],s[r]))return!1}return Object.keys(s).length===n}}return t!=t&&s!=s},[Wb,Zb]=((e,t)=>{if(!fb.has(e)){const s=jb(Pb,t),r=Object.create(null),n=Ub.bind(xb,e);let a=gb;const i=Object.create(null),o=(e,t)=>{const s=i[e]||[];return i[e]=s,s.push(t),()=>s.splice(s.indexOf(t),1)},l=(t,s,r)=>{e.set(t,s);const n=i[t];if(n)for(const e of n)e(s,r)},c=()=>{if(!fb.has(e)&&(fb.set(e,[r,Object.create(null),Object.create(null),Object.create(null),n,l,o]),!Ib)){const t=s.initFocus(setTimeout.bind(xb,Fb.bind(xb,r,0))),n=s.initReconnect(setTimeout.bind(xb,Fb.bind(xb,r,1)));a=()=>{t&&t(),n&&n(),fb.delete(e)}}};return c(),[e,n,c,a]}return[e,fb.get(e)[4]]})(new Map);jb({onLoadingSlow:gb,onSuccess:gb,onError:gb,onErrorRetry:(e,t,s,r,n)=>{const a=s.errorRetryCount,i=n.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*s.errorRetryInterval;!bb(a)&&i>a||setTimeout(r,o,n)},onDiscarded:gb,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Lb?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:Lb?5e3:3e3,compare:$b,isPaused:()=>!1,cache:Wb,mutate:Zb,fallback:{}},Tb),s.createContext({});const Hb=(e,t,r,n=!1,a)=>{const i=s.useRef(!0),[o,l]=s.useState(!1),[c,d]=s.useState(0),[u,m]=s.useState(null),[h,p]=s.useState(!1),[f,g]=s.useState(!1),[x,v]=s.useState(null),[b,y]=s.useState(!1),[j,w]=s.useState(0);s.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]);return{showQuiz:o,setShowQuiz:l,quizChapter:c,currentQuestion:u,showSuccessMessage:h,setShowSuccessMessage:p,isValidating:n,prepareAndShowQuestion:async s=>{if(!t||!e||!e.id)throw new Error("User or book information missing");try{a&&a(!0);const r=await(async(e,t,s)=>{try{const r=`lock_${e}_${t}_${s}`,n=sessionStorage.getItem(r);if(n){const e=JSON.parse(n),t=new Date,s=new Date(e.lockedUntil);if(s>t)return{isLocked:!0,remainingTime:Math.floor((s.getTime()-t.getTime())/1e3)};sessionStorage.removeItem(r)}const{data:a,error:i}=await en.from("validation_locks").select("locked_until").eq("user_id",e).eq("book_id",t).eq("segment",s).maybeSingle();if(i)return{isLocked:!1,remainingTime:null};if(!a)return{isLocked:!1,remainingTime:null};const o=new Date,l=new Date(a.locked_until),c=l>o,d=c?Math.floor((l.getTime()-o.getTime())/1e3):null;return c&&sessionStorage.setItem(r,JSON.stringify({lockedUntil:a.locked_until})),{isLocked:c,remainingTime:d}}catch(r){return{isLocked:!1,remainingTime:null}}})(t,e.id,s);if(!i.current)return;if(r.isLocked&&null!==r.remainingTime)return g(!0),void v(r.remainingTime);const n=await async function(e,t,s){try{const{data:r,error:n}=await en.from("reading_validations").select("id").eq("user_id",e).eq("book_id",t).eq("segment",s).maybeSingle();return!n&&!!r}catch(r){return!1}}(t,e.id,s);if(!i.current)return;if(n)return void mn.info("Ce segment a dj t valid");const o=await Qv(e.id,t);if(!i.current)return;w(o);const c=await Hv(e.slug||e.id,s);if(!i.current)return;if(!c)return void mn.error("Aucune question trouve pour ce segment");m(c),d(s),l(!0)}catch(r){throw mn.error("Erreur lors de la prparation du quiz. Veuillez ressayer."),r}finally{a&&a(!1)}},handleQuizComplete:async(s,n=!1)=>{if(t&&e&&e.id)try{return a&&a(!0),s?(l(!1),p(!0),Zb(["jokers-info",e.id]),Zb(["book-progress",e.id]),Zb(["reading-progress",t]),r&&r(e.id),{success:!0,newBadges:[]}):(l(!1),{canUseJoker:j>0})}catch(i){return{canUseJoker:j>0}}finally{a&&a(!1),y(!1)}else mn.error("Information utilisateur ou livre manquante")},isLocked:f,remainingLockTime:x,handleLockExpire:()=>{g(!1),v(null)},isUsingJoker:b,jokersRemaining:j}};var Gb,Kb,Yb={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Gb=Yb,Kb=Yb.exports,function(){var e,t="Expected a function",s="__lodash_hash_undefined__",r="__lodash_placeholder__",n=16,a=32,i=64,o=128,l=256,c=1/0,d=9007199254740991,u=NaN,m=4294967295,h=[["ary",o],["bind",1],["bindKey",2],["curry",8],["curryRight",n],["flip",512],["partial",a],["partialRight",i],["rearg",l]],p="[object Arguments]",f="[object Array]",g="[object Boolean]",x="[object Date]",v="[object Error]",b="[object Function]",y="[object GeneratorFunction]",j="[object Map]",w="[object Number]",N="[object Object]",_="[object Promise]",k="[object RegExp]",S="[object Set]",E="[object String]",R="[object Symbol]",C="[object WeakMap]",A="[object ArrayBuffer]",T="[object DataView]",P="[object Float32Array]",I="[object Float64Array]",D="[object Int8Array]",L="[object Int16Array]",O="[object Int32Array]",M="[object Uint8Array]",V="[object Uint8ClampedArray]",q="[object Uint16Array]",B="[object Uint32Array]",z=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,F=/(__e\(.*?\)|\b__t\)) \+\n'';/g,$=/&(?:amp|lt|gt|quot|#39);/g,W=/[&<>"']/g,Z=RegExp($.source),H=RegExp(W.source),G=/<%-([\s\S]+?)%>/g,K=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X=/^\w*$/,J=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ee=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ee.source),se=/^\s+/,re=/\s/,ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ae=/\{\n\/\* \[wrapped with (.+)\] \*/,ie=/,? & /,oe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,le=/[()=,{}\[\]\/\s]/,ce=/\\(\\)?/g,de=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ue=/\w*$/,me=/^[-+]0x[0-9a-f]+$/i,he=/^0b[01]+$/i,pe=/^\[object .+?Constructor\]$/,fe=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,xe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve=/($^)/,be=/['\n\r\u2028\u2029\\]/g,ye="\\ud800-\\udfff",je="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="\\u2700-\\u27bf",Ne="a-z\\xdf-\\xf6\\xf8-\\xff",_e="A-Z\\xc0-\\xd6\\xd8-\\xde",ke="\\ufe0e\\ufe0f",Se="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ee="[']",Re="["+ye+"]",Ce="["+Se+"]",Ae="["+je+"]",Te="\\d+",Pe="["+we+"]",Ie="["+Ne+"]",De="[^"+ye+Se+Te+we+Ne+_e+"]",Le="\\ud83c[\\udffb-\\udfff]",Oe="[^"+ye+"]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",Ve="[\\ud800-\\udbff][\\udc00-\\udfff]",qe="["+_e+"]",Be="\\u200d",ze="(?:"+Ie+"|"+De+")",Ue="(?:"+qe+"|"+De+")",Fe="(?:['](?:d|ll|m|re|s|t|ve))?",$e="(?:['](?:D|LL|M|RE|S|T|VE))?",We="(?:"+Ae+"|"+Le+")?",Ze="["+ke+"]?",He=Ze+We+"(?:"+Be+"(?:"+[Oe,Me,Ve].join("|")+")"+Ze+We+")*",Ge="(?:"+[Pe,Me,Ve].join("|")+")"+He,Ke="(?:"+[Oe+Ae+"?",Ae,Me,Ve,Re].join("|")+")",Ye=RegExp(Ee,"g"),Qe=RegExp(Ae,"g"),Xe=RegExp(Le+"(?="+Le+")|"+Ke+He,"g"),Je=RegExp([qe+"?"+Ie+"+"+Fe+"(?="+[Ce,qe,"$"].join("|")+")",Ue+"+"+$e+"(?="+[Ce,qe+ze,"$"].join("|")+")",qe+"?"+ze+"+"+Fe,qe+"+"+$e,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Te,Ge].join("|"),"g"),et=RegExp("["+Be+ye+je+ke+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,st=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,nt={};nt[P]=nt[I]=nt[D]=nt[L]=nt[O]=nt[M]=nt[V]=nt[q]=nt[B]=!0,nt[p]=nt[f]=nt[A]=nt[g]=nt[T]=nt[x]=nt[v]=nt[b]=nt[j]=nt[w]=nt[N]=nt[k]=nt[S]=nt[E]=nt[C]=!1;var at={};at[p]=at[f]=at[A]=at[T]=at[g]=at[x]=at[P]=at[I]=at[D]=at[L]=at[O]=at[j]=at[w]=at[N]=at[k]=at[S]=at[E]=at[R]=at[M]=at[V]=at[q]=at[B]=!0,at[v]=at[b]=at[C]=!1;var it={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ot=parseFloat,lt=parseInt,ct="object"==typeof St&&St&&St.Object===Object&&St,dt="object"==typeof self&&self&&self.Object===Object&&self,ut=ct||dt||Function("return this")(),mt=Kb&&!Kb.nodeType&&Kb,ht=mt&&Gb&&!Gb.nodeType&&Gb,pt=ht&&ht.exports===mt,ft=pt&&ct.process,gt=function(){try{var e=ht&&ht.require&&ht.require("util").types;return e||ft&&ft.binding&&ft.binding("util")}catch(V_){}}(),xt=gt&&gt.isArrayBuffer,vt=gt&&gt.isDate,bt=gt&&gt.isMap,yt=gt&&gt.isRegExp,jt=gt&&gt.isSet,wt=gt&&gt.isTypedArray;function Nt(e,t,s){switch(s.length){case 0:return e.call(t);case 1:return e.call(t,s[0]);case 2:return e.call(t,s[0],s[1]);case 3:return e.call(t,s[0],s[1],s[2])}return e.apply(t,s)}function _t(e,t,s,r){for(var n=-1,a=null==e?0:e.length;++n<a;){var i=e[n];t(r,i,s(i),e)}return r}function kt(e,t){for(var s=-1,r=null==e?0:e.length;++s<r&&!1!==t(e[s],s,e););return e}function Et(e,t){for(var s=null==e?0:e.length;s--&&!1!==t(e[s],s,e););return e}function Rt(e,t){for(var s=-1,r=null==e?0:e.length;++s<r;)if(!t(e[s],s,e))return!1;return!0}function Ct(e,t){for(var s=-1,r=null==e?0:e.length,n=0,a=[];++s<r;){var i=e[s];t(i,s,e)&&(a[n++]=i)}return a}function At(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Tt(e,t,s){for(var r=-1,n=null==e?0:e.length;++r<n;)if(s(t,e[r]))return!0;return!1}function Pt(e,t){for(var s=-1,r=null==e?0:e.length,n=Array(r);++s<r;)n[s]=t(e[s],s,e);return n}function It(e,t){for(var s=-1,r=t.length,n=e.length;++s<r;)e[n+s]=t[s];return e}function Dt(e,t,s,r){var n=-1,a=null==e?0:e.length;for(r&&a&&(s=e[++n]);++n<a;)s=t(s,e[n],n,e);return s}function Lt(e,t,s,r){var n=null==e?0:e.length;for(r&&n&&(s=e[--n]);n--;)s=t(s,e[n],n,e);return s}function Ot(e,t){for(var s=-1,r=null==e?0:e.length;++s<r;)if(t(e[s],s,e))return!0;return!1}var Mt=$t("length");function Vt(e,t,s){var r;return s(e,function(e,s,n){if(t(e,s,n))return r=s,!1}),r}function qt(e,t,s,r){for(var n=e.length,a=s+(r?1:-1);r?a--:++a<n;)if(t(e[a],a,e))return a;return-1}function Bt(e,t,s){return t==t?function(e,t,s){for(var r=s-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}(e,t,s):qt(e,Ut,s)}function zt(e,t,s,r){for(var n=s-1,a=e.length;++n<a;)if(r(e[n],t))return n;return-1}function Ut(e){return e!=e}function Ft(e,t){var s=null==e?0:e.length;return s?Ht(e,t)/s:u}function $t(t){return function(s){return null==s?e:s[t]}}function Wt(t){return function(s){return null==t?e:t[s]}}function Zt(e,t,s,r,n){return n(e,function(e,n,a){s=r?(r=!1,e):t(s,e,n,a)}),s}function Ht(t,s){for(var r,n=-1,a=t.length;++n<a;){var i=s(t[n]);i!==e&&(r=r===e?i:r+i)}return r}function Gt(e,t){for(var s=-1,r=Array(e);++s<e;)r[s]=t(s);return r}function Kt(e){return e?e.slice(0,us(e)+1).replace(se,""):e}function Yt(e){return function(t){return e(t)}}function Qt(e,t){return Pt(t,function(t){return e[t]})}function Xt(e,t){return e.has(t)}function Jt(e,t){for(var s=-1,r=e.length;++s<r&&Bt(t,e[s],0)>-1;);return s}function es(e,t){for(var s=e.length;s--&&Bt(t,e[s],0)>-1;);return s}var ts=Wt({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),ss=Wt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function rs(e){return"\\"+it[e]}function ns(e){return et.test(e)}function as(e){var t=-1,s=Array(e.size);return e.forEach(function(e,r){s[++t]=[r,e]}),s}function is(e,t){return function(s){return e(t(s))}}function os(e,t){for(var s=-1,n=e.length,a=0,i=[];++s<n;){var o=e[s];o!==t&&o!==r||(e[s]=r,i[a++]=s)}return i}function ls(e){var t=-1,s=Array(e.size);return e.forEach(function(e){s[++t]=e}),s}function cs(e){return ns(e)?function(e){for(var t=Xe.lastIndex=0;Xe.test(e);)++t;return t}(e):Mt(e)}function ds(e){return ns(e)?function(e){return e.match(Xe)||[]}(e):function(e){return e.split("")}(e)}function us(e){for(var t=e.length;t--&&re.test(e.charAt(t)););return t}var ms=Wt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),hs=function re(ye){var je,we=(ye=null==ye?ut:hs.defaults(ut.Object(),ye,hs.pick(ut,st))).Array,Ne=ye.Date,_e=ye.Error,ke=ye.Function,Se=ye.Math,Ee=ye.Object,Re=ye.RegExp,Ce=ye.String,Ae=ye.TypeError,Te=we.prototype,Pe=ke.prototype,Ie=Ee.prototype,De=ye["__core-js_shared__"],Le=Pe.toString,Oe=Ie.hasOwnProperty,Me=0,Ve=(je=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||""))?"Symbol(src)_1."+je:"",qe=Ie.toString,Be=Le.call(Ee),ze=ut._,Ue=Re("^"+Le.call(Oe).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fe=pt?ye.Buffer:e,$e=ye.Symbol,We=ye.Uint8Array,Ze=Fe?Fe.allocUnsafe:e,He=is(Ee.getPrototypeOf,Ee),Ge=Ee.create,Ke=Ie.propertyIsEnumerable,Xe=Te.splice,et=$e?$e.isConcatSpreadable:e,it=$e?$e.iterator:e,ct=$e?$e.toStringTag:e,dt=function(){try{var e=ua(Ee,"defineProperty");return e({},"",{}),e}catch(V_){}}(),mt=ye.clearTimeout!==ut.clearTimeout&&ye.clearTimeout,ht=Ne&&Ne.now!==ut.Date.now&&Ne.now,ft=ye.setTimeout!==ut.setTimeout&&ye.setTimeout,gt=Se.ceil,St=Se.floor,Mt=Ee.getOwnPropertySymbols,Wt=Fe?Fe.isBuffer:e,ps=ye.isFinite,fs=Te.join,gs=is(Ee.keys,Ee),xs=Se.max,vs=Se.min,bs=Ne.now,ys=ye.parseInt,js=Se.random,ws=Te.reverse,Ns=ua(ye,"DataView"),_s=ua(ye,"Map"),ks=ua(ye,"Promise"),Ss=ua(ye,"Set"),Es=ua(ye,"WeakMap"),Rs=ua(Ee,"create"),Cs=Es&&new Es,As={},Ts=Ba(Ns),Ps=Ba(_s),Is=Ba(ks),Ds=Ba(Ss),Ls=Ba(Es),Os=$e?$e.prototype:e,Ms=Os?Os.valueOf:e,Vs=Os?Os.toString:e;function qs(e){if(ro(e)&&!Zi(e)&&!(e instanceof Fs)){if(e instanceof Us)return e;if(Oe.call(e,"__wrapped__"))return za(e)}return new Us(e)}var Bs=function(){function t(){}return function(s){if(!so(s))return{};if(Ge)return Ge(s);t.prototype=s;var r=new t;return t.prototype=e,r}}();function zs(){}function Us(t,s){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!s,this.__index__=0,this.__values__=e}function Fs(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=m,this.__views__=[]}function $s(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}function Ws(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}function Zs(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}function Hs(e){var t=-1,s=null==e?0:e.length;for(this.__data__=new Zs;++t<s;)this.add(e[t])}function Gs(e){var t=this.__data__=new Ws(e);this.size=t.size}function Ks(e,t){var s=Zi(e),r=!s&&Wi(e),n=!s&&!r&&Yi(e),a=!s&&!r&&!n&&mo(e),i=s||r||n||a,o=i?Gt(e.length,Ce):[],l=o.length;for(var c in e)!t&&!Oe.call(e,c)||i&&("length"==c||n&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||va(c,l))||o.push(c);return o}function Ys(t){var s=t.length;return s?t[Hr(0,s-1)]:e}function Qs(e,t){return Da(Cn(e),ir(t,0,e.length))}function Xs(e){return Da(Cn(e))}function Js(t,s,r){(r!==e&&!Ui(t[s],r)||r===e&&!(s in t))&&nr(t,s,r)}function er(t,s,r){var n=t[s];Oe.call(t,s)&&Ui(n,r)&&(r!==e||s in t)||nr(t,s,r)}function tr(e,t){for(var s=e.length;s--;)if(Ui(e[s][0],t))return s;return-1}function sr(e,t,s,r){return ur(e,function(e,n,a){t(r,e,s(e),a)}),r}function rr(e,t){return e&&An(t,Do(t),e)}function nr(e,t,s){"__proto__"==t&&dt?dt(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function ar(t,s){for(var r=-1,n=s.length,a=we(n),i=null==t;++r<n;)a[r]=i?e:Co(t,s[r]);return a}function ir(t,s,r){return t==t&&(r!==e&&(t=t<=r?t:r),s!==e&&(t=t>=s?t:s)),t}function or(t,s,r,n,a,i){var o,l=1&s,c=2&s,d=4&s;if(r&&(o=a?r(t,n,a,i):r(t)),o!==e)return o;if(!so(t))return t;var u=Zi(t);if(u){if(o=function(e){var t=e.length,s=new e.constructor(t);return t&&"string"==typeof e[0]&&Oe.call(e,"index")&&(s.index=e.index,s.input=e.input),s}(t),!l)return Cn(t,o)}else{var m=pa(t),h=m==b||m==y;if(Yi(t))return Nn(t,l);if(m==N||m==p||h&&!a){if(o=c||h?{}:ga(t),!l)return c?function(e,t){return An(e,ha(e),t)}(t,function(e,t){return e&&An(t,Lo(t),e)}(o,t)):function(e,t){return An(e,ma(e),t)}(t,rr(o,t))}else{if(!at[m])return a?t:{};o=function(e,t,s){var r,n=e.constructor;switch(t){case A:return _n(e);case g:case x:return new n(+e);case T:return function(e,t){var s=t?_n(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}(e,s);case P:case I:case D:case L:case O:case M:case V:case q:case B:return kn(e,s);case j:return new n;case w:case E:return new n(e);case k:return function(e){var t=new e.constructor(e.source,ue.exec(e));return t.lastIndex=e.lastIndex,t}(e);case S:return new n;case R:return r=e,Ms?Ee(Ms.call(r)):{}}}(t,m,l)}}i||(i=new Gs);var f=i.get(t);if(f)return f;i.set(t,o),lo(t)?t.forEach(function(e){o.add(or(e,s,r,e,t,i))}):no(t)&&t.forEach(function(e,n){o.set(n,or(e,s,r,n,t,i))});var v=u?e:(d?c?na:ra:c?Lo:Do)(t);return kt(v||t,function(e,n){v&&(e=t[n=e]),er(o,n,or(e,s,r,n,t,i))}),o}function lr(t,s,r){var n=r.length;if(null==t)return!n;for(t=Ee(t);n--;){var a=r[n],i=s[a],o=t[a];if(o===e&&!(a in t)||!i(o))return!1}return!0}function cr(s,r,n){if("function"!=typeof s)throw new Ae(t);return Aa(function(){s.apply(e,n)},r)}function dr(e,t,s,r){var n=-1,a=At,i=!0,o=e.length,l=[],c=t.length;if(!o)return l;s&&(t=Pt(t,Yt(s))),r?(a=Tt,i=!1):t.length>=200&&(a=Xt,i=!1,t=new Hs(t));e:for(;++n<o;){var d=e[n],u=null==s?d:s(d);if(d=r||0!==d?d:0,i&&u==u){for(var m=c;m--;)if(t[m]===u)continue e;l.push(d)}else a(t,u,r)||l.push(d)}return l}qs.templateSettings={escape:G,evaluate:K,interpolate:Y,variable:"",imports:{_:qs}},qs.prototype=zs.prototype,qs.prototype.constructor=qs,Us.prototype=Bs(zs.prototype),Us.prototype.constructor=Us,Fs.prototype=Bs(zs.prototype),Fs.prototype.constructor=Fs,$s.prototype.clear=function(){this.__data__=Rs?Rs(null):{},this.size=0},$s.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},$s.prototype.get=function(t){var r=this.__data__;if(Rs){var n=r[t];return n===s?e:n}return Oe.call(r,t)?r[t]:e},$s.prototype.has=function(t){var s=this.__data__;return Rs?s[t]!==e:Oe.call(s,t)},$s.prototype.set=function(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Rs&&r===e?s:r,this},Ws.prototype.clear=function(){this.__data__=[],this.size=0},Ws.prototype.delete=function(e){var t=this.__data__,s=tr(t,e);return!(s<0||(s==t.length-1?t.pop():Xe.call(t,s,1),--this.size,0))},Ws.prototype.get=function(t){var s=this.__data__,r=tr(s,t);return r<0?e:s[r][1]},Ws.prototype.has=function(e){return tr(this.__data__,e)>-1},Ws.prototype.set=function(e,t){var s=this.__data__,r=tr(s,e);return r<0?(++this.size,s.push([e,t])):s[r][1]=t,this},Zs.prototype.clear=function(){this.size=0,this.__data__={hash:new $s,map:new(_s||Ws),string:new $s}},Zs.prototype.delete=function(e){var t=ca(this,e).delete(e);return this.size-=t?1:0,t},Zs.prototype.get=function(e){return ca(this,e).get(e)},Zs.prototype.has=function(e){return ca(this,e).has(e)},Zs.prototype.set=function(e,t){var s=ca(this,e),r=s.size;return s.set(e,t),this.size+=s.size==r?0:1,this},Hs.prototype.add=Hs.prototype.push=function(e){return this.__data__.set(e,s),this},Hs.prototype.has=function(e){return this.__data__.has(e)},Gs.prototype.clear=function(){this.__data__=new Ws,this.size=0},Gs.prototype.delete=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s},Gs.prototype.get=function(e){return this.__data__.get(e)},Gs.prototype.has=function(e){return this.__data__.has(e)},Gs.prototype.set=function(e,t){var s=this.__data__;if(s instanceof Ws){var r=s.__data__;if(!_s||r.length<199)return r.push([e,t]),this.size=++s.size,this;s=this.__data__=new Zs(r)}return s.set(e,t),this.size=s.size,this};var ur=In(br),mr=In(yr,!0);function hr(e,t){var s=!0;return ur(e,function(e,r,n){return s=!!t(e,r,n)}),s}function pr(t,s,r){for(var n=-1,a=t.length;++n<a;){var i=t[n],o=s(i);if(null!=o&&(l===e?o==o&&!uo(o):r(o,l)))var l=o,c=i}return c}function fr(e,t){var s=[];return ur(e,function(e,r,n){t(e,r,n)&&s.push(e)}),s}function gr(e,t,s,r,n){var a=-1,i=e.length;for(s||(s=xa),n||(n=[]);++a<i;){var o=e[a];t>0&&s(o)?t>1?gr(o,t-1,s,r,n):It(n,o):r||(n[n.length]=o)}return n}var xr=Dn(),vr=Dn(!0);function br(e,t){return e&&xr(e,t,Do)}function yr(e,t){return e&&vr(e,t,Do)}function jr(e,t){return Ct(t,function(t){return Ji(e[t])})}function wr(t,s){for(var r=0,n=(s=bn(s,t)).length;null!=t&&r<n;)t=t[qa(s[r++])];return r&&r==n?t:e}function Nr(e,t,s){var r=t(e);return Zi(e)?r:It(r,s(e))}function _r(t){return null==t?t===e?"[object Undefined]":"[object Null]":ct&&ct in Ee(t)?function(t){var s=Oe.call(t,ct),r=t[ct];try{t[ct]=e;var n=!0}catch(V_){}var a=qe.call(t);return n&&(s?t[ct]=r:delete t[ct]),a}(t):function(e){return qe.call(e)}(t)}function kr(e,t){return e>t}function Sr(e,t){return null!=e&&Oe.call(e,t)}function Er(e,t){return null!=e&&t in Ee(e)}function Rr(t,s,r){for(var n=r?Tt:At,a=t[0].length,i=t.length,o=i,l=we(i),c=1/0,d=[];o--;){var u=t[o];o&&s&&(u=Pt(u,Yt(s))),c=vs(u.length,c),l[o]=!r&&(s||a>=120&&u.length>=120)?new Hs(o&&u):e}u=t[0];var m=-1,h=l[0];e:for(;++m<a&&d.length<c;){var p=u[m],f=s?s(p):p;if(p=r||0!==p?p:0,!(h?Xt(h,f):n(d,f,r))){for(o=i;--o;){var g=l[o];if(!(g?Xt(g,f):n(t[o],f,r)))continue e}h&&h.push(f),d.push(p)}}return d}function Cr(t,s,r){var n=null==(t=Ea(t,s=bn(s,t)))?t:t[qa(Xa(s))];return null==n?e:Nt(n,t,r)}function Ar(e){return ro(e)&&_r(e)==p}function Tr(t,s,r,n,a){return t===s||(null==t||null==s||!ro(t)&&!ro(s)?t!=t&&s!=s:function(t,s,r,n,a,i){var o=Zi(t),l=Zi(s),c=o?f:pa(t),d=l?f:pa(s),u=(c=c==p?N:c)==N,m=(d=d==p?N:d)==N,h=c==d;if(h&&Yi(t)){if(!Yi(s))return!1;o=!0,u=!1}if(h&&!u)return i||(i=new Gs),o||mo(t)?ta(t,s,r,n,a,i):function(e,t,s,r,n,a,i){switch(s){case T:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case A:return!(e.byteLength!=t.byteLength||!a(new We(e),new We(t)));case g:case x:case w:return Ui(+e,+t);case v:return e.name==t.name&&e.message==t.message;case k:case E:return e==t+"";case j:var o=as;case S:var l=1&r;if(o||(o=ls),e.size!=t.size&&!l)return!1;var c=i.get(e);if(c)return c==t;r|=2,i.set(e,t);var d=ta(o(e),o(t),r,n,a,i);return i.delete(e),d;case R:if(Ms)return Ms.call(e)==Ms.call(t)}return!1}(t,s,c,r,n,a,i);if(!(1&r)){var b=u&&Oe.call(t,"__wrapped__"),y=m&&Oe.call(s,"__wrapped__");if(b||y){var _=b?t.value():t,C=y?s.value():s;return i||(i=new Gs),a(_,C,r,n,i)}}return!!h&&(i||(i=new Gs),function(t,s,r,n,a,i){var o=1&r,l=ra(t),c=l.length,d=ra(s),u=d.length;if(c!=u&&!o)return!1;for(var m=c;m--;){var h=l[m];if(!(o?h in s:Oe.call(s,h)))return!1}var p=i.get(t),f=i.get(s);if(p&&f)return p==s&&f==t;var g=!0;i.set(t,s),i.set(s,t);for(var x=o;++m<c;){var v=t[h=l[m]],b=s[h];if(n)var y=o?n(b,v,h,s,t,i):n(v,b,h,t,s,i);if(!(y===e?v===b||a(v,b,r,n,i):y)){g=!1;break}x||(x="constructor"==h)}if(g&&!x){var j=t.constructor,w=s.constructor;j==w||!("constructor"in t)||!("constructor"in s)||"function"==typeof j&&j instanceof j&&"function"==typeof w&&w instanceof w||(g=!1)}return i.delete(t),i.delete(s),g}(t,s,r,n,a,i))}(t,s,r,n,Tr,a))}function Pr(t,s,r,n){var a=r.length,i=a,o=!n;if(null==t)return!i;for(t=Ee(t);a--;){var l=r[a];if(o&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++a<i;){var c=(l=r[a])[0],d=t[c],u=l[1];if(o&&l[2]){if(d===e&&!(c in t))return!1}else{var m=new Gs;if(n)var h=n(d,u,c,t,s,m);if(!(h===e?Tr(u,d,3,n,m):h))return!1}}return!0}function Ir(e){return!(!so(e)||(t=e,Ve&&Ve in t))&&(Ji(e)?Ue:pe).test(Ba(e));var t}function Dr(e){return"function"==typeof e?e:null==e?il:"object"==typeof e?Zi(e)?Br(e[0],e[1]):qr(e):fl(e)}function Lr(e){if(!Na(e))return gs(e);var t=[];for(var s in Ee(e))Oe.call(e,s)&&"constructor"!=s&&t.push(s);return t}function Or(e){if(!so(e))return function(e){var t=[];if(null!=e)for(var s in Ee(e))t.push(s);return t}(e);var t=Na(e),s=[];for(var r in e)("constructor"!=r||!t&&Oe.call(e,r))&&s.push(r);return s}function Mr(e,t){return e<t}function Vr(e,t){var s=-1,r=Gi(e)?we(e.length):[];return ur(e,function(e,n,a){r[++s]=t(e,n,a)}),r}function qr(e){var t=da(e);return 1==t.length&&t[0][2]?ka(t[0][0],t[0][1]):function(s){return s===e||Pr(s,e,t)}}function Br(t,s){return ya(t)&&_a(s)?ka(qa(t),s):function(r){var n=Co(r,t);return n===e&&n===s?Ao(r,t):Tr(s,n,3)}}function zr(t,s,r,n,a){t!==s&&xr(s,function(i,o){if(a||(a=new Gs),so(i))!function(t,s,r,n,a,i,o){var l=Ra(t,r),c=Ra(s,r),d=o.get(c);if(d)Js(t,r,d);else{var u=i?i(l,c,r+"",t,s,o):e,m=u===e;if(m){var h=Zi(c),p=!h&&Yi(c),f=!h&&!p&&mo(c);u=c,h||p||f?Zi(l)?u=l:Ki(l)?u=Cn(l):p?(m=!1,u=Nn(c,!0)):f?(m=!1,u=kn(c,!0)):u=[]:io(c)||Wi(c)?(u=l,Wi(l)?u=yo(l):so(l)&&!Ji(l)||(u=ga(c))):m=!1}m&&(o.set(c,u),a(u,c,n,i,o),o.delete(c)),Js(t,r,u)}}(t,s,o,r,zr,n,a);else{var l=n?n(Ra(t,o),i,o+"",t,s,a):e;l===e&&(l=i),Js(t,o,l)}},Lo)}function Ur(t,s){var r=t.length;if(r)return va(s+=s<0?r:0,r)?t[s]:e}function Fr(e,t,s){t=t.length?Pt(t,function(e){return Zi(e)?function(t){return wr(t,1===e.length?e[0]:e)}:e}):[il];var r=-1;return t=Pt(t,Yt(la())),function(e,t){var s=e.length;for(e.sort(t);s--;)e[s]=e[s].value;return e}(Vr(e,function(e,s,n){return{criteria:Pt(t,function(t){return t(e)}),index:++r,value:e}}),function(e,t){return function(e,t,s){for(var r=-1,n=e.criteria,a=t.criteria,i=n.length,o=s.length;++r<i;){var l=Sn(n[r],a[r]);if(l)return r>=o?l:l*("desc"==s[r]?-1:1)}return e.index-t.index}(e,t,s)})}function $r(e,t,s){for(var r=-1,n=t.length,a={};++r<n;){var i=t[r],o=wr(e,i);s(o,i)&&Xr(a,bn(i,e),o)}return a}function Wr(e,t,s,r){var n=r?zt:Bt,a=-1,i=t.length,o=e;for(e===t&&(t=Cn(t)),s&&(o=Pt(e,Yt(s)));++a<i;)for(var l=0,c=t[a],d=s?s(c):c;(l=n(o,d,l,r))>-1;)o!==e&&Xe.call(o,l,1),Xe.call(e,l,1);return e}function Zr(e,t){for(var s=e?t.length:0,r=s-1;s--;){var n=t[s];if(s==r||n!==a){var a=n;va(n)?Xe.call(e,n,1):un(e,n)}}return e}function Hr(e,t){return e+St(js()*(t-e+1))}function Gr(e,t){var s="";if(!e||t<1||t>d)return s;do{t%2&&(s+=e),(t=St(t/2))&&(e+=e)}while(t);return s}function Kr(e,t){return Ta(Sa(e,t,il),e+"")}function Yr(e){return Ys(Fo(e))}function Qr(e,t){var s=Fo(e);return Da(s,ir(t,0,s.length))}function Xr(t,s,r,n){if(!so(t))return t;for(var a=-1,i=(s=bn(s,t)).length,o=i-1,l=t;null!=l&&++a<i;){var c=qa(s[a]),d=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(a!=o){var u=l[c];(d=n?n(u,c,l):e)===e&&(d=so(u)?u:va(s[a+1])?[]:{})}er(l,c,d),l=l[c]}return t}var Jr=Cs?function(e,t){return Cs.set(e,t),e}:il,en=dt?function(e,t){return dt(e,"toString",{configurable:!0,enumerable:!1,value:rl(t),writable:!0})}:il;function tn(e){return Da(Fo(e))}function sn(e,t,s){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(s=s>n?n:s)<0&&(s+=n),n=t>s?0:s-t>>>0,t>>>=0;for(var a=we(n);++r<n;)a[r]=e[r+t];return a}function rn(e,t){var s;return ur(e,function(e,r,n){return!(s=t(e,r,n))}),!!s}function nn(e,t,s){var r=0,n=null==e?r:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;r<n;){var a=r+n>>>1,i=e[a];null!==i&&!uo(i)&&(s?i<=t:i<t)?r=a+1:n=a}return n}return an(e,t,il,s)}function an(t,s,r,n){var a=0,i=null==t?0:t.length;if(0===i)return 0;for(var o=(s=r(s))!=s,l=null===s,c=uo(s),d=s===e;a<i;){var u=St((a+i)/2),m=r(t[u]),h=m!==e,p=null===m,f=m==m,g=uo(m);if(o)var x=n||f;else x=d?f&&(n||h):l?f&&h&&(n||!p):c?f&&h&&!p&&(n||!g):!p&&!g&&(n?m<=s:m<s);x?a=u+1:i=u}return vs(i,4294967294)}function on(e,t){for(var s=-1,r=e.length,n=0,a=[];++s<r;){var i=e[s],o=t?t(i):i;if(!s||!Ui(o,l)){var l=o;a[n++]=0===i?0:i}}return a}function ln(e){return"number"==typeof e?e:uo(e)?u:+e}function cn(e){if("string"==typeof e)return e;if(Zi(e))return Pt(e,cn)+"";if(uo(e))return Vs?Vs.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function dn(e,t,s){var r=-1,n=At,a=e.length,i=!0,o=[],l=o;if(s)i=!1,n=Tt;else if(a>=200){var c=t?null:Kn(e);if(c)return ls(c);i=!1,n=Xt,l=new Hs}else l=t?[]:o;e:for(;++r<a;){var d=e[r],u=t?t(d):d;if(d=s||0!==d?d:0,i&&u==u){for(var m=l.length;m--;)if(l[m]===u)continue e;t&&l.push(u),o.push(d)}else n(l,u,s)||(l!==o&&l.push(u),o.push(d))}return o}function un(e,t){return null==(e=Ea(e,t=bn(t,e)))||delete e[qa(Xa(t))]}function mn(e,t,s,r){return Xr(e,t,s(wr(e,t)),r)}function hn(e,t,s,r){for(var n=e.length,a=r?n:-1;(r?a--:++a<n)&&t(e[a],a,e););return s?sn(e,r?0:a,r?a+1:n):sn(e,r?a+1:0,r?n:a)}function pn(e,t){var s=e;return s instanceof Fs&&(s=s.value()),Dt(t,function(e,t){return t.func.apply(t.thisArg,It([e],t.args))},s)}function fn(e,t,s){var r=e.length;if(r<2)return r?dn(e[0]):[];for(var n=-1,a=we(r);++n<r;)for(var i=e[n],o=-1;++o<r;)o!=n&&(a[n]=dr(a[n]||i,e[o],t,s));return dn(gr(a,1),t,s)}function gn(t,s,r){for(var n=-1,a=t.length,i=s.length,o={};++n<a;){var l=n<i?s[n]:e;r(o,t[n],l)}return o}function xn(e){return Ki(e)?e:[]}function vn(e){return"function"==typeof e?e:il}function bn(e,t){return Zi(e)?e:ya(e,t)?[e]:Va(jo(e))}var yn=Kr;function jn(t,s,r){var n=t.length;return r=r===e?n:r,!s&&r>=n?t:sn(t,s,r)}var wn=mt||function(e){return ut.clearTimeout(e)};function Nn(e,t){if(t)return e.slice();var s=e.length,r=Ze?Ze(s):new e.constructor(s);return e.copy(r),r}function _n(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function kn(e,t){var s=t?_n(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Sn(t,s){if(t!==s){var r=t!==e,n=null===t,a=t==t,i=uo(t),o=s!==e,l=null===s,c=s==s,d=uo(s);if(!l&&!d&&!i&&t>s||i&&o&&c&&!l&&!d||n&&o&&c||!r&&c||!a)return 1;if(!n&&!i&&!d&&t<s||d&&r&&a&&!n&&!i||l&&r&&a||!o&&a||!c)return-1}return 0}function En(e,t,s,r){for(var n=-1,a=e.length,i=s.length,o=-1,l=t.length,c=xs(a-i,0),d=we(l+c),u=!r;++o<l;)d[o]=t[o];for(;++n<i;)(u||n<a)&&(d[s[n]]=e[n]);for(;c--;)d[o++]=e[n++];return d}function Rn(e,t,s,r){for(var n=-1,a=e.length,i=-1,o=s.length,l=-1,c=t.length,d=xs(a-o,0),u=we(d+c),m=!r;++n<d;)u[n]=e[n];for(var h=n;++l<c;)u[h+l]=t[l];for(;++i<o;)(m||n<a)&&(u[h+s[i]]=e[n++]);return u}function Cn(e,t){var s=-1,r=e.length;for(t||(t=we(r));++s<r;)t[s]=e[s];return t}function An(t,s,r,n){var a=!r;r||(r={});for(var i=-1,o=s.length;++i<o;){var l=s[i],c=n?n(r[l],t[l],l,r,t):e;c===e&&(c=t[l]),a?nr(r,l,c):er(r,l,c)}return r}function Tn(e,t){return function(s,r){var n=Zi(s)?_t:sr,a=t?t():{};return n(s,e,la(r,2),a)}}function Pn(t){return Kr(function(s,r){var n=-1,a=r.length,i=a>1?r[a-1]:e,o=a>2?r[2]:e;for(i=t.length>3&&"function"==typeof i?(a--,i):e,o&&ba(r[0],r[1],o)&&(i=a<3?e:i,a=1),s=Ee(s);++n<a;){var l=r[n];l&&t(s,l,n,i)}return s})}function In(e,t){return function(s,r){if(null==s)return s;if(!Gi(s))return e(s,r);for(var n=s.length,a=t?n:-1,i=Ee(s);(t?a--:++a<n)&&!1!==r(i[a],a,i););return s}}function Dn(e){return function(t,s,r){for(var n=-1,a=Ee(t),i=r(t),o=i.length;o--;){var l=i[e?o:++n];if(!1===s(a[l],l,a))break}return t}}function Ln(t){return function(s){var r=ns(s=jo(s))?ds(s):e,n=r?r[0]:s.charAt(0),a=r?jn(r,1).join(""):s.slice(1);return n[t]()+a}}function On(e){return function(t){return Dt(el(Zo(t).replace(Ye,"")),e,"")}}function Mn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=Bs(e.prototype),r=e.apply(s,t);return so(r)?r:s}}function Vn(t){return function(s,r,n){var a=Ee(s);if(!Gi(s)){var i=la(r,3);s=Do(s),r=function(e){return i(a[e],e,a)}}var o=t(s,r,n);return o>-1?a[i?s[o]:o]:e}}function qn(s){return sa(function(r){var n=r.length,a=n,i=Us.prototype.thru;for(s&&r.reverse();a--;){var o=r[a];if("function"!=typeof o)throw new Ae(t);if(i&&!l&&"wrapper"==ia(o))var l=new Us([],!0)}for(a=l?a:n;++a<n;){var c=ia(o=r[a]),d="wrapper"==c?aa(o):e;l=d&&ja(d[0])&&424==d[1]&&!d[4].length&&1==d[9]?l[ia(d[0])].apply(l,d[3]):1==o.length&&ja(o)?l[c]():l.thru(o)}return function(){var e=arguments,t=e[0];if(l&&1==e.length&&Zi(t))return l.plant(t).value();for(var s=0,a=n?r[s].apply(this,e):t;++s<n;)a=r[s].call(this,a);return a}})}function Bn(t,s,r,n,a,i,l,c,d,u){var m=s&o,h=1&s,p=2&s,f=24&s,g=512&s,x=p?e:Mn(t);return function o(){for(var v=arguments.length,b=we(v),y=v;y--;)b[y]=arguments[y];if(f)var j=oa(o),w=function(e,t){for(var s=e.length,r=0;s--;)e[s]===t&&++r;return r}(b,j);if(n&&(b=En(b,n,a,f)),i&&(b=Rn(b,i,l,f)),v-=w,f&&v<u){var N=os(b,j);return Hn(t,s,Bn,o.placeholder,r,b,N,c,d,u-v)}var _=h?r:this,k=p?_[t]:t;return v=b.length,c?b=function(t,s){for(var r=t.length,n=vs(s.length,r),a=Cn(t);n--;){var i=s[n];t[n]=va(i,r)?a[i]:e}return t}(b,c):g&&v>1&&b.reverse(),m&&d<v&&(b.length=d),this&&this!==ut&&this instanceof o&&(k=x||Mn(k)),k.apply(_,b)}}function zn(e,t){return function(s,r){return function(e,t,s,r){return br(e,function(e,n,a){t(r,s(e),n,a)}),r}(s,e,t(r),{})}}function Un(t,s){return function(r,n){var a;if(r===e&&n===e)return s;if(r!==e&&(a=r),n!==e){if(a===e)return n;"string"==typeof r||"string"==typeof n?(r=cn(r),n=cn(n)):(r=ln(r),n=ln(n)),a=t(r,n)}return a}}function Fn(e){return sa(function(t){return t=Pt(t,Yt(la())),Kr(function(s){var r=this;return e(t,function(e){return Nt(e,r,s)})})})}function $n(t,s){var r=(s=s===e?" ":cn(s)).length;if(r<2)return r?Gr(s,t):s;var n=Gr(s,gt(t/cs(s)));return ns(s)?jn(ds(n),0,t).join(""):n.slice(0,t)}function Wn(t){return function(s,r,n){return n&&"number"!=typeof n&&ba(s,r,n)&&(r=n=e),s=go(s),r===e?(r=s,s=0):r=go(r),function(e,t,s,r){for(var n=-1,a=xs(gt((t-e)/(s||1)),0),i=we(a);a--;)i[r?a:++n]=e,e+=s;return i}(s,r,n=n===e?s<r?1:-1:go(n),t)}}function Zn(e){return function(t,s){return"string"==typeof t&&"string"==typeof s||(t=bo(t),s=bo(s)),e(t,s)}}function Hn(t,s,r,n,o,l,c,d,u,m){var h=8&s;s|=h?a:i,4&(s&=~(h?i:a))||(s&=-4);var p=[t,s,o,h?l:e,h?c:e,h?e:l,h?e:c,d,u,m],f=r.apply(e,p);return ja(t)&&Ca(f,p),f.placeholder=n,Pa(f,t,s)}function Gn(e){var t=Se[e];return function(e,s){if(e=bo(e),(s=null==s?0:vs(xo(s),292))&&ps(e)){var r=(jo(e)+"e").split("e");return+((r=(jo(t(r[0]+"e"+(+r[1]+s)))+"e").split("e"))[0]+"e"+(+r[1]-s))}return t(e)}}var Kn=Ss&&1/ls(new Ss([,-0]))[1]==c?function(e){return new Ss(e)}:ul;function Yn(e){return function(t){var s=pa(t);return s==j?as(t):s==S?function(e){var t=-1,s=Array(e.size);return e.forEach(function(e){s[++t]=[e,e]}),s}(t):function(e,t){return Pt(t,function(t){return[t,e[t]]})}(t,e(t))}}function Qn(s,c,d,u,m,h,p,f){var g=2&c;if(!g&&"function"!=typeof s)throw new Ae(t);var x=u?u.length:0;if(x||(c&=-97,u=m=e),p=p===e?p:xs(xo(p),0),f=f===e?f:xo(f),x-=m?m.length:0,c&i){var v=u,b=m;u=m=e}var y=g?e:aa(s),j=[s,c,d,u,m,v,b,h,p,f];if(y&&function(e,t){var s=e[1],n=t[1],a=s|n,i=a<131,c=n==o&&8==s||n==o&&s==l&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==s;if(!i&&!c)return e;1&n&&(e[2]=t[2],a|=1&s?0:4);var d=t[3];if(d){var u=e[3];e[3]=u?En(u,d,t[4]):d,e[4]=u?os(e[3],r):t[4]}(d=t[5])&&(u=e[5],e[5]=u?Rn(u,d,t[6]):d,e[6]=u?os(e[5],r):t[6]),(d=t[7])&&(e[7]=d),n&o&&(e[8]=null==e[8]?t[8]:vs(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=a}(j,y),s=j[0],c=j[1],d=j[2],u=j[3],m=j[4],!(f=j[9]=j[9]===e?g?0:s.length:xs(j[9]-x,0))&&24&c&&(c&=-25),c&&1!=c)w=8==c||c==n?function(t,s,r){var n=Mn(t);return function a(){for(var i=arguments.length,o=we(i),l=i,c=oa(a);l--;)o[l]=arguments[l];var d=i<3&&o[0]!==c&&o[i-1]!==c?[]:os(o,c);return(i-=d.length)<r?Hn(t,s,Bn,a.placeholder,e,o,d,e,e,r-i):Nt(this&&this!==ut&&this instanceof a?n:t,this,o)}}(s,c,f):c!=a&&33!=c||m.length?Bn.apply(e,j):function(e,t,s,r){var n=1&t,a=Mn(e);return function t(){for(var i=-1,o=arguments.length,l=-1,c=r.length,d=we(c+o),u=this&&this!==ut&&this instanceof t?a:e;++l<c;)d[l]=r[l];for(;o--;)d[l++]=arguments[++i];return Nt(u,n?s:this,d)}}(s,c,d,u);else var w=function(e,t,s){var r=1&t,n=Mn(e);return function t(){return(this&&this!==ut&&this instanceof t?n:e).apply(r?s:this,arguments)}}(s,c,d);return Pa((y?Jr:Ca)(w,j),s,c)}function Xn(t,s,r,n){return t===e||Ui(t,Ie[r])&&!Oe.call(n,r)?s:t}function Jn(t,s,r,n,a,i){return so(t)&&so(s)&&(i.set(s,t),zr(t,s,e,Jn,i),i.delete(s)),t}function ea(t){return io(t)?e:t}function ta(t,s,r,n,a,i){var o=1&r,l=t.length,c=s.length;if(l!=c&&!(o&&c>l))return!1;var d=i.get(t),u=i.get(s);if(d&&u)return d==s&&u==t;var m=-1,h=!0,p=2&r?new Hs:e;for(i.set(t,s),i.set(s,t);++m<l;){var f=t[m],g=s[m];if(n)var x=o?n(g,f,m,s,t,i):n(f,g,m,t,s,i);if(x!==e){if(x)continue;h=!1;break}if(p){if(!Ot(s,function(e,t){if(!Xt(p,t)&&(f===e||a(f,e,r,n,i)))return p.push(t)})){h=!1;break}}else if(f!==g&&!a(f,g,r,n,i)){h=!1;break}}return i.delete(t),i.delete(s),h}function sa(t){return Ta(Sa(t,e,Ha),t+"")}function ra(e){return Nr(e,Do,ma)}function na(e){return Nr(e,Lo,ha)}var aa=Cs?function(e){return Cs.get(e)}:ul;function ia(e){for(var t=e.name+"",s=As[t],r=Oe.call(As,t)?s.length:0;r--;){var n=s[r],a=n.func;if(null==a||a==e)return n.name}return t}function oa(e){return(Oe.call(qs,"placeholder")?qs:e).placeholder}function la(){var e=qs.iteratee||ol;return e=e===ol?Dr:e,arguments.length?e(arguments[0],arguments[1]):e}function ca(e,t){var s,r,n=e.__data__;return("string"==(r=typeof(s=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==s:null===s)?n["string"==typeof t?"string":"hash"]:n.map}function da(e){for(var t=Do(e),s=t.length;s--;){var r=t[s],n=e[r];t[s]=[r,n,_a(n)]}return t}function ua(t,s){var r=function(t,s){return null==t?e:t[s]}(t,s);return Ir(r)?r:e}var ma=Mt?function(e){return null==e?[]:(e=Ee(e),Ct(Mt(e),function(t){return Ke.call(e,t)}))}:vl,ha=Mt?function(e){for(var t=[];e;)It(t,ma(e)),e=He(e);return t}:vl,pa=_r;function fa(e,t,s){for(var r=-1,n=(t=bn(t,e)).length,a=!1;++r<n;){var i=qa(t[r]);if(!(a=null!=e&&s(e,i)))break;e=e[i]}return a||++r!=n?a:!!(n=null==e?0:e.length)&&to(n)&&va(i,n)&&(Zi(e)||Wi(e))}function ga(e){return"function"!=typeof e.constructor||Na(e)?{}:Bs(He(e))}function xa(e){return Zi(e)||Wi(e)||!!(et&&e&&e[et])}function va(e,t){var s=typeof e;return!!(t=null==t?d:t)&&("number"==s||"symbol"!=s&&ge.test(e))&&e>-1&&e%1==0&&e<t}function ba(e,t,s){if(!so(s))return!1;var r=typeof t;return!!("number"==r?Gi(s)&&va(t,s.length):"string"==r&&t in s)&&Ui(s[t],e)}function ya(e,t){if(Zi(e))return!1;var s=typeof e;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=e&&!uo(e))||X.test(e)||!Q.test(e)||null!=t&&e in Ee(t)}function ja(e){var t=ia(e),s=qs[t];if("function"!=typeof s||!(t in Fs.prototype))return!1;if(e===s)return!0;var r=aa(s);return!!r&&e===r[0]}(Ns&&pa(new Ns(new ArrayBuffer(1)))!=T||_s&&pa(new _s)!=j||ks&&pa(ks.resolve())!=_||Ss&&pa(new Ss)!=S||Es&&pa(new Es)!=C)&&(pa=function(t){var s=_r(t),r=s==N?t.constructor:e,n=r?Ba(r):"";if(n)switch(n){case Ts:return T;case Ps:return j;case Is:return _;case Ds:return S;case Ls:return C}return s});var wa=De?Ji:bl;function Na(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ie)}function _a(e){return e==e&&!so(e)}function ka(t,s){return function(r){return null!=r&&r[t]===s&&(s!==e||t in Ee(r))}}function Sa(t,s,r){return s=xs(s===e?t.length-1:s,0),function(){for(var e=arguments,n=-1,a=xs(e.length-s,0),i=we(a);++n<a;)i[n]=e[s+n];n=-1;for(var o=we(s+1);++n<s;)o[n]=e[n];return o[s]=r(i),Nt(t,this,o)}}function Ea(e,t){return t.length<2?e:wr(e,sn(t,0,-1))}function Ra(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Ca=Ia(Jr),Aa=ft||function(e,t){return ut.setTimeout(e,t)},Ta=Ia(en);function Pa(e,t,s){var r=t+"";return Ta(e,function(e,t){var s=t.length;if(!s)return e;var r=s-1;return t[r]=(s>1?"& ":"")+t[r],t=t.join(s>2?", ":" "),e.replace(ne,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return kt(h,function(s){var r="_."+s[0];t&s[1]&&!At(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(ae);return t?t[1].split(ie):[]}(r),s)))}function Ia(t){var s=0,r=0;return function(){var n=bs(),a=16-(n-r);if(r=n,a>0){if(++s>=800)return arguments[0]}else s=0;return t.apply(e,arguments)}}function Da(t,s){var r=-1,n=t.length,a=n-1;for(s=s===e?n:s;++r<s;){var i=Hr(r,a),o=t[i];t[i]=t[r],t[r]=o}return t.length=s,t}var La,Oa,Ma,Va=(La=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(J,function(e,s,r,n){t.push(r?n.replace(ce,"$1"):s||e)}),t},Oa=Oi(La,function(e){return 500===Ma.size&&Ma.clear(),e}),Ma=Oa.cache,Oa);function qa(e){if("string"==typeof e||uo(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ba(e){if(null!=e){try{return Le.call(e)}catch(V_){}try{return e+""}catch(V_){}}return""}function za(e){if(e instanceof Fs)return e.clone();var t=new Us(e.__wrapped__,e.__chain__);return t.__actions__=Cn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ua=Kr(function(e,t){return Ki(e)?dr(e,gr(t,1,Ki,!0)):[]}),Fa=Kr(function(t,s){var r=Xa(s);return Ki(r)&&(r=e),Ki(t)?dr(t,gr(s,1,Ki,!0),la(r,2)):[]}),$a=Kr(function(t,s){var r=Xa(s);return Ki(r)&&(r=e),Ki(t)?dr(t,gr(s,1,Ki,!0),e,r):[]});function Wa(e,t,s){var r=null==e?0:e.length;if(!r)return-1;var n=null==s?0:xo(s);return n<0&&(n=xs(r+n,0)),qt(e,la(t,3),n)}function Za(t,s,r){var n=null==t?0:t.length;if(!n)return-1;var a=n-1;return r!==e&&(a=xo(r),a=r<0?xs(n+a,0):vs(a,n-1)),qt(t,la(s,3),a,!0)}function Ha(e){return null!=e&&e.length?gr(e,1):[]}function Ga(t){return t&&t.length?t[0]:e}var Ka=Kr(function(e){var t=Pt(e,xn);return t.length&&t[0]===e[0]?Rr(t):[]}),Ya=Kr(function(t){var s=Xa(t),r=Pt(t,xn);return s===Xa(r)?s=e:r.pop(),r.length&&r[0]===t[0]?Rr(r,la(s,2)):[]}),Qa=Kr(function(t){var s=Xa(t),r=Pt(t,xn);return(s="function"==typeof s?s:e)&&r.pop(),r.length&&r[0]===t[0]?Rr(r,e,s):[]});function Xa(t){var s=null==t?0:t.length;return s?t[s-1]:e}var Ja=Kr(ei);function ei(e,t){return e&&e.length&&t&&t.length?Wr(e,t):e}var ti=sa(function(e,t){var s=null==e?0:e.length,r=ar(e,t);return Zr(e,Pt(t,function(e){return va(e,s)?+e:e}).sort(Sn)),r});function si(e){return null==e?e:ws.call(e)}var ri=Kr(function(e){return dn(gr(e,1,Ki,!0))}),ni=Kr(function(t){var s=Xa(t);return Ki(s)&&(s=e),dn(gr(t,1,Ki,!0),la(s,2))}),ai=Kr(function(t){var s=Xa(t);return s="function"==typeof s?s:e,dn(gr(t,1,Ki,!0),e,s)});function ii(e){if(!e||!e.length)return[];var t=0;return e=Ct(e,function(e){if(Ki(e))return t=xs(e.length,t),!0}),Gt(t,function(t){return Pt(e,$t(t))})}function oi(t,s){if(!t||!t.length)return[];var r=ii(t);return null==s?r:Pt(r,function(t){return Nt(s,e,t)})}var li=Kr(function(e,t){return Ki(e)?dr(e,t):[]}),ci=Kr(function(e){return fn(Ct(e,Ki))}),di=Kr(function(t){var s=Xa(t);return Ki(s)&&(s=e),fn(Ct(t,Ki),la(s,2))}),ui=Kr(function(t){var s=Xa(t);return s="function"==typeof s?s:e,fn(Ct(t,Ki),e,s)}),mi=Kr(ii),hi=Kr(function(t){var s=t.length,r=s>1?t[s-1]:e;return r="function"==typeof r?(t.pop(),r):e,oi(t,r)});function pi(e){var t=qs(e);return t.__chain__=!0,t}function fi(e,t){return t(e)}var gi=sa(function(t){var s=t.length,r=s?t[0]:0,n=this.__wrapped__,a=function(e){return ar(e,t)};return!(s>1||this.__actions__.length)&&n instanceof Fs&&va(r)?((n=n.slice(r,+r+(s?1:0))).__actions__.push({func:fi,args:[a],thisArg:e}),new Us(n,this.__chain__).thru(function(t){return s&&!t.length&&t.push(e),t})):this.thru(a)}),xi=Tn(function(e,t,s){Oe.call(e,s)?++e[s]:nr(e,s,1)}),vi=Vn(Wa),bi=Vn(Za);function yi(e,t){return(Zi(e)?kt:ur)(e,la(t,3))}function ji(e,t){return(Zi(e)?Et:mr)(e,la(t,3))}var wi=Tn(function(e,t,s){Oe.call(e,s)?e[s].push(t):nr(e,s,[t])}),Ni=Kr(function(e,t,s){var r=-1,n="function"==typeof t,a=Gi(e)?we(e.length):[];return ur(e,function(e){a[++r]=n?Nt(t,e,s):Cr(e,t,s)}),a}),_i=Tn(function(e,t,s){nr(e,s,t)});function ki(e,t){return(Zi(e)?Pt:Vr)(e,la(t,3))}var Si=Tn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]}),Ei=Kr(function(e,t){if(null==e)return[];var s=t.length;return s>1&&ba(e,t[0],t[1])?t=[]:s>2&&ba(t[0],t[1],t[2])&&(t=[t[0]]),Fr(e,gr(t,1),[])}),Ri=ht||function(){return ut.Date.now()};function Ci(t,s,r){return s=r?e:s,s=t&&null==s?t.length:s,Qn(t,o,e,e,e,e,s)}function Ai(s,r){var n;if("function"!=typeof r)throw new Ae(t);return s=xo(s),function(){return--s>0&&(n=r.apply(this,arguments)),s<=1&&(r=e),n}}var Ti=Kr(function(e,t,s){var r=1;if(s.length){var n=os(s,oa(Ti));r|=a}return Qn(e,r,t,s,n)}),Pi=Kr(function(e,t,s){var r=3;if(s.length){var n=os(s,oa(Pi));r|=a}return Qn(t,r,e,s,n)});function Ii(s,r,n){var a,i,o,l,c,d,u=0,m=!1,h=!1,p=!0;if("function"!=typeof s)throw new Ae(t);function f(t){var r=a,n=i;return a=i=e,u=t,l=s.apply(n,r)}function g(t){var s=t-d;return d===e||s>=r||s<0||h&&t-u>=o}function x(){var e=Ri();if(g(e))return v(e);c=Aa(x,function(e){var t=r-(e-d);return h?vs(t,o-(e-u)):t}(e))}function v(t){return c=e,p&&a?f(t):(a=i=e,l)}function b(){var t=Ri(),s=g(t);if(a=arguments,i=this,d=t,s){if(c===e)return function(e){return u=e,c=Aa(x,r),m?f(e):l}(d);if(h)return wn(c),c=Aa(x,r),f(d)}return c===e&&(c=Aa(x,r)),l}return r=bo(r)||0,so(n)&&(m=!!n.leading,o=(h="maxWait"in n)?xs(bo(n.maxWait)||0,r):o,p="trailing"in n?!!n.trailing:p),b.cancel=function(){c!==e&&wn(c),u=0,a=d=i=c=e},b.flush=function(){return c===e?l:v(Ri())},b}var Di=Kr(function(e,t){return cr(e,1,t)}),Li=Kr(function(e,t,s){return cr(e,bo(t)||0,s)});function Oi(e,s){if("function"!=typeof e||null!=s&&"function"!=typeof s)throw new Ae(t);var r=function(){var t=arguments,n=s?s.apply(this,t):t[0],a=r.cache;if(a.has(n))return a.get(n);var i=e.apply(this,t);return r.cache=a.set(n,i)||a,i};return r.cache=new(Oi.Cache||Zs),r}function Mi(e){if("function"!=typeof e)throw new Ae(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Oi.Cache=Zs;var Vi=yn(function(e,t){var s=(t=1==t.length&&Zi(t[0])?Pt(t[0],Yt(la())):Pt(gr(t,1),Yt(la()))).length;return Kr(function(r){for(var n=-1,a=vs(r.length,s);++n<a;)r[n]=t[n].call(this,r[n]);return Nt(e,this,r)})}),qi=Kr(function(t,s){var r=os(s,oa(qi));return Qn(t,a,e,s,r)}),Bi=Kr(function(t,s){var r=os(s,oa(Bi));return Qn(t,i,e,s,r)}),zi=sa(function(t,s){return Qn(t,l,e,e,e,s)});function Ui(e,t){return e===t||e!=e&&t!=t}var Fi=Zn(kr),$i=Zn(function(e,t){return e>=t}),Wi=Ar(function(){return arguments}())?Ar:function(e){return ro(e)&&Oe.call(e,"callee")&&!Ke.call(e,"callee")},Zi=we.isArray,Hi=xt?Yt(xt):function(e){return ro(e)&&_r(e)==A};function Gi(e){return null!=e&&to(e.length)&&!Ji(e)}function Ki(e){return ro(e)&&Gi(e)}var Yi=Wt||bl,Qi=vt?Yt(vt):function(e){return ro(e)&&_r(e)==x};function Xi(e){if(!ro(e))return!1;var t=_r(e);return t==v||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!io(e)}function Ji(e){if(!so(e))return!1;var t=_r(e);return t==b||t==y||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eo(e){return"number"==typeof e&&e==xo(e)}function to(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=d}function so(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ro(e){return null!=e&&"object"==typeof e}var no=bt?Yt(bt):function(e){return ro(e)&&pa(e)==j};function ao(e){return"number"==typeof e||ro(e)&&_r(e)==w}function io(e){if(!ro(e)||_r(e)!=N)return!1;var t=He(e);if(null===t)return!0;var s=Oe.call(t,"constructor")&&t.constructor;return"function"==typeof s&&s instanceof s&&Le.call(s)==Be}var oo=yt?Yt(yt):function(e){return ro(e)&&_r(e)==k},lo=jt?Yt(jt):function(e){return ro(e)&&pa(e)==S};function co(e){return"string"==typeof e||!Zi(e)&&ro(e)&&_r(e)==E}function uo(e){return"symbol"==typeof e||ro(e)&&_r(e)==R}var mo=wt?Yt(wt):function(e){return ro(e)&&to(e.length)&&!!nt[_r(e)]},ho=Zn(Mr),po=Zn(function(e,t){return e<=t});function fo(e){if(!e)return[];if(Gi(e))return co(e)?ds(e):Cn(e);if(it&&e[it])return function(e){for(var t,s=[];!(t=e.next()).done;)s.push(t.value);return s}(e[it]());var t=pa(e);return(t==j?as:t==S?ls:Fo)(e)}function go(e){return e?(e=bo(e))===c||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function xo(e){var t=go(e),s=t%1;return t==t?s?t-s:t:0}function vo(e){return e?ir(xo(e),0,m):0}function bo(e){if("number"==typeof e)return e;if(uo(e))return u;if(so(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=so(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Kt(e);var s=he.test(e);return s||fe.test(e)?lt(e.slice(2),s?2:8):me.test(e)?u:+e}function yo(e){return An(e,Lo(e))}function jo(e){return null==e?"":cn(e)}var wo=Pn(function(e,t){if(Na(t)||Gi(t))An(t,Do(t),e);else for(var s in t)Oe.call(t,s)&&er(e,s,t[s])}),No=Pn(function(e,t){An(t,Lo(t),e)}),_o=Pn(function(e,t,s,r){An(t,Lo(t),e,r)}),ko=Pn(function(e,t,s,r){An(t,Do(t),e,r)}),So=sa(ar),Eo=Kr(function(t,s){t=Ee(t);var r=-1,n=s.length,a=n>2?s[2]:e;for(a&&ba(s[0],s[1],a)&&(n=1);++r<n;)for(var i=s[r],o=Lo(i),l=-1,c=o.length;++l<c;){var d=o[l],u=t[d];(u===e||Ui(u,Ie[d])&&!Oe.call(t,d))&&(t[d]=i[d])}return t}),Ro=Kr(function(t){return t.push(e,Jn),Nt(Mo,e,t)});function Co(t,s,r){var n=null==t?e:wr(t,s);return n===e?r:n}function Ao(e,t){return null!=e&&fa(e,t,Er)}var To=zn(function(e,t,s){null!=t&&"function"!=typeof t.toString&&(t=qe.call(t)),e[t]=s},rl(il)),Po=zn(function(e,t,s){null!=t&&"function"!=typeof t.toString&&(t=qe.call(t)),Oe.call(e,t)?e[t].push(s):e[t]=[s]},la),Io=Kr(Cr);function Do(e){return Gi(e)?Ks(e):Lr(e)}function Lo(e){return Gi(e)?Ks(e,!0):Or(e)}var Oo=Pn(function(e,t,s){zr(e,t,s)}),Mo=Pn(function(e,t,s,r){zr(e,t,s,r)}),Vo=sa(function(e,t){var s={};if(null==e)return s;var r=!1;t=Pt(t,function(t){return t=bn(t,e),r||(r=t.length>1),t}),An(e,na(e),s),r&&(s=or(s,7,ea));for(var n=t.length;n--;)un(s,t[n]);return s}),qo=sa(function(e,t){return null==e?{}:function(e,t){return $r(e,t,function(t,s){return Ao(e,s)})}(e,t)});function Bo(e,t){if(null==e)return{};var s=Pt(na(e),function(e){return[e]});return t=la(t),$r(e,s,function(e,s){return t(e,s[0])})}var zo=Yn(Do),Uo=Yn(Lo);function Fo(e){return null==e?[]:Qt(e,Do(e))}var $o=On(function(e,t,s){return t=t.toLowerCase(),e+(s?Wo(t):t)});function Wo(e){return Jo(jo(e).toLowerCase())}function Zo(e){return(e=jo(e))&&e.replace(xe,ts).replace(Qe,"")}var Ho=On(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Go=On(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Ko=Ln("toLowerCase"),Yo=On(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()}),Qo=On(function(e,t,s){return e+(s?" ":"")+Jo(t)}),Xo=On(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Jo=Ln("toUpperCase");function el(t,s,r){return t=jo(t),(s=r?e:s)===e?function(e){return tt.test(e)}(t)?function(e){return e.match(Je)||[]}(t):function(e){return e.match(oe)||[]}(t):t.match(s)||[]}var tl=Kr(function(t,s){try{return Nt(t,e,s)}catch(V_){return Xi(V_)?V_:new _e(V_)}}),sl=sa(function(e,t){return kt(t,function(t){t=qa(t),nr(e,t,Ti(e[t],e))}),e});function rl(e){return function(){return e}}var nl=qn(),al=qn(!0);function il(e){return e}function ol(e){return Dr("function"==typeof e?e:or(e,1))}var ll=Kr(function(e,t){return function(s){return Cr(s,e,t)}}),cl=Kr(function(e,t){return function(s){return Cr(e,s,t)}});function dl(e,t,s){var r=Do(t),n=jr(t,r);null!=s||so(t)&&(n.length||!r.length)||(s=t,t=e,e=this,n=jr(t,Do(t)));var a=!(so(s)&&"chain"in s&&!s.chain),i=Ji(e);return kt(n,function(s){var r=t[s];e[s]=r,i&&(e.prototype[s]=function(){var t=this.__chain__;if(a||t){var s=e(this.__wrapped__);return(s.__actions__=Cn(this.__actions__)).push({func:r,args:arguments,thisArg:e}),s.__chain__=t,s}return r.apply(e,It([this.value()],arguments))})}),e}function ul(){}var ml=Fn(Pt),hl=Fn(Rt),pl=Fn(Ot);function fl(e){return ya(e)?$t(qa(e)):function(e){return function(t){return wr(t,e)}}(e)}var gl=Wn(),xl=Wn(!0);function vl(){return[]}function bl(){return!1}var yl,jl=Un(function(e,t){return e+t},0),wl=Gn("ceil"),Nl=Un(function(e,t){return e/t},1),_l=Gn("floor"),kl=Un(function(e,t){return e*t},1),Sl=Gn("round"),El=Un(function(e,t){return e-t},0);return qs.after=function(e,s){if("function"!=typeof s)throw new Ae(t);return e=xo(e),function(){if(--e<1)return s.apply(this,arguments)}},qs.ary=Ci,qs.assign=wo,qs.assignIn=No,qs.assignInWith=_o,qs.assignWith=ko,qs.at=So,qs.before=Ai,qs.bind=Ti,qs.bindAll=sl,qs.bindKey=Pi,qs.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Zi(e)?e:[e]},qs.chain=pi,qs.chunk=function(t,s,r){s=(r?ba(t,s,r):s===e)?1:xs(xo(s),0);var n=null==t?0:t.length;if(!n||s<1)return[];for(var a=0,i=0,o=we(gt(n/s));a<n;)o[i++]=sn(t,a,a+=s);return o},qs.compact=function(e){for(var t=-1,s=null==e?0:e.length,r=0,n=[];++t<s;){var a=e[t];a&&(n[r++]=a)}return n},qs.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),s=arguments[0],r=e;r--;)t[r-1]=arguments[r];return It(Zi(s)?Cn(s):[s],gr(t,1))},qs.cond=function(e){var s=null==e?0:e.length,r=la();return e=s?Pt(e,function(e){if("function"!=typeof e[1])throw new Ae(t);return[r(e[0]),e[1]]}):[],Kr(function(t){for(var r=-1;++r<s;){var n=e[r];if(Nt(n[0],this,t))return Nt(n[1],this,t)}})},qs.conforms=function(e){return function(e){var t=Do(e);return function(s){return lr(s,e,t)}}(or(e,1))},qs.constant=rl,qs.countBy=xi,qs.create=function(e,t){var s=Bs(e);return null==t?s:rr(s,t)},qs.curry=function t(s,r,n){var a=Qn(s,8,e,e,e,e,e,r=n?e:r);return a.placeholder=t.placeholder,a},qs.curryRight=function t(s,r,a){var i=Qn(s,n,e,e,e,e,e,r=a?e:r);return i.placeholder=t.placeholder,i},qs.debounce=Ii,qs.defaults=Eo,qs.defaultsDeep=Ro,qs.defer=Di,qs.delay=Li,qs.difference=Ua,qs.differenceBy=Fa,qs.differenceWith=$a,qs.drop=function(t,s,r){var n=null==t?0:t.length;return n?sn(t,(s=r||s===e?1:xo(s))<0?0:s,n):[]},qs.dropRight=function(t,s,r){var n=null==t?0:t.length;return n?sn(t,0,(s=n-(s=r||s===e?1:xo(s)))<0?0:s):[]},qs.dropRightWhile=function(e,t){return e&&e.length?hn(e,la(t,3),!0,!0):[]},qs.dropWhile=function(e,t){return e&&e.length?hn(e,la(t,3),!0):[]},qs.fill=function(t,s,r,n){var a=null==t?0:t.length;return a?(r&&"number"!=typeof r&&ba(t,s,r)&&(r=0,n=a),function(t,s,r,n){var a=t.length;for((r=xo(r))<0&&(r=-r>a?0:a+r),(n=n===e||n>a?a:xo(n))<0&&(n+=a),n=r>n?0:vo(n);r<n;)t[r++]=s;return t}(t,s,r,n)):[]},qs.filter=function(e,t){return(Zi(e)?Ct:fr)(e,la(t,3))},qs.flatMap=function(e,t){return gr(ki(e,t),1)},qs.flatMapDeep=function(e,t){return gr(ki(e,t),c)},qs.flatMapDepth=function(t,s,r){return r=r===e?1:xo(r),gr(ki(t,s),r)},qs.flatten=Ha,qs.flattenDeep=function(e){return null!=e&&e.length?gr(e,c):[]},qs.flattenDepth=function(t,s){return null!=t&&t.length?gr(t,s=s===e?1:xo(s)):[]},qs.flip=function(e){return Qn(e,512)},qs.flow=nl,qs.flowRight=al,qs.fromPairs=function(e){for(var t=-1,s=null==e?0:e.length,r={};++t<s;){var n=e[t];r[n[0]]=n[1]}return r},qs.functions=function(e){return null==e?[]:jr(e,Do(e))},qs.functionsIn=function(e){return null==e?[]:jr(e,Lo(e))},qs.groupBy=wi,qs.initial=function(e){return null!=e&&e.length?sn(e,0,-1):[]},qs.intersection=Ka,qs.intersectionBy=Ya,qs.intersectionWith=Qa,qs.invert=To,qs.invertBy=Po,qs.invokeMap=Ni,qs.iteratee=ol,qs.keyBy=_i,qs.keys=Do,qs.keysIn=Lo,qs.map=ki,qs.mapKeys=function(e,t){var s={};return t=la(t,3),br(e,function(e,r,n){nr(s,t(e,r,n),e)}),s},qs.mapValues=function(e,t){var s={};return t=la(t,3),br(e,function(e,r,n){nr(s,r,t(e,r,n))}),s},qs.matches=function(e){return qr(or(e,1))},qs.matchesProperty=function(e,t){return Br(e,or(t,1))},qs.memoize=Oi,qs.merge=Oo,qs.mergeWith=Mo,qs.method=ll,qs.methodOf=cl,qs.mixin=dl,qs.negate=Mi,qs.nthArg=function(e){return e=xo(e),Kr(function(t){return Ur(t,e)})},qs.omit=Vo,qs.omitBy=function(e,t){return Bo(e,Mi(la(t)))},qs.once=function(e){return Ai(2,e)},qs.orderBy=function(t,s,r,n){return null==t?[]:(Zi(s)||(s=null==s?[]:[s]),Zi(r=n?e:r)||(r=null==r?[]:[r]),Fr(t,s,r))},qs.over=ml,qs.overArgs=Vi,qs.overEvery=hl,qs.overSome=pl,qs.partial=qi,qs.partialRight=Bi,qs.partition=Si,qs.pick=qo,qs.pickBy=Bo,qs.property=fl,qs.propertyOf=function(t){return function(s){return null==t?e:wr(t,s)}},qs.pull=Ja,qs.pullAll=ei,qs.pullAllBy=function(e,t,s){return e&&e.length&&t&&t.length?Wr(e,t,la(s,2)):e},qs.pullAllWith=function(t,s,r){return t&&t.length&&s&&s.length?Wr(t,s,e,r):t},qs.pullAt=ti,qs.range=gl,qs.rangeRight=xl,qs.rearg=zi,qs.reject=function(e,t){return(Zi(e)?Ct:fr)(e,Mi(la(t,3)))},qs.remove=function(e,t){var s=[];if(!e||!e.length)return s;var r=-1,n=[],a=e.length;for(t=la(t,3);++r<a;){var i=e[r];t(i,r,e)&&(s.push(i),n.push(r))}return Zr(e,n),s},qs.rest=function(s,r){if("function"!=typeof s)throw new Ae(t);return Kr(s,r=r===e?r:xo(r))},qs.reverse=si,qs.sampleSize=function(t,s,r){return s=(r?ba(t,s,r):s===e)?1:xo(s),(Zi(t)?Qs:Qr)(t,s)},qs.set=function(e,t,s){return null==e?e:Xr(e,t,s)},qs.setWith=function(t,s,r,n){return n="function"==typeof n?n:e,null==t?t:Xr(t,s,r,n)},qs.shuffle=function(e){return(Zi(e)?Xs:tn)(e)},qs.slice=function(t,s,r){var n=null==t?0:t.length;return n?(r&&"number"!=typeof r&&ba(t,s,r)?(s=0,r=n):(s=null==s?0:xo(s),r=r===e?n:xo(r)),sn(t,s,r)):[]},qs.sortBy=Ei,qs.sortedUniq=function(e){return e&&e.length?on(e):[]},qs.sortedUniqBy=function(e,t){return e&&e.length?on(e,la(t,2)):[]},qs.split=function(t,s,r){return r&&"number"!=typeof r&&ba(t,s,r)&&(s=r=e),(r=r===e?m:r>>>0)?(t=jo(t))&&("string"==typeof s||null!=s&&!oo(s))&&!(s=cn(s))&&ns(t)?jn(ds(t),0,r):t.split(s,r):[]},qs.spread=function(e,s){if("function"!=typeof e)throw new Ae(t);return s=null==s?0:xs(xo(s),0),Kr(function(t){var r=t[s],n=jn(t,0,s);return r&&It(n,r),Nt(e,this,n)})},qs.tail=function(e){var t=null==e?0:e.length;return t?sn(e,1,t):[]},qs.take=function(t,s,r){return t&&t.length?sn(t,0,(s=r||s===e?1:xo(s))<0?0:s):[]},qs.takeRight=function(t,s,r){var n=null==t?0:t.length;return n?sn(t,(s=n-(s=r||s===e?1:xo(s)))<0?0:s,n):[]},qs.takeRightWhile=function(e,t){return e&&e.length?hn(e,la(t,3),!1,!0):[]},qs.takeWhile=function(e,t){return e&&e.length?hn(e,la(t,3)):[]},qs.tap=function(e,t){return t(e),e},qs.throttle=function(e,s,r){var n=!0,a=!0;if("function"!=typeof e)throw new Ae(t);return so(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),Ii(e,s,{leading:n,maxWait:s,trailing:a})},qs.thru=fi,qs.toArray=fo,qs.toPairs=zo,qs.toPairsIn=Uo,qs.toPath=function(e){return Zi(e)?Pt(e,qa):uo(e)?[e]:Cn(Va(jo(e)))},qs.toPlainObject=yo,qs.transform=function(e,t,s){var r=Zi(e),n=r||Yi(e)||mo(e);if(t=la(t,4),null==s){var a=e&&e.constructor;s=n?r?new a:[]:so(e)&&Ji(a)?Bs(He(e)):{}}return(n?kt:br)(e,function(e,r,n){return t(s,e,r,n)}),s},qs.unary=function(e){return Ci(e,1)},qs.union=ri,qs.unionBy=ni,qs.unionWith=ai,qs.uniq=function(e){return e&&e.length?dn(e):[]},qs.uniqBy=function(e,t){return e&&e.length?dn(e,la(t,2)):[]},qs.uniqWith=function(t,s){return s="function"==typeof s?s:e,t&&t.length?dn(t,e,s):[]},qs.unset=function(e,t){return null==e||un(e,t)},qs.unzip=ii,qs.unzipWith=oi,qs.update=function(e,t,s){return null==e?e:mn(e,t,vn(s))},qs.updateWith=function(t,s,r,n){return n="function"==typeof n?n:e,null==t?t:mn(t,s,vn(r),n)},qs.values=Fo,qs.valuesIn=function(e){return null==e?[]:Qt(e,Lo(e))},qs.without=li,qs.words=el,qs.wrap=function(e,t){return qi(vn(t),e)},qs.xor=ci,qs.xorBy=di,qs.xorWith=ui,qs.zip=mi,qs.zipObject=function(e,t){return gn(e||[],t||[],er)},qs.zipObjectDeep=function(e,t){return gn(e||[],t||[],Xr)},qs.zipWith=hi,qs.entries=zo,qs.entriesIn=Uo,qs.extend=No,qs.extendWith=_o,dl(qs,qs),qs.add=jl,qs.attempt=tl,qs.camelCase=$o,qs.capitalize=Wo,qs.ceil=wl,qs.clamp=function(t,s,r){return r===e&&(r=s,s=e),r!==e&&(r=(r=bo(r))==r?r:0),s!==e&&(s=(s=bo(s))==s?s:0),ir(bo(t),s,r)},qs.clone=function(e){return or(e,4)},qs.cloneDeep=function(e){return or(e,5)},qs.cloneDeepWith=function(t,s){return or(t,5,s="function"==typeof s?s:e)},qs.cloneWith=function(t,s){return or(t,4,s="function"==typeof s?s:e)},qs.conformsTo=function(e,t){return null==t||lr(e,t,Do(t))},qs.deburr=Zo,qs.defaultTo=function(e,t){return null==e||e!=e?t:e},qs.divide=Nl,qs.endsWith=function(t,s,r){t=jo(t),s=cn(s);var n=t.length,a=r=r===e?n:ir(xo(r),0,n);return(r-=s.length)>=0&&t.slice(r,a)==s},qs.eq=Ui,qs.escape=function(e){return(e=jo(e))&&H.test(e)?e.replace(W,ss):e},qs.escapeRegExp=function(e){return(e=jo(e))&&te.test(e)?e.replace(ee,"\\$&"):e},qs.every=function(t,s,r){var n=Zi(t)?Rt:hr;return r&&ba(t,s,r)&&(s=e),n(t,la(s,3))},qs.find=vi,qs.findIndex=Wa,qs.findKey=function(e,t){return Vt(e,la(t,3),br)},qs.findLast=bi,qs.findLastIndex=Za,qs.findLastKey=function(e,t){return Vt(e,la(t,3),yr)},qs.floor=_l,qs.forEach=yi,qs.forEachRight=ji,qs.forIn=function(e,t){return null==e?e:xr(e,la(t,3),Lo)},qs.forInRight=function(e,t){return null==e?e:vr(e,la(t,3),Lo)},qs.forOwn=function(e,t){return e&&br(e,la(t,3))},qs.forOwnRight=function(e,t){return e&&yr(e,la(t,3))},qs.get=Co,qs.gt=Fi,qs.gte=$i,qs.has=function(e,t){return null!=e&&fa(e,t,Sr)},qs.hasIn=Ao,qs.head=Ga,qs.identity=il,qs.includes=function(e,t,s,r){e=Gi(e)?e:Fo(e),s=s&&!r?xo(s):0;var n=e.length;return s<0&&(s=xs(n+s,0)),co(e)?s<=n&&e.indexOf(t,s)>-1:!!n&&Bt(e,t,s)>-1},qs.indexOf=function(e,t,s){var r=null==e?0:e.length;if(!r)return-1;var n=null==s?0:xo(s);return n<0&&(n=xs(r+n,0)),Bt(e,t,n)},qs.inRange=function(t,s,r){return s=go(s),r===e?(r=s,s=0):r=go(r),function(e,t,s){return e>=vs(t,s)&&e<xs(t,s)}(t=bo(t),s,r)},qs.invoke=Io,qs.isArguments=Wi,qs.isArray=Zi,qs.isArrayBuffer=Hi,qs.isArrayLike=Gi,qs.isArrayLikeObject=Ki,qs.isBoolean=function(e){return!0===e||!1===e||ro(e)&&_r(e)==g},qs.isBuffer=Yi,qs.isDate=Qi,qs.isElement=function(e){return ro(e)&&1===e.nodeType&&!io(e)},qs.isEmpty=function(e){if(null==e)return!0;if(Gi(e)&&(Zi(e)||"string"==typeof e||"function"==typeof e.splice||Yi(e)||mo(e)||Wi(e)))return!e.length;var t=pa(e);if(t==j||t==S)return!e.size;if(Na(e))return!Lr(e).length;for(var s in e)if(Oe.call(e,s))return!1;return!0},qs.isEqual=function(e,t){return Tr(e,t)},qs.isEqualWith=function(t,s,r){var n=(r="function"==typeof r?r:e)?r(t,s):e;return n===e?Tr(t,s,e,r):!!n},qs.isError=Xi,qs.isFinite=function(e){return"number"==typeof e&&ps(e)},qs.isFunction=Ji,qs.isInteger=eo,qs.isLength=to,qs.isMap=no,qs.isMatch=function(e,t){return e===t||Pr(e,t,da(t))},qs.isMatchWith=function(t,s,r){return r="function"==typeof r?r:e,Pr(t,s,da(s),r)},qs.isNaN=function(e){return ao(e)&&e!=+e},qs.isNative=function(e){if(wa(e))throw new _e("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ir(e)},qs.isNil=function(e){return null==e},qs.isNull=function(e){return null===e},qs.isNumber=ao,qs.isObject=so,qs.isObjectLike=ro,qs.isPlainObject=io,qs.isRegExp=oo,qs.isSafeInteger=function(e){return eo(e)&&e>=-9007199254740991&&e<=d},qs.isSet=lo,qs.isString=co,qs.isSymbol=uo,qs.isTypedArray=mo,qs.isUndefined=function(t){return t===e},qs.isWeakMap=function(e){return ro(e)&&pa(e)==C},qs.isWeakSet=function(e){return ro(e)&&"[object WeakSet]"==_r(e)},qs.join=function(e,t){return null==e?"":fs.call(e,t)},qs.kebabCase=Ho,qs.last=Xa,qs.lastIndexOf=function(t,s,r){var n=null==t?0:t.length;if(!n)return-1;var a=n;return r!==e&&(a=(a=xo(r))<0?xs(n+a,0):vs(a,n-1)),s==s?function(e,t,s){for(var r=s+1;r--;)if(e[r]===t)return r;return r}(t,s,a):qt(t,Ut,a,!0)},qs.lowerCase=Go,qs.lowerFirst=Ko,qs.lt=ho,qs.lte=po,qs.max=function(t){return t&&t.length?pr(t,il,kr):e},qs.maxBy=function(t,s){return t&&t.length?pr(t,la(s,2),kr):e},qs.mean=function(e){return Ft(e,il)},qs.meanBy=function(e,t){return Ft(e,la(t,2))},qs.min=function(t){return t&&t.length?pr(t,il,Mr):e},qs.minBy=function(t,s){return t&&t.length?pr(t,la(s,2),Mr):e},qs.stubArray=vl,qs.stubFalse=bl,qs.stubObject=function(){return{}},qs.stubString=function(){return""},qs.stubTrue=function(){return!0},qs.multiply=kl,qs.nth=function(t,s){return t&&t.length?Ur(t,xo(s)):e},qs.noConflict=function(){return ut._===this&&(ut._=ze),this},qs.noop=ul,qs.now=Ri,qs.pad=function(e,t,s){e=jo(e);var r=(t=xo(t))?cs(e):0;if(!t||r>=t)return e;var n=(t-r)/2;return $n(St(n),s)+e+$n(gt(n),s)},qs.padEnd=function(e,t,s){e=jo(e);var r=(t=xo(t))?cs(e):0;return t&&r<t?e+$n(t-r,s):e},qs.padStart=function(e,t,s){e=jo(e);var r=(t=xo(t))?cs(e):0;return t&&r<t?$n(t-r,s)+e:e},qs.parseInt=function(e,t,s){return s||null==t?t=0:t&&(t=+t),ys(jo(e).replace(se,""),t||0)},qs.random=function(t,s,r){if(r&&"boolean"!=typeof r&&ba(t,s,r)&&(s=r=e),r===e&&("boolean"==typeof s?(r=s,s=e):"boolean"==typeof t&&(r=t,t=e)),t===e&&s===e?(t=0,s=1):(t=go(t),s===e?(s=t,t=0):s=go(s)),t>s){var n=t;t=s,s=n}if(r||t%1||s%1){var a=js();return vs(t+a*(s-t+ot("1e-"+((a+"").length-1))),s)}return Hr(t,s)},qs.reduce=function(e,t,s){var r=Zi(e)?Dt:Zt,n=arguments.length<3;return r(e,la(t,4),s,n,ur)},qs.reduceRight=function(e,t,s){var r=Zi(e)?Lt:Zt,n=arguments.length<3;return r(e,la(t,4),s,n,mr)},qs.repeat=function(t,s,r){return s=(r?ba(t,s,r):s===e)?1:xo(s),Gr(jo(t),s)},qs.replace=function(){var e=arguments,t=jo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},qs.result=function(t,s,r){var n=-1,a=(s=bn(s,t)).length;for(a||(a=1,t=e);++n<a;){var i=null==t?e:t[qa(s[n])];i===e&&(n=a,i=r),t=Ji(i)?i.call(t):i}return t},qs.round=Sl,qs.runInContext=re,qs.sample=function(e){return(Zi(e)?Ys:Yr)(e)},qs.size=function(e){if(null==e)return 0;if(Gi(e))return co(e)?cs(e):e.length;var t=pa(e);return t==j||t==S?e.size:Lr(e).length},qs.snakeCase=Yo,qs.some=function(t,s,r){var n=Zi(t)?Ot:rn;return r&&ba(t,s,r)&&(s=e),n(t,la(s,3))},qs.sortedIndex=function(e,t){return nn(e,t)},qs.sortedIndexBy=function(e,t,s){return an(e,t,la(s,2))},qs.sortedIndexOf=function(e,t){var s=null==e?0:e.length;if(s){var r=nn(e,t);if(r<s&&Ui(e[r],t))return r}return-1},qs.sortedLastIndex=function(e,t){return nn(e,t,!0)},qs.sortedLastIndexBy=function(e,t,s){return an(e,t,la(s,2),!0)},qs.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var s=nn(e,t,!0)-1;if(Ui(e[s],t))return s}return-1},qs.startCase=Qo,qs.startsWith=function(e,t,s){return e=jo(e),s=null==s?0:ir(xo(s),0,e.length),t=cn(t),e.slice(s,s+t.length)==t},qs.subtract=El,qs.sum=function(e){return e&&e.length?Ht(e,il):0},qs.sumBy=function(e,t){return e&&e.length?Ht(e,la(t,2)):0},qs.template=function(t,s,r){var n=qs.templateSettings;r&&ba(t,s,r)&&(s=e),t=jo(t),s=_o({},s,n,Xn);var a,i,o=_o({},s.imports,n.imports,Xn),l=Do(o),c=Qt(o,l),d=0,u=s.interpolate||ve,m="__p += '",h=Re((s.escape||ve).source+"|"+u.source+"|"+(u===Y?de:ve).source+"|"+(s.evaluate||ve).source+"|$","g"),p="//# sourceURL="+(Oe.call(s,"sourceURL")?(s.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";t.replace(h,function(e,s,r,n,o,l){return r||(r=n),m+=t.slice(d,l).replace(be,rs),s&&(a=!0,m+="' +\n__e("+s+") +\n'"),o&&(i=!0,m+="';\n"+o+";\n__p += '"),r&&(m+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),d=l+e.length,e}),m+="';\n";var f=Oe.call(s,"variable")&&s.variable;if(f){if(le.test(f))throw new _e("Invalid `variable` option passed into `_.template`")}else m="with (obj) {\n"+m+"\n}\n";m=(i?m.replace(z,""):m).replace(U,"$1").replace(F,"$1;"),m="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var g=tl(function(){return ke(l,p+"return "+m).apply(e,c)});if(g.source=m,Xi(g))throw g;return g},qs.times=function(e,t){if((e=xo(e))<1||e>d)return[];var s=m,r=vs(e,m);t=la(t),e-=m;for(var n=Gt(r,t);++s<e;)t(s);return n},qs.toFinite=go,qs.toInteger=xo,qs.toLength=vo,qs.toLower=function(e){return jo(e).toLowerCase()},qs.toNumber=bo,qs.toSafeInteger=function(e){return e?ir(xo(e),-9007199254740991,d):0===e?e:0},qs.toString=jo,qs.toUpper=function(e){return jo(e).toUpperCase()},qs.trim=function(t,s,r){if((t=jo(t))&&(r||s===e))return Kt(t);if(!t||!(s=cn(s)))return t;var n=ds(t),a=ds(s);return jn(n,Jt(n,a),es(n,a)+1).join("")},qs.trimEnd=function(t,s,r){if((t=jo(t))&&(r||s===e))return t.slice(0,us(t)+1);if(!t||!(s=cn(s)))return t;var n=ds(t);return jn(n,0,es(n,ds(s))+1).join("")},qs.trimStart=function(t,s,r){if((t=jo(t))&&(r||s===e))return t.replace(se,"");if(!t||!(s=cn(s)))return t;var n=ds(t);return jn(n,Jt(n,ds(s))).join("")},qs.truncate=function(t,s){var r=30,n="...";if(so(s)){var a="separator"in s?s.separator:a;r="length"in s?xo(s.length):r,n="omission"in s?cn(s.omission):n}var i=(t=jo(t)).length;if(ns(t)){var o=ds(t);i=o.length}if(r>=i)return t;var l=r-cs(n);if(l<1)return n;var c=o?jn(o,0,l).join(""):t.slice(0,l);if(a===e)return c+n;if(o&&(l+=c.length-l),oo(a)){if(t.slice(l).search(a)){var d,u=c;for(a.global||(a=Re(a.source,jo(ue.exec(a))+"g")),a.lastIndex=0;d=a.exec(u);)var m=d.index;c=c.slice(0,m===e?l:m)}}else if(t.indexOf(cn(a),l)!=l){var h=c.lastIndexOf(a);h>-1&&(c=c.slice(0,h))}return c+n},qs.unescape=function(e){return(e=jo(e))&&Z.test(e)?e.replace($,ms):e},qs.uniqueId=function(e){var t=++Me;return jo(e)+t},qs.upperCase=Xo,qs.upperFirst=Jo,qs.each=yi,qs.eachRight=ji,qs.first=Ga,dl(qs,(yl={},br(qs,function(e,t){Oe.call(qs.prototype,t)||(yl[t]=e)}),yl),{chain:!1}),qs.VERSION="4.17.21",kt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){qs[e].placeholder=qs}),kt(["drop","take"],function(t,s){Fs.prototype[t]=function(r){r=r===e?1:xs(xo(r),0);var n=this.__filtered__&&!s?new Fs(this):this.clone();return n.__filtered__?n.__takeCount__=vs(r,n.__takeCount__):n.__views__.push({size:vs(r,m),type:t+(n.__dir__<0?"Right":"")}),n},Fs.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),kt(["filter","map","takeWhile"],function(e,t){var s=t+1,r=1==s||3==s;Fs.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:la(e,3),type:s}),t.__filtered__=t.__filtered__||r,t}}),kt(["head","last"],function(e,t){var s="take"+(t?"Right":"");Fs.prototype[e]=function(){return this[s](1).value()[0]}}),kt(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Fs.prototype[e]=function(){return this.__filtered__?new Fs(this):this[s](1)}}),Fs.prototype.compact=function(){return this.filter(il)},Fs.prototype.find=function(e){return this.filter(e).head()},Fs.prototype.findLast=function(e){return this.reverse().find(e)},Fs.prototype.invokeMap=Kr(function(e,t){return"function"==typeof e?new Fs(this):this.map(function(s){return Cr(s,e,t)})}),Fs.prototype.reject=function(e){return this.filter(Mi(la(e)))},Fs.prototype.slice=function(t,s){t=xo(t);var r=this;return r.__filtered__&&(t>0||s<0)?new Fs(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),s!==e&&(r=(s=xo(s))<0?r.dropRight(-s):r.take(s-t)),r)},Fs.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Fs.prototype.toArray=function(){return this.take(m)},br(Fs.prototype,function(t,s){var r=/^(?:filter|find|map|reject)|While$/.test(s),n=/^(?:head|last)$/.test(s),a=qs[n?"take"+("last"==s?"Right":""):s],i=n||/^find/.test(s);a&&(qs.prototype[s]=function(){var s=this.__wrapped__,o=n?[1]:arguments,l=s instanceof Fs,c=o[0],d=l||Zi(s),u=function(e){var t=a.apply(qs,It([e],o));return n&&m?t[0]:t};d&&r&&"function"==typeof c&&1!=c.length&&(l=d=!1);var m=this.__chain__,h=!!this.__actions__.length,p=i&&!m,f=l&&!h;if(!i&&d){s=f?s:new Fs(this);var g=t.apply(s,o);return g.__actions__.push({func:fi,args:[u],thisArg:e}),new Us(g,m)}return p&&f?t.apply(this,o):(g=this.thru(u),p?n?g.value()[0]:g.value():g)})}),kt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Te[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);qs.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var n=this.value();return t.apply(Zi(n)?n:[],e)}return this[s](function(s){return t.apply(Zi(s)?s:[],e)})}}),br(Fs.prototype,function(e,t){var s=qs[t];if(s){var r=s.name+"";Oe.call(As,r)||(As[r]=[]),As[r].push({name:t,func:s})}}),As[Bn(e,2).name]=[{name:"wrapper",func:e}],Fs.prototype.clone=function(){var e=new Fs(this.__wrapped__);return e.__actions__=Cn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Cn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Cn(this.__views__),e},Fs.prototype.reverse=function(){if(this.__filtered__){var e=new Fs(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Fs.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,s=Zi(e),r=t<0,n=s?e.length:0,a=function(e,t,s){for(var r=-1,n=s.length;++r<n;){var a=s[r],i=a.size;switch(a.type){case"drop":e+=i;break;case"dropRight":t-=i;break;case"take":t=vs(t,e+i);break;case"takeRight":e=xs(e,t-i)}}return{start:e,end:t}}(0,n,this.__views__),i=a.start,o=a.end,l=o-i,c=r?o:i-1,d=this.__iteratees__,u=d.length,m=0,h=vs(l,this.__takeCount__);if(!s||!r&&n==l&&h==l)return pn(e,this.__actions__);var p=[];e:for(;l--&&m<h;){for(var f=-1,g=e[c+=t];++f<u;){var x=d[f],v=x.iteratee,b=x.type,y=v(g);if(2==b)g=y;else if(!y){if(1==b)continue e;break e}}p[m++]=g}return p},qs.prototype.at=gi,qs.prototype.chain=function(){return pi(this)},qs.prototype.commit=function(){return new Us(this.value(),this.__chain__)},qs.prototype.next=function(){this.__values__===e&&(this.__values__=fo(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},qs.prototype.plant=function(t){for(var s,r=this;r instanceof zs;){var n=za(r);n.__index__=0,n.__values__=e,s?a.__wrapped__=n:s=n;var a=n;r=r.__wrapped__}return a.__wrapped__=t,s},qs.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Fs){var s=t;return this.__actions__.length&&(s=new Fs(this)),(s=s.reverse()).__actions__.push({func:fi,args:[si],thisArg:e}),new Us(s,this.__chain__)}return this.thru(si)},qs.prototype.toJSON=qs.prototype.valueOf=qs.prototype.value=function(){return pn(this.__wrapped__,this.__actions__)},qs.prototype.first=qs.prototype.head,it&&(qs.prototype[it]=function(){return this}),qs}();ht?((ht.exports=hs)._=hs,mt._=hs):ut._=hs}.call(St);var Qb=Yb.exports;const Xb=({book:e,userId:t,originalHandleQuizComplete:r,onProgressUpdate:n})=>{const a=s.useRef(!0),{user:i}=kn(),o=_e(),[l,c]=s.useState([]),[d,u]=s.useState([]),[m,h]=s.useState(null),{forceRefresh:p}=Ax();s.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]);const f=s.useMemo(()=>Qb.debounce(()=>{a.current&&p()},500),[p]),g=function(e){const t=_e(),[r,n]=s.useState(!1),[a,i]=s.useState(!1),[o,l]=s.useState(!1);return s.useEffect(()=>{e&&(e.companion&&t.setQueryData(["companion",e.companion.user_id],e.companion),e.isFirstDay?n(!0):e.isFirstWeek?i(!0):e.isReturnAfterBreak&&l(!0))},[e,t]),{showBirthRitual:r,showWeekRitual:a,showReturnRitual:o,closeBirthRitual:()=>n(!1),closeWeekRitual:()=>i(!1),closeReturnRitual:()=>l(!1)}}(m);return{newBadges:l,setNewBadges:c,newQuests:d,setNewQuests:u,handleQuizComplete:async(s,l)=>{try{const m=await r(s,l);if(!a.current)return m;if(s&&t&&e?.id){f(),n&&n(e.id);try{const e=await async function(e,t){let s=await sx(e);s||(s=await rx(e));const r=s.total_reading_days,n=s.last_reading_date,a=s.current_streak,i={};let o=null;i.segments_this_week=s.segments_this_week+1;const l=new Date(t);l.setHours(0,0,0,0);const c=n?new Date(n):null;c&&c.setHours(0,0,0,0);const d=c&&l.getTime()===c.getTime();d||(o=c?Math.floor((l.getTime()-c.getTime())/864e5):null,null===o?(i.current_streak=1,i.total_reading_days=1):1===o?(i.current_streak=a+1,i.total_reading_days=r+1):o>=2&&(i.current_streak=1,i.total_reading_days=r+1),i.current_streak&&i.current_streak>s.longest_streak&&(i.longest_streak=i.current_streak),i.last_reading_date=l.toISOString().split("T")[0]),(i.total_reading_days??r)>=1&&(i.current_stage=2);const u=(new Date).getDay(),m=c?c.getDay():null;1===u&&1!==m&&(i.segments_this_week=1);const h=0===r&&!s.has_seen_birth_ritual,p=i.current_streak??a,f=!s.has_seen_week_ritual&&a<7&&p>=7,g=!s.has_seen_return_ritual&&null!==n&&!d&&null!==o&&o>=4;h&&(i.has_seen_birth_ritual=!0),f&&(i.has_seen_week_ritual=!0),g&&(i.has_seen_return_ritual=!0);const{data:x,error:v}=await en.from("user_companion").update(i).eq("user_id",e).select().single();if(v){const e=wn("updateCompanionProgress",v);throw new Error(e.userMessage)}return{isFirstDay:h,isFirstWeek:f,isReturnAfterBreak:g,companion:x}}(t,new Date);if(!a.current)return m;h(e),o.setQueryData(["companion",t],e.companion)}catch(d){}}if(!a.current)return m;if(m?.newBadges&&m.newBadges.length>0?(c(m.newBadges),t&&m.newBadges.some(e=>e.id&&e.id.includes("streak"))&&await tb(t,30)):c([]),!a.current)return m;if(m?.newQuests&&m.newQuests.length>0?(u(m.newQuests),m.newQuests.forEach(e=>{const t=e.quest?.title||e.quest_slug,s=e.quest?.xp_reward||100;mn.success(` Challenge Complt : ${t}`,{description:`+${s} XP  Exploit rare dbloqu !`,duration:8e3,className:"quest-toast-special bg-gradient-to-r from-amber-100 to-yellow-100 border-2 border-amber-400"})})):u([]),!a.current)return m;if(m?.bookyResult&&(h(m.bookyResult),"tanguy.warsmann@gmail.com"===i?.email&&m.bookyResult.companion)){const e=m.bookyResult.companion;mn.success(` [Booky debug] stage=${e.current_stage}, days=${e.total_reading_days}, streak=${e.current_streak}`,{duration:4e3})}return m}catch(d){mn.error("Erreur lors de la validation. Vos donnes seront rafrachies.");try{a.current&&f()}catch(m){}throw d}},...g}},Jb=(e,t)=>e?!!t||(mn.error("Information du livre manquante : Impossible de valider sans les informations du livre",{duration:3e3}),!1):(mn.error("Vous devez tre connect pour valider votre lecture : Connectez-vous pour enregistrer votre progression.",{duration:5e3}),!1);async function ey(e){if(!e)return null;try{const t=new Date,s=t.getFullYear(),r=t.getMonth()+1,n=`${s}-${r.toString().padStart(2,"0")}`,a=await async function(e,t){if(!e)return!1;const{data:s,error:r}=await en.from("user_monthly_rewards").select("id").eq("user_id",e).eq("month",t).maybeSingle();return!r&&!!s}(e,n);if(a)return null;const i=await async function(e,t,s){if(!e)return[];const r=new Date(t,s-1,1).toISOString(),n=new Date(t,s,0).toISOString(),{data:a,error:i}=await en.from("reading_validations").select("*").eq("user_id",e).gte("validated_at",r).lte("validated_at",n);return i?[]:a||[]}(e,s,r);if(i.length>=10){const t=function(e,t){const s=new Date(e,t-1,1).toLocaleString("fr-FR",{month:"long"}),r=t.toString().padStart(2,"0");return{id:`gift-${e}-${r}`,label:`Cadeau du mois : ${s} ${e}`,slug:`gift-${e}-${r}`,name:`Cadeau du mois : ${s} ${e}`,description:`Rcompense pour avoir valid plus de 10 segments en ${s} ${e}`,icon:"",color:"amber-100",rarity:"epic"}}(s,r),a=await async function(e,t,s){try{const{error:r}=await en.from("user_monthly_rewards").insert({user_id:e,badge_id:t,month:s});return!r}catch(r){return!1}}(e,t.id,n);if(a)return await Cv(e,t.id),t}return null}catch(t){return null}}function ty({badge:e,isOpen:t,onClose:n}){const a=s.useRef(null);return s.useEffect(()=>{if(t&&e){const e=5e3,t=Date.now()+e,s=(e,t)=>Math.random()*(t-e)+e,r=setInterval(()=>{if(t-Date.now()<=0)return clearInterval(r);Dn({particleCount:3,angle:s(60,120),spread:s(50,70),origin:{y:.6},colors:["#FFD700","#FFA500","#FF4500"]}),Dn({particleCount:2,angle:s(60,120),spread:s(50,70),origin:{y:.6},shapes:["star"],colors:["#FFD700","#FFA500"]})},250);return()=>clearInterval(r)}},[t,e]),e?r.jsx(nx,{open:t,onOpenChange:n,children:r.jsxs(lx,{className:"sm:max-w-md border-amber-300 animate-enter bg-gradient-to-b from-amber-50 to-white",children:[r.jsx("div",{ref:a,className:"absolute inset-0 pointer-events-none"}),r.jsxs(cx,{children:[r.jsx(ux,{className:"text-center text-h3 font-serif text-amber-800",children:" Cadeau Mystre du Mois "}),r.jsx(mx,{className:"text-center text-amber-700",children:"Bravo ! Tu as valid plus de 10 segments ce mois-ci !"})]}),r.jsxs("div",{className:"py-8 flex flex-col items-center space-y-8",children:[r.jsxs("div",{className:"relative animate-bounce duration-1000",children:[r.jsx("div",{className:"absolute inset-0 bg-amber-300 rounded-full opacity-20 animate-ping"}),r.jsx(ub,{badge:e,className:"scale-150 animate-scale-in relative z-10"})]}),r.jsx("p",{className:"text-center text-h4 text-amber-700 font-medium",children:e.label}),r.jsx("p",{className:"text-center text-body-sm text-amber-600",children:e.description}),r.jsx(qn,{onClick:n,className:"mt-4 bg-amber-500 hover:bg-amber-600 text-white px-8 py-6 text-h4",children:"Gnial, merci !"})]})]})}):null}function sy({monthlyReward:e,showMonthlyReward:t,onClose:s}){return r.jsx(ty,{badge:e,isOpen:t,onClose:s})}const ry=({book:e,userId:t,onProgressUpdate:r,currentBook:n,setCurrentBook:a,refreshProgressData:i,refreshReadingProgress:o,user:l,onChapterComplete:c})=>{const d=s.useRef(null),[u,m]=s.useState(!1),[h,p]=s.useState([]),[f,g]=s.useState(!1),[x,v]=s.useState([]),[b,y]=s.useState(null),j=s.useRef(null),w=s.useRef([]),{isValidating:N,setIsValidating:_,validationSegment:k,setValidationSegment:S,validationError:E,setValidationError:R,resetValidationState:C}=(()=>{const[e,t]=s.useState(!1),[r,n]=s.useState(null),[a,i]=s.useState(null);return{isValidating:e,setIsValidating:t,validationSegment:r,setValidationSegment:n,validationError:a,setValidationError:i,resetValidationState:()=>{i(null),n(null),t(!1)}}})();s.useEffect(()=>()=>{w.current.forEach(clearTimeout),w.current=[]},[]),s.useEffect(()=>{j.current=null},[t,e?.id,n?.id]);const A=()=>{try{w.current.forEach(clearTimeout),w.current=[],Dn({particleCount:200,spread:70,origin:{y:.6}});const e=setTimeout(()=>{Dn({particleCount:100,angle:60,spread:55,origin:{x:0}}),Dn({particleCount:100,angle:120,spread:55,origin:{x:1}})},250);w.current.push(e)}catch(e){}},{monthlyReward:T,showMonthlyReward:P,setShowMonthlyReward:I}=function(e){const[t,r]=s.useState(null),[n,a]=s.useState(!1);return s.useEffect(()=>{e&&ey(e).then(e=>{e&&(r(e),a(!0))})},[e]),{monthlyReward:t,showMonthlyReward:n,setShowMonthlyReward:a}}(t),{showQuiz:D,setShowQuiz:L,quizChapter:O,currentQuestion:M,showSuccessMessage:V,setShowSuccessMessage:q,prepareAndShowQuestion:B,handleQuizComplete:z,isLocked:U,remainingLockTime:F,handleLockExpire:$,isUsingJoker:W,jokersRemaining:Z}=Hb(e,t,r,N,_),{newBadges:H,setNewBadges:G,newQuests:K,setNewQuests:Y,handleQuizComplete:Q,showBirthRitual:X,showWeekRitual:J,showReturnRitual:ee,closeBirthRitual:te,closeWeekRitual:se,closeReturnRitual:re}=Xb({book:e,userId:t,originalHandleQuizComplete:z,onProgressUpdate:r}),ne=b||k,ae=s.useCallback(s=>{if(!t)return void mn.error("Vous devez tre connect pour commencer ou valider votre lecture");const r=(s?.chaptersRead||(n||e)?.chaptersRead||0)+1;y(r),S(r),d.current||(d.current=new Date)},[t,n,e,S]),ie=Vg(Bg(async s=>{if(s.preventDefault(),s.stopPropagation(),R(null),Jb(t,e)&&(!e||!(e=>e.chaptersRead>=e.totalChapters&&(mn.success("Vous avez dj termin ce livre ! : Votre progression a t entirement enregistre.",{duration:3e3}),!0))(e)))try{_(!0);const t=(e.chaptersRead||0)+1;y(t),S(t)}catch(r){const e=r instanceof Error?r.message:String(r);R(e),((e,t)=>{const s=e instanceof Error?e.message:String(e);mn.error(`Erreur lors ${t} : ${s.substring(0,100)}`,{duration:5e3})})(r,"de la prparation de la validation")}finally{_(!1)}},"useBookValidation.handleValidateReading")),oe=Vg(Bg(async()=>{if(!Jb(t,e))return;let s=ne;if(!s&&e&&(s=(e.chaptersRead||0)+1,y(s),S(s)),s)try{_(!0),await B(s)}catch(r){mn.error("Erreur de validation",{description:r.message||"Impossible de prparer la validation",duration:5e3})}finally{_(!1)}else mn.error("Impossible de dterminer le segment  valider",{duration:3e3})},"useBookValidation.handleValidationConfirm")),le=s.useCallback(async(s,r)=>{if(r&&s)return A(),{success:!0,newBadges:[]};s&&A();const a=await Q(s,!1);if(s&&a){if(t){a?.newBadges&&a.newBadges.length>0&&(p(a.newBadges),m(!0)),a?.newQuests&&a.newQuests.length>0&&(v(a.newQuests),g(!0));const s=n||e,r=s?.id;if(s?.isCompleted&&r&&j.current!==r){j.current=r;const e=localStorage.getItem(`completed_books_${t}`)?JSON.parse(localStorage.getItem(`completed_books_${t}`)||"[]"):[];e.some(e=>e.id===r)||(e.push(s),localStorage.setItem(`completed_books_${t}`,JSON.stringify(e))),setTimeout(()=>{mn.success("Livre termin !",{description:"Ton exploit est visible dans le flux",duration:5e3,icon:"",action:{label:"Voir le flux",onClick:()=>window.location.href="/discover"}})},2e3)}if(d.current){const e=new Date;(async(e,t,s)=>{try{if(Math.round((s.getTime()-t.getTime())/6e4)<1)return}catch(r){}})(0,d.current,e),d.current=null}try{await ey(t)&&setTimeout(()=>{I(!0)},1500)}catch(o){}}mn.success("Segment valid avec succs !")}return i&&await i(),a},[Q,A,i,t,a,n,e,m,p,I]),ce=s.useCallback(e=>le(e.correct,e.useJoker),[le]);return s.useMemo(()=>({isValidating:N,showQuiz:D,setShowQuiz:L,quizChapter:O,validationSegment:ne,setValidationSegment:y,currentQuestion:M,showSuccessMessage:V,setShowSuccessMessage:q,handleValidateReading:ie,prepareAndShowQuestion:B,handleQuizComplete:ce,handleValidationConfirm:oe,showConfetti:A,validationError:E,isLocked:U,remainingLockTime:F,handleLockExpire:$,newBadges:H,showBadgeDialog:u,setShowBadgeDialog:m,unlockedBadges:h,showQuestDialog:f,setShowQuestDialog:g,unlockedQuests:x,newQuests:K,monthlyReward:T,showMonthlyReward:P,setShowMonthlyReward:I,handleMainButtonClick:ae,sessionStartTimeRef:d,isUsingJoker:W,jokersRemaining:Z,showBirthRitual:X,showWeekRitual:J,showReturnRitual:ee,closeBirthRitual:te,closeWeekRitual:se,closeReturnRitual:re}),[N,D,L,O,ne,y,M,V,q,ie,B,ce,oe,A,E,U,F,$,H,u,h,f,x,K,T,P,ae,W,Z,X,J,ee,te,se,re])};function ny({isOpen:e,onClose:t}){return r.jsx(nx,{open:e,onOpenChange:t,children:r.jsxs(lx,{className:"sm:max-w-md",children:[r.jsx(cx,{children:r.jsx(ux,{className:"text-center text-2xl",children:"Booky vient de natre"})}),r.jsxs("div",{className:"flex flex-col items-center gap-6 py-6",children:[r.jsx(eh.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"text-8xl",children:""}),r.jsxs("div",{className:"text-center space-y-3 px-4",children:[r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"Chaque jour o tu lis, ton renard grandit."}),r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"Tu viens de dmarrer ton entranement de lecture."})]}),r.jsx(qn,{onClick:t,className:"w-full max-w-xs",children:"Continuer"})]})]})})}function ay({isOpen:e,onClose:t}){return r.jsx(nx,{open:e,onOpenChange:t,children:r.jsxs(lx,{className:"sm:max-w-md",children:[r.jsx(cx,{children:r.jsx(ux,{className:"text-center text-2xl",children:"Premire semaine d'entranement"})}),r.jsxs("div",{className:"flex flex-col items-center gap-6 py-6",children:[r.jsx(eh.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"text-8xl",children:""}),r.jsxs("div",{className:"text-center space-y-3 px-4",children:[r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"Tu viens de tenir 7 jours de lecture conscutifs."}),r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"Ton renard te voit comme un vrai marathonien de la lecture."})]}),r.jsx(qn,{onClick:t,className:"w-full max-w-xs",children:"Continuer mon cycle"})]})]})})}function iy({isOpen:e,onClose:t}){return r.jsx(nx,{open:e,onOpenChange:t,children:r.jsxs(lx,{className:"sm:max-w-md",children:[r.jsx(cx,{children:r.jsx(ux,{className:"text-center text-2xl",children:"Tu es revenu"})}),r.jsxs("div",{className:"flex flex-col items-center gap-6 py-6",children:[r.jsx(eh.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"text-8xl",children:""}),r.jsxs("div",{className:"text-center space-y-3 px-4",children:[r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"C'est a, tre lecteur."}),r.jsx("p",{className:"text-foreground/80 leading-relaxed",children:"Faire des pauses, puis revenir."})]}),r.jsx(qn,{onClick:t,className:"w-full max-w-xs",children:"Reprendre mon entranement"})]})]})})}const oy=class e{constructor(){t(this,"metrics",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}trackRender(e){}trackApiCall(e){}trackError(e,t){const s=this.metrics.get(e)||{renderCount:0,lastRenderTime:Date.now(),apiCallCount:0,errorCount:0};s.errorCount++,this.metrics.set(e,s)}getReport(){let e=" RAPPORT DE PERFORMANCE\n\n";return this.metrics.forEach((t,s)=>{e+=`${s}:\n`,e+=`  - Rendus: ${t.renderCount}\n`,e+=`  - API Calls: ${t.apiCallCount}\n`,e+=`  - Erreurs: ${t.errorCount}\n\n`}),e}logReport(){}};t(oy,"instance");let ly=oy;const cy=s.memo(({children:e})=>r.jsx(r.Fragment,{children:e}),(e,t)=>e.deps&&t.deps?e.deps.every((e,s)=>e===t.deps[s]):e.children===t.children);function dy({validations:e}){return e?.length?r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"text-h4 font-medium text-coffee-darker flex items-center",children:[r.jsx(Ve,{className:"mr-2 h-5 w-5"}),"Historique de mes validations"]})}),r.jsx(Ox,{children:r.jsx("div",{className:"space-y-3",children:e.slice().reverse().map((e,t)=>r.jsxs("div",{className:"flex gap-3 pb-3 border-b border-coffee-lightest last:border-b-0",children:[r.jsx("div",{className:"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-coffee-lightest text-coffee-dark",children:e.used_joker?r.jsx(De,{className:"h-4 w-4"}):r.jsx(ft,{className:"h-4 w-4"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("p",{className:"font-medium text-body-sm text-coffee-darker",children:["Validation du segment ",e.segment," (pages ",30*(e.segment-1)+1,"-",30*e.segment,")"]}),e.used_joker&&r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-caption bg-amber-100 text-amber-700 rounded-full",children:[r.jsx(De,{className:"h-3 w-3"}),"Joker utilis"]})]}),r.jsx("p",{className:"text-caption text-muted-foreground",children:new Date(e.validated_at||e.date_validated).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]},t))})})]}):null}cy.displayName="MemoizedComponent";const uy=({book:e,onChapterComplete:t})=>{const{trackRender:n,trackApiCall:a,trackError:i}=(e=>{const t=ly.getInstance();return{trackRender:()=>t.trackRender(e),trackApiCall:()=>t.trackApiCall(e),trackError:s=>t.trackError(e,s)}})("BookDetail"),{currentBook:o,setCurrentBook:l,progressPercent:c,readingProgress:d,progressRef:u,refreshReadingProgress:m,refreshProgressData:h,user:p}=function(e){const[t,r]=s.useState(e),[n,a]=s.useState(0),[i,o]=s.useState(null),[l,c]=s.useState(null),[d,u]=s.useState(!1),m=s.useRef(null),{user:h}=kn(),{refetch:p}=Ax(),f=s.useRef(null),g=s.useRef(!0),x=t?.id||t?.slug||"";s.useEffect(()=>(g.current=!0,()=>{g.current=!1,f.current&&clearTimeout(f.current)}),[]);const v=s.useCallback(async()=>{if(h?.id&&x)try{c(null),u(!0),f.current&&clearTimeout(f.current);const e=await kx(h.id,x);if(!g.current)return;if(e){o(e);const t=e.chaptersRead||0;r(s=>({...s,chaptersRead:t,progressPercent:e.progressPercent,currentSegment:e.currentSegment})),a(e.progressPercent||0),setTimeout(()=>{m.current&&(m.current.style.transform="translateZ(0)")},0)}}catch(e){if(!g.current)return;const t=wn("useBookDetailProgress",e);c(t.userMessage),t.isAuthExpired||mn.error(t.userMessage)}finally{g.current&&u(!1)}},[h?.id,x]);return s.useEffect(()=>{(async()=>{h?.id&&x&&await v()})()},[h?.id,x,v]),s.useEffect(()=>{i&&a(i.progressPercent||0)},[i]),{currentBook:t,setCurrentBook:r,progressPercent:n,setProgressPercent:a,readingProgress:i,setReadingProgress:o,progressRef:m,refreshReadingProgress:p,refreshProgressData:v,user:h,error:l,isRetrying:d,retry:v}}(e),{isValidating:f,showQuiz:g,setShowQuiz:x,validationSegment:v,setValidationSegment:b,currentQuestion:y,showSuccessMessage:j,setShowSuccessMessage:w,prepareAndShowQuestion:N,handleQuizComplete:_,handleValidationConfirm:k,showConfetti:S,isLocked:E,remainingLockTime:R,handleLockExpire:C,showBadgeDialog:A,setShowBadgeDialog:T,unlockedBadges:P,showQuestDialog:I,setShowQuestDialog:D,unlockedQuests:L,monthlyReward:O,showMonthlyReward:M,setShowMonthlyReward:V,handleMainButtonClick:q,sessionStartTimeRef:B,isUsingJoker:z,jokersRemaining:U,showBirthRitual:F,showWeekRitual:$,showReturnRitual:W,closeBirthRitual:Z,closeWeekRitual:H,closeReturnRitual:G}=ry({book:o,userId:p?.id||null,currentBook:o,setCurrentBook:l,refreshProgressData:h,refreshReadingProgress:m,user:p,onChapterComplete:t}),[K,Y]=s.useState(!1),[Q,X]=s.useState([]),J=lb(o),ee=function(e){const t=Number(e??0);return!Number.isFinite(t)||t<3?0:Math.floor(t/10)+1}(J),{jokersAllowed:te,jokersUsed:se}=Xv({bookId:o?.id||null,userId:p?.id||null,expectedSegments:J}),re=ee,ne=s.useMemo(()=>{const e=d?.chaptersRead||o.chaptersRead||0,t=d?.totalSegments||o.totalChapters||o.expectedSegments||o.total_chapters||1,s=e>=t;return{chaptersRead:e,totalChapters:t,isBookCompleted:s,showValidationButton:!s}},[d?.chaptersRead,d?.totalSegments,o.chaptersRead,o.totalChapters,o.expectedSegments,o.total_chapters]);s.useEffect(()=>{const e=p?.id,t=o?.id;if(!e||!t)return void X([]);let s=!1;return(async()=>{try{const r=await async function(e,t){try{const{data:s,error:r}=await en.from("reading_validations").select("*").eq("user_id",e).eq("book_id",t).order("segment",{ascending:!0});return r?[]:s||[]}catch(s){return[]}}(e,t);s||X(r)}catch(r){}})(),()=>{s=!0}},[o?.id,p?.id]);const ae=Vg(Bg(()=>{const e=(d?.chaptersRead||o?.chaptersRead||0)+1;if(e<=0)return i(new Error("Invalid segment calculated")),void mn.error("Impossible de dterminer le segment  valider");b(e),Y(!0),B.current||(B.current=new Date)},"BookDetail.handleOpenValidationModal")),ie=Vg(Bg(async()=>{if(!v){const e=(d?.chaptersRead||o?.chaptersRead||0)+1;if(!e||e<=0)return i(new Error("Unable to calculate valid segment")),void mn.error("Impossible de dterminer le segment  valider");b(e)}if(v<=(d?.chaptersRead||0)){Y(!1);try{await h()}catch(e){i(e)}}else Y(!1),k()},"BookDetail.handleModalValidationConfirm"));return n(),r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Mv,{title:o.title}),r.jsxs(Ox,{className:"space-y-4",children:[r.jsxs(cy,{deps:[o.id,o.title],children:[r.jsx(Vv,{book:o}),r.jsx(qv,{description:o.description})]}),ne.isBookCompleted?r.jsx(cy,{deps:[ne.isBookCompleted],children:r.jsx("div",{className:"bg-green-50 p-4 rounded-md border border-green-200 text-center",children:r.jsx("p",{className:"text-green-800 font-medium",children:"Flicitations ! Vous avez termin ce livre."})})}):ne.showValidationButton&&r.jsx(cy,{deps:[ne.chaptersRead,f],children:r.jsx(r.Fragment,{children:r.jsx(qn,{variant:"bookCta",disabled:f,onClick:ae,className:"w-full py-3 text-h4 font-serif my-4",children:r.jsx("span",{className:"!text-white",children:ne.chaptersRead>0?"Valider ma lecture":"Commencer ma lecture"})})})}),r.jsx(cy,{deps:[ne.chaptersRead,ne.totalChapters,c,se,re],children:r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"text-muted-foreground text-center",children:["Progression : ",ne.chaptersRead," / ",ne.totalChapters," segments valids."]}),r.jsx(Bv,{progressPercent:c,jokersUsed:se,jokersAllowed:re,ref:u})]})}),(K||g||j)&&r.jsx(cb,{book:o,showValidationModal:K,showQuizModal:g,showSuccessMessage:j,validationSegment:v,currentQuestion:y,isValidating:f,isLocked:E,remainingLockTime:R,jokersUsed:se,jokersAllowed:re,jokersRemaining:U,isUsingJoker:z,userId:p?.id,onValidationClose:()=>Y(!1),onValidationConfirm:ie,onQuizClose:()=>x(!1),onQuizComplete:_,onSuccessClose:()=>w(!1),onLockExpire:C}),A&&r.jsx(mb,{open:A,badges:P,setOpen:T}),I&&r.jsx(hb,{open:I,quests:L,setOpen:D}),M&&r.jsx(sy,{monthlyReward:O,showMonthlyReward:M,onClose:()=>V(!1)}),F&&r.jsx(ny,{isOpen:F,onClose:Z}),$&&r.jsx(ay,{isOpen:$,onClose:H}),W&&r.jsx(iy,{isOpen:W,onClose:G}),Q.length>0&&r.jsx(cy,{deps:[Q.length],children:r.jsx(dy,{validations:Q})})]})]})};const my=async e=>{const t=await(async e=>{if(!e)return[];const{data:t,error:s}=await en.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!0});return s?[]:t})(e);if(!t||t.length<3)return{has3DayStreak:!1,has5DayStreak:!1,has7DayStreak:!1};const s=new Set;t.forEach(e=>{const t=e.validated_at||e.date_validated||"";if(t){const e=new Date(t).toISOString().split("T")[0];s.add(e)}});const r=Array.from(s).sort();let n=1,a=1,i=r[0];for(let o=1;o<r.length;o++){const e=new Date(r[o]),t=new Date(r[o-1]),s=(e.getTime()-t.getTime())/864e5;1===s?(a++,i=r[o]):s>1&&(a>n&&(n=a),a=1,i=r[o])}return a>n&&(n=a),{has3DayStreak:n>=3,has5DayStreak:n>=5,has7DayStreak:n>=7,endDate:i,streakLength:n}};let hy=null;const py=async()=>{if(hy)return hy;try{const{data:e,error:t}=await en.from("quests").select("slug, title, description, icon, category, xp_reward").order("created_at",{ascending:!0});return t?[]:(hy=e||[],hy)}catch(e){return[]}},fy=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(e).toLocaleString("en-US",{timeZone:s,hour12:!1});return new Date(r).getHours()},gy=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(e).toLocaleString("en-US",{timeZone:s,weekday:"long",year:"numeric",month:"numeric",day:"numeric"});return new Date(r).getDay()},xy=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone;return new Date(e).toLocaleDateString("en-CA",{timeZone:s})};py().then(e=>{});const vy=async(e,t)=>{try{if(!e||!t)return null;const{data:s,error:r}=await en.from("user_quests").select("*").eq("user_id",e).eq("quest_slug",t).maybeSingle();if(r&&"PGRST116"!==r.code)return null;if(s)return null;const{data:n,error:a}=await en.from("user_quests").insert({user_id:e,quest_slug:t,unlocked_at:(new Date).toISOString()}).select().single();if(a)return null;const i=(await py()).find(e=>e.slug===t),o=i?.xp_reward||100;await tb(e,o);return{...n,quest:i}}catch(s){s instanceof Error&&s.message;return null}},by=async(e,t)=>{try{if(!e||!t)return null;const s=await Nx(e),{data:r}=await en.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!1});if(!r)return null;const n=s.filter(e=>"completed"===e.status),{data:a}=await en.rpc("get_user_streaks",{user_id:e}),i=a?.current||0;switch(t){case"marathon_reader":{const e=xy((new Date).toISOString()),t=r.filter(t=>xy(t.validated_at)===e).length;return{current:Math.min(t,10),target:10}}case"night_marathon":{const e=r.filter(e=>{const t=fy(e.validated_at);return t>=22||t<6}).length;return{current:Math.min(e,5),target:5}}case"binge_reading":{if(n.length<3)return{current:n.length,target:3};const e=[...n].sort((e,t)=>new Date(e.updated_at).getTime()-new Date(t.updated_at).getTime());let t=0;for(let s=0;s<=e.length-3;s++){const r=new Date(e[s].updated_at),n=new Date(e[s+2].updated_at);if(Math.floor((n.getTime()-r.getTime())/864e5)<=7){t=3;break}}return{current:t||n.length,target:3}}case"unstoppable":case"perfect_month":return{current:Math.min(i,30),target:30};default:return null}}catch(s){return null}};async function yy(e,t,s,r,n,a,i){await vx(a),Zb(e=>"string"==typeof e&&e.includes(`reading-progress-${a}`),void 0,{revalidate:!0}),Zb(e=>"string"==typeof e&&e.includes(`book-progress-${n}`),void 0,{revalidate:!0}),Zb(e=>"string"==typeof e&&e.includes(`jokers-info-${n}`),void 0,{revalidate:!0}),Zb(()=>kx(a,n),void 0,{revalidate:!0}),await tb(a,10);const o=await(async(e,t=!1)=>{if(!e)return[];try{const s=[],r=await my(e);if(r.has7DayStreak&&r.endDate){const r="serie-7-jours";if(!(await Rv(e,r))&&(await Cv(e,r),t)){const e=Ev.find(e=>e.id===r);e&&s.push({...e,dateEarned:(new Date).toLocaleDateString("fr-FR")})}}else r.has5DayStreak&&r.endDate||r.has3DayStreak&&r.endDate;return s}catch(s){return[]}})(a,!0);let l=[];try{l=await(async e=>{const t=[];try{if(!e)return[];const s=await py(),r=await Nx(e),{data:n,error:a}=await en.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!1});if(a)return;const i=r.filter(e=>"completed"===e.status),{data:o}=await en.rpc("get_user_streaks",{user_id:e}),l=o?.current||0,c=o?.best||0;for(const d of s){let s=!1;switch(d.slug){case"marathon_reader":if(n&&n.length>=10){const e={};n.forEach(t=>{const s=xy(t.validated_at);e[s]=(e[s]||0)+1}),s=Object.values(e).some(e=>e>=10)}break;case"binge_reading":if(i.length>=3){const e=[...i].sort((e,t)=>new Date(e.updated_at).getTime()-new Date(t.updated_at).getTime());for(let t=0;t<=e.length-3;t++){const r=new Date(e[t].updated_at),n=new Date(e[t+2].updated_at);if(Math.floor((n.getTime()-r.getTime())/864e5)<=7){s=!0;break}}}break;case"night_marathon":n&&n.length>=5&&(s=n.filter(e=>{const t=fy(e.validated_at);return t>=22||t<6}).length>=5);break;case"lightning_reader":s=i.some(e=>{if(!e.started_at||!e.total_pages||e.total_pages<300)return!1;const t=new Date(e.started_at),s=new Date(e.updated_at);return Math.floor((s.getTime()-t.getTime())/864e5)<3});break;case"speed_demon":s=i.some(e=>{if(!e.started_at)return!1;const t=new Date(e.started_at);return(new Date(e.updated_at).getTime()-t.getTime())/36e5<24});break;case"sprinter":s=r.some(e=>e.current_page&&e.current_page>=50);break;case"explorer":if(i.length>=3){const e=new Date((new Date).getTime()-2592e6);s=i.filter(t=>new Date(t.updated_at)>=e).length>=3}break;case"completionist":s=i.length>=3;break;case"unstoppable":case"perfect_month":s=l>=30||c>=30;break;case"punctual":if(n&&n.length>=7){const e=n.slice(0,7).map(e=>fy(e.validated_at)),t=Math.min(...e);s=Math.max(...e)-t<=2}break;case"early_bird":n&&n.length>0&&(s=n.some(e=>fy(e.validated_at)<7));break;case"night_owl":n&&n.length>0&&(s=n.some(e=>fy(e.validated_at)>=23));break;case"weekend_warrior":n&&n.length>=2&&(s=n.some(e=>{if(6!==gy(e.validated_at))return!1;const t=xy(e.validated_at),s=new Date(new Date(t+"T00:00:00"));s.setDate(s.getDate()+1);const r=s.toISOString().split("T")[0];return n.some(e=>xy(e.validated_at)===r&&0===gy(e.validated_at))}))}if(s){const s=await vy(e,d.slug);s&&t.push(s)}}}catch(s){}return t})(a)}catch(c){}return setTimeout(async()=>{try{await ey(a)}catch(e){}},0),{newBadges:o&&o.length>0?o:void 0,newQuests:l&&l.length>0?l:void 0,bookyResult:null}}const jy=async e=>{try{await async function(){const{data:e,error:t}=await en.auth.getSession();if(t)throw t;if(!e?.session)throw new Error(" Utilisateur non authentifi lors de la validation");return!0}(e.user_id);const{data:t,error:s}=await en.from("books_public").select("slug, total_pages").eq("id",e.book_id).maybeSingle();if(s||!t)throw new Error(" Impossible de rcuprer les informations du livre");const r=await Hv(t.slug||e.book_id,e.segment);if(!r?.id)throw new Error(" Question introuvable pour ce segment");const{data:n,error:a}=await en.rpc("force_validate_segment_beta",{p_book_id:e.book_id,p_question_id:r.id,p_answer:e.answer??"",p_user_id:e.user_id,p_used_joker:!!e.used_joker,p_correct:void 0===e.correct||!!e.correct});if(a)throw new Error(a.message||"chec validation (RPC)");const i=Array.isArray(n)?n[0]:n??{},o=i.progress_id??i.progressId??i.progress??i.data?.progress_id??void 0,l=i.action??i.data?.action??void 0;let c=0;if(o){const{data:e,error:t}=await en.from("reading_progress").select("current_page, status").eq("id",o).maybeSingle();!t&&e&&(c=e.current_page??0)}else{const{data:t,error:s}=await en.from("reading_progress").select("current_page, status").eq("user_id",e.user_id).eq("book_id",e.book_id).order("updated_at",{ascending:!1}).limit(1).maybeSingle();!s&&t&&(c=t.current_page??0)}let d="updated"===l;if(!d){const{data:t,error:s}=await en.from("reading_validations").select("id").eq("user_id",e.user_id).eq("book_id",e.book_id).eq("segment",e.segment).limit(1);s||(d=(t?.length??0)>0)}e.segment;const u=await yy(0,0,0,0,e.book_id,e.user_id).catch(e=>({newBadges:void 0,newQuests:void 0}));return{message:d?"Segment dj valid (idempotent)":"Segment valid avec succs",current_page:c,already_validated:d,next_segment_question:null,...u?.newBadges?{newBadges:u.newBadges}:{},...u?.newQuests?{newQuests:u.newQuests}:{}}}catch(t){const e=t instanceof Error?t.message:"Erreur inconnue";throw mn.error(`chec de la validation: ${e}`),new Error(e)}},wy=async(e,t)=>{try{const s=await kx(e,t),r=await yx(t);return r?s?{...r,chaptersRead:s.chaptersRead,progressPercent:s.progressPercent,nextSegmentPage:s.nextSegmentPage,isCompleted:s.progressPercent>=100}:(await(async(e,t)=>{if(!e||"string"!=typeof e)return null;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return null;const s={user_id:e,book_id:t.id,total_pages:t.pages,current_page:0,status:"to_read",started_at:(new Date).toISOString(),streak_current:0,streak_best:0};try{const{data:e,error:t}=await en.from("reading_progress").insert(s).select().single();return t?null:{...e,validations:[]}}catch(r){return null}})(e,r),{...r,chaptersRead:0,progressPercent:0,nextSegmentPage:30,isCompleted:!1}):null}catch(s){return null}};function Ny(){const{id:e}=gt(),[t,n]=s.useState(null),[a,i]=s.useState(!0),[o,l]=s.useState(null),c=H(),d=Et(),{user:u}=kn(),{t:m}=Tn(),h=s.useRef(!0),p=lb(t),f=function(e){const t=Number(e??0);return Number.isFinite(t)&&t>=3}(p);s.useEffect(()=>{},[t?.title,p,f]);const[g,x]=s.useState(null);s.useEffect(()=>{d.state?.accessDenied&&d.state?.message&&(x(d.state.message),window.history.replaceState({},document.title))},[d.state]),s.useEffect(()=>{h.current=!0;return(async()=>{if(!e)return l("Aucun identifiant de livre fourni"),void i(!1);try{i(!0),l(null);const s=await yx(e);if(!h.current)return;if(!s)return l(`Le livre avec l'identifiant "${e}" n'existe pas`),void i(!1);const r={...s,categories:s.categories||s.tags||[],tags:s.tags||s.categories||[]},a={...r,progressPercent:0,currentSegment:1,totalSegments:r.totalChapters||r.expectedSegments||r.total_chapters||1,nextSegmentPage:1,chaptersRead:0,expectedSegments:r.expectedSegments||r.total_chapters||1,book_id:r.id,current_page:0,started_at:(new Date).toISOString(),status:"to_read",streak_best:0,streak_current:0,total_pages:r.total_pages||r.pages||0,updated_at:(new Date).toISOString(),user_id:u?.id||""};if(n(a),u?.id)try{const t=await kx(u.id,e);if(!h.current)return;if(t){const e={...t,categories:t.categories||t.tags||[],tags:t.tags||t.categories||[]};n(e)}else{const t=await wy(u.id,e);if(!h.current)return;if(t){const e={...t,categories:t.categories||t.tags||[],tags:t.tags||t.categories||[],isCompleted:t.progressPercent>=100};n(e)}}}catch(t){}}catch(s){h.current&&(l("Erreur lors du chargement du livre"),mn.error("Erreur lors du chargement du livre"))}finally{h.current&&i(!1)}})(),()=>{h.current=!1}},[e,u?.id]);return r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("main",{className:"mx-auto w-full px-4 max-w-none py-6",children:a?r.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Chargement du livre..."})]})}):o?r.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:r.jsxs("div",{className:"text-center max-w-none",children:[r.jsx("h2",{className:"text-xl font-medium text-coffee-darker mb-2",children:"Erreur"}),r.jsx("p",{className:"text-muted-foreground mb-4",children:o}),r.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker underline",onClick:()=>c(-1),children:"Retourner  la page prcdente"})]})}):t?r.jsxs("div",{className:"space-y-6",children:[g&&r.jsx("div",{className:"max-w-4xl mx-auto",children:r.jsx("div",{className:"bg-coffee-lightest border border-coffee-light rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-orange-500",children:""}),r.jsx("p",{className:"text-coffee-dark font-medium",children:g})]})})}),r.jsx(uy,{book:t,onChapterComplete:async e=>{if(t&&u?.id)try{await jy({user_id:u.id,book_id:e,segment:t.currentSegment??0});const s=await kx(u.id,e);if(!h.current)return;if(s)n(s);else{const t=await wy(u.id,e);if(!h.current)return;t?n(t):mn.error("Impossible de mettre  jour le livre")}}catch(s){mn.error("Erreur lors de la validation : "+s.message)}else mn.error("Vous devez tre connect pour valider un chapitre")}}),t.progressPercent>=100&&r.jsx("div",{className:"max-w-4xl mx-auto",children:r.jsxs("div",{className:"bg-coffee-lightest/50 border border-coffee-light rounded-lg p-6 text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[r.jsx("span",{className:"text-2xl",children:""}),r.jsx("h3",{className:"text-xl font-semibold text-coffee-darker",children:"Flicitations ! Vous avez termin ce livre"})]}),r.jsxs("p",{className:"text-muted-foreground mb-4",children:["Rejoignez la discussion avec d'autres lecteurs qui ont galement termin \"",t.title,'"']}),r.jsxs(T,{to:`/finished-chat/${t.slug||e}`,className:"inline-flex items-center gap-2 bg-coffee-dark hover:bg-coffee-darker text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[r.jsx("span",{children:""}),"Accder au salon de discussion"]})]})})]}):r.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:r.jsxs("div",{className:"text-center max-w-none",children:[r.jsx("h2",{className:"text-xl font-medium text-coffee-darker mb-2",children:m.common.bookNotAvailable}),r.jsx("p",{className:"text-muted-foreground mb-4",children:m.common.bookNotAvailableDescription}),r.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker underline",onClick:()=>c("/explore"),children:m.common.discoverOtherBooks})]})})})]})})}function _y(e){let t=document.querySelector('link[rel="canonical"]');t||(t=document.createElement("link"),t.setAttribute("rel","canonical"),document.head.appendChild(t)),t.setAttribute("href",e)}function ky(e){if(e.startsWith("http"))return e;const{data:t}=en.storage.from("blog-images").getPublicUrl(e);return t.publicUrl}const Sy={async getPublishedPosts(e=50){const t=(new Date).toISOString(),{data:s,error:r}=await en.from("blog_posts").select("id,title,slug,content,excerpt,author,tags,published,created_at,updated_at,image_url,image_alt,published_at").eq("published",!0).or(`published_at.is.null,published_at.lte.${t}`).order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).order("id",{ascending:!1}).limit(e);if(r)throw r;return(s||[]).map(e=>({...e,imageUrl:e.image_url?ky(e.image_url):void 0,imageHero:e.image_url?ky(e.image_url):void 0,imageAlt:e.image_alt}))},async getPublishedPostsPage(e,t){const s=(e-1)*t,r=s+t-1,n=(new Date).toISOString(),{data:a,count:i,error:o}=await en.from("blog_posts").select("id,title,slug,excerpt,image_url,image_alt,published_at,author,tags",{count:"exact"}).eq("published",!0).or(`published_at.is.null,published_at.lte.${n}`).order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).order("id",{ascending:!1}).range(s,r);if(o)throw o;return{data:(a||[]).map(e=>({...e,imageUrl:e.image_url?ky(e.image_url):void 0,imageHero:e.image_url?ky(e.image_url):void 0,imageAlt:e.image_alt,content:"",created_at:e.published_at||"",updated_at:e.published_at||"",published:!0})),count:i??0}},async getAllPosts(){const{data:e,error:t}=await en.from("blog_posts").select("*").order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(e=>({...e,imageUrl:e.image_url?ky(e.image_url):void 0,imageHero:e.image_url?ky(e.image_url):void 0,imageAlt:e.image_alt}))},async getPostBySlug(e){const{data:t,error:s}=await en.from("blog_posts").select("*").eq("slug",e).eq("published",!0).maybeSingle();if(s)throw s;return t?{...t,imageUrl:t.image_url?ky(t.image_url):void 0,imageHero:t.image_url?ky(t.image_url):void 0,imageAlt:t.image_alt,reading_time:t.reading_time}:null},async createPost(e){const{imageUrl:t,imageAlt:s,published_at:r,...n}=e,{data:a,error:i}=await en.from("blog_posts").insert([{...n,image_url:t,image_alt:s,published_at:r,published:e.published??!0}]).select().single();if(i)throw i;return{...a,imageUrl:a.image_url,imageAlt:a.image_alt}},async updatePost(e){const{id:t,imageUrl:s,imageAlt:r,published_at:n,...a}=e,{data:i,error:o}=await en.from("blog_posts").update({...a,image_url:s,image_alt:r,published_at:n}).eq("id",t).select().single();if(o)throw o;return{...i,imageUrl:i.image_url,imageAlt:i.image_alt}},async deletePost(e){const{error:t}=await en.from("blog_posts").delete().eq("id",e);if(t)throw t},async uploadImage(e){const t=e.name.split(".").pop(),s=`${`${Date.now()}-${Math.random().toString(36).substring(2)}.${t}`}`,{error:r}=await en.storage.from("blog-images").upload(s,e);if(r)throw r;const{data:n}=en.storage.from("blog-images").getPublicUrl(s);return n.publicUrl},async deleteImage(e){if(!e)return;const t=e.split("/"),s=t[t.length-1],{error:r}=await en.storage.from("blog-images").remove([s]);if(r)throw r}};function Ey({posts:e}){return 0===e.length?r.jsx(Px,{className:"border-coffee-light",children:r.jsx(Ox,{className:"text-center py-12",children:r.jsx("p",{className:"text-coffee-dark",children:"Aucun article publi pour le moment."})})}):r.jsx("div",{className:"space-y-6",children:e.map(e=>r.jsxs(Px,{className:"border-coffee-light hover:shadow-lg transition-shadow",children:[e.imageUrl&&r.jsx("div",{className:"relative h-48 w-full overflow-hidden rounded-t-lg",children:r.jsx("img",{src:e.imageUrl,alt:e.imageAlt||e.title,className:"object-cover w-full h-full",loading:"lazy",width:640,height:360})}),r.jsxs(Ix,{children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:r.jsxs("div",{className:"flex-1",children:[r.jsx(Dx,{className:"text-xl font-serif text-coffee-darker mb-2",children:r.jsx(T,{to:`/blog/${e.slug}`,className:"hover:text-coffee-dark transition-colors",children:e.title})}),e.excerpt&&r.jsx(Lx,{className:"text-base text-coffee-dark",children:e.excerpt})]})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-coffee-dark mt-3",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ve,{className:"h-4 w-4"}),r.jsx("time",{dateTime:e.published_at,children:new Date(e.published_at||"").toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),e.author&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(P,{className:"h-4 w-4"}),r.jsx("span",{children:e.author})]})]}),e.tags&&e.tags.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:e.tags.map(e=>r.jsx(Dh,{variant:"secondary",className:"bg-coffee-light text-coffee-darker",children:e},e))})]})]},e.id))})}function Ry({currentPage:e,totalPages:t}){if(t<=1)return null;const s=e=>1===e?"/blog":`/blog/page/${e}`;return r.jsxs("nav",{className:"flex items-center justify-center space-x-2 mt-8","aria-label":"Pagination du blog",children:[e>1&&r.jsx(T,{to:s(e-1),children:r.jsxs(qn,{variant:"outline",size:"sm",className:"flex items-center gap-2","aria-label":"Page prcdente",children:[r.jsx(Rt,{className:"h-4 w-4"}),"Prcdente"]})}),r.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const n=[];let a=Math.max(1,e-Math.floor(2.5)),i=Math.min(t,a+5-1);i-a<4&&(a=Math.max(1,i-5+1)),a>1&&(n.push(r.jsx(T,{to:s(1),children:r.jsx(qn,{variant:1===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":1===e?"page":void 0,children:"1"})},1)),a>2&&n.push(r.jsx("span",{className:"px-2 text-coffee-dark",children:"..."},"ellipsis-start")));for(let t=a;t<=i;t++)n.push(r.jsx(T,{to:s(t),children:r.jsx(qn,{variant:t===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":t===e?"page":void 0,children:t})},t));return i<t&&(i<t-1&&n.push(r.jsx("span",{className:"px-2 text-coffee-dark",children:"..."},"ellipsis-end")),n.push(r.jsx(T,{to:s(t),children:r.jsx(qn,{variant:t===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":t===e?"page":void 0,children:t})},t))),n})()}),e<t&&r.jsx(T,{to:s(e+1),children:r.jsxs(qn,{variant:"outline",size:"sm",className:"flex items-center gap-2","aria-label":"Page suivante",children:["Suivante",r.jsx(h,{className:"h-4 w-4"})]})})]})}function Cy(){const e=gt(),t=Math.max(1,Number(e.page??1)||1),{posts:n,totalPages:a,total:i,isLoading:o,error:l}=((e,t=20)=>{const[r,n]=s.useState([]),[a,i]=s.useState(0),[o,l]=s.useState(!0),[c,d]=s.useState(null),u=Math.max(1,Math.ceil(a/t));return s.useEffect(()=>{(async()=>{try{l(!0),d(null);const{data:s,count:r}=await Sy.getPublishedPostsPage(e,t);n(s),i(r)}catch(s){d("Erreur lors du chargement des articles")}finally{l(!1)}})()},[e,t]),{posts:r,total:a,totalPages:u,isLoading:o,error:c}})(t,12);return s.useEffect(()=>{_y(1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`)},[t]),t>a&&i>0?r.jsx(Ct,{to:`/blog/page/${a}`,replace:!0}):o?r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:r.jsx("div",{className:"text-center text-white",children:"Chargement des articles..."})})}):l?r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:r.jsx("div",{className:"text-center text-white",children:l})})}):r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsx("title",{children:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),r.jsx("meta",{name:"description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),r.jsx("link",{rel:"canonical",href:1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`}),r.jsx("meta",{property:"og:type",content:"website"}),r.jsx("meta",{property:"og:title",content:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),r.jsx("meta",{property:"og:description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),r.jsx("meta",{property:"og:url",content:1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`}),r.jsx("meta",{name:"twitter:card",content:"summary"}),r.jsx("meta",{name:"twitter:title",content:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),r.jsx("meta",{name:"twitter:description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),t>1&&r.jsx("link",{rel:"prev",href:t-1==1?"https://www.vread.fr/blog":"https://www.vread.fr/blog/page/"+(t-1)}),t<a&&r.jsx("link",{rel:"next",href:`https://www.vread.fr/blog/page/${t+1}`}),r.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"ItemList",name:"Blog VREAD",description:"Tous nos articles VREAD: mthodes, lecture, SEO, nouveauts",url:"https://www.vread.fr/blog",publisher:{"@type":"Organization",name:"VREAD",url:"https://www.vread.fr"},itemListElement:n.map((e,t)=>({"@type":"ListItem",position:t+1,url:`https://www.vread.fr/blog/${e.slug}`}))})})]}),r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsxs("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:[r.jsx("div",{className:"mb-6",children:r.jsx(T,{to:"/",children:r.jsxs(qn,{variant:"ghost",className:"text-white hover:text-logo-accent",children:[r.jsx(z,{className:"h-4 w-4 mr-2"}),"Retour  l'accueil"]})})}),r.jsxs("header",{className:"text-center mb-12",children:[r.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-4",children:"Blog VREAD"}),r.jsx("p",{className:"text-lg text-white/90 max-w-none mx-auto",children:"Dcouvrez nos articles sur la lecture, les livres et la culture littraire"})]}),r.jsxs("div",{className:"max-w-none mx-auto",children:[r.jsx(Ey,{posts:n}),r.jsx(Ry,{currentPage:t,totalPages:a})]})]})})]})}
/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:Ay,setPrototypeOf:Ty,isFrozen:Py,getPrototypeOf:Iy,getOwnPropertyDescriptor:Dy}=Object;let{freeze:Ly,seal:Oy,create:My}=Object,{apply:Vy,construct:qy}="undefined"!=typeof Reflect&&Reflect;Ly||(Ly=function(e){return e}),Oy||(Oy=function(e){return e}),Vy||(Vy=function(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),n=2;n<s;n++)r[n-2]=arguments[n];return e.apply(t,r)}),qy||(qy=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return new e(...s)});const By=tj(Array.prototype.forEach),zy=tj(Array.prototype.lastIndexOf),Uy=tj(Array.prototype.pop),Fy=tj(Array.prototype.push),$y=tj(Array.prototype.splice),Wy=tj(String.prototype.toLowerCase),Zy=tj(String.prototype.toString),Hy=tj(String.prototype.match),Gy=tj(String.prototype.replace),Ky=tj(String.prototype.indexOf),Yy=tj(String.prototype.trim),Qy=tj(Object.prototype.hasOwnProperty),Xy=tj(RegExp.prototype.test),Jy=(ej=TypeError,function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return qy(ej,t)});var ej;function tj(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var s=arguments.length,r=new Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return Vy(e,t,r)}}function sj(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wy;Ty&&Ty(e,null);let r=t.length;for(;r--;){let n=t[r];if("string"==typeof n){const e=s(n);e!==n&&(Py(t)||(t[r]=e),n=e)}e[n]=!0}return e}function rj(e){for(let t=0;t<e.length;t++){Qy(e,t)||(e[t]=null)}return e}function nj(e){const t=My(null);for(const[s,r]of Ay(e)){Qy(e,s)&&(Array.isArray(r)?t[s]=rj(r):r&&"object"==typeof r&&r.constructor===Object?t[s]=nj(r):t[s]=r)}return t}function aj(e,t){for(;null!==e;){const s=Dy(e,t);if(s){if(s.get)return tj(s.get);if("function"==typeof s.value)return tj(s.value)}e=Iy(e)}return function(){return null}}const ij=Ly(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),oj=Ly(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),lj=Ly(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),cj=Ly(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),dj=Ly(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),uj=Ly(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),mj=Ly(["#text"]),hj=Ly(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),pj=Ly(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),fj=Ly(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),gj=Ly(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),xj=Oy(/\{\{[\w\W]*|[\w\W]*\}\}/gm),vj=Oy(/<%[\w\W]*|[\w\W]*%>/gm),bj=Oy(/\$\{[\w\W]*/gm),yj=Oy(/^data-[\-\w.\u00B7-\uFFFF]+$/),jj=Oy(/^aria-[\-\w]+$/),wj=Oy(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Nj=Oy(/^(?:\w+script|data):/i),_j=Oy(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),kj=Oy(/^html$/i),Sj=Oy(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ej=Object.freeze({__proto__:null,ARIA_ATTR:jj,ATTR_WHITESPACE:_j,CUSTOM_ELEMENT:Sj,DATA_ATTR:yj,DOCTYPE_NAME:kj,ERB_EXPR:vj,IS_ALLOWED_URI:wj,IS_SCRIPT_OR_DATA:Nj,MUSTACHE_EXPR:xj,TMPLIT_EXPR:bj});const Rj=1,Cj=3,Aj=7,Tj=8,Pj=9;var Ij=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const s=t=>e(t);if(s.version="3.3.0",s.removed=[],!t||!t.document||t.document.nodeType!==Pj||!t.Element)return s.isSupported=!1,s;let{document:r}=t;const n=r,a=n.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:m,DOMParser:h,trustedTypes:p}=t,f=c.prototype,g=aj(f,"cloneNode"),x=aj(f,"remove"),v=aj(f,"nextSibling"),b=aj(f,"childNodes"),y=aj(f,"parentNode");if("function"==typeof o){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let j,w="";const{implementation:N,createNodeIterator:_,createDocumentFragment:k,getElementsByTagName:S}=r,{importNode:E}=n;let R={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};s.isSupported="function"==typeof Ay&&"function"==typeof y&&N&&void 0!==N.createHTMLDocument;const{MUSTACHE_EXPR:C,ERB_EXPR:A,TMPLIT_EXPR:T,DATA_ATTR:P,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:D,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:O}=Ej;let{IS_ALLOWED_URI:M}=Ej,V=null;const q=sj({},[...ij,...oj,...lj,...dj,...mj]);let B=null;const z=sj({},[...hj,...pj,...fj,...gj]);let U=Object.seal(My(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),F=null,$=null;const W=Object.seal(My(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Z=!0,H=!0,G=!1,K=!0,Y=!1,Q=!0,X=!1,J=!1,ee=!1,te=!1,se=!1,re=!1,ne=!0,ae=!1,ie=!0,oe=!1,le={},ce=null;const de=sj({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const me=sj({},["audio","video","img","source","image","track"]);let he=null;const pe=sj({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",xe="http://www.w3.org/1999/xhtml";let ve=xe,be=!1,ye=null;const je=sj({},[fe,ge,xe],Zy);let we=sj({},["mi","mo","mn","ms","mtext"]),Ne=sj({},["annotation-xml"]);const _e=sj({},["title","style","font","a","script"]);let ke=null;const Se=["application/xhtml+xml","text/html"];let Ee=null,Re=null;const Ce=r.createElement("form"),Ae=function(e){return e instanceof RegExp||e instanceof Function},Te=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Re||Re!==e){if(e&&"object"==typeof e||(e={}),e=nj(e),ke=-1===Se.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ee="application/xhtml+xml"===ke?Zy:Wy,V=Qy(e,"ALLOWED_TAGS")?sj({},e.ALLOWED_TAGS,Ee):q,B=Qy(e,"ALLOWED_ATTR")?sj({},e.ALLOWED_ATTR,Ee):z,ye=Qy(e,"ALLOWED_NAMESPACES")?sj({},e.ALLOWED_NAMESPACES,Zy):je,he=Qy(e,"ADD_URI_SAFE_ATTR")?sj(nj(pe),e.ADD_URI_SAFE_ATTR,Ee):pe,ue=Qy(e,"ADD_DATA_URI_TAGS")?sj(nj(me),e.ADD_DATA_URI_TAGS,Ee):me,ce=Qy(e,"FORBID_CONTENTS")?sj({},e.FORBID_CONTENTS,Ee):de,F=Qy(e,"FORBID_TAGS")?sj({},e.FORBID_TAGS,Ee):nj({}),$=Qy(e,"FORBID_ATTR")?sj({},e.FORBID_ATTR,Ee):nj({}),le=!!Qy(e,"USE_PROFILES")&&e.USE_PROFILES,Z=!1!==e.ALLOW_ARIA_ATTR,H=!1!==e.ALLOW_DATA_ATTR,G=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Y=e.SAFE_FOR_TEMPLATES||!1,Q=!1!==e.SAFE_FOR_XML,X=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,se=e.RETURN_DOM_FRAGMENT||!1,re=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,ne=!1!==e.SANITIZE_DOM,ae=e.SANITIZE_NAMED_PROPS||!1,ie=!1!==e.KEEP_CONTENT,oe=e.IN_PLACE||!1,M=e.ALLOWED_URI_REGEXP||wj,ve=e.NAMESPACE||xe,we=e.MATHML_TEXT_INTEGRATION_POINTS||we,Ne=e.HTML_INTEGRATION_POINTS||Ne,U=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Ae(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ae(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(U.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Y&&(H=!1),se&&(te=!0),le&&(V=sj({},mj),B=[],!0===le.html&&(sj(V,ij),sj(B,hj)),!0===le.svg&&(sj(V,oj),sj(B,pj),sj(B,gj)),!0===le.svgFilters&&(sj(V,lj),sj(B,pj),sj(B,gj)),!0===le.mathMl&&(sj(V,dj),sj(B,fj),sj(B,gj))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?W.tagCheck=e.ADD_TAGS:(V===q&&(V=nj(V)),sj(V,e.ADD_TAGS,Ee))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?W.attributeCheck=e.ADD_ATTR:(B===z&&(B=nj(B)),sj(B,e.ADD_ATTR,Ee))),e.ADD_URI_SAFE_ATTR&&sj(he,e.ADD_URI_SAFE_ATTR,Ee),e.FORBID_CONTENTS&&(ce===de&&(ce=nj(ce)),sj(ce,e.FORBID_CONTENTS,Ee)),ie&&(V["#text"]=!0),X&&sj(V,["html","head","body"]),V.table&&(sj(V,["tbody"]),delete F.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Jy('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Jy('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');j=e.TRUSTED_TYPES_POLICY,w=j.createHTML("")}else void 0===j&&(j=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let s=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(s=t.getAttribute(r));const n="dompurify"+(s?"#"+s:"");try{return e.createPolicy(n,{createHTML:e=>e,createScriptURL:e=>e})}catch(a){return null}}(p,a)),null!==j&&"string"==typeof w&&(w=j.createHTML(""));Ly&&Ly(e),Re=e}},Pe=sj({},[...oj,...lj,...cj]),Ie=sj({},[...dj,...uj]),De=function(e){Fy(s.removed,{element:e});try{y(e).removeChild(e)}catch(t){x(e)}},Le=function(e,t){try{Fy(s.removed,{attribute:t.getAttributeNode(e),from:t})}catch(r){Fy(s.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||se)try{De(t)}catch(r){}else try{t.setAttribute(e,"")}catch(r){}},Oe=function(e){let t=null,s=null;if(ee)e="<remove></remove>"+e;else{const t=Hy(e,/^[\r\n\t ]+/);s=t&&t[0]}"application/xhtml+xml"===ke&&ve===xe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const n=j?j.createHTML(e):e;if(ve===xe)try{t=(new h).parseFromString(n,ke)}catch(i){}if(!t||!t.documentElement){t=N.createDocument(ve,"template",null);try{t.documentElement.innerHTML=be?w:n}catch(i){}}const a=t.body||t.documentElement;return e&&s&&a.insertBefore(r.createTextNode(s),a.childNodes[0]||null),ve===xe?S.call(t,X?"html":"body")[0]:X?t.documentElement:a},Me=function(e){return _.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Ve=function(e){return e instanceof m&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},qe=function(e){return"function"==typeof l&&e instanceof l};function Be(e,t,r){By(e,e=>{e.call(s,t,r,Re)})}const ze=function(e){let t=null;if(Be(R.beforeSanitizeElements,e,null),Ve(e))return De(e),!0;const r=Ee(e.nodeName);if(Be(R.uponSanitizeElement,e,{tagName:r,allowedTags:V}),Q&&e.hasChildNodes()&&!qe(e.firstElementChild)&&Xy(/<[/\w!]/g,e.innerHTML)&&Xy(/<[/\w!]/g,e.textContent))return De(e),!0;if(e.nodeType===Aj)return De(e),!0;if(Q&&e.nodeType===Tj&&Xy(/<[/\w]/g,e.data))return De(e),!0;if(!(W.tagCheck instanceof Function&&W.tagCheck(r))&&(!V[r]||F[r])){if(!F[r]&&Fe(r)){if(U.tagNameCheck instanceof RegExp&&Xy(U.tagNameCheck,r))return!1;if(U.tagNameCheck instanceof Function&&U.tagNameCheck(r))return!1}if(ie&&!ce[r]){const t=y(e)||e.parentNode,s=b(e)||e.childNodes;if(s&&t){for(let r=s.length-1;r>=0;--r){const n=g(s[r],!0);n.__removalCount=(e.__removalCount||0)+1,t.insertBefore(n,v(e))}}}return De(e),!0}return e instanceof c&&!function(e){let t=y(e);t&&t.tagName||(t={namespaceURI:ve,tagName:"template"});const s=Wy(e.tagName),r=Wy(t.tagName);return!!ye[e.namespaceURI]&&(e.namespaceURI===ge?t.namespaceURI===xe?"svg"===s:t.namespaceURI===fe?"svg"===s&&("annotation-xml"===r||we[r]):Boolean(Pe[s]):e.namespaceURI===fe?t.namespaceURI===xe?"math"===s:t.namespaceURI===ge?"math"===s&&Ne[r]:Boolean(Ie[s]):e.namespaceURI===xe?!(t.namespaceURI===ge&&!Ne[r])&&!(t.namespaceURI===fe&&!we[r])&&!Ie[s]&&(_e[s]||!Pe[s]):!("application/xhtml+xml"!==ke||!ye[e.namespaceURI]))}(e)?(De(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!Xy(/<\/no(script|embed|frames)/i,e.innerHTML)?(Y&&e.nodeType===Cj&&(t=e.textContent,By([C,A,T],e=>{t=Gy(t,e," ")}),e.textContent!==t&&(Fy(s.removed,{element:e.cloneNode()}),e.textContent=t)),Be(R.afterSanitizeElements,e,null),!1):(De(e),!0)},Ue=function(e,t,s){if(ne&&("id"===t||"name"===t)&&(s in r||s in Ce))return!1;if(H&&!$[t]&&Xy(P,t));else if(Z&&Xy(I,t));else if(W.attributeCheck instanceof Function&&W.attributeCheck(t,e));else if(!B[t]||$[t]){if(!(Fe(e)&&(U.tagNameCheck instanceof RegExp&&Xy(U.tagNameCheck,e)||U.tagNameCheck instanceof Function&&U.tagNameCheck(e))&&(U.attributeNameCheck instanceof RegExp&&Xy(U.attributeNameCheck,t)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(t,e))||"is"===t&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&Xy(U.tagNameCheck,s)||U.tagNameCheck instanceof Function&&U.tagNameCheck(s))))return!1}else if(he[t]);else if(Xy(M,Gy(s,L,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Ky(s,"data:")||!ue[e]){if(G&&!Xy(D,Gy(s,L,"")));else if(s)return!1}else;return!0},Fe=function(e){return"annotation-xml"!==e&&Hy(e,O)},$e=function(e){Be(R.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Ve(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:B,forceKeepAttr:void 0};let n=t.length;for(;n--;){const i=t[n],{name:o,namespaceURI:l,value:c}=i,d=Ee(o),u=c;let m="value"===o?u:Yy(u);if(r.attrName=d,r.attrValue=m,r.keepAttr=!0,r.forceKeepAttr=void 0,Be(R.uponSanitizeAttribute,e,r),m=r.attrValue,!ae||"id"!==d&&"name"!==d||(Le(o,e),m="user-content-"+m),Q&&Xy(/((--!?|])>)|<\/(style|title|textarea)/i,m)){Le(o,e);continue}if("attributename"===d&&Hy(m,"href")){Le(o,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){Le(o,e);continue}if(!K&&Xy(/\/>/i,m)){Le(o,e);continue}Y&&By([C,A,T],e=>{m=Gy(m,e," ")});const h=Ee(e.nodeName);if(Ue(h,d,m)){if(j&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(l);else switch(p.getAttributeType(h,d)){case"TrustedHTML":m=j.createHTML(m);break;case"TrustedScriptURL":m=j.createScriptURL(m)}if(m!==u)try{l?e.setAttributeNS(l,o,m):e.setAttribute(o,m),Ve(e)?De(e):Uy(s.removed)}catch(a){Le(o,e)}}else Le(o,e)}Be(R.afterSanitizeAttributes,e,null)},We=function e(t){let s=null;const r=Me(t);for(Be(R.beforeSanitizeShadowDOM,t,null);s=r.nextNode();)Be(R.uponSanitizeShadowNode,s,null),ze(s),$e(s),s.content instanceof i&&e(s.content);Be(R.afterSanitizeShadowDOM,t,null)};return s.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,a=null,o=null,c=null;if(be=!e,be&&(e="\x3c!--\x3e"),"string"!=typeof e&&!qe(e)){if("function"!=typeof e.toString)throw Jy("toString is not a function");if("string"!=typeof(e=e.toString()))throw Jy("dirty is not a string, aborting")}if(!s.isSupported)return e;if(J||Te(t),s.removed=[],"string"==typeof e&&(oe=!1),oe){if(e.nodeName){const t=Ee(e.nodeName);if(!V[t]||F[t])throw Jy("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)r=Oe("\x3c!----\x3e"),a=r.ownerDocument.importNode(e,!0),a.nodeType===Rj&&"BODY"===a.nodeName||"HTML"===a.nodeName?r=a:r.appendChild(a);else{if(!te&&!Y&&!X&&-1===e.indexOf("<"))return j&&re?j.createHTML(e):e;if(r=Oe(e),!r)return te?null:re?w:""}r&&ee&&De(r.firstChild);const d=Me(oe?e:r);for(;o=d.nextNode();)ze(o),$e(o),o.content instanceof i&&We(o.content);if(oe)return e;if(te){if(se)for(c=k.call(r.ownerDocument);r.firstChild;)c.appendChild(r.firstChild);else c=r;return(B.shadowroot||B.shadowrootmode)&&(c=E.call(n,c,!0)),c}let u=X?r.outerHTML:r.innerHTML;return X&&V["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&Xy(kj,r.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+u),Y&&By([C,A,T],e=>{u=Gy(u,e," ")}),j&&re?j.createHTML(u):u},s.setConfig=function(){Te(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),J=!0},s.clearConfig=function(){Re=null,J=!1},s.isValidAttribute=function(e,t,s){Re||Te({});const r=Ee(e),n=Ee(t);return Ue(r,n,s)},s.addHook=function(e,t){"function"==typeof t&&Fy(R[e],t)},s.removeHook=function(e,t){if(void 0!==t){const s=zy(R[e],t);return-1===s?void 0:$y(R[e],s,1)[0]}return Uy(R[e])},s.removeHooks=function(e){R[e]=[]},s.removeAllHooks=function(){R={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},s}();const Dj=(...e)=>{"undefined"!=typeof window&&window.gtag&&window.gtag(...e)},Lj=(e,t)=>{Dj("event","share",{content_type:"article",item_id:e,method:t})};function Oj(){const{slug:e}=gt(),[t,n]=s.useState(null),[a,i]=s.useState([]),[o,l]=s.useState(!0),[c,d]=s.useState(null);if(s.useEffect(()=>{_y(window.location.href.replace("http://","https://"));(async()=>{if(!e)return d("Article non trouv"),void l(!1);try{const t=await Sy.getPostBySlug(e);t?(n(t),d(null)):d("Article non trouv")}catch(t){d("Erreur lors du chargement de l'article")}finally{l(!1)}})()},[e]),s.useEffect(()=>{(async()=>{if(t?.tags&&0!==t.tags.length)try{const{data:e}=await en.from("blog_posts").select("id, title, slug, excerpt, image_url, image_alt, tags, published_at").contains("tags",t.tags).neq("id",t.id).eq("published",!0).limit(3);e&&i(e.map(e=>({...e,content:"",created_at:e.published_at||"",updated_at:e.published_at||"",published:!0,imageHero:e.image_url,imageAlt:e.image_alt})))}catch(e){}})()},[t]),s.useEffect(()=>{var e,s;t&&(e=t.title,s=`/blog/${t.slug}`,Dj("event","page_view",{page_title:e,page_location:window.location.href,page_path:s}))},[t]),s.useEffect(()=>{if(!t)return;const e=Date.now();return()=>{const s=Math.round((Date.now()-e)/1e3);var r;s>5&&(r=t.title,Dj("event","reading_time",{article_title:r,time_seconds:s}))}},[t]),o)return r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:r.jsx("div",{className:"text-center text-white",children:"Chargement de l'article..."})})});if(c||!t)return r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:r.jsx("div",{className:"text-center text-white",children:c||"Article non trouv"})})});const u=new Date(t.created_at);new Date(t.updated_at);return r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsxs("title",{children:[t.title," | VREAD Blog"]}),r.jsx("meta",{name:"description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),t.tags&&t.tags.length>0&&r.jsx("meta",{name:"keywords",content:t.tags.join(", ")}),r.jsx("link",{rel:"canonical",href:`https://www.vread.fr/blog/${t.slug}`}),r.jsx("meta",{property:"og:type",content:"article"}),r.jsx("meta",{property:"og:title",content:t.title}),r.jsx("meta",{property:"og:description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),r.jsx("meta",{property:"og:url",content:`https://www.vread.fr/blog/${t.slug}`}),r.jsx("meta",{property:"og:image",content:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"}),r.jsx("meta",{property:"article:published_time",content:t.created_at}),t.author&&r.jsx("meta",{property:"article:author",content:t.author}),t.tags&&t.tags.length>0&&r.jsx("meta",{property:"article:tag",content:t.tags.join(", ")}),r.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),r.jsx("meta",{name:"twitter:title",content:t.title}),r.jsx("meta",{name:"twitter:description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),r.jsx("meta",{name:"twitter:image",content:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"}),r.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:t.title,description:t.excerpt||"",author:{"@type":"Organization",name:t.author||"VREAD"},publisher:{"@type":"Organization",name:"VREAD",url:"https://www.vread.fr",logo:{"@type":"ImageObject",url:"https://www.vread.fr/branding/vread-logo-512.png"}},datePublished:t.created_at,dateModified:t.updated_at,url:`https://www.vread.fr/blog/${t.slug}`,mainEntityOfPage:{"@type":"WebPage","@id":`https://www.vread.fr/blog/${t.slug}`},keywords:t.tags?.join(", ")||"",articleSection:"Littrature",image:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"})})]}),r.jsx("div",{className:"min-h-screen bg-logo-background",children:r.jsxs("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:[r.jsx("div",{className:"mb-6",children:r.jsx(T,{to:"/blog",children:r.jsxs(qn,{variant:"ghost",className:"text-white hover:text-logo-accent",children:[r.jsx(At,{className:"h-4 w-4 mr-2"}),"Retour au blog"]})})}),r.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-6",children:r.jsxs("ol",{className:"flex items-center gap-2 text-sm text-white/80",children:[r.jsx("li",{children:r.jsx(T,{to:"/",className:"hover:text-white transition-colors",children:"Accueil"})}),r.jsx("li",{children:r.jsx(h,{className:"h-4 w-4"})}),r.jsx("li",{children:r.jsx(T,{to:"/blog",className:"hover:text-white transition-colors",children:"Blog"})}),r.jsx("li",{children:r.jsx(h,{className:"h-4 w-4"})}),r.jsx("li",{className:"text-white/60 truncate max-w-md",children:t.title})]})}),r.jsxs("article",{className:"max-w-none mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[t.imageHero&&r.jsx("div",{className:"relative h-64 md:h-80 w-full overflow-hidden",children:r.jsx("img",{src:t.imageHero,alt:t.imageAlt||t.title,className:"object-cover w-full h-full",loading:"lazy",decoding:"async",width:1200,height:630})}),r.jsxs("header",{className:"p-8 pb-6",children:[r.jsx("h1",{className:"text-3xl md:text-4xl font-serif font-bold text-coffee-darker mb-4",children:t.title}),t.excerpt&&r.jsx("p",{className:"text-lg text-coffee-dark mb-6 leading-relaxed",children:t.excerpt}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-coffee-dark mb-4",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ve,{className:"h-4 w-4"}),r.jsx("time",{dateTime:t.created_at,children:u.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),t.author&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(P,{className:"h-4 w-4"}),r.jsx("span",{children:t.author})]}),t.reading_time&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:""}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(bt,{className:"h-4 w-4"}),r.jsxs("span",{children:[t.reading_time," min de lecture"]})]})]}),r.jsxs(qn,{onClick:async()=>{if(navigator.share)try{await navigator.share({title:t.title,text:t.excerpt||t.title,url:window.location.href}),Lj(t.title,"web_share"),mn.success("Article partag avec succs")}catch(e){"AbortError"!==e.name&&mn.error("Erreur lors du partage")}else try{await navigator.clipboard.writeText(window.location.href),Lj(t.title,"clipboard"),mn.success("Lien copi dans le presse-papier")}catch(e){mn.error("Impossible de copier le lien")}},variant:"ghost",size:"sm",className:"ml-auto text-coffee-dark hover:text-logo-accent",children:[r.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Partager"]})]}),t.tags&&t.tags.length>0&&r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx(Pt,{className:"h-4 w-4 text-coffee-dark mt-1"}),t.tags.map(e=>r.jsx(Dh,{variant:"secondary",className:"bg-coffee-light text-coffee-darker",children:e},e))]})]}),r.jsx("div",{className:"px-8 pb-8 prose prose-lg max-w-none prose-headings:text-coffee-darker prose-p:text-coffee-dark prose-strong:text-coffee-darker prose-a:text-logo-accent prose-a:no-underline hover:prose-a:underline",dangerouslySetInnerHTML:{__html:Ij.sanitize(t.content,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","a","img","code","pre"],ALLOWED_ATTR:["href","target","rel","src","alt","title","class"],ALLOW_DATA_ATTR:!1})}}),a.length>0&&r.jsxs("section",{className:"px-8 pb-8 mt-8 border-t border-coffee-light pt-8",children:[r.jsx("h2",{className:"text-2xl font-serif font-bold text-coffee-darker mb-6",children:"Articles lis"}),r.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:a.map(e=>r.jsx(T,{to:`/blog/${e.slug}`,className:"group block",children:r.jsxs("article",{className:"bg-coffee-lightest rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[e.imageHero&&r.jsx("div",{className:"relative h-40 w-full overflow-hidden",children:r.jsx("img",{src:e.imageHero,alt:e.imageAlt||e.title,className:"object-cover w-full h-full group-hover:scale-105 transition-transform duration-300",loading:"lazy",width:400,height:200})}),r.jsxs("div",{className:"p-4",children:[r.jsx("h3",{className:"font-semibold text-coffee-darker mb-2 group-hover:text-logo-accent transition-colors line-clamp-2",children:e.title}),e.excerpt&&r.jsx("p",{className:"text-sm text-coffee-dark line-clamp-3",children:e.excerpt})]})]})},e.id))})]})]})]})})]})}const Mj=()=>{const[e,t]=s.useState(null),r=_e();return{handleRemove:async(s,n)=>{if(!e){t(s);try{const e=await(async e=>{try{const{data:{user:t}}=await en.auth.getUser();if(!t)throw new Error("Utilisateur non authentifi");const{data:s,error:r}=await en.from("reading_progress").select("*").eq("user_id",t.id).eq("book_id",e).eq("status","to_read").maybeSingle();if(r)throw new Error("Impossible de vrifier le statut du livre");if(!s)throw new Error("Livre non trouv dans   lire ");const{error:n}=await en.from("reading_progress").delete().eq("id",s.id);if(n)throw new Error("Impossible de retirer le livre");return s}catch(t){throw t}})(s);if(!e)throw new Error("Suppression choue");r.invalidateQueries({queryKey:["reading-list"]}),r.invalidateQueries({queryKey:["reading-progress"]}),mn.success(`"${n}" retir de   lire `,{action:{label:"Annuler",onClick:async()=>{try{await(async e=>{try{const{error:t}=await en.from("reading_progress").insert([{id:e.id,user_id:e.user_id,book_id:e.book_id,current_page:e.current_page,total_pages:e.total_pages,status:e.status,started_at:e.started_at,updated_at:e.updated_at}]);if(t)throw new Error("Impossible de restaurer le livre")}catch(t){throw t}})(e),r.invalidateQueries({queryKey:["reading-list"]}),r.invalidateQueries({queryKey:["reading-progress"]}),mn.success(`"${n}" restaur`)}catch(t){mn.error("Impossible de restaurer le livre")}}},duration:5e3})}catch(a){mn.error(a.message||"Impossible de retirer le livre")}finally{t(null)}}},removingBookId:e}};function Vj({title:e,description:t,books:n,actionLabel:a,onAction:i,showProgress:o=!1,showDate:c=!1,hideUnavailableBooks:d=!1,enablePagination:u=!1,initialPageSize:m=8,showRemoveButton:h=!1}){const{handleRemove:p,removingBookId:f}=Mj(),g=s.useMemo(()=>{const e=Array.isArray(n)?n:[];return e.length,d?e.filter(e=>!e.isUnavailable):e},[n,d,e]),{paginatedBooks:x,hasMore:v,loadMore:b,showingItems:y,totalItems:j}=Gg(g,{initialPageSize:m,pageSize:6}),w=u?x:g;return l.useEffect(()=>{},[e,w.length]),0===w.length?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center sm:text-left",children:[r.jsx("h2",{className:"text-xl sm:text-2xl font-serif font-medium text-coffee-darker",children:e}),t&&r.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:t})]}),r.jsx("div",{className:"text-center p-6 border border-dashed rounded-lg",children:r.jsx("p",{className:"text-muted-foreground",children:"Aucun livre dans cette catgorie"})})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center sm:text-left",children:[r.jsx("h2",{className:"text-xl sm:text-2xl font-serif font-medium text-coffee-darker",children:e}),t&&r.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:t})]}),r.jsx("div",{className:"space-y-4 sm:space-y-6",children:w.map(e=>{const t=e.chaptersRead||0,s=e.totalChapters||e.expectedSegments||1,n=e.progressPercent||Math.round(t/s*100),l=e.id||e.slug||"";return r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 p-4 bg-background rounded-lg border border-border relative group",children:[h&&r.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(l,e.title||"Ce livre")},disabled:f===l,className:"absolute top-2 right-2 z-10 p-1.5 rounded-full bg-background/80 hover:bg-destructive/10 border border-border hover:border-destructive/50 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 disabled:opacity-50","aria-label":`Retirer "${e.title}" de   lire `,children:r.jsx(R,{className:"h-4 w-4 text-muted-foreground hover:text-destructive transition-colors"})}),r.jsxs("div",{className:"book-cover w-20 h-28 sm:w-20 sm:h-28 mx-auto sm:mx-0 overflow-hidden flex-shrink-0 relative",children:[(()=>{const t=e?.coverImage||e?.cover_url||e?.book_cover;return t?r.jsx("img",{src:t,alt:e.title||"Couverture",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="/placeholder.svg"}}):r.jsx("div",{className:"w-full h-full flex items-center justify-center "+(e.isUnavailable?"bg-gray-300":"bg-chocolate-medium"),children:r.jsx("span",{className:"font-serif text-xl italic "+(e.isUnavailable?"text-gray-500":"text-white"),children:(e.title||"?").substring(0,1)})})})(),e.isUnavailable&&r.jsx("div",{className:"absolute top-0 right-0 bg-amber-500 p-0.5 rounded-bl",children:r.jsx(It,{className:"h-3 w-3 text-white"})})]}),r.jsxs("div",{className:"flex-1 text-center sm:text-left space-y-2",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[r.jsx("h3",{className:"font-semibold text-base sm:text-lg "+(e.isUnavailable?"text-gray-500":"text-coffee-darker"),children:e.title||"Livre sans titre"}),e.isUnavailable&&r.jsx(Dh,{variant:"outline",className:"text-xs border-amber-500 text-amber-600 mx-auto sm:mx-0 w-fit",children:"Indisponible"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:e.author||"Auteur inconnu"}),o&&r.jsxs("div",{className:"mt-3 mb-2 space-y-1",children:[r.jsx("div",{className:"h-2 w-full bg-muted rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full rounded-full "+(e.isUnavailable?"bg-gray-400":"bg-coffee-dark"),style:{width:`${Math.min(n,100)}%`}})}),r.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[r.jsxs("span",{children:[n,"% termin"]}),r.jsxs("span",{children:[t,"/",s," segment",s>1?"s":""]})]})]}),c&&e.completed_at&&r.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Termin le: ",new Date(e.completed_at).toLocaleDateString("fr-FR")]}),a&&i&&r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>i(l),className:"mt-3 w-full sm:w-auto min-h-[44px]",disabled:e.isUnavailable,children:a})]})]},l)})}),u&&r.jsx(Kg,{onLoadMore:b,hasMore:v,showingCount:y,totalCount:j,className:"mt-6"})]})}function qj({className:e,shimmer:t=!1,...s}){return r.jsx("div",{className:zr("animate-pulse rounded-md bg-muted",t&&"animate-shimmer loading-pulse",e),...s})}function Bj(){return r.jsxs("div",{className:"space-y-8",children:[r.jsxs(Px,{className:"border-coffee-light",children:[r.jsxs(Ix,{children:[r.jsx(qj,{className:"h-7 w-52"}),r.jsx(qj,{className:"h-4 w-40"})]}),r.jsx(Ox,{className:"space-y-4",children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>r.jsx(qj,{className:"h-64 w-full rounded-md"},e))})})]}),r.jsxs(Px,{className:"border-coffee-light",children:[r.jsxs(Ix,{children:[r.jsx(qj,{className:"h-7 w-40"}),r.jsx(qj,{className:"h-4 w-36"})]}),r.jsx(Ox,{className:"space-y-4",children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[1,2].map(e=>r.jsx(qj,{className:"h-64 w-full rounded-md"},e))})})]})]})}function zj({hasError:e,title:t="Aucune lecture trouve",description:s}){const n=H();return r.jsxs(Px,{className:"border-coffee-light",children:[r.jsxs(Ix,{children:[r.jsx(Dx,{className:"text-xl font-serif text-coffee-darker",children:t}),r.jsx(Lx,{children:e?"Une erreur est survenue lors du chargement de vos livres.":s||"Vous n'avez pas encore de livres dans votre liste de lecture."})]}),r.jsx(Ox,{className:"flex justify-center py-8",children:r.jsxs(qn,{className:"bg-coffee-dark hover:bg-coffee-darker",onClick:()=>n("/explore"),children:[r.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Dcouvrir des livres"]})})]})}function Uj({isFetching:e}){return e?r.jsx("div",{className:"py-2 px-4 bg-coffee-light/20 rounded-md text-center text-sm text-muted-foreground",children:"Mise  jour de votre liste de lecture..."}):null}function Fj(){const e=Rx("ReadingList"),{user:t,session:n}=kn(),a=H();s.useEffect(()=>{t&&n?e.info("ReadingList component mounted for user:",t.id):a("/auth")},[t,n,a,e]);const{books:i,loading:o,navigateToBook:l}=(()=>{const e=H(),{user:t,session:r,isInitialized:n,isLoading:a}=kn(),[i,o]=s.useState({toReadCount:0,inProgressCount:0,completedCount:0,isLoading:!0,isLoadingReadingList:!1,hasInitialFetch:!1,isDataReady:!1,toRead:[],inProgress:[],completed:[]}),l=s.useCallback(t=>{e(`/books/${t}`)},[e]);return s.useEffect(()=>{if(!n||a)return void o(e=>({...e,isLoading:!0,isLoadingReadingList:!0}));if(!t?.id)return void o(e=>({...e,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}));let e=!1;return(async()=>{try{o(e=>({...e,isLoading:!0,isLoadingReadingList:!0}));const s=await Pg(t.id);if(e)return;const r=await Ig(s,"to_read",t.id),n=await Ig(s,"in_progress",t.id),a=await Ig(s,"completed",t.id);o(e=>({...e,toReadCount:s.toReadCount,inProgressCount:s.inProgressCount,completedCount:s.completedCount,toRead:r,inProgress:n,completed:a,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}))}catch(V_){if(e)return;o(e=>({...e,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}))}})(),()=>{e=!0}},[t?.id,n,a]),{books:{toRead:i.toRead,inProgress:i.inProgress,completed:i.completed},loading:{isLoading:i.isLoading,isLoadingReadingList:i.isLoadingReadingList,isDataReady:i.isDataReady,isFetching:!1},navigateToBook:l}})();e.debug("Reading list state",{toReadCount:i.toRead?.length||0,inProgressCount:i.inProgress?.length||0,completedCount:i.completed?.length||0,isLoading:o.isLoading,isLoadingReadingList:o.isLoadingReadingList,isDataReady:o.isDataReady});return r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"mx-auto w-full px-4 max-w-none px-4 sm:px-6 lg:px-8 py-6 space-y-8",children:[r.jsx(Uj,{isFetching:o.isFetching}),o.isLoading||o.isLoadingReadingList||!o.isDataReady?(e.debug("Showing loading state",{isLoading:o.isLoading,isLoadingReadingList:o.isLoadingReadingList,isDataReady:o.isDataReady}),r.jsx(Bj,{})):i.toRead?.length||i.inProgress?.length||i.completed?.length?(e.debug("Rendering book sections",{inProgress:i.inProgress?.length||0,toRead:i.toRead?.length||0,completed:i.completed?.length||0}),r.jsxs("div",{className:"space-y-8",children:[i.inProgress?.length>0&&r.jsx(Vj,{title:"En cours de lecture",description:"Reprenez o vous vous tes arrt",books:i.inProgress,showProgress:!0,actionLabel:"Continuer la lecture",onAction:l}),i.toRead?.length>0&&r.jsx(Vj,{title:" lire",description:"Votre liste de lecture  venir",books:i.toRead,actionLabel:"Commencer la lecture",onAction:l,enablePagination:i.toRead.length>8,initialPageSize:8,showRemoveButton:!0}),i.completed?.length>0&&r.jsx(Vj,{title:"Livres termins",description:"Vos lectures compltes",books:i.completed,showDate:!0,actionLabel:"Relire",onAction:l,enablePagination:i.completed.length>10,initialPageSize:10})]})):(e.info("All lists are empty, showing empty state"),r.jsx(zj,{hasError:!1,title:"Aucune lecture trouve",description:"Vous n'avez pas encore de livres dans votre liste de lecture."}))]})]})})}const $j=(e,t)=>ke({queryKey:["discover",e],queryFn:()=>async function(e){const{data:t,error:s}=await en.rpc("discover_feed",{uid:e,lim:20}).single();if(s)throw s;if(!t)throw new Error("No data returned from discover_feed");const r=t,n=Array.isArray(r.readers)?r.readers.filter(e=>e.in_progress>0):[];return{feed:Array.isArray(r.feed)?r.feed:[],readers:n,stats:r.stats||{readers:0,followers:0,following:0}}}(e),enabled:!!e&&t,staleTime:6e4,refetchOnWindowFocus:!1});function Wj({show:e}){return r.jsx(sc,{children:e&&r.jsx(eh.div,{className:"pointer-events-none absolute inset-0 flex items-center justify-center",initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.35,ease:"easeOut"},children:r.jsxs("div",{className:"relative",children:[r.jsx(eh.div,{className:"absolute inset-0 rounded-full",style:{filter:"blur(24px)",background:"#AE6841"},initial:{opacity:.15,scale:.7},animate:{opacity:.18,scale:1.15},exit:{opacity:0}}),r.jsx(Dt,{className:"h-28 w-28",color:"#DFC5A6",strokeWidth:1.5,fill:"#DFC5A6"})]})})})}function Zj({activities:e,loading:t}){return t?r.jsxs(Px,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[r.jsx(Ix,{className:"bg-gradient-to-r from-coffee-light/20 to-coffee-medium/10 border-b border-coffee-light/30",children:r.jsxs(Dx,{className:"font-serif text-coffee-darker flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-coffee-medium/20 to-coffee-light/20 rounded-xl",children:r.jsx(De,{className:"h-5 w-5 text-coffee-dark"})}),r.jsx("span",{children:"Fil d'actualit"})]})}),r.jsx(Ox,{className:"p-6",children:r.jsx("div",{className:"space-y-4",children:[...Array(4)].map((e,t)=>r.jsx("div",{className:"h-20 bg-coffee-light/20 rounded-lg animate-pulse"},t))})})]}):r.jsxs(Px,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[r.jsxs(Ix,{className:"bg-gradient-to-r from-coffee-light/20 to-coffee-medium/10 border-b border-coffee-light/30",children:[r.jsxs(Dx,{className:"font-serif text-coffee-darker flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-coffee-medium/20 to-coffee-light/20 rounded-xl",children:r.jsx(De,{className:"h-5 w-5 text-coffee-dark"})}),r.jsx("span",{children:"Fil d'actualit"})]}),r.jsx("p",{className:"text-coffee-dark font-light text-body-sm",children:"Dcouvrez les dernires activits de la communaut"})]}),r.jsx(Ox,{className:"p-6",children:r.jsx("div",{className:"space-y-4",children:0===e.length?r.jsxs("div",{className:"text-center py-12 text-coffee-dark",children:[r.jsx("div",{className:"mx-auto w-20 h-20 mb-6 rounded-full bg-gradient-to-br from-coffee-light/30 to-coffee-medium/20 flex items-center justify-center",children:r.jsx(De,{className:"h-10 w-10 text-coffee-medium"})}),r.jsx("p",{className:"text-lg font-medium text-coffee-darker mb-2",children:"Aucune activit rcente"}),r.jsx("p",{className:"text-body-sm text-coffee-dark/70 mb-6",children:"Les activits de la communaut apparatront ici"}),r.jsx("button",{className:"px-6 py-2 rounded-full bg-gradient-to-r from-coffee-medium to-coffee-dark text-white hover:shadow-lg transition-all hover:scale-105",children:"Dcouvrir des lecteurs"})]}):e.map((e,t)=>r.jsx(Hj,{activity:e,index:t},`${e.actor_id}-${e.ts}-${t}`))})})]})}function Hj({activity:e,index:t}){const s=he(new Date(e.ts),{addSuffix:!0,locale:pe});return"finished"===e.kind?r.jsx(Gj,{activity:e,timeAgo:s,index:t}):r.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-xl bg-gradient-to-r from-amber-50/50 to-yellow-50/30 border border-amber-200/40 hover:border-amber-300/60 hover:shadow-md transition-all animate-fade-in",style:{animationDelay:50*t+"ms"},children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(yh,{src:e.avatar_url??void 0,alt:e.actor_name,fallbackText:e.actor_name,size:"md",className:"border-2 border-amber-200/60"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-center gap-2 mb-1",children:r.jsx("span",{className:"font-semibold text-coffee-darker",children:e.actor_name})}),r.jsx("p",{className:"text-coffee-dark",children:"badge"===e.kind&&r.jsxs(r.Fragment,{children:["a dbloqu le badge ",r.jsx(Dh,{variant:"secondary",className:"inline-flex items-center font-medium bg-amber-100/80 text-amber-900 border-amber-300/60",children:e.payload_title})]})}),r.jsx("p",{className:"text-coffee-dark/60 text-caption mt-2",children:s})]}),r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"p-2 rounded-xl bg-amber-100/60",children:r.jsx(jt,{className:"h-6 w-6 text-amber-600"})})})]})}function Gj({activity:e,timeAgo:t,index:n}){const[a,i]=s.useState(!!e.liked_by_me),[o,l]=s.useState(e.likes_count??0),[c,d]=s.useState(!1),u=s.useCallback(async()=>{if(!e.activity_id)return;d(!0),setTimeout(()=>d(!1),600),l(e=>a?e-1:e+1);const t=a;i(!a);try{t?await async function(e){const{data:t}=await en.auth.getSession(),s=t?.session?.user?.id;if(!s)throw new Error("Not authenticated");const{error:r}=await en.from("activity_likes").delete().eq("progress_id",e).eq("liker_id",s);if(r)throw r}(e.activity_id):await async function(e){const{data:t}=await en.auth.getSession(),s=t?.session?.user?.id;if(!s)throw new Error("Not authenticated");const{error:r}=await en.from("activity_likes").insert({progress_id:e,liker_id:s});if(r&&"23505"!==r.code)throw r}(e.activity_id)}catch(V_){i(t),l(e.likes_count??0),d(!1)}},[a,o,e.activity_id]),m=function(e,t=300){const r=s.useRef(0);return{onPointerDown:()=>{const s=Date.now();s-r.current<t&&e(),r.current=s}}}(u);return r.jsxs("div",{className:"activity-card relative rounded-xl bg-gradient-to-r from-brand-100/50 to-brand-50/30 border border-brand-200/40 hover:border-brand-300/60 hover:shadow-md transition-all overflow-hidden animate-fade-in",...m,style:{animationDelay:50*n+"ms"},children:[r.jsx(Wj,{show:c}),r.jsxs("div",{className:"flex items-start gap-4 p-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(yh,{src:e.avatar_url??void 0,alt:e.actor_name,fallbackText:e.actor_name,size:"md",className:"border-2 border-brand-200/60"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-center gap-2 mb-1",children:r.jsx("span",{className:"font-semibold text-coffee-darker",children:e.actor_name})}),r.jsxs("p",{className:"text-coffee-dark mb-3",children:["a termin la lecture de ",r.jsx("span",{className:"font-semibold text-brand-600",children:e.payload_title})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-coffee-dark/60 text-caption",children:t}),r.jsxs("button",{"aria-label":a?"Retirer le Booky":"Donner un Booky",className:"flex items-center gap-2 px-4 py-2 rounded-full border-2 border-coffee-medium/30 bg-white/80 hover:bg-coffee-light/20 hover:border-coffee-medium/50 hover:scale-105 transition-all shadow-sm",onClick:e=>{e.stopPropagation(),u()},children:[r.jsx(Dt,{className:"h-5 w-5 transition-transform "+(a?"fill-current scale-110":""),style:{color:"#AE6841"}}),r.jsxs("span",{className:"font-medium",children:[o," Booky",o>1?"s":""]})]})]})]}),r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"p-2 rounded-xl bg-brand-100/60",children:r.jsx(xe,{className:"h-6 w-6 text-brand-600"})})})]})]})}function Kj({stats:e,loading:t}){if(t)return r.jsxs(Px,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[r.jsx(Ix,{className:"pb-3",children:r.jsx(Dx,{className:"font-serif text-coffee-darker text-h4",children:"Statistiques de la communaut"})}),r.jsx(Ox,{className:"space-y-4",children:[...Array(3)].map((e,t)=>r.jsx("div",{className:"h-16 bg-coffee-light/10 rounded-lg animate-pulse"},t))})]});const s=[{icon:W,label:"Lecteurs",value:e.readers.toString(),color:"text-coffee-dark",bgColor:"bg-coffee-light/20"},{icon:Lt,label:"Abonnes",value:e.followers.toString(),color:"text-coffee-darker",bgColor:"bg-coffee-medium/20"},{icon:Fe,label:"Abonnements",value:e.following.toString(),color:"text-coffee-dark",bgColor:"bg-coffee-light/30"}];return r.jsxs(Px,{className:"border-coffee-light bg-white/80 backdrop-blur-md shadow-lg",children:[r.jsx(Ix,{className:"pb-4 bg-gradient-to-r from-coffee-light/10 to-transparent",children:r.jsxs(Dx,{className:"font-serif text-coffee-darker text-h3 flex items-center gap-2",children:[r.jsx(W,{className:"h-6 w-6 text-coffee-medium"}),"Communaut"]})}),r.jsx(Ox,{className:"space-y-3",children:s.map((e,t)=>r.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-coffee-light/10 to-coffee-medium/5 hover:from-coffee-light/20 hover:to-coffee-medium/10 transition-all hover:shadow-md hover:scale-[1.02] cursor-default",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:`p-3 rounded-xl ${e.bgColor} group-hover:scale-110 transition-transform`,children:r.jsx(e.icon,{className:`h-5 w-5 ${e.color}`})}),r.jsx("span",{className:"text-coffee-dark font-medium",children:e.label})]}),r.jsx("span",{className:"font-bold text-coffee-darker text-4xl tabular-nums",children:e.value})]},t))})]})}function Yj({readers:e,loading:t}){const[n,a]=s.useState(6),i=e.slice(0,n),o=n<e.length;return t?r.jsxs(Px,{className:"border-coffee-light/40 bg-white/80 backdrop-blur-md shadow-sm",children:[r.jsx(Ix,{className:"bg-gradient-to-r from-coffee-light/10 to-transparent",children:r.jsxs(Dx,{className:"text-h3 font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(W,{className:"h-6 w-6 text-coffee-dark"}),"Lecteurs  dcouvrir"]})}),r.jsx(Ox,{className:"p-6",children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[...Array(4)].map((e,t)=>r.jsx("div",{className:"h-40 bg-coffee-light/10 rounded-xl animate-pulse"},t))})})]}):r.jsxs(Px,{className:"border-coffee-light/40 bg-white/80 backdrop-blur-md shadow-sm",children:[r.jsxs(Ix,{className:"bg-gradient-to-r from-coffee-light/10 to-transparent",children:[r.jsxs(Dx,{className:"text-h3 font-serif text-coffee-darker flex items-center gap-2",children:[r.jsx(W,{className:"h-6 w-6 text-coffee-dark"}),"Lecteurs  dcouvrir"]}),r.jsxs("p",{className:"text-coffee-dark/70 text-body-sm font-light mt-1",children:[e.length," lecteur",e.length>1?"s":""," actif",e.length>1?"s":""]})]}),r.jsx(Ox,{className:"p-6",children:0===e.length?r.jsxs("div",{className:"text-center py-12 text-coffee-dark",children:[r.jsx("div",{className:"mx-auto w-20 h-20 mb-6 rounded-full bg-gradient-to-br from-coffee-light/30 to-coffee-medium/20 flex items-center justify-center",children:r.jsx(W,{className:"h-10 w-10 text-coffee-medium"})}),r.jsx("p",{className:"text-lg font-medium text-coffee-darker mb-2",children:"Aucun lecteur  dcouvrir"}),r.jsx("p",{className:"text-body-sm text-coffee-dark/70",children:"Revenez bientt pour dcouvrir de nouveaux lecteurs"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map((e,t)=>r.jsx(Qj,{reader:e,index:t},e.id))}),o&&r.jsx("div",{className:"mt-6 text-center",children:r.jsxs("button",{onClick:()=>a(t=>Math.min(t+6,e.length)),className:"px-6 py-3 rounded-full bg-gradient-to-r from-coffee-medium to-coffee-dark text-white font-medium hover:shadow-lg hover:scale-105 transition-all",children:["Voir plus de lecteurs (",e.length-n," restants)"]})})]})})]})}function Qj({reader:e,index:t}){return r.jsxs("div",{className:"group relative flex flex-col gap-4 rounded-2xl bg-gradient-to-br from-white via-coffee-lightest/30 to-coffee-light/10 border border-coffee-light/30 hover:border-coffee-medium/40 p-5 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 animate-fade-in",style:{animationDelay:100*t+"ms"},children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r.jsx(yh,{src:e.avatar_url??void 0,alt:e.username,fallbackText:e.username,size:"lg",className:"border-2 border-coffee-light/30 group-hover:border-coffee-medium/50 transition-colors ring-2 ring-white/50"}),r.jsx("div",{className:"min-w-0 flex-1",children:r.jsx("h4",{className:"font-semibold text-lg text-coffee-darker truncate group-hover:text-coffee-dark transition-colors",children:e.username})})]}),r.jsx(Zx,{targetUserId:e.id,onFollowChange:()=>{}})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs(Dh,{variant:"secondary",className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100 transition-colors",children:[r.jsx(xe,{className:"h-4 w-4"}),r.jsx("span",{className:"font-semibold",children:e.in_progress}),r.jsx("span",{className:"text-xs",children:"en cours"})]}),r.jsxs(Dh,{variant:"secondary",className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 transition-colors",children:[r.jsx(jt,{className:"h-4 w-4"}),r.jsx("span",{className:"font-semibold",children:e.badges}),r.jsx("span",{className:"text-xs",children:"badges"})]}),r.jsxs(Dh,{variant:"secondary",className:"flex items-center gap-1.5 px-3 py-1.5 bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100 transition-colors",children:[r.jsx(ue,{className:"h-4 w-4"}),r.jsx("span",{className:"font-semibold",children:e.streak}),r.jsx("span",{className:"text-xs",children:"jours"})]})]})]})}const Xj=({index:e,delay:t})=>{const[n,a]=s.useState(0);s.useEffect(()=>{const e=()=>a(window.scrollY);return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]);const i=[{top:"10%",left:"5%",rotate:-15},{top:"25%",right:"8%",rotate:12},{top:"45%",left:"3%",rotate:8},{top:"60%",right:"5%",rotate:-10},{top:"75%",left:"7%",rotate:15},{top:"85%",right:"10%",rotate:-8}],o=i[e%i.length],l=.3*n*(e%2==0?1:-1),{rotate:c,...d}=o;return r.jsx("div",{className:"absolute pointer-events-auto transition-transform duration-300 hover:scale-105",style:{...d,transform:`translateY(${l}px) rotate(${c}deg)`,animationDelay:`${t}ms`},children:r.jsxs("svg",{width:"60",height:"80",viewBox:"0 0 60 80",className:"drop-shadow-lg animate-float",children:[r.jsx("rect",{x:"5",y:"10",width:"40",height:"55",rx:"2",fill:"#A67B5B",opacity:"0.9"}),r.jsx("rect",{x:"10",y:"5",width:"40",height:"55",rx:"2",fill:"#C4A287",opacity:"0.8"}),r.jsx("rect",{x:"15",y:"0",width:"40",height:"55",rx:"2",fill:"#8B6F47",opacity:"0.7"})]})})};function Jj(){return r.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[0,1,2,3,4,5,6,7].map(e=>r.jsx(Xj,{index:e,delay:400*e},e))})}function ew(){const e=function(){const[e,t]=s.useState({x:0,y:0});return s.useEffect(()=>{const e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[]),e}(),[t,n]=s.useState([]),[a,i]=s.useState(!1);return s.useEffect(()=>{if(window.matchMedia("(hover: none) and (pointer: coarse)").matches)return;const t=setInterval(()=>{n(t=>{const s={x:e.x,y:e.y,id:Date.now()};return[...t.slice(-5),s]})},50),s=e=>{const t=e.target;i(null!==t.closest(".book-card, .activity-card"))};return document.addEventListener("mouseover",s),()=>{clearInterval(t),document.removeEventListener("mouseover",s)}},[e]),window.matchMedia("(hover: none) and (pointer: coarse)").matches?null:r.jsx("div",{className:"fixed inset-0 pointer-events-none z-50",children:t.map((e,t)=>r.jsx(eh.div,{initial:{opacity:.4,scale:a?1.5:1},animate:{opacity:0,scale:0,x:e.x-6,y:e.y-6},transition:{duration:.8,delay:.05*t,ease:"easeOut"},className:"absolute w-3 h-3 rounded-full",style:{background:"radial-gradient(circle, hsl(var(--brand-400)) 0%, hsl(var(--brand-600)) 100%)",filter:"blur(8px)"}},e.id))})}function tw(){const[e,t]=s.useState(0),[n,a]=s.useState(1),{showConfetti:i}=ab();s.useEffect(()=>{const e=()=>{t(e=>Math.min(e+1,100)),a(2),setTimeout(()=>a(1),300)},s=e=>{e.target.closest(".book-card, .activity-card")&&(t(e=>Math.min(e+3,100)),a(2.5),setTimeout(()=>a(1),300))},r=e=>{e.target.closest(".book-card, .activity-card")&&(t(e=>Math.min(e+5,100)),a(3),setTimeout(()=>a(1),300))};return window.addEventListener("scroll",e,{passive:!0}),document.addEventListener("mouseover",s),document.addEventListener("click",r),()=>{window.removeEventListener("scroll",e),document.removeEventListener("mouseover",s),document.removeEventListener("click",r)}},[]),s.useEffect(()=>{e>=100&&(i({burst:"big"}),setTimeout(()=>t(0),2e3))},[e,i]);const o=2*Math.PI*36,l=o-e/100*o;return r.jsx(eh.div,{className:"fixed bottom-8 right-8 z-40",animate:{scale:[1,.1*n+1,1]},transition:{duration:.3},children:r.jsxs("div",{className:"relative w-20 h-20 cursor-pointer group",children:[r.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 80 80",children:[r.jsx("circle",{cx:"40",cy:"40",r:"36",fill:"none",stroke:"hsl(var(--brand-200))",strokeWidth:"6",opacity:"0.3"}),r.jsx(eh.circle,{cx:"40",cy:"40",r:"36",fill:"none",stroke:"hsl(var(--brand-500))",strokeWidth:"6",strokeDasharray:o,strokeDashoffset:l,strokeLinecap:"round",animate:{strokeDashoffset:l},transition:{duration:.5,ease:"easeOut"}})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform",children:e>=100?r.jsx(F,{className:"w-6 h-6 text-white animate-bounce"}):r.jsxs("span",{className:"text-sm font-bold text-white",children:[e,"%"]})})})]})})}function sw(){const{user:e,isInitialized:t,isLoading:s}=kn(),{t:n}=Tn(),{data:a,isLoading:i,error:o}=$j(e?.id,t);return r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-background via-background to-primary/5",children:[r.jsx(Jj,{}),r.jsx(ew,{}),r.jsx(tw,{}),r.jsx(Zh,{}),r.jsxs("main",{className:"mx-auto w-full px-4 max-w-7xl py-8",children:[r.jsxs("div",{className:"mb-10 relative overflow-hidden rounded-[2rem] bg-gradient-to-br from-primary/5 via-background to-primary/8 p-10 md:p-14 border border-primary/10 shadow-[0_8px_32px_-12px_rgba(166,123,91,0.18)] backdrop-blur-xl",children:[r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(166,123,91,0.08),transparent_50%)]"}),r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_70%_80%,rgba(166,123,91,0.06),transparent_50%)]"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("h1",{className:"text-4xl md:text-6xl font-bold font-serif bg-gradient-to-br from-foreground via-foreground to-primary/90 bg-clip-text text-transparent mb-4 animate-fade-in tracking-tight",children:n.discover.title}),r.jsx("p",{className:"text-lg md:text-xl text-muted-foreground font-light max-w-2xl mx-auto leading-relaxed",children:n.discover.subtitle})]})]}),o&&r.jsx("div",{className:"mb-6 p-5 bg-destructive/10 border border-destructive/30 rounded-2xl text-destructive backdrop-blur-sm",children:n.discover.error}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsx("div",{className:"space-y-8 lg:order-2",children:r.jsx(Kj,{stats:a?.stats||{readers:0,followers:0,following:0},loading:i})}),r.jsxs("div",{className:"lg:col-span-2 lg:order-1 space-y-8",children:[r.jsx(Zj,{activities:a?.feed||[],loading:i}),r.jsx(Yj,{readers:a?.readers||[],loading:i})]})]})]})]})})}function rw(){Tn();const{isPremium:e}=kn(),[t]=Be(),n=Et(),a=H(),i=["litterature","religion","essai","bio"],o=t.get("cat"),l=i.includes(o)?o:"litterature",c=(t.get("q")??"").trim(),[d,u]=s.useState(l),[m,h]=s.useState(c),[p,f]=s.useState([]),[g,x]=s.useState(!1),[v,b]=s.useState(null),[y,j]=s.useState(1);async function w(e=0){x(!0),b(null);const t=24*(y-1),s=t+24-1;try{let e=en.from("books_explore").select("*").eq("category",d).order("created_at",{ascending:!1}).range(t,s);m&&m.length>=2&&(e=e.or(`title.ilike.%${m}%,author.ilike.%${m}%`));const{data:r,error:n}=await e;if(n)throw n;f(r||[]),b(null)}catch(V_){if(e<2&&(V_.message?.includes("connection")||V_.message?.includes("timeout")||V_.message?.includes("network")||"PGRST301"===V_.code))return await new Promise(t=>setTimeout(t,1e3*(e+1))),w(e+1);b(V_.message??"Erreur inconnue"),f([])}finally{x(!1)}}s.useEffect(()=>{const e=new URLSearchParams(t);e.set("cat",d),m?e.set("q",m):e.delete("q"),a({search:e.toString()},{replace:!0})},[d,m]),s.useEffect(()=>{const e=new URLSearchParams(n.search),t=e.get("cat"),s=i.includes(t)?t:"litterature",r=(e.get("q")??"").trim();let a=!1;u(e=>e!==s?(a=!0,s):e),h(e=>e!==r?(a=!0,r):e),a&&j(1)},[n.search]),s.useEffect(()=>{let e=!0;const t=new AbortController;return(async()=>{e&&await w()})(),()=>{e=!1,t.abort()}},[d,y,m]);const N=({value:e,label:t})=>{const s=d===e;return r.jsx("button",{onClick:()=>{u(e),j(1)},className:"px-4 py-2 text-sm rounded-lg transition-colors "+(s?"bg-neutral text-neutral-foreground font-medium":"text-muted-foreground hover:bg-muted hover:text-foreground"),"aria-pressed":s,children:t})};return r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6 space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:"Explorer"}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"inline-flex items-center gap-1 rounded-xl border border-border p-1 order-2 sm:order-1",children:[r.jsx(N,{value:"litterature",label:"Littrature"}),r.jsx(N,{value:"religion",label:"Religion"}),r.jsx(N,{value:"essai",label:"Essai"}),r.jsx(N,{value:"bio",label:"Bio"})]}),r.jsx("div",{className:"order-1 sm:order-2 w-full sm:max-w-md",role:"search","aria-label":"Recherche de livres",children:r.jsx(ex,{onSearch:e=>{h(e.trim()),j(1)},placeholder:"Titre ou auteur",isSearching:g})})]})]}),g&&r.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement des livres"}),v&&r.jsx("p",{className:"text-sm text-destructive",children:v}),!g&&!v&&0===p.length&&r.jsxs("div",{className:"text-center py-12 space-y-4",children:[r.jsx("p",{className:"text-lg text-muted-foreground",children:m.length>0?"Ce livre n'est pas disponible.":"Aucun livre dans cette catgorie."}),m.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Voulez-vous l'ajouter ?"}),r.jsxs(qn,{onClick:()=>a(e?"/request-book":"/premium"),className:"bg-coffee-dark hover:bg-coffee-darker",children:[r.jsx($,{className:"h-4 w-4 mr-2"}),"Demander ce livre"]})]})]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:p.map(e=>r.jsx(Hg,{book:e},e.id))}),r.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[r.jsx("button",{className:"px-3 py-2 rounded-lg border border-border disabled:opacity-40 hover:bg-muted transition-colors",disabled:1===y,onClick:()=>j(e=>Math.max(1,e-1)),children:"Prcdent"}),r.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",y]}),r.jsx("button",{className:"px-3 py-2 rounded-lg border border-border hover:bg-muted transition-colors",onClick:()=>j(e=>e+1),children:"Suivant"})]})]})]})}function nw({earnedBadges:e,allBadges:t,className:s}){return r.jsx("div",{className:zr("space-y-3",s),children:[{name:"legendary",label:"Lgendaires",color:"text-amber-600",bgColor:"bg-amber-50",progressColor:"bg-amber-400"},{name:"epic",label:"piques",color:"text-purple-600",bgColor:"bg-purple-50",progressColor:"bg-purple-400"},{name:"rare",label:"Rares",color:"text-blue-600",bgColor:"bg-blue-50",progressColor:"bg-blue-400"},{name:"common",label:"Communs",color:"text-gray-600",bgColor:"bg-gray-50",progressColor:"bg-gray-400"}].map(s=>{const n=(s=>{const r=t.filter(e=>e.rarity===s).length,n=e.filter(e=>e.rarity===s).length;return{earned:n,total:r,percentage:r>0?Math.round(n/r*100):0}})(s.name);return 0===n.total?null:r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:zr("text-body-sm font-medium",s.color),children:s.label}),r.jsxs("span",{className:"text-caption text-coffee-medium",children:[n.earned," / ",n.total]})]}),r.jsx(Fg,{value:n.percentage,className:zr("h-2 bg-coffee-lightest",s.bgColor),indicatorClassName:s.progressColor})]},s.name)})})}function aw(){const{user:e}=kn(),{t:t}=Tn(),{data:s=[],isLoading:n}=ke({queryKey:["user-badges",a=e?.id||""],queryFn:()=>Av(a),enabled:!!a,staleTime:3e4});var a;const{data:i=[],isLoading:o}=ke({queryKey:["all-badges"],queryFn:Sv,staleTime:3e5});return n||o?r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),r.jsxs(Px,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[r.jsx(Ix,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:r.jsxs(Dx,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-secondary to-reed-light rounded-xl flex-shrink-0",children:r.jsx(jt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),r.jsx("span",{className:"flex-1 min-w-0",children:t.achievements.badges.title}),r.jsx(De,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]})}),r.jsx(Ox,{className:"p-6 sm:p-8 flex items-center justify-center min-h-[200px]",children:r.jsx(Ne,{className:"h-8 w-8 animate-spin text-reed-primary"})})]})]}):r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),r.jsxs(Px,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[r.jsxs(Ix,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:[r.jsxs(Dx,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-secondary to-reed-light rounded-xl flex-shrink-0",children:r.jsx(jt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),r.jsx("span",{className:"flex-1 min-w-0",children:t.achievements.badges.title}),r.jsx(De,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]}),r.jsx(Lx,{className:"text-reed-dark",children:t.achievements.badges.subtitle})]}),r.jsx(Ox,{className:"p-6 sm:p-8",children:r.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[r.jsx(nw,{earnedBadges:s,allBadges:i,className:"mb-6"}),s.length>0?r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 sm:gap-6",children:s.map(e=>r.jsxs("div",{className:"group relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-2xl blur-xl transform group-hover:scale-105 transition-transform duration-500"}),r.jsxs("div",{className:"relative bg-white/80 backdrop-blur-sm border border-white/50 rounded-2xl p-4 sm:p-6 hover:shadow-2xl transition-all duration-500 group-hover:-translate-y-1 text-center",children:[r.jsx("div",{className:"text-h2 mb-3",children:e.icon}),r.jsx("h3",{className:"font-serif font-semibold text-reed-darker text-body-sm sm:text-body mb-2 break-words",children:e.label}),r.jsx("p",{className:"text-caption sm:text-body-sm text-reed-dark leading-relaxed break-words",children:e.description}),e.dateEarned&&r.jsx("p",{className:"text-caption text-reed-medium mt-2",children:t.achievements.badges.earnedOn.replace("{date}",e.dateEarned)}),r.jsx("div",{className:"absolute -top-2 -right-2",children:r.jsx("div",{className:"px-2 py-1 rounded-full text-caption font-medium "+("legendary"===e.rarity?"bg-amber-100 text-amber-800":"epic"===e.rarity?"bg-purple-100 text-purple-800":"rare"===e.rarity?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:"legendary"===e.rarity?t.achievements.badges.rarity.legendary:"epic"===e.rarity?t.achievements.badges.rarity.epic:"rare"===e.rarity?t.achievements.badges.rarity.rare:t.achievements.badges.rarity.common})})]})]},e.id))}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"text-hero mb-4 opacity-30",children:""}),r.jsx("h3",{className:"font-serif text-reed-darker text-h4 mb-2",children:t.achievements.badges.empty}),r.jsx("p",{className:"text-reed-dark",children:t.achievements.badges.emptyDesc})]})]})})]})]})}function iw({quest:e,questInfo:t,isLocked:s=!1,progress:n}){return s?r.jsx(Px,{className:"border-gray-300 bg-gray-50/50 opacity-75",children:r.jsx(Ox,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"rounded-full bg-gray-200 p-2 mt-1",children:r.jsx(pt,{className:"h-5 w-5 text-gray-500"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-medium text-gray-700",children:t.title}),t.category&&r.jsx("span",{className:"text-caption text-gray-500 uppercase tracking-wider px-2 py-0.5 bg-gray-200 rounded",children:t.category})]}),r.jsx("p",{className:"text-body-sm text-gray-600 italic mt-1",children:"Accomplissez l'exploit pour dcouvrir les dtails..."}),n&&r.jsxs("div",{className:"mt-2",children:[r.jsx("div",{className:"flex items-center gap-2 mb-1",children:r.jsxs("span",{className:"text-caption text-gray-600 font-medium",children:["Progression : ",n.current," / ",n.target]})}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-amber-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(n.current/n.target*100,100)}%`}})})]}),t.xp_reward&&r.jsxs("p",{className:"text-caption text-gray-500 mt-2 flex items-center gap-1",children:[r.jsx(kt,{className:"h-3 w-3"}),t.xp_reward," XP"]})]})]})})}):r.jsx(Px,{className:"border-amber-400 bg-gradient-to-br from-amber-50 to-yellow-50 hover:shadow-lg transition-shadow",children:r.jsx(Ox,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"rounded-full bg-amber-100 p-2 mt-1 text-amber-600",children:(()=>{const s=e?.quest?.icon||t?.icon;if(!s)return r.jsx(jt,{className:"h-5 w-5"});switch(s){case"sun":return r.jsx(Mt,{className:"h-5 w-5"});case"zap":return r.jsx(kt,{className:"h-5 w-5"});case"books":return r.jsx(xe,{className:"h-5 w-5"});case"refresh":return r.jsx(Re,{className:"h-5 w-5"});default:return r.jsx(jt,{className:"h-5 w-5"})}})()}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"font-medium text-amber-900",children:e?.quest?.title||t.title}),t.category&&r.jsx("span",{className:"text-caption text-amber-700 uppercase tracking-wider px-2 py-0.5 bg-amber-200 rounded",children:t.category})]}),r.jsx("p",{className:"text-body-sm text-amber-800 mt-1",children:e?.quest?.description||t.description}),e?.unlocked_at&&r.jsxs("p",{className:"text-caption text-amber-700 mt-2",children:[" Dbloque le ",Ot(new Date(e.unlocked_at),"d MMMM yyyy",{locale:pe})]}),t.xp_reward&&r.jsxs("p",{className:"text-caption text-amber-700 mt-1 flex items-center gap-1 font-semibold",children:[r.jsx(kt,{className:"h-3 w-3"}),"+",t.xp_reward," XP"]})]})]})})})}function ow(){const{t:e}=Tn(),[t,n]=s.useState([]),[a,i]=s.useState([]),[o,l]=s.useState({}),[c,d]=s.useState(!0),[u,m]=s.useState(null),h={marathons:a.filter(e=>"marathons"===e.category),vitesse:a.filter(e=>"vitesse"===e.category),variete:a.filter(e=>"variete"===e.category),regularite:a.filter(e=>"regularite"===e.category),horaires:a.filter(e=>"horaires"===e.category)};return s.useEffect(()=>{(async()=>{try{d(!0);const{data:e}=await en.auth.getUser();if(e?.user){m(e.user.id);const t=await py();i(t);const s=await(async e=>{try{if(!e)return[];const{data:t,error:s}=await en.from("user_quests").select("*").eq("user_id",e).order("unlocked_at",{ascending:!1});if(s)return[];const r=await py();return t.map(e=>{const t=r.find(t=>t.slug===e.quest_slug);return{...e,quest:t}})}catch(t){return[]}})(e.user.id);n(s);const r={};for(const n of t){if(!s.some(e=>e.quest_slug===n.slug)){const t=await by(e.user.id,n.slug);t&&(r[n.slug]=t)}}l(r)}}catch(e){}finally{d(!1)}})()},[]),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),r.jsxs(Px,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[r.jsxs(Ix,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:[r.jsxs(Dx,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-light to-white rounded-xl flex-shrink-0",children:r.jsx(Vt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),r.jsx("span",{className:"flex-1 min-w-0",children:e.achievements.quests.title}),r.jsx(_t,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]}),r.jsx(Lx,{className:"text-reed-dark",children:e.achievements.quests.subtitle})]}),r.jsx(Ox,{className:"p-6 sm:p-8",children:c?r.jsx("div",{className:"space-y-6",children:[...Array(3)].map((e,t)=>r.jsx("div",{className:"h-20 sm:h-24 bg-gradient-to-r from-reed-secondary/30 to-reed-light/30 animate-pulse rounded-2xl"},t))}):r.jsxs("div",{className:"space-y-8",children:[Object.entries(h).map(([s,n])=>{if(0===n.length)return null;const a=s,i=e.achievements.quests.categories[a];return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b-2 border-reed-primary/20",children:[r.jsx("span",{className:"text-2xl",children:i.icon}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-serif text-h5 text-reed-darker",children:i.label}),r.jsxs("p",{className:"text-caption text-reed-medium",children:[i.desc,"  ",n.length>1?e.achievements.quests.questsCountPlural.replace("{count}",String(n.length)):e.achievements.quests.questsCount.replace("{count}",String(n.length))]})]})]}),r.jsx("div",{className:"space-y-4 pl-2",children:n.map(e=>{const s=t.find(t=>t.quest_slug===e.slug),n=o[e.slug];return r.jsx(iw,{quest:s,questInfo:e,isLocked:!s,progress:n},e.slug)})})]},s)}),0===a.length&&r.jsxs("div",{className:"text-center py-12 sm:py-16",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-3xl blur-xl"}),r.jsx("div",{className:"relative p-6 bg-gradient-to-br from-reed-secondary/30 to-reed-light/30 rounded-3xl border border-white/30",children:r.jsx(De,{className:"h-10 w-10 sm:h-12 sm:w-12 text-reed-primary"})})]})}),r.jsx("h3",{className:"font-serif text-h4 text-reed-darker mb-3",children:e.achievements.quests.empty}),r.jsx("p",{className:"text-reed-dark leading-relaxed px-4",children:e.achievements.quests.emptyDesc})]})]})})]})]})}function lw({xp:e,level:t}){const s=(e??0)%1e3/10;return r.jsxs("div",{className:"group relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-3xl blur-xl transform group-hover:scale-105 transition-transform duration-500"}),r.jsx("div",{className:"relative bg-white/70 backdrop-blur-md border border-white/40 rounded-3xl p-6 sm:p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 group-hover:-translate-y-1",children:r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6",children:[r.jsxs("div",{className:"relative flex-shrink-0",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary to-reed-dark rounded-2xl blur-sm opacity-30 scale-110"}),r.jsx("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-reed-secondary to-reed-light rounded-2xl border border-reed-primary/30",children:r.jsx(_t,{className:"h-6 w-6 sm:h-8 sm:w-8 text-reed-primary"})}),r.jsx("div",{className:"absolute -top-2 -right-2",children:r.jsx("div",{className:"px-2 py-1 bg-gradient-to-br from-reed-primary to-reed-dark rounded-full text-caption font-bold text-white",children:t??1})})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("h3",{className:"text-caption sm:text-body-sm font-serif font-medium text-reed-dark uppercase mb-2",children:["Niveau ",t??1]}),r.jsxs("p",{className:"text-h4 sm:text-h4 font-serif font-semibold text-reed-darker mb-3 break-words",children:[(e??0).toLocaleString()," XP"]}),r.jsx("div",{className:"w-full bg-reed-light/50 rounded-full h-2 overflow-hidden",children:r.jsx("div",{className:"h-full bg-gradient-to-r from-reed-primary to-reed-secondary transition-all duration-1000 ease-out",style:{width:`${s}%`}})}),r.jsxs("p",{className:"text-caption text-reed-dark mt-1",children:[1e3-(e??0)%1e3," XP jusqu'au niveau ",(t??1)+1]})]}),r.jsx("div",{className:"flex-shrink-0",children:r.jsx(De,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse"})})]})})]})}function cw(){const{user:e}=kn(),{t:t}=Tn(),{data:s,isLoading:n}=ke({queryKey:["user-stats",a=e?.id||""],queryFn:()=>Tv(a),enabled:!!a,staleTime:6e4});var a;const i=s||{booksRead:0,pagesRead:0,badgesCount:0,streakCurrent:0,streakBest:0,questsDone:0,xp:0,lvl:1};return n?r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-light/30 to-white",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"container max-w-6xl mx-auto px-4 py-8 sm:py-12",children:[r.jsxs("div",{className:"text-center mb-8 px-4",children:[r.jsx("h1",{className:"text-h1 font-serif text-reed-darker mb-2",style:{hyphens:"none",wordBreak:"normal",whiteSpace:"nowrap"},children:t.achievements.title}),r.jsx("p",{className:"text-body text-reed-dark",children:t.achievements.subtitle})]}),r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx(Ne,{className:"h-8 w-8 animate-spin text-reed-primary"})})]})]})}):r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-light/30 to-white",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"container max-w-6xl mx-auto px-4 py-8 sm:py-12",children:[r.jsxs("div",{className:"text-center mb-10 sm:mb-12 px-4",children:[r.jsx("h1",{className:"text-h1 sm:text-hero font-serif text-reed-darker mb-2",style:{hyphens:"none",wordBreak:"normal",whiteSpace:"nowrap"},children:t.achievements.title}),r.jsx("p",{className:"text-body sm:text-lg text-reed-dark",children:t.achievements.subtitle})]}),r.jsxs("div",{className:"space-y-8",children:[r.jsx(lw,{xp:i.xp,level:i.lvl}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("div",{className:"text-h2 mb-1",children:""}),r.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:i.booksRead}),r.jsx("div",{className:"text-caption text-reed-dark",children:t.achievements.stats.booksRead})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("div",{className:"text-h2 mb-1",children:""}),r.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:i.pagesRead}),r.jsx("div",{className:"text-caption text-reed-dark",children:t.achievements.stats.pagesRead})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("div",{className:"text-h2 mb-1",children:""}),r.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:i.streakCurrent}),r.jsxs("div",{className:"text-caption text-reed-dark",children:[t.achievements.stats.currentStreak,i.streakBest>0&&r.jsx("span",{className:"block text-caption text-reed-medium mt-1",children:t.achievements.stats.record.replace("{count}",String(i.streakBest))})]})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("div",{className:"text-h2 mb-1",children:""}),r.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:i.badgesCount}),r.jsx("div",{className:"text-caption text-reed-dark",children:t.achievements.stats.badges})]})]}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsx(aw,{}),r.jsx(ow,{})]})]})]})]})})}function dw({user:e,compact:t=!1,hideUnfollow:n=!1}){const{user:a}=kn(),[i,o]=s.useState(e.name||"Lecteur"),[l,c]=s.useState(!1),[d,u]=s.useState(!0);return s.useEffect(()=>{c(!!a&&a.id!==e.id);(async()=>{try{u(!0);const t=await yn(e.id);if(t){const s=jn(t.username||e.username,t.email||e.email,e.id);o(s)}}catch(t){}finally{u(!1)}})()},[a,e]),r.jsxs("div",{className:"flex items-center justify-between "+(t?"gap-2":"gap-4"),children:[r.jsxs(T,{to:`/profile/${e.id}`,className:"flex items-center gap-3 hover:underline","aria-label":`Voir le profil de ${i}`,children:[r.jsx(yh,{src:e.avatar_url||void 0,alt:i,fallbackText:i}),r.jsx("span",{className:"font-medium text-coffee-darker "+(t?"text-body-sm":"text-body"),children:d?"Chargement...":i})]}),l&&r.jsx("div",{children:r.jsx(Zx,{targetUserId:e.id,hideUnfollow:n})})]})}function uw(){const{type:e,userId:t}=gt(),n=H(),{user:a}=kn(),[i,o]=s.useState([]),[l,c]=s.useState(!0),[d,u]=s.useState(null),m=t||a?.id,h=a?.id===m;s.useEffect(()=>{if(!m)return;(async()=>{c(!0),u(null);try{let t=[];"followers"===e?t=await async function(e){try{const{data:t,error:s}=await en.from("followers").select("follower_id").eq("following_id",e);if(s)throw s;if(!t.length)return[];const{data:r,error:n}=await en.rpc("get_public_profiles_for_ids",{ids:t.map(e=>e.follower_id)});if(n)throw n;return r||[]}catch(d){return[]}}(m):"following"===e&&(t=await async function(e){try{const{data:t,error:s}=await en.from("followers").select("following_id").eq("follower_id",e);if(s)throw s;if(!t.length)return[];const{data:r,error:n}=await en.rpc("get_public_profiles_for_ids",{ids:t.map(e=>e.following_id)});if(n)throw n;return r||[]}catch(d){return[]}}(m)),o(t)}catch(t){u("Impossible de charger les "+("followers"===e?"abonns":"abonnements"))}finally{c(!1)}})()},[m,e]);return r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[r.jsxs(qn,{variant:"ghost",size:"sm",className:"text-coffee-dark",onClick:()=>{n(t?`/profile/${t}`:"/profile")},children:[r.jsx(Rt,{className:"h-4 w-4 mr-1"}),"Retour au profil"]}),r.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:"followers"===e?h?"Mes abonns":"Abonns":h?"Mes abonnements":"Abonnements"})]}),r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Ix,{children:r.jsx(Dx,{className:"text-lg font-serif text-coffee-darker",children:"followers"===e?"Personnes qui vous suivent":"Personnes que vous suivez"})}),r.jsx(Ox,{className:"space-y-4",children:l?r.jsx("div",{className:"flex justify-center p-6",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-coffee-dark"})}):d?r.jsx("div",{className:"text-center p-4 text-muted-foreground",children:d}):i.length>0?i.map(t=>r.jsx(dw,{user:t,hideUnfollow:"followers"===e},t.id)):r.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"followers"===e?h?"Vous n'avez pas encore d'abonns":"Cet utilisateur n'a pas encore d'abonns":h?"Vous n'tes abonn  aucun utilisateur":"Cet utilisateur n'est abonn  personne"})})]})]})]})})}function mw({children:e}){const{user:t,isLoading:n,isInitialized:a,isAdmin:i}=kn(),o=H(),[l,c]=s.useState(!1);return s.useEffect(()=>{if(a&&!n&&!i&&!l){c(!0);const e=setTimeout(()=>{o("/home")},100);return()=>clearTimeout(e)}},[i,n,a,o,l]),n||!a?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Vrification des droits d'administration..."})]})}):i?r.jsx(r.Fragment,{children:e}):r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(qt,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),r.jsx("h2",{className:"text-h4 font-medium mb-2",children:"Accs refus"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas les droits d'administration ncessaires pour accder  cette page."}),r.jsx("button",{onClick:()=>o("/home"),className:"px-4 py-2 bg-coffee-dark hover:bg-coffee-darker text-white rounded-md",children:"Retour  l'accueil"})]})})}function hw(){const{user:e,isAdmin:t}=kn();return e?r.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.email,"  ",t?"Admin ":"Admin "]}):null}function pw({children:e}){return r.jsxs("div",{children:[r.jsxs("header",{className:"flex items-center justify-between p-3 border-b border-border bg-card",children:[r.jsxs("nav",{className:"flex gap-3 text-sm",children:[r.jsx(Bt,{to:"/admin",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Dashboard"}),r.jsx(Bt,{to:"/admin/auto-covers",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Auto-covers"}),r.jsx(Bt,{to:"/admin/audit",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Audit"}),r.jsx(Bt,{to:"/admin/book-requests",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Demandes"})]}),r.jsx(hw,{})]}),r.jsx("main",{children:e})]})}const fw=s.forwardRef(({className:e,...t},s)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:s,className:zr("w-full caption-bottom text-sm",e),...t})}));fw.displayName="Table";const gw=s.forwardRef(({className:e,...t},s)=>r.jsx("thead",{ref:s,className:zr("[&_tr]:border-b",e),...t}));gw.displayName="TableHeader";const xw=s.forwardRef(({className:e,...t},s)=>r.jsx("tbody",{ref:s,className:zr("[&_tr:last-child]:border-0",e),...t}));xw.displayName="TableBody";s.forwardRef(({className:e,...t},s)=>r.jsx("tfoot",{ref:s,className:zr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const vw=s.forwardRef(({className:e,...t},s)=>r.jsx("tr",{ref:s,className:zr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));vw.displayName="TableRow";const bw=s.forwardRef(({className:e,...t},s)=>r.jsx("th",{ref:s,className:zr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));bw.displayName="TableHead";const yw=s.forwardRef(({className:e,...t},s)=>r.jsx("td",{ref:s,className:zr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));yw.displayName="TableCell";s.forwardRef(({className:e,...t},s)=>r.jsx("caption",{ref:s,className:zr("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const jw=s.forwardRef(({className:e,orientation:t="horizontal",decorative:s=!0,...n},a)=>r.jsx(zt,{ref:a,decorative:s,orientation:t,className:zr("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...n}));function ww({book:e,onUpdate:t}){const[n,a]=s.useState(!1),[i,o]=s.useState(!1),[l,c]=s.useState(e.total_pages||0),[d,u]=s.useState(e.expected_segments),[m,h]=s.useState(""),[p,f]=s.useState(!0),[g,x]=s.useState(e.slug),[v,b]=s.useState(null),[y,j]=s.useState(""),[w,N]=s.useState(""),[_,k]=s.useState(!1);return r.jsxs(nx,{open:n,onOpenChange:t=>{a(t),t&&(async()=>{try{const{data:t,error:s}=await en.from("books").select("id, title, author, description, cover_url, slug, is_published, total_pages").eq("slug",e.slug).single();if(s||!t)return;t&&(t.description&&h(t.description),f(!1!==t.is_published),t.total_pages&&c(t.total_pages),t.slug&&x(t.slug))}catch(t){}})()},children:[r.jsx(ax,{asChild:!0,children:r.jsxs(qn,{variant:"outline",size:"sm",children:[r.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Modifier"]})}),r.jsxs(lx,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx(cx,{children:r.jsxs(ux,{className:"text-h4",children:['Modifier "',e.title,'"']})}),r.jsxs("div",{className:"space-y-6 py-4",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-h4 font-medium",children:"Mtadonnes"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"totalPages",children:"Nombre total de pages"}),r.jsx(Jg,{id:"totalPages",type:"number",value:l,onChange:e=>c(parseInt(e.target.value)||0),min:0})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"expectedSegments",children:"Nombre de segments attendus"}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(Jg,{id:"expectedSegments",type:"number",value:d,onChange:e=>u(parseInt(e.target.value)||0),min:0}),r.jsx(qn,{onClick:()=>{const e=Math.ceil(Number(l)/30);u(e)},type:"button",variant:"secondary",children:"Recalculer"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"description",children:"Description (optionnelle)"}),r.jsx($v,{id:"description",value:m,onChange:e=>h(e.target.value),rows:4,placeholder:"Description du livre..."})]}),r.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[r.jsx(zv,{id:"isPublished",checked:p,onCheckedChange:e=>f(!0===e)}),r.jsx(Vx,{htmlFor:"isPublished",className:"font-medium cursor-pointer",children:"Publier ce livre"})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(qn,{onClick:async()=>{o(!0);try{const s=parseInt(String(l),10);if(isNaN(s))throw new Error("Le nombre de pages doit tre un nombre valide");if(!g)throw new Error("Le slug du livre est manquant");const r={total_pages:s,description:m||null,is_published:p},{data:n,error:i}=await en.from("books").update(r).eq("slug",g).select();if(i)throw i;mn.success(`Les informations du livre "${e.title}" ont t mises  jour.`,{description:"Modifications enregistres"}),a(!1),t()}catch(s){mn.error(`Impossible de mettre  jour le livre: ${s.message}`,{description:"Erreur"})}finally{o(!1)}},disabled:i,className:"w-full sm:w-auto",children:i?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Sauvegarder les modifications"]})}),r.jsx(qn,{onClick:async()=>{if(0!==e.missingSegments.length){o(!0);try{const{data:s,error:r}=await en.from("books").select("id, slug").eq("id",e.id).single();if(r)throw r;const n=e.missingSegments.map(e=>({book_id:s.id,book_slug:s.slug,segment:e,question:"",answer:""})),{error:i}=await en.from("reading_questions").upsert(n,{onConflict:"book_slug,segment"});if(i)throw i;mn.success(`${e.missingSegments.length} segments vides ont t gnrs avec succs.`,{description:"Segments gnrs"}),a(!1),t()}catch(s){mn.error(`Impossible de gnrer les segments: ${s.message}`,{description:"Erreur"})}finally{o(!1)}}else mn("Tous les segments ont dj t crs pour ce livre.",{description:"Information"})},disabled:i||0===e.missingSegments?.length,variant:"outline",className:"w-full sm:w-auto",children:i?r.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}):"Gnrer les segments manquants"})]})]}),r.jsx(jw,{}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-h4 font-medium",children:"Ajouter une question de validation"}),e.missingSegments&&e.missingSegments.length>0?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"segment",children:"Segment manquant"}),r.jsxs("select",{id:"segment",className:"w-full rounded-md border border-input bg-background px-3 py-2",value:v||"",onChange:e=>b(parseInt(e.target.value)),children:[r.jsx("option",{value:"",children:"Slectionnez un segment"}),e.missingSegments.map(e=>r.jsxs("option",{value:e,children:["Segment ",e]},e))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"question",children:"Question"}),r.jsx(Jg,{id:"question",value:y,onChange:e=>j(e.target.value),placeholder:"Exemple: Quel est le nom du personnage principal ?"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{htmlFor:"answer",children:"Rponse (un seul mot)"}),r.jsx(Jg,{id:"answer",value:w,onChange:e=>N(e.target.value),placeholder:"Exemple: Jean"}),r.jsx("p",{className:"text-caption text-muted-foreground",children:"La rponse doit contenir un seul mot, sans espace."})]}),r.jsx(qn,{onClick:async()=>{if(v||0===v)if(y.trim())if(w.trim())if(w.trim().split(/\s+/).length>1)mn.error("La rponse doit contenir un seul mot",{description:"Rponse invalide"});else{k(!0);try{const{data:s,error:r}=await en.from("books").select("id, slug").eq("id",e.id).single();if(r)throw r;const{error:n}=await en.from("reading_questions").insert({book_id:s.id,book_slug:s.slug,segment:v,question:y.trim(),answer:w.trim().toLowerCase()});if(n)throw n;mn.success(`La question pour le segment ${v} a t ajoute avec succs.`,{description:"Question ajoute"}),j(""),N(""),a(!1),t()}catch(s){mn.error(`Impossible d'ajouter la question: ${s.message}`,{description:"Erreur"})}finally{k(!1)}}else mn.error("La rponse ne peut pas tre vide",{description:"Rponse invalide"});else mn.error("La question ne peut pas tre vide",{description:"Question invalide"});else mn.error("Veuillez slectionner un segment",{description:"Segment non slectionn"})},disabled:_,variant:"secondary",className:"w-full sm:w-auto",children:_?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Ajout en cours..."]}):r.jsx(r.Fragment,{children:"Ajouter la question"})})]}):r.jsx("p",{className:"text-muted-foreground",children:"Tous les segments de ce livre ont dj des questions."})]})]})]})]})}jw.displayName=zt.displayName;const Nw=kg.object({title:kg.string().min(1,"Le titre est requis"),author:kg.string().min(1,"L'auteur est requis"),total_pages:kg.coerce.number().min(1,"Le nombre de pages est requis"),description:kg.string().optional(),cover_url:kg.string().optional(),is_published:kg.boolean().default(!0)});function _w({onBookAdded:e}){const[t,n]=s.useState(!1),[a,i]=s.useState(!1),[o,l]=s.useState(null),[c,d]=s.useState(null),u=Ye({resolver:ov(Nw),defaultValues:{title:"",author:"",total_pages:void 0,description:"",cover_url:"",is_published:!0}});return r.jsxs(nx,{open:t,onOpenChange:n,children:[r.jsx(ax,{asChild:!0,children:r.jsxs(qn,{size:"sm",className:"gap-2",children:[r.jsx(Pe,{className:"h-4 w-4"}),"Ajouter un livre"]})}),r.jsxs(lx,{className:"sm:max-w-[550px]",children:[r.jsx(cx,{children:r.jsx(ux,{children:"Ajouter un nouveau livre"})}),r.jsx(Hx,{...u,children:r.jsxs("form",{onSubmit:u.handleSubmit(async t=>{i(!0);try{const s=(t.title+"-"+t.author).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");let r=t.cover_url;o&&(r=await(async(e,t)=>{const s=`books/${t}.${e.name.split(".").pop()}`,{error:r}=await en.storage.from("covers").upload(s,e,{cacheControl:"3600",upsert:!0});if(r)throw new Error(`Erreur lors de l'upload de la couverture: ${r.message}`);const{data:n}=en.storage.from("covers").getPublicUrl(s);return n.publicUrl})(o,s));const a={id:crypto.randomUUID(),title:t.title,author:t.author,total_pages:t.total_pages,description:t.description||null,cover_url:r||null,slug:s,tags:[],is_published:t.is_published},{error:i}=await en.from("books").insert(a);if(i)throw i;await(async(e,t)=>{const s=Math.ceil(t/30);if(!(s<=0))try{const t=[];for(let n=0;n<s;n++)t.push({book_slug:e,segment:n,question:"",answer:""});const{error:r}=await en.from("reading_questions").upsert(t,{onConflict:"book_slug,segment"});if(r)throw r}catch(i){mn("Le livre a t cr, mais la gnration automatique des segments a chou.",{description:"Attention"})}})(s,t.total_pages),mn.success(`"${t.title}" a t ajout  la base de donnes.`,{description:"Livre ajout avec succs"}),u.reset(),l(null),d(null),n(!1),e()}catch(s){mn.error(`Impossible d'ajouter le livre: ${s.message}`,{description:"Erreur"})}finally{i(!1)}}),className:"space-y-4",children:[r.jsx(Kx,{control:u.control,name:"title",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{children:"Titre"}),r.jsx(ev,{children:r.jsx(Jg,{placeholder:"Titre du livre",...e})}),r.jsx(tv,{})]})}),r.jsx(Kx,{control:u.control,name:"author",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{children:"Auteur"}),r.jsx(ev,{children:r.jsx(Jg,{placeholder:"Nom de l'auteur",...e})}),r.jsx(tv,{})]})}),r.jsx(Kx,{control:u.control,name:"total_pages",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{children:"Nombre de pages"}),r.jsx(ev,{children:r.jsx(Jg,{type:"number",min:"1",placeholder:"Nombre de pages",...e})}),r.jsx(tv,{})]})}),r.jsx(Kx,{control:u.control,name:"description",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{children:"Rsum (optionnel)"}),r.jsx(ev,{children:r.jsx($v,{placeholder:"Description du livre",...e})}),r.jsx(tv,{})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Jx,{children:"Couverture"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Kx,{control:u.control,name:"cover_url",render:({field:e})=>r.jsxs(Xx,{children:[r.jsx(Jx,{className:"text-body-sm text-muted-foreground",children:"URL de l'image"}),r.jsx(ev,{children:r.jsx(Jg,{placeholder:"https://example.com/cover.jpg",...e,onChange:t=>{e.onChange(t),(e=>{const t=e.target.value;t?(l(null),d(t)):d(null)})(t)},disabled:!!o})}),r.jsx(tv,{})]})}),r.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-md p-4",children:r.jsxs("label",{htmlFor:"cover-upload",className:"flex flex-col items-center justify-center cursor-pointer",children:[r.jsx($t,{className:"h-6 w-6 text-gray-400 mb-2"}),r.jsx("span",{className:"text-body-sm text-muted-foreground",children:"Uploader une image"}),r.jsx("input",{id:"cover-upload",type:"file",className:"hidden",accept:"image/*",onChange:e=>{const t=e.target.files?.[0]||null;if(t){l(t);const e=URL.createObjectURL(t);d(e),u.setValue("cover_url","")}},disabled:a})]})})]}),r.jsx("div",{className:"flex items-center justify-center",children:c?r.jsx("div",{className:"relative w-40 h-56 overflow-hidden rounded-md border border-gray-200",children:r.jsx("img",{src:c,alt:"Aperu",className:"w-full h-full object-cover",onError:()=>d(null)})}):r.jsx("div",{className:"w-40 h-56 bg-gray-100 flex items-center justify-center rounded-md border border-gray-200",children:r.jsx("span",{className:"text-gray-400",children:"Aperu"})})})]})]}),r.jsx(Kx,{control:u.control,name:"is_published",render:({field:e})=>r.jsxs(Xx,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[r.jsxs("div",{className:"space-y-0.5",children:[r.jsx(Jx,{children:"Publier ce livre"}),r.jsx(tv,{})]}),r.jsx(ev,{children:r.jsx(zv,{checked:e.value,onCheckedChange:e.onChange})})]})}),r.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[r.jsx(qn,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:a,children:"Annuler"}),r.jsx(qn,{type:"submit",disabled:a,children:a?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Cration..."]}):"Crer le livre"})]})]})})]})]})}const kw=Xt,Sw=Qt,Ew=s.forwardRef(({className:e,...t},s)=>r.jsx(Wt,{className:zr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));Ew.displayName=Wt.displayName;const Rw=s.forwardRef(({className:e,...t},s)=>r.jsxs(Sw,{children:[r.jsx(Ew,{}),r.jsx(Zt,{ref:s,className:zr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Rw.displayName=Zt.displayName;const Cw=({className:e,...t})=>r.jsx("div",{className:zr("flex flex-col space-y-2 text-center sm:text-left",e),...t});Cw.displayName="AlertDialogHeader";const Aw=({className:e,...t})=>r.jsx("div",{className:zr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Aw.displayName="AlertDialogFooter";const Tw=s.forwardRef(({className:e,...t},s)=>r.jsx(Ht,{ref:s,className:zr("text-lg font-semibold",e),...t}));Tw.displayName=Ht.displayName;const Pw=s.forwardRef(({className:e,...t},s)=>r.jsx(Gt,{ref:s,className:zr("text-sm text-muted-foreground",e),...t}));Pw.displayName=Gt.displayName;const Iw=s.forwardRef(({className:e,...t},s)=>r.jsx(Kt,{ref:s,className:zr(Vn(),e),...t}));Iw.displayName=Kt.displayName;const Dw=s.forwardRef(({className:e,...t},s)=>r.jsx(Yt,{ref:s,className:zr(Vn({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Dw.displayName=Yt.displayName;function Lw({open:e,onOpenChange:t,bookId:n,bookTitle:a,onDeleted:i}){const[o,l]=s.useState(!1),[c,d]=s.useState(!1),[u,m]=s.useState(0);s.useEffect(()=>{e&&h()},[e,n]);const h=async()=>{try{const{data:e,error:t,count:s}=await en.from("reading_questions").select("id",{count:"exact"}).eq("book_slug",n);if(t)throw t;d(!!s&&s>0),m(s||0)}catch(e){}},p=async()=>{l(!0);try{const e=await(async e=>{try{if(!e)return mn.error("Identifiant du livre non fourni",{description:"Erreur de suppression"}),!1;const{error:t}=await en.from("reading_questions").delete().eq("book_slug",e);if(t)throw t;const{error:s}=await en.from("reading_validations").delete().eq("book_id",e);if(s)throw s;const{error:r}=await en.from("books").delete().eq("id",e);if(r)throw r;return mn.success("Livre supprim avec succs"),!0}catch(t){const e=t instanceof Error?t.message:"Impossible de supprimer ce livre";return mn.error(e,{description:"Erreur de suppression"}),!1}})(n);e&&(mn.success(`"${a}" et ses donnes associes ont t supprims avec succs.`,{description:"Livre supprim"}),i(),t(!1))}catch(e){mn.error(e.message||"Impossible de supprimer ce livre",{description:"Erreur de suppression"})}finally{l(!1)}};return r.jsx(kw,{open:e,onOpenChange:t,children:r.jsxs(Rw,{children:[r.jsxs(Cw,{children:[r.jsxs(Tw,{className:"flex items-center gap-2",children:[r.jsx(Jt,{className:"h-5 w-5 text-destructive"}),'Supprimer "',a,'"']}),r.jsxs(Pw,{children:["Cette action est irrversible. Le livre sera supprim dfinitivement de la base de donnes.",c&&r.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded flex items-start gap-2",children:[r.jsx(It,{className:"h-4 w-4 text-amber-500 mt-0.5"}),r.jsxs("span",{className:"text-amber-800",children:["Ce livre contient ",u," question",u>1?"s":""," de validation qui ",u>1?"seront galement supprimes":"sera galement supprime","."]})]})]})]}),r.jsxs(Aw,{children:[r.jsx(Dw,{disabled:o,children:"Annuler"}),r.jsx(Iw,{onClick:e=>{e.preventDefault(),p()},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:o,children:o?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Suppression..."]}):c?"Supprimer tout":"Supprimer dfinitivement"})]})]})})}function Ow(e){const t=(e?.tags||[]).map(e=>(e||"").toLowerCase()),s=(e?.author||"").toLowerCase();return t.includes("ancien testament")||s.includes("bible - ancien testament")?"ot":t.includes("nouveau testament")||s.includes("bible - nouveau testament")?"nt":t.includes("talmud")||t.includes("bavli")||t.includes("yerushalmi")||s.includes("talmud")?"talmud":"other"}const Mw={ot:{bg:"#FCF7ED",title:"#5A3921",icon:""},nt:{bg:"#F6FAFF",title:"#2E4159",icon:""},talmud:{bg:"#F7F6F1",title:"#4B4436",icon:""},other:{bg:"#F5F5F5",title:"#222222",icon:null}};function Vw(e,t,s,r){e.font=r;const n=(t||"Sans titre").split(/\s+/),a=[];let i="";for(const o of n){const t=i?`${i} ${o}`:o;e.measureText(t).width>s&&i?(a.push(i),i=o):i=t}return i&&a.push(i),a}async function qw(e){const t=512,s=768,r=document.createElement("canvas");r.width=t,r.height=s;const n=r.getContext("2d"),a=Ow(e),i=Mw[a],o="other"===a?function(e){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)>>>0;return`hsl(${t%360} 70% 95%)`}(e.title||e.slug||e.id):i.bg;n.fillStyle=o,n.fillRect(0,0,t,s);let l=30,c=`600 ${l}px system-ui, -apple-system, Segoe UI, Roboto, serif`,d=Vw(n,e.title,440,c);for(;d.length>3&&l>18;)l-=2,c=`600 ${l}px system-ui, -apple-system, Segoe UI, Roboto, serif`,d=Vw(n,e.title,440,c);n.fillStyle=i.title,n.textAlign="center",n.textBaseline="middle",n.font=c;const u=l+8,m=384-d.length*u/2;d.forEach((e,t)=>n.fillText(e,256,m+t*u)),i.icon&&(n.font="20px system-ui, -apple-system, Segoe UI, Roboto, serif",n.fillText(i.icon,256,740));const h=await new Promise((e,t)=>r.toBlob(s=>s?e(s):t(new Error("toBlob null")),"image/jpeg",.9));const p=`auto/${(e.slug||e.title||e.id||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}.jpg`,{error:f}=await en.storage.from("covers").upload(p,h,{upsert:!0,contentType:"image/jpeg"});if(f)throw f;const{data:g}=en.storage.from("covers").getPublicUrl(p),x=g?.publicUrl,{error:v}=await en.from("books").update({cover_url:x}).eq("id",e.id);if(v)throw v;return x}function Bw(){const[e,t]=s.useState([]),[n,a]=s.useState(!0),[i,o]=s.useState(null),[l,c]=s.useState(null),[d,u]=s.useState(!1),[m,h]=s.useState(0),[p,f]=s.useState(!1),[g,x]=s.useState(new Set),v=s.useCallback(async()=>{a(!0),o(null);try{const{data:e,error:s}=await en.from("books").select("id, title, slug, total_pages, cover_url, expected_segments");if(s)throw s;const{data:r}=await en.from("book_segment_status").select("*"),n=new Map(r?.map(e=>[e.slug,e])??[]),a=e.map(e=>{const t=e.total_pages||0,s=e.expected_segments??0,r=n.get(e.slug),a=r?.available_questions??0,i=r?.missing_segments??[],o="complete"===r?.status?"complete":"incomplete"===r?.status?"incomplete":"missing";return{id:e.id,title:e.title,slug:e.slug,total_pages:t,expectedSegments:s,availableQuestions:a,segments:[],missingSegments:i,status:o,cover_url:e.cover_url,author:"",description:"",totalChapters:s,chaptersRead:a,isCompleted:"complete"===o,language:"fr",categories:[],pages:t,publicationYear:(new Date).getFullYear()}});a.sort((e,t)=>{const s={incomplete:0,missing:1,complete:2};return s[e.status]-s[t.status]}),t(a)}catch(e){o(e.message||"Erreur lors de la rcupration des donnes")}finally{a(!1),f(!1)}},[]);s.useEffect(()=>{v()},[m,v]),s.useEffect(()=>{v()},[v]);const b=s.useCallback(()=>{h(e=>e+1)},[]),y=e=>{switch(e){case"complete":return r.jsxs("div",{className:"flex items-center text-green-600",children:[r.jsx(fe,{className:"w-5 h-5 mr-1"}),r.jsx("span",{children:"Complet"})]});case"incomplete":return r.jsxs("div",{className:"flex items-center text-amber-600",children:[r.jsx(It,{className:"w-5 h-5 mr-1"}),r.jsx("span",{children:"Incomplet"})]});case"missing":return r.jsxs("div",{className:"flex items-center text-destructive",children:[r.jsx(It,{className:"w-5 h-5 mr-1"}),r.jsx("span",{children:"Aucune question"})]})}},j=({book:e})=>r.jsxs(nx,{children:[r.jsx(ax,{asChild:!0,children:r.jsx(qn,{variant:"outline",size:"sm",className:"ml-2",disabled:0===e.missingSegments.length,children:"Voir segments manquants"})}),r.jsxs(lx,{children:[r.jsx(cx,{children:r.jsxs(ux,{className:"flex items-center gap-2",children:[r.jsx(xe,{className:"h-5 w-5"}),'Segments manquants pour "',e.title,'"']})}),r.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-4",children:0===e.missingSegments.length?r.jsxs("p",{className:"text-green-600 flex items-center",children:[r.jsx(fe,{className:"w-5 h-5 mr-2"}),"Tous les segments ont des questions"]}):r.jsxs("div",{children:[r.jsxs("p",{className:"mb-3",children:[e.missingSegments.length," segment",e.missingSegments.length>1?"s":""," sur ",e.expectedSegments," manquant",e.missingSegments.length>1?"s":""," :"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.missingSegments.map(e=>r.jsxs(Dh,{variant:"secondary",className:"px-3 py-1",children:["Segment ",e]},e))}),r.jsx("div",{className:"mt-4 p-3 bg-muted rounded-md",children:r.jsxs("p",{className:"text-body-sm flex items-start gap-2",children:[r.jsx(ss,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),r.jsx("span",{children:"Rappel : le segment 1 correspond aux pages 1  30, le segment 2 aux pages 31  60, etc."})]})})]})})]})]});return n&&!p?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"animate-spin h-8 w-8 mx-auto mb-4 text-coffee-dark"}),r.jsx("p",{className:"text-coffee-dark",children:"Chargement des donnes..."})]})}):i?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx(It,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),r.jsx("h3",{className:"text-h4 font-medium mb-2 text-destructive",children:"Erreur"}),r.jsx("p",{className:"text-muted-foreground",children:i}),r.jsx(qn,{onClick:v,className:"mt-4",children:"Ressayer"})]})}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h2",{className:"text-h4 font-serif font-medium text-coffee-darker",children:["tat des questions de validation (",e.length," livres)"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(qn,{onClick:()=>{f(!0),v()},variant:"outline",size:"sm",className:"gap-2",disabled:p,children:[p?r.jsx(Ne,{className:"h-4 w-4 animate-spin"}):r.jsx(es,{className:"h-4 w-4"}),"Recharger manuellement"]}),r.jsxs(qn,{onClick:async()=>{u(!0);try{const{data:e,error:t}=await en.from("reading_questions").select("id, book_slug, segment").eq("segment",0);if(t)throw t;if(!e||0===e.length)return mn("Aucun segment avec index 0 n'a t trouv.",{description:"Information"}),void u(!1);const s={success:0,skipped:0,failed:0};for(const r of e){const{data:e,error:t}=await en.from("reading_questions").select("id").eq("book_slug",r.book_slug).eq("segment",1).maybeSingle();if(t)s.failed++;else if(e){const{error:e}=await en.from("reading_questions").delete().eq("id",r.id);e?s.failed++:s.skipped++}else{const{error:e}=await en.from("reading_questions").update({segment:1}).eq("id",r.id);e?s.failed++:s.success++}}mn.success(`${s.success} segments mis  jour, ${s.skipped} segments supprims car redondants, ${s.failed} erreurs.`,{description:"Correction des segments termine"}),v()}catch(e){mn.error(`Impossible de corriger les segments: ${e.message}`,{description:"Erreur"})}finally{u(!1)}},variant:"outline",size:"sm",className:"gap-2",disabled:d,children:[d?r.jsx(Ne,{className:"h-4 w-4 animate-spin"}):r.jsx(ts,{className:"h-4 w-4"}),d?"Correction...":"Corriger les segments  zro"]}),r.jsx(_w,{onBookAdded:b}),r.jsxs(qn,{onClick:v,size:"sm",variant:"outline",className:"gap-2",children:[r.jsx(Ne,{className:"h-4 w-4"}),"Actualiser"]})]})]}),r.jsx("div",{className:"rounded-md border",children:r.jsxs(fw,{children:[r.jsx(gw,{children:r.jsxs(vw,{children:[r.jsx(bw,{className:"w-1/3",children:"Titre"}),r.jsx(bw,{className:"text-right",children:"Pages"}),r.jsx(bw,{className:"text-right",children:"Segments attendus"}),r.jsx(bw,{className:"text-right",children:"Questions disponibles"}),r.jsx(bw,{className:"text-right",children:"Couverture"}),r.jsx(bw,{className:"text-center",children:"Cover"}),r.jsx(bw,{className:"text-right",children:"tat"}),r.jsx(bw,{className:"text-right",children:"Actions"})]})}),r.jsxs(xw,{children:[e.map(e=>r.jsxs(vw,{children:[r.jsx(yw,{className:"font-medium",children:e.title}),r.jsx(yw,{className:"text-right",children:e.total_pages}),r.jsx(yw,{className:"text-right",children:e.expectedSegments}),r.jsx(yw,{className:"text-right",children:e.availableQuestions}),r.jsxs(yw,{className:"text-right",children:[Math.round(e.availableQuestions/e.expectedSegments*100),"%"]}),r.jsx(yw,{className:"text-center",children:e.cover_url?r.jsx("div",{className:"flex items-center justify-center text-green-600",children:r.jsx(fe,{className:"w-4 h-4"})}):r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>(async e=>{x(t=>new Set(t).add(e.id));try{const t=await qw(e);mn.success(`URL: ${t}`,{description:`Couverture gnre pour "${e.title}"`}),b()}catch(t){mn.error(t.message,{description:"Erreur lors de la gnration de la couverture"})}finally{x(t=>{const s=new Set(t);return s.delete(e.id),s})}})(e),disabled:g.has(e.id),className:"text-xs px-2 py-1 h-6",children:g.has(e.id)?r.jsx(Ne,{className:"w-3 h-3 animate-spin"}):" Gnrer"})}),r.jsx(yw,{className:"text-right",children:y(e.status)}),r.jsx(yw,{className:"text-right",children:r.jsxs("div",{className:"flex justify-end items-center gap-2",children:[r.jsx(ww,{book:e,onUpdate:b}),r.jsx(j,{book:e}),r.jsxs(qn,{variant:"outline",size:"sm",className:"border-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>(e=>{c(e)})({id:e.id,title:e.title}),children:[r.jsx(Jt,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Supprimer"})]})]})})]},e.id)),0===e.length&&r.jsx(vw,{children:r.jsx(yw,{colSpan:8,className:"h-24 text-center",children:"Aucun livre trouv"})})]})]})}),l&&r.jsx(Lw,{open:!!l,onOpenChange:e=>!e&&c(null),bookId:l.id,bookTitle:l.title,onDeleted:b})]})}function zw(){const{user:e}=kn(),[t,n]=s.useState(!1),[a,i]=s.useState(!0);return s.useEffect(()=>{!async function(){if(!e)return n(!1),void i(!1);try{const{data:t,error:s}=await en.from("profiles").select("is_admin").eq("id",e.id).single();n(!s&&(t?.is_admin||!1))}catch(t){n(!1)}finally{i(!1)}}()},[e]),a?r.jsxs(Px,{className:"p-4 mb-6 bg-amber-50 border-amber-300",children:[r.jsx("h3",{className:"text-h4 font-medium mb-2 text-amber-800",children:"Panneau de dbogage administrateur"}),r.jsx("p",{className:"text-body-sm",children:"Vrification des permissions..."})]}):r.jsxs(Px,{className:"p-4 mb-6 bg-amber-50 border-amber-300",children:[r.jsx("h3",{className:"text-h4 font-medium mb-2 text-amber-800",children:"Panneau de dbogage administrateur"}),r.jsxs("div",{className:"space-y-1 text-body-sm",children:[r.jsxs("p",{children:[r.jsx("span",{className:"font-semibold",children:"Email utilisateur :"})," ",e?.email||"Non connect"]}),r.jsxs("p",{children:[r.jsx("span",{className:"font-semibold",children:"Accs administrateur autoris :"})," ",t?"Oui":"Non"]}),r.jsxs("p",{children:[r.jsx("span",{className:"font-semibold",children:"ID utilisateur :"})," ",e?.id||"N/A"]}),r.jsx("p",{className:"text-caption text-amber-600 mt-2",children:"Statut bas sur la base de donnes"})]})]})}function Uw({className:e,classNames:t,showOutsideDays:s=!0,...n}){return r.jsx(rs,{showOutsideDays:s,className:zr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:zr(Vn({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:zr(Vn({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>r.jsx(Rt,{className:"h-4 w-4"}),IconRight:({...e})=>r.jsx(h,{className:"h-4 w-4"})},...n})}function Fw({currentImageUrl:e,currentImageAlt:t,onImageChange:n,onImageRemove:a}){const[i,o]=s.useState(!1),[l,c]=s.useState(t||""),d=s.useRef(null);return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(Vx,{children:"Image principale"}),r.jsxs("div",{className:"mt-2",children:[e?r.jsx("div",{className:"space-y-3",children:r.jsxs("div",{className:"relative inline-block",children:[r.jsx($g,{src:e,alt:l||"Image de l'article",className:"w-32 h-20 object-cover rounded border",sizes:"128px"}),r.jsx(qn,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:async()=>{if(e)try{await Sy.deleteImage(e),a(),c(""),mn.success("Image supprime")}catch(t){mn.error("Erreur lors de la suppression")}},children:r.jsx(R,{className:"h-3 w-3"})})]})}):r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx(ns,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsx("div",{className:"mt-2",children:r.jsxs(qn,{type:"button",variant:"outline",onClick:()=>d.current?.click(),disabled:i,className:"flex items-center gap-2",children:[r.jsx($t,{className:"h-4 w-4"}),i?"Upload en cours...":"Choisir une image"]})}),r.jsx("p",{className:"text-body-sm text-gray-500 mt-2",children:"PNG, JPG, GIF jusqu' 5MB"})]}),r.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)mn.error("L'image doit faire moins de 5MB");else{o(!0);try{const e=await Sy.uploadImage(t);n(e,l),mn.success("Image uploade avec succs")}catch(s){mn.error("Erreur lors de l'upload de l'image")}finally{o(!1)}}else mn.error("Veuillez slectionner un fichier image")},className:"hidden"})]})]}),e&&r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"image-alt",children:"Texte alternatif de l'image"}),r.jsx(Jg,{id:"image-alt",value:l,onChange:t=>{return s=t.target.value,c(s),void(e&&n(e,s));var s},placeholder:"Description de l'image pour l'accessibilit"}),r.jsx("p",{className:"text-body-sm text-muted-foreground mt-1",children:"Dcrivez l'image pour l'accessibilit et le SEO"})]})]})}function $w(){const[e,t]=s.useState([]),[n,a]=s.useState(!1),[i,o]=s.useState(null),[l,c]=s.useState({title:"",slug:"",content:"",excerpt:"",author:"VREAD",tags:[],published:!0,published_at:void 0,imageUrl:"",imageAlt:""}),[d,u]=s.useState(!1);s.useEffect(()=>{m()},[]);const m=async()=>{try{const e=await Sy.getAllPosts();t(e)}catch(e){mn.error("Erreur lors du chargement des articles")}},h=e=>e.toLowerCase().replace(/[]/g,"a").replace(/[]/g,"e").replace(/[]/g,"i").replace(/[]/g,"o").replace(/[]/g,"u").replace(/[]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),p=(e,t)=>{c(s=>({...s,imageUrl:e,imageAlt:t}))},f=()=>{c(e=>({...e,imageUrl:"",imageAlt:""}))},g=async()=>{if(l.title&&l.slug&&l.content){u(!0);try{i?(await Sy.updatePost({id:i.id,...l}),mn.success("Article mis  jour avec succs")):(await Sy.createPost(l),mn.success("Article cr avec succs")),await m(),a(!1),o(null)}catch(e){mn.error("Erreur lors de la sauvegarde")}finally{u(!1)}}else mn.error("Veuillez remplir tous les champs obligatoires")};return n?r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"flex items-center gap-2",children:[r.jsx(Ut,{className:"h-5 w-5"}),i?"Modifier l'article":"Nouvel article"]})}),r.jsxs(Ox,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"title",children:"Titre *"}),r.jsx(Jg,{id:"title",value:l.title,onChange:e=>{return t=e.target.value,void c(e=>({...e,title:t,slug:e.slug||h(t)}));var t},placeholder:"Titre de l'article"})]}),r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"slug",children:"Slug *"}),r.jsx(Jg,{id:"slug",value:l.slug,onChange:e=>c(t=>({...t,slug:e.target.value})),placeholder:"slug-de-l-article"})]})]}),r.jsx(Fw,{currentImageUrl:l.imageUrl,currentImageAlt:l.imageAlt,onImageChange:p,onImageRemove:f}),r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"excerpt",children:"Extrait"}),r.jsx($v,{id:"excerpt",value:l.excerpt,onChange:e=>c(t=>({...t,excerpt:e.target.value})),placeholder:"Rsum de l'article...",rows:3})]}),r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"content",children:"Contenu *"}),r.jsx($v,{id:"content",value:l.content,onChange:e=>c(t=>({...t,content:e.target.value})),placeholder:"Contenu de l'article (HTML ou Markdown)...",className:"min-h-[300px] font-mono text-body-sm"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(zv,{id:"published",checked:l.published,onCheckedChange:e=>c(t=>({...t,published:!!e}))}),r.jsx(Vx,{htmlFor:"published",children:"Publi"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{children:"Date de publication programme (optionnel)"}),r.jsxs(Uh,{children:[r.jsx(Fh,{asChild:!0,children:r.jsxs(qn,{variant:"outline",className:zr("w-full justify-start text-left font-normal",!l.published_at&&"text-muted-foreground"),children:[r.jsx(Ve,{className:"mr-2 h-4 w-4"}),l.published_at?Ot(new Date(l.published_at),"PPP '' HH:mm",{locale:pe}):r.jsx("span",{children:"Slectionner une date et heure"})]})}),r.jsxs($h,{className:"w-auto p-0",align:"start",children:[r.jsx(Uw,{mode:"single",selected:l.published_at?new Date(l.published_at):void 0,onSelect:e=>{if(e){const t=l.published_at?new Date(l.published_at):new Date;e.setHours(t.getHours(),t.getMinutes()),c(t=>({...t,published_at:e.toISOString()}))}else c(e=>({...e,published_at:void 0}))},disabled:e=>e<new Date,initialFocus:!0,className:"p-3 pointer-events-auto"}),l.published_at&&r.jsxs("div",{className:"p-3 border-t",children:[r.jsx(Vx,{className:"text-caption",children:"Heure"}),r.jsxs("div",{className:"flex gap-2 mt-1",children:[r.jsx(Jg,{type:"time",value:l.published_at?Ot(new Date(l.published_at),"HH:mm"):"12:00",onChange:e=>{if(l.published_at){const t=new Date(l.published_at),[s,r]=e.target.value.split(":");t.setHours(parseInt(s),parseInt(r)),c(e=>({...e,published_at:t.toISOString()}))}},className:"flex-1"}),r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>c(e=>({...e,published_at:void 0})),children:"Supprimer"})]})]})]})]}),l.published_at&&r.jsxs("p",{className:"text-caption text-muted-foreground flex items-center gap-1",children:[r.jsx(bt,{className:"h-3 w-3"}),"L'article sera publi automatiquement"]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(qn,{onClick:g,disabled:d,className:"flex items-center gap-2",children:[r.jsx(Ft,{className:"h-4 w-4"}),d?"Sauvegarde...":"Sauvegarder"]}),r.jsx(qn,{variant:"outline",onClick:()=>a(!1),disabled:d,children:"Annuler"})]})]})]}):r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Articles de blog"}),r.jsxs(qn,{onClick:()=>{o(null),c({title:"",slug:"",content:"",excerpt:"",author:"VREAD",tags:[],published:!0,published_at:void 0,imageUrl:"",imageAlt:""}),a(!0)},className:"flex items-center gap-2",children:[r.jsx(Pe,{className:"h-4 w-4"}),"Nouvel article"]})]})}),r.jsx(Ox,{children:0===e.length?r.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucun article trouv"}):r.jsxs(fw,{children:[r.jsx(gw,{children:r.jsxs(vw,{children:[r.jsx(bw,{children:"Titre"}),r.jsx(bw,{children:"Slug"}),r.jsx(bw,{children:"Statut"}),r.jsx(bw,{children:"Date"}),r.jsx(bw,{children:"Actions"})]})}),r.jsx(xw,{children:e.map(e=>r.jsxs(vw,{children:[r.jsx(yw,{className:"font-medium",children:e.title}),r.jsx(yw,{className:"text-muted-foreground",children:e.slug}),r.jsx(yw,{children:e.published_at&&new Date(e.published_at)>new Date?r.jsxs("span",{className:"px-2 py-1 rounded text-caption bg-blue-100 text-blue-800 flex items-center gap-1",children:[r.jsx(bt,{className:"h-3 w-3"}),"Programm"]}):r.jsx("span",{className:"px-2 py-1 rounded text-caption "+(e.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.published?"Publi":"Brouillon"})}),r.jsx(yw,{children:r.jsxs("div",{children:[r.jsx("div",{children:new Date(e.created_at).toLocaleDateString("fr-FR")}),e.published_at&&new Date(e.published_at)>new Date&&r.jsxs("div",{className:"text-caption text-muted-foreground",children:["Prog: ",Ot(new Date(e.published_at),"dd/MM '' HH:mm",{locale:pe})]})]})}),r.jsx(yw,{children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>window.open(`/blog/${e.slug}`,"_blank"),children:r.jsx(as,{className:"h-4 w-4"})}),r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>(e=>{o(e),c({title:e.title,slug:e.slug,content:e.content,excerpt:e.excerpt||"",author:e.author||"VREAD",tags:e.tags||[],published:e.published,published_at:e.published_at,imageUrl:e.imageUrl||"",imageAlt:e.imageAlt||""}),a(!0)})(e),children:r.jsx(Ut,{className:"h-4 w-4"})}),r.jsx(qn,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("tes-vous sr de vouloir supprimer cet article ?"))try{await Sy.deletePost(e),mn.success("Article supprim avec succs"),await m()}catch(t){mn.error("Erreur lors de la suppression")}})(e.id),children:r.jsx(Ae,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})}Uw.displayName="Calendar";function Ww(){return r.jsxs(qn,{onClick:async function(){const{data:{user:e}}=await en.auth.getUser();if(!e)return void mn.error("Vous devez tre connect pour exporter les donnes");const{data:t}=await en.from("profiles").select("is_admin").eq("id",e.id).single();if(!t?.is_admin)return void mn.error("Accs refus: Droits administrateur requis");const s=["books","reading_progress","reading_questions","reading_validations"];let r="-- Export SQL pour VREAD\n\n";for(const o of s){const{data:e,error:t}=await en.from(o).select("*");if(!t&&e){r+=`-- Table: ${o}\n`;for(const t of e){const e=Object.keys(t),s=e.map(e=>{const s=t[e];return null===s?"NULL":"string"==typeof s?`'${s.replace(/'/g,"''")}'`:"boolean"==typeof s?s?"TRUE":"FALSE":Array.isArray(s)?`'${JSON.stringify(s)}'`:s});r+=`INSERT INTO ${o} (${e.join(", ")}) VALUES (${s.join(", ")});\n`}r+="\n"}}const n=new Blob([r],{type:"text/sql;charset=utf-8"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download="read_export.sql",document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(a)},variant:"outline",className:"gap-2",children:[r.jsx(is,{className:"h-4 w-4"}),"Exporter la base VREAD (SQL)"]})}function Zw(){const[e,t]=s.useState(localStorage.getItem("vercel-webhook-url")||""),[n,a]=s.useState(!1);return r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsxs(Dx,{className:"flex items-center gap-2",children:[r.jsx(kt,{className:"h-5 w-5"}),"Configuration Vercel"]})}),r.jsxs(Ox,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"webhook-url",children:"URL du webhook de dploiement Vercel"}),r.jsx(Jg,{id:"webhook-url",value:e,onChange:e=>t(e.target.value),placeholder:"https://api.vercel.com/v1/integrations/deploy/..."}),r.jsx("p",{className:"text-body-sm text-muted-foreground mt-1",children:"Crez un webhook dans votre projet Vercel pour dclencher les redploiements automatiques"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(qn,{onClick:()=>{localStorage.setItem("vercel-webhook-url",e),mn.success("URL du webhook Vercel sauvegarde")},variant:"outline",children:"Sauvegarder"}),r.jsxs(qn,{onClick:async()=>{if(e){a(!0);try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trigger:"blog-update"})})).ok)throw new Error("Erreur lors du dclenchement");mn.success("Redploiement Vercel dclench avec succs")}catch(t){mn.error("Erreur lors du dclenchement du redploiement")}finally{a(!1)}}else mn.error("Veuillez d'abord configurer l'URL du webhook Vercel")},disabled:n||!e,className:"flex items-center gap-2",children:[r.jsx(kt,{className:"h-4 w-4"}),n?"Dclenchement...":"Dclencher le redploiement"]})]})]})]})}async function Hw(e=100,t="all"){const{data:s,error:r}=await en.from("books").select("id,title,slug,author,tags,cover_url").limit(e);if(r)throw r;return(s||[]).filter(e=>{if(!(function(e){if(!e)return!0;try{const t=new URL(e).hostname;return/(^|\.)vread\.fr$/i.test(t)}catch{return!0}}(e.cover_url)||!e.cover_url))return!1;const s=function(e){const t=(e?.tags||[]).map(e=>(e||"").toLowerCase()),s=(e?.author||"").toLowerCase();return t.includes("ancien testament")||s.includes("bible - ancien testament")?"ot":t.includes("nouveau testament")||s.includes("bible - nouveau testament")?"nt":t.includes("talmud")||t.includes("bavli")||t.includes("yerushalmi")||s.includes("talmud")?"talmud":"other"}(e);return"all"===t||s===t})}const Gw="autoCoverBatchLock",Kw="autoCoverBatchLastBeat";function Yw(){return Date.now()}function Qw(){try{localStorage.setItem(Gw,String(Yw())),localStorage.setItem(Kw,String(Yw()))}catch{}}function Xw(){try{localStorage.removeItem(Gw),localStorage.removeItem(Kw)}catch{}}function Jw({enabled:e=!0,batchSize:t=20,delayBetweenBatchesMs:r=2500,concurrency:n=3,variant:a="all"}){const{isAdmin:i}=kn(),[o,l]=s.useState(!1),[c,d]=s.useState({done:0,total:0}),u=s.useRef(null);return s.useEffect(()=>{if(!e||!i)return;let s=!1;return async function(){const{data:{user:e}}=await en.auth.getUser();if(e&&i&&function(){try{const e=localStorage.getItem(Gw),t=e?parseInt(e,10):0;return(!t||Yw()-t>9e4)&&(localStorage.setItem(Gw,String(Yw())),!0)}catch{return!0}}()){l(!0),u.current=window.setInterval(Qw,2e4);try{for(;!s;){const e=await Hw(t,a);if(0===e.length)break;d({done:0,total:e.length});let s=0,i=0;const o=async()=>{if(s>=e.length)return;const t=e[s++];try{await qw(t)}catch(V_){}finally{i++,d({done:i,total:e.length}),Qw(),await o()}};await Promise.all(Array.from({length:Math.min(n,e.length)},o)),await new Promise(e=>setTimeout(e,r))}}finally{l(!1),u.current&&window.clearInterval(u.current),Xw()}}}(),()=>{s=!0,u.current&&window.clearInterval(u.current),Xw()}},[e,t,r,n,a,i]),o&&c.total,null}function eN(){const[e,t]=s.useState("books"),n=nh(),a=async()=>{try{await(async()=>{try{const{data:e,error:t}=await en.from("books").select("id, title, slug, total_pages");if(t)throw t;const{data:s,error:r}=await en.from("reading_questions").select("book_slug, segment");if(r)throw r;const n=[];if(e.forEach(e=>{const t=e.total_pages||0,r=Math.ceil(t/30),a=s.filter(t=>t.book_slug===e.slug).map(e=>e.segment),i=[...new Set(a)],o=[];for(let s=0;s<r;s++)i.includes(s)||o.push(s);o.length>0&&n.push({id:e.id,title:e.title,missingSegments:o,expectedSegments:r,availableQuestions:i.length})}),0===n.length)throw new Error("Aucun livre avec des segments manquants n'a t trouv.");let a="book_id,titre,segment_manquant,questions_existantes,segments_attendus\n";n.forEach(e=>{e.missingSegments.forEach(t=>{a+=`"${e.id}","${e.title.replace(/"/g,'""')}",${t},${e.availableQuestions},${e.expectedSegments}\n`})});const i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),l=document.createElement("a"),c=(new Date).toISOString().split("T")[0];return l.setAttribute("href",o),l.setAttribute("download",`segments-manquants-${c}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),!0}catch(e){throw e}})(),mn.success("le fichier CSV des segments manquants a t tlcharg",{description:"Export russi"})}catch(e){mn.error("impossible de gnrer le fichier CSV",{description:"Erreur d'export"})}},i=async()=>{try{const e=["books","reading_progress","reading_questions","reading_validations"];let t="-- Export SQL pour VREAD\n\n";for(const a of e){const{data:e,error:s}=await en.from(a).select("*");if(!s&&e){t+=`-- Table: ${a}\n`;for(const s of e){const e=Object.keys(s),r=e.map(e=>{const t=s[e];return null===t?"NULL":"string"==typeof t?`'${t.replace(/'/g,"''")}'`:"boolean"==typeof t?t?"TRUE":"FALSE":Array.isArray(t)?`'${JSON.stringify(t)}'`:t});t+=`INSERT INTO ${a} (${e.join(", ")}) VALUES (${r.join(", ")});\n`}t+="\n"}}const s=new Blob([t],{type:"text/sql;charset=utf-8"}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download="read_export.sql",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(r),mn.success("le fichier SQL a t tlcharg",{description:"Export complet russi"})}catch(e){mn.error("impossible de gnrer le fichier SQL complet",{description:"Erreur d'export"})}};return r.jsx(Hh,{children:r.jsx(mw,{children:r.jsx(pw,{children:r.jsxs("div",{className:"min-h-screen bg-logo-background text-logo-text",children:[r.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:wh}),!n&&r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(qn,{onClick:a,variant:"outline",className:"gap-2",children:[r.jsx(ft,{className:"h-4 w-4"}),"Exporter les segments manquants"]}),r.jsxs(qn,{onClick:i,variant:"outline",className:"gap-2",children:[r.jsx(is,{className:"h-4 w-4"}),Ah]}),r.jsx(Ww,{})]}),n&&r.jsxs("div",{className:"flex gap-2",children:[r.jsx(qn,{onClick:a,variant:"outline",size:"sm",children:"CSV"}),r.jsx(qn,{onClick:i,variant:"outline",size:"sm",children:"SQL"})]})]}),!n&&r.jsx(zw,{}),r.jsx(Zw,{}),r.jsxs(Px,{className:"border-coffee-light",children:[r.jsxs(Ix,{className:"pb-3",children:[r.jsx(Dx,{children:Eh}),r.jsx(Lx,{children:"Grer les livres, articles de blog et vrifier le statut des questions de validation"})]}),r.jsx(Ox,{children:r.jsxs(Lh,{defaultValue:e,onValueChange:t,className:"w-full",children:[r.jsxs(Oh,{className:"mb-6",children:[r.jsxs(Mh,{value:"books",className:"flex items-center",children:[r.jsx("span",{className:"w-4 h-4 mr-2",children:""}),Sh]}),r.jsxs(Mh,{value:"blog",className:"flex items-center",children:[r.jsx("span",{className:"w-4 h-4 mr-2",children:""}),"Blog"]}),r.jsxs(Mh,{value:"settings",className:"flex items-center",children:[r.jsx("span",{className:"w-4 h-4 mr-2",children:""}),_h]})]}),r.jsx(Vh,{value:"books",children:r.jsx(Bw,{})}),r.jsx(Vh,{value:"blog",children:r.jsx($w,{})}),r.jsx(Vh,{value:"settings",children:r.jsxs("div",{className:"p-8 text-center border border-dashed rounded-lg",children:[r.jsx(It,{className:"w-12 h-12 mx-auto text-amber-500 mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-coffee-darker mb-2",children:Rh}),r.jsx("p",{className:"text-muted-foreground",children:Ch})]})})]})})]})]}),r.jsx(Jw,{enabled:!0,batchSize:20,concurrency:3,delayBetweenBatchesMs:2e3,variant:"all"})]})})})})}function tN(){kn();const[e,t]=s.useState("all"),[n,a]=s.useState([]),[i,o]=s.useState(!1),[l,c]=s.useState(0),[d,u]=s.useState([]),[m,h]=s.useState(500);async function p(){try{const t=await async function(e=500,t="all"){const{data:s,error:r}=await en.from("books").select("id,title,slug,author,tags,cover_url").limit(e);if(r)throw r;return(s||[]).filter(e=>{const s=Ow(e);var r;return(!e.cover_url||!!(r=e.cover_url)&&/(^https?:\/\/(www\.)?vread\.fr\/)/i.test(r))&&("all"===t||s===t)})}(m,"all"===e?"all":e);a(t),c(0),u([])}catch(V_){mn.error(V_.message)}}s.useEffect(()=>{p()},[e,m]);const f=s.useMemo(()=>n.length?Math.round(100*l/n.length):0,[l,n.length]);return r.jsx(Hh,{children:r.jsx(mw,{children:r.jsx(pw,{children:r.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-h1 font-medium mb-2",children:"Auto-covers (JPEG)"}),r.jsx("p",{className:"text-body-sm text-muted-foreground",children:"Gnre de vraies couvertures pour les livres sans image (ou fausse URL)."})]}),r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsx(Dx,{children:"Configuration"})}),r.jsxs(Ox,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{children:"Groupe"}),r.jsxs(uv,{value:e,onValueChange:e=>t(e),children:[r.jsx(hv,{children:r.jsx(mv,{})}),r.jsxs(gv,{children:[r.jsx(xv,{value:"all",children:"Tous"}),r.jsx(xv,{value:"ot",children:"Ancien Testament"}),r.jsx(xv,{value:"nt",children:"Nouveau Testament"}),r.jsx(xv,{value:"talmud",children:"Talmud"}),r.jsx(xv,{value:"other",children:"Autres"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{children:"Limite"}),r.jsx(Jg,{type:"number",min:1,max:2e3,value:m,onChange:e=>h(parseInt(e.target.value||"500",10))})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Vx,{children:""}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(qn,{onClick:p,variant:"outline",className:"flex-1",children:[r.jsx(Re,{className:"h-4 w-4 mr-2"}),"Rafrachir"]}),r.jsxs(qn,{onClick:async function(){if(!n.length)return void mn("Rien  faire");o(!0),c(0),u([]);let e=0;const t=async()=>{if(e>=n.length)return;const s=n[e++];try{await qw(s)}catch(V_){u(t=>[...t,{id:s.id,title:s.title,error:V_.message||"err"}])}finally{c(e=>e+1),await t()}};await Promise.all(Array.from({length:Math.min(4,n.length)},t)),o(!1),mn.success(`Batch termin : ${n.length-d.length} OK, ${d.length} erreurs`)},disabled:!n.length||i,className:"flex-1",children:[r.jsx(os,{className:"h-4 w-4 mr-2"}),i?"En cours":`Gnrer ${n.length}`]})]})]})]}),r.jsxs("div",{className:"text-body-sm text-muted-foreground",children:[n.length," livres  traiter  ",l,"/",n.length," effectus (",f,"%)"]}),i&&r.jsx("div",{className:"mt-4",children:r.jsx(Fg,{value:f,className:"w-full"})})]})]}),!!d.length&&r.jsx(Ux,{variant:"destructive",children:r.jsxs(Fx,{children:[r.jsxs("div",{className:"font-medium mb-2",children:["checs (",d.length,")"]}),r.jsx("ul",{className:"list-disc ml-5 space-y-1",children:d.slice(0,10).map(e=>r.jsxs("li",{className:"text-sm",children:[e.title,"  ",e.error]},e.id))})]})}),n.length>0&&r.jsxs(Px,{children:[r.jsxs(Ix,{children:[r.jsx(Dx,{children:"Aperu des livres"}),r.jsxs(Lx,{children:["Premiers ",Math.min(10,n.length)," livres de la liste"]})]}),r.jsx(Ox,{children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.slice(0,10).map(e=>r.jsxs("div",{className:"border rounded-lg p-3",children:[r.jsx("div",{className:"text-body font-medium",children:e.title}),r.jsx("div",{className:"text-caption text-muted-foreground",children:e.slug}),r.jsxs("div",{className:"text-caption text-muted-foreground",children:[e.author," ",e.tags?.length?` ${e.tags.join(", ")}`:""]})]},e.id))})})]})]})})})})}function sN(){const[e,t]=s.useState([]),[n,a]=s.useState("idle");function i(e){t(t=>[...t,e])}async function o(e){const t=512,s=768,r=document.createElement("canvas");r.width=t,r.height=s;const n=r.getContext("2d");if(!n)throw new Error("Canvas 2D non dispo");n.fillStyle="#F6FAFF",n.fillRect(0,0,t,s),n.fillStyle="#2E4159",n.textAlign="center",n.textBaseline="middle",n.font="600 28px system-ui, -apple-system, Segoe UI, Roboto, serif";const a=[],i=e.split(/\s+/);let o="";for(const c of i){const e=o?`${o} ${c}`:c;n.measureText(e).width>440&&o?(a.push(o),o=c):o=e}o&&a.push(o);const l=384-36*a.length/2;a.forEach((e,t)=>n.fillText(e,256,l+36*t)),n.font="20px system-ui, -apple-system, Segoe UI, Roboto, serif",n.fillText("",256,740);return await new Promise((e,t)=>r.toBlob(s=>s?e(s):t(new Error("toBlob null")),"image/jpeg",.9))}return r.jsx(Hh,{children:r.jsx(mw,{children:r.jsx(pw,{children:r.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[r.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Audit Supabase (Admin)"}),r.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Vrifie RLS (lecture), gnration JPEG, Storage (upload/remove) et update DB (avec rollback)."}),r.jsx("div",{className:"flex items-center gap-2 mb-4",children:r.jsx("button",{className:"border rounded px-3 py-2 text-sm",onClick:async function(){t([]),a("running");const e=[{key:"auth",label:"Vrification session admin",run:async()=>{const{data:{user:e},error:t}=await en.auth.getUser();if(t)throw t;if(!e)throw new Error("Pas de session");const{data:s,error:r}=await en.rpc("get_current_user_admin_status");if(r)throw r;if(!s)throw new Error("Utilisateur non admin (is_admin=false)");i(`OK admin: ${e.email||e.id}`)}},{key:"select_books",label:"Lecture books (RLS SELECT)",run:async()=>{const{data:e,error:t}=await en.from("books").select("id,title,cover_url").limit(1);if(t)throw t;e&&e.length?i(`OK lecture books: ${e[0].title}`):i("Aucun livre trouv (ce n'est pas une erreur si la base est vide)")}},{key:"gen_jpeg",label:"Gnration JPEG (Canvas)",run:async()=>{const e=await o("Audit Cover");if(!e||e.size<1e3)throw new Error("JPEG trop petit ou vide");i(`OK JPEG: ${(e.size/1024).toFixed(1)} kB`)}},{key:"upload_storage",label:"Upload Storage (covers/auto)",run:async()=>{const e=await o("Audit Cover"),t=`auto/audit-${Date.now()}.jpg`,s=await en.storage.from("covers").upload(t,e,{upsert:!0,contentType:"image/jpeg"});if(s.error)throw s.error;i(`OK upload: ${t}`),window.__audit_path=t}},{key:"update_book",label:"Update DB cover_url (rollback)",run:async()=>{const{data:e,error:t}=await en.from("books").select("id,cover_url,title").limit(1);if(t)throw t;if(!e||!e.length)return void i("Pas de livre  mettre  jour  on saute cette tape");const s=e[0],r=s.cover_url,{data:n}=en.storage.from("covers").getPublicUrl(window.__audit_path),a=n?.publicUrl;if(!a)throw new Error("URL publique introuvable");const o=await en.from("books").update({cover_url:a}).eq("id",s.id);if(o.error)throw o.error;i(`OK update cover_url sur: ${s.title}`);const l=await en.from("books").update({cover_url:r}).eq("id",s.id);if(l.error)throw l.error;i("OK rollback cover_url")}},{key:"cleanup",label:"Nettoyage (delete fichier test)",run:async()=>{const e=window.__audit_path;if(!e)return void i("Skip nettoyage (pas de path enregistr)");const t=await en.storage.from("covers").remove([e]);if(t.error)throw t.error;i("OK suppression fichier test")}}];try{for(const t of e)i(` ${t.label}`),await t.run();a("ok"),i(" Audit termin : TOUT OK")}catch(V_){a("fail"),i(` chec: ${V_.message||V_.toString()}`)}},disabled:"running"===n,children:"running"===n?"Audit en cours...":"Lancer l'audit"})}),r.jsx("div",{className:"text-sm p-3 rounded border bg-muted/50 whitespace-pre-wrap",children:e.length?e.join("\n"):""}),"ok"===n&&r.jsx("div",{className:"mt-3 text-green-700 text-sm",children:"Tout est oprationnel "}),"fail"===n&&r.jsx("div",{className:"mt-3 text-red-700 text-sm",children:"Audit en chec. Regarde les logs ci-dessus."})]})})})})}function rN(){const[e,t]=s.useState("all"),n=_e(),{data:a,isLoading:i}=ke({queryKey:["admin-book-requests",e],queryFn:async()=>{let t=en.from("book_requests").select("*").order("created_at",{ascending:!1});"all"!==e&&(t=t.eq("status",e));const{data:s,error:r}=await t;if(r)throw r;const n=[...new Set(s?.map(e=>e.user_id))],{data:a}=await en.from("profiles").select("id, username, email").in("id",n),i=new Map(a?.map(e=>[e.id,e]));return s?.map(e=>({...e,profile:i.get(e.user_id)}))}}),o=ls({mutationFn:async({id:e,status:t})=>{const{error:s}=await en.from("book_requests").update({status:t}).eq("id",e);if(s)throw s},onSuccess:()=>{n.invalidateQueries({queryKey:["admin-book-requests"]}),mn.success("Statut mis  jour")},onError:()=>{mn.error("Erreur lors de la mise  jour")}});return r.jsx(pw,{children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h1",{className:"text-h3 font-medium",children:"Demandes de livres"}),r.jsxs(uv,{value:e,onValueChange:t,children:[r.jsx(hv,{className:"w-[180px]",children:r.jsx(mv,{placeholder:"Filtrer par statut"})}),r.jsxs(gv,{children:[r.jsx(xv,{value:"all",children:"Tous"}),r.jsx(xv,{value:"pending",children:"En attente"}),r.jsx(xv,{value:"processing",children:"En traitement"}),r.jsx(xv,{value:"completed",children:"Complt"})]})]})]}),i?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(Ne,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):r.jsx("div",{className:"border rounded-lg",children:r.jsxs(fw,{children:[r.jsx(gw,{children:r.jsxs(vw,{children:[r.jsx(bw,{children:"Date"}),r.jsx(bw,{children:"Utilisateur"}),r.jsx(bw,{children:"Titre"}),r.jsx(bw,{children:"Auteur"}),r.jsx(bw,{children:"Notes"}),r.jsx(bw,{children:"Statut"}),r.jsx(bw,{children:"Actions"})]})}),r.jsxs(xw,{children:[a?.map(e=>r.jsxs(vw,{children:[r.jsx(yw,{className:"text-sm",children:Ot(new Date(e.created_at),"dd/MM/yyyy")}),r.jsx(yw,{className:"text-sm",children:e.profile?.username||e.profile?.email||""}),r.jsx(yw,{className:"font-medium",children:e.book_title}),r.jsx(yw,{className:"text-sm",children:e.book_author||""}),r.jsx(yw,{className:"text-sm max-w-xs truncate",children:e.reason||""}),r.jsx(yw,{children:r.jsxs("span",{className:"inline-flex px-2 py-1 text-xs rounded-full "+("completed"===e.status?"bg-green-100 text-green-800":"processing"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:["pending"===e.status&&"En attente","processing"===e.status&&"En traitement","completed"===e.status&&"Complt"]})}),r.jsx(yw,{children:r.jsxs(uv,{value:e.status,onValueChange:t=>o.mutate({id:e.id,status:t}),children:[r.jsx(hv,{className:"w-[140px]",children:r.jsx(mv,{})}),r.jsxs(gv,{children:[r.jsx(xv,{value:"pending",children:"En attente"}),r.jsx(xv,{value:"processing",children:"En traitement"}),r.jsx(xv,{value:"completed",children:"Complt"})]})]})})]},e.id)),!a?.length&&r.jsx(vw,{children:r.jsx(yw,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Aucune demande trouve"})})]})]})})]})})}function nN(){const{slug:e}=gt(),t=H(),{user:n}=kn(),[a,i]=s.useState(null),[o,l]=s.useState(!1),[c,d]=s.useState(!0),[u,m]=s.useState([]),[h,p]=s.useState(""),[f,g]=s.useState(!1),x=s.useRef(null);s.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[u]),s.useEffect(()=>{if(!e||!n?.id)return;(async()=>{try{d(!0);const s=await yx(e);if(!s)return void t("/explore");i(s);const r=await kx(n.id,e);if(!(r?.progressPercent>=100||"completed"===r?.status)&&null!==r)return void t(`/${e}`,{state:{accessDenied:!0,message:"Vous devez terminer ce livre pour accder au salon de discussion"}});l(!0),await v()}catch(s){t("/explore")}finally{d(!1)}})()},[e,n?.id,t]);const v=async()=>{if(e)try{const{data:t,error:s}=await en.from("book_chats").select("\n          id,\n          book_slug,\n          user_id,\n          content,\n          created_at,\n          profiles!inner (\n            username,\n            avatar_url\n          )\n        ").eq("book_slug",e).order("created_at",{ascending:!0}).limit(100);if(s)throw s;m(t||[])}catch(t){mn.error("Erreur lors du chargement des messages")}},b=async()=>{if(h.trim()&&n?.id&&e&&!f)try{g(!0);const{error:t}=await en.from("book_chats").insert({book_slug:e,user_id:n.id,content:h.trim()});if(t)throw t;p(""),mn.success("Message envoy !"),await v()}catch(t){mn.error("Erreur lors de l'envoi du message")}finally{g(!1)}};return s.useEffect(()=>{if(!e)return;const t=en.channel("book-chat-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"book_chats",filter:`book_slug=eq.${e}`},()=>{v()}).subscribe();return()=>{en.removeChannel(t)}},[e]),c?r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("main",{className:"container mx-auto px-4 py-6",children:r.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Vrification de l'accs..."})]})})})]})}):o||c?r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsxs("main",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs(T,{to:`/${e}`,className:"inline-flex items-center text-coffee-dark hover:text-coffee-darker mb-4",children:[r.jsx(At,{className:"h-4 w-4 mr-2"}),"Retour au livre"]}),r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(cs,{className:"h-6 w-6 text-coffee-dark"}),r.jsxs("h1",{className:"text-2xl font-bold text-coffee-darker",children:["Salon  ",a?.title||"Livre"]})]}),r.jsx("p",{className:"text-muted-foreground",children:"Discutez avec d'autres lecteurs qui ont termin ce livre"})]}),r.jsxs(Px,{className:"border-coffee-light",children:[r.jsx(Ix,{className:"pb-4",children:r.jsxs(Dx,{className:"text-lg text-coffee-dark",children:["Messages de la communaut ",a?.title?` ${a.title}`:""]})}),r.jsxs(Ox,{className:"space-y-4",children:[r.jsxs("div",{className:"h-96 overflow-y-auto space-y-4 p-4 bg-coffee-lightest/30 rounded-lg",children:[0===u.length?r.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[r.jsx(cs,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),r.jsx("p",{children:"Aucun message pour le moment."}),r.jsx("p",{className:"text-sm",children:"Soyez le premier  partager vos impressions !"})]}):u.map(e=>r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(xh,{className:"h-8 w-8 flex-shrink-0",children:[r.jsx(vh,{src:e.profiles?.avatar_url||void 0}),r.jsx(bh,{className:"bg-coffee-light text-coffee-darker text-sm",children:e.profiles?.username?.charAt(0)?.toUpperCase()||"?"})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[r.jsx("span",{className:"font-medium text-coffee-darker text-sm",children:e.profiles?.username||"Utilisateur"}),r.jsx("span",{className:"text-xs text-muted-foreground",children:he(new Date(e.created_at),{addSuffix:!0,locale:pe})})]}),r.jsx("p",{className:"text-foreground text-sm leading-relaxed",children:e.content})]})]},e.id)),r.jsx("div",{ref:x})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Jg,{value:h,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"Partagez vos impressions sur ce livre...",className:"flex-1",maxLength:500,disabled:f}),r.jsx(qn,{onClick:b,disabled:!h.trim()||f,className:"bg-coffee-dark hover:bg-coffee-darker text-white",children:f?r.jsx(Ne,{className:"h-4 w-4 animate-spin"}):"Envoyer"})]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Appuyez sur Entre pour envoyer  Maximum 500 caractres"})]})]})]})]})}):r.jsx(Hh,{children:r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("main",{className:"container mx-auto px-4 py-6",children:r.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ne,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Redirection en cours..."})]})})})]})})}function aN({title:e,description:t,canonical:s,noindex:n=!1,ogImage:a,ogType:i="website",publishedTime:o,modifiedTime:l,author:c,tags:d=[],section:u}){const m=s||("undefined"!=typeof window?window.location.href:"");return r.jsxs(A,{children:[r.jsx("title",{children:e}),r.jsx("meta",{name:"description",content:t}),r.jsx("meta",{name:"robots",content:n?"noindex, nofollow":"index, follow"}),r.jsx("link",{rel:"canonical",href:m}),r.jsx("meta",{property:"og:title",content:e}),r.jsx("meta",{property:"og:description",content:t}),r.jsx("meta",{property:"og:type",content:i}),r.jsx("meta",{property:"og:url",content:m}),a&&r.jsx("meta",{property:"og:image",content:a}),"article"===i&&o&&r.jsx("meta",{property:"article:published_time",content:o}),"article"===i&&l&&r.jsx("meta",{property:"article:modified_time",content:l}),"article"===i&&c&&r.jsx("meta",{property:"article:author",content:c}),"article"===i&&u&&r.jsx("meta",{property:"article:section",content:u}),"article"===i&&d.map(e=>r.jsx("meta",{property:"article:tag",content:e},e)),r.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),r.jsx("meta",{name:"twitter:title",content:e}),r.jsx("meta",{name:"twitter:description",content:t}),a&&r.jsx("meta",{name:"twitter:image",content:a}),r.jsx("meta",{name:"author",content:c||"VREAD"}),d.length>0&&r.jsx("meta",{name:"keywords",content:d.join(", ")})]})}function iN(){return r.jsxs(r.Fragment,{children:[r.jsx(aN,{title:"VREAD   propos  L'application qui transforme votre lecture",description:"Dcouvrez VREAD, l'application rvolutionnaire qui gamifie votre lecture grce  des questions IA, un systme de progression motivant et une communaut de lecteurs passionns. Transformez chaque page en succs !",canonical:"https://www.vread.fr/a-propos",tags:["lecture","application","motivation","communaut","livres","gamification"]}),r.jsx("main",{className:"container mx-auto px-4 py-10 max-w-4xl",children:r.jsxs("div",{className:"prose prose-neutral max-w-none",children:[r.jsx("h1",{className:"text-4xl font-bold mb-6",children:"VREAD : Rvolutionnez votre faon de lire"}),r.jsx("p",{className:"text-xl leading-relaxed mb-8 text-logo-accent font-medium",children:"VREAD accompagne votre lecture, page aprs page. Notre plateforme rvolutionnaire mle passion du livre, motivation personnelle et communaut bienveillante pour transformer chaque progression en victoire."}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Qu'est-ce que VREAD ?"}),r.jsxs("p",{className:"mb-6",children:["VREAD est l'application qui ",r.jsx("strong",{children:"gamifie intelligemment votre exprience de lecture"}),". Finies les lectures abandonnes  mi-parcours ! Grce  notre systme unique de validation par questions IA, chaque segment de lecture devient un dfi stimulant et chaque page tourne, un succs tangible."]}),r.jsxs("div",{className:"bg-gradient-to-r from-logo-accent/10 to-logo-background/10 p-6 rounded-lg mb-8",children:[r.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Comment a marche ?"}),r.jsxs("ul",{className:"space-y-3",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"1. Choisissez votre livre"})," parmi notre vaste bibliothque"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"2. Lisez par segments"})," d'environ 30 pages"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"3. Validez votre comprhension"})," avec une question IA personnalise"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"4. Progressez et dbloquez"})," des badges et rcompenses"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"5. Partagez vos succs"})," avec la communaut VREAD"]})]})]}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Notre mission"}),r.jsxs("p",{className:"mb-6",children:[r.jsx("strong",{children:"Dmocratiser la lecture rgulire"})," en la rendant accessible, motivante et sociale. Nous croyons que chaque personne peut dvelopper une habitude de lecture durable avec les bons outils et la bonne communaut. VREAD transforme la lecture solitaire en aventure collective."]}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Nos valeurs fondamentales"}),r.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[r.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[r.jsx("h3",{className:"font-semibold mb-2",children:" Accessibilit"}),r.jsx("p",{children:"La lecture pour tous, sans discrimination de niveau ou de rythme. Chacun avance  sa vitesse."})]}),r.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[r.jsx("h3",{className:"font-semibold mb-2",children:" Communaut"}),r.jsx("p",{children:"Avancer ensemble, s'entraider et clbrer les victoires de chacun dans un esprit bienveillant."})]}),r.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[r.jsx("h3",{className:"font-semibold mb-2",children:" Progression"}),r.jsx("p",{children:"Suivre ses objectifs, visualiser ses progrs et maintenir la motivation sur le long terme."})]}),r.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[r.jsx("h3",{className:"font-semibold mb-2",children:" Dcouverte"}),r.jsx("p",{children:"Ouvrir de nouveaux horizons littraires et encourager l'exploration de genres varis."})]})]}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Pourquoi choisir VREAD ?"}),r.jsxs("ul",{className:"space-y-4 mb-8",children:[r.jsxs("li",{children:[r.jsx("strong",{children:" Interface intuitive"})," : Design moderne et ergonomique pour une exprience fluide"]}),r.jsxs("li",{children:[r.jsx("strong",{children:" IA personnalise"})," : Questions adaptes  votre niveau et style de lecture"]}),r.jsxs("li",{children:[r.jsx("strong",{children:" Gamification motivante"})," : Badges, classements et dfis pour maintenir l'engagement"]}),r.jsxs("li",{children:[r.jsx("strong",{children:" Suivi dtaill"})," : Statistiques compltes de vos habitudes de lecture"]}),r.jsxs("li",{children:[r.jsx("strong",{children:" Communaut active"})," : changez avec des milliers de lecteurs passionns"]}),r.jsxs("li",{children:[r.jsx("strong",{children:" Bibliothque riche"})," : Des milliers de livres dans tous les genres"]})]}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" L'quipe VREAD"}),r.jsx("p",{className:"mb-6",children:"VREAD est n de la passion d'une quipe de dveloppeurs et de passionns de littrature. Nous sommes convaincus que la technologie peut servir la culture et rendre la lecture plus accessible  l're numrique. Chaque fonctionnalit est pense avec soin pour respecter l'exprience de lecture tout en l'enrichissant."}),r.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Contact et support"}),r.jsx("p",{className:"mb-4",children:"Des questions ? Des suggestions ? Notre quipe est  votre coute pour amliorer continuellement votre exprience VREAD. Rejoignez notre communaut Discord ou crivez-nous directement !"}),r.jsxs("p",{className:"mb-6",children:[r.jsx("strong",{children:"Pour nous contacter :"})," ",r.jsx("a",{href:"mailto:tanguy@vread.fr",className:"text-logo-accent hover:underline font-medium",children:"tanguy@vread.fr"})]}),r.jsxs("div",{className:"bg-logo-background text-white p-8 rounded-lg text-center mt-12",children:[r.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Prt  transformer votre lecture ?"}),r.jsx("p",{className:"mb-6 text-lg",children:"Rejoignez des milliers de lecteurs qui ont dj rvolutionn leurs habitudes de lecture avec VREAD."}),r.jsx(T,{to:"/auth",className:"inline-block bg-white text-logo-background hover:bg-gray-100 px-8 py-4 rounded-lg font-bold text-lg transition-colors shadow-lg",children:"Crer mon compte gratuitement"})]})]})})]})}function oN(){return r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsx("title",{children:"Presse | VREAD"}),r.jsx("meta",{name:"description",content:"Espace presse VREAD : kit mdia, logos, visuels, contacts et communiqus."}),r.jsx("link",{rel:"canonical",href:"https://www.vread.fr/presse"}),r.jsx("meta",{property:"og:title",content:"Presse | VREAD"}),r.jsx("meta",{property:"og:description",content:"Kit mdia, logos, visuels et contact presse VREAD."}),r.jsx("meta",{property:"og:type",content:"website"}),r.jsx("meta",{property:"og:url",content:"https://www.vread.fr/presse"}),r.jsx("style",{children:'script[type="application/ld+json"]{display:block !important;min-height:1px;width:1px;margin:0;padding:0;border:0}'})]}),r.jsx("main",{className:"container mx-auto px-4 py-10 max-w-4xl",children:r.jsxs("div",{className:"prose prose-neutral max-w-none",children:[r.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Presse"}),r.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify({"@context":"https://schema.org","@type":"Organization",name:"VREAD",url:"https://www.vread.fr/"})}}),r.jsx("p",{className:"text-base leading-relaxed mb-8",children:"VREAD accompagne les lecteurs page aprs page et transforme la lecture en exprience sociale et motivante. Retrouvez ici notre kit mdia."}),r.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Kit mdia"}),r.jsxs("div",{className:"bg-muted p-6 rounded-lg mb-8",children:[r.jsx("strong",{className:"block mb-4",children:"Logos & visuels officiels"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("a",{href:"/branding/vread-logo.svg",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (SVG)"}),r.jsx("a",{href:"/branding/vread-logo-192.png",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (PNG 192px)"}),r.jsx("a",{href:"/branding/vread-logo-512.png",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (PNG 512px)"}),r.jsx("a",{href:"/branding/vread-logo-1024-q80.webp",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (WebP 1024px)"})]})]}),r.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Contact presse"}),r.jsx("p",{className:"mb-2",children:"Pour toute demande mdia, contactez-nous :"}),r.jsxs("p",{className:"mb-8",children:[r.jsx("strong",{children:"Email :"})," contact@vread.fr"]}),r.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Communiqus & actus"}),r.jsxs("p",{className:"mb-8",children:["Consultez notre ",r.jsx(T,{to:"/blog",className:"text-logo-accent hover:underline",children:"blog"})," pour les dernires annonces."]}),r.jsx(T,{to:"/auth",className:"inline-block bg-logo-accent hover:bg-logo-accent-dark text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Dcouvrir VREAD"})]})})]})}function lN(){const{t:e}=Tn();return r.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-logo-accent/20 bg-logo-background/95 backdrop-blur supports-[backdrop-filter]:bg-logo-background/60",role:"banner",children:r.jsxs("div",{className:"mx-auto w-full px-4 max-w-none flex h-16 sm:h-14 items-center justify-between",children:[r.jsxs(T,{to:"/",className:"flex items-center gap-2 focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2 rounded-md focus:outline-none","aria-label":"VREAD - Retour  l'accueil",children:[r.jsx(Pn,{size:32,className:"h-8 w-8"}),r.jsx("span",{className:"text-h4 font-serif text-logo-text",children:"VREAD"})]}),r.jsxs("nav",{className:"hidden md:flex items-center space-x-6",role:"navigation","aria-label":"Navigation principale",children:[r.jsx(T,{to:"/blog",className:"text-white/80 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-logo-background rounded px-2 py-1",children:e.nav.blog}),r.jsx(T,{to:"/a-propos",className:"text-white/80 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-logo-background rounded px-2 py-1",children:e.nav.about}),r.jsx(T,{to:"/presse",className:"text-white/80 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-logo-background rounded px-2 py-1",children:e.nav.press})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Zn,{}),r.jsx(qn,{variant:"default",className:"bg-logo-accent hover:bg-logo-accent/90 text-logo-background focus:ring-2 focus:ring-logo-accent focus:ring-offset-2",asChild:!0,children:r.jsx(T,{to:"/auth","aria-label":"Se connecter  votre compte VREAD",children:e.auth.signIn})})]})]})})}function cN({children:e}){return r.jsxs("div",{className:"min-h-screen flex flex-col",children:[r.jsx(lN,{}),r.jsx("main",{className:"flex-1",children:e}),r.jsx(qx,{})]})}const dN=ps,uN=s.forwardRef(({className:e,...t},s)=>r.jsx(ds,{ref:s,className:zr("border-b",e),...t}));uN.displayName="AccordionItem";const mN=s.forwardRef(({className:e,children:t,...s},n)=>r.jsx(us,{className:"flex",children:r.jsxs(ms,{ref:n,className:zr("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...s,children:[t,r.jsx(Me,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));mN.displayName=ms.displayName;const hN=s.forwardRef(({className:e,children:t,...s},n)=>r.jsx(hs,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:r.jsx("div",{className:zr("pb-4 pt-0",e),children:t})}));function pN(){return r.jsxs(cN,{children:[r.jsx(aN,{title:"VREAD et Duolingo : Quelle app pour apprendre le franais ? | Comparaison 2025",description:"Comparaison complte entre VREAD et Duolingo pour apprendre le franais. Dcouvrez quelle app correspond le mieux  votre niveau et vos objectifs de lecture.",canonical:"https://www.vread.fr/duolingo",ogType:"article",tags:["duolingo","apprendre franais","lecture","comparaison","application franais","DELF","DALF"]}),r.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:"VREAD et Duolingo : Comparaison complte pour apprendre le franais",description:"Comparaison dtaille entre VREAD et Duolingo pour apprendre le franais. Analyse des forces, faiblesses, prix et recommandations selon votre niveau.",url:"https://www.vread.fr/duolingo",author:{"@type":"Organization",name:"VREAD"},publisher:{"@type":"Organization",name:"VREAD",logo:{"@type":"ImageObject",url:"https://www.vread.fr/logo.png"}},datePublished:"2025-01-15",dateModified:(new Date).toISOString().split("T")[0],mainEntityOfPage:"https://www.vread.fr/duolingo",keywords:"duolingo, apprendre franais, lecture, comparaison, application franais, DELF, DALF, B2, C1, C2"})}),r.jsxs("article",{className:"container mx-auto px-4 py-12 max-w-4xl",children:[r.jsxs("nav",{className:"text-body-sm text-muted-foreground mb-6","aria-label":"Breadcrumb",children:[r.jsx(T,{to:"/",className:"hover:text-foreground transition-colors",children:"Accueil"}),r.jsx("span",{className:"mx-2",children:"/"}),r.jsx("span",{children:"Comparaison Duolingo"})]}),r.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 mb-8",children:r.jsx("p",{className:"text-body-sm text-muted-foreground",children:" VREAD n'est pas affili  Duolingo Inc. Cette comparaison est indpendante et factuelle."})}),r.jsxs("header",{className:"mb-12",children:[r.jsx("h1",{className:"text-h1 font-serif text-foreground mb-4",children:"VREAD et Duolingo : Comparaison complte pour apprendre le franais"}),r.jsx("p",{className:"text-h4 text-muted-foreground font-sans",children:"Duolingo et VREAD sont deux excellentes apps pour apprendre le franais. Mais laquelle choisir selon votre niveau et vos objectifs ?"})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Comparaison rapide"}),r.jsx("div",{className:"hidden md:block overflow-x-auto",children:r.jsxs("table",{className:"w-full border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"border-b-2 border-border",children:[r.jsx("th",{className:"text-left p-4 text-body font-semibold",children:"Critre"}),r.jsx("th",{className:"text-left p-4 text-body font-semibold",children:"Duolingo"}),r.jsx("th",{className:"text-left p-4 text-body font-semibold",children:"VREAD"})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{className:"border-b border-border bg-muted/20",children:[r.jsx("td",{className:"p-4 text-body",children:" Focus principal"}),r.jsx("td",{className:"p-4 text-body",children:"Vocabulaire + Grammaire"}),r.jsx("td",{className:"p-4 text-body",children:"Lecture + Comprhension"})]}),r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-4 text-body",children:" Type de contenu"}),r.jsx("td",{className:"p-4 text-body",children:"Exercices courts (5-10 min)"}),r.jsx("td",{className:"p-4 text-body",children:"Livres complets (romans, classiques)"})]}),r.jsxs("tr",{className:"border-b border-border bg-muted/20",children:[r.jsx("td",{className:"p-4 text-body",children:" Gamification"}),r.jsx("td",{className:"p-4 text-body",children:" Srie quotidienne, leagues"}),r.jsx("td",{className:"p-4 text-body",children:" Stats de lecture, badges"})]}),r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-4 text-body",children:" Niveau recommand"}),r.jsx("td",{className:"p-4 text-body",children:"Dbutant  intermdiaire (A1-B1)"}),r.jsx("td",{className:"p-4 text-body",children:"Intermdiaire avanc (B2-C2)"})]}),r.jsxs("tr",{className:"border-b border-border bg-muted/20",children:[r.jsx("td",{className:"p-4 text-body",children:" Prix gratuit"}),r.jsx("td",{className:"p-4 text-body",children:"Trs gnreux, presque tout accessible"}),r.jsx("td",{className:"p-4 text-body",children:"Catalogue complet de classiques"})]}),r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-4 text-body",children:" Premium"}),r.jsx("td",{className:"p-4 text-body",children:"Super Duolingo : 6,99/mois"}),r.jsx("td",{className:"p-4 text-body",children:"VREAD Premium : 29  vie (offre lancement)"})]}),r.jsxs("tr",{className:"border-b border-border bg-muted/20",children:[r.jsx("td",{className:"p-4 text-body",children:" Disponibilit"}),r.jsx("td",{className:"p-4 text-body",children:"iOS, Android, Web"}),r.jsx("td",{className:"p-4 text-body",children:"iOS, Web"})]}),r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-4 text-body",children:" Langues disponibles"}),r.jsx("td",{className:"p-4 text-body",children:"40+ langues"}),r.jsx("td",{className:"p-4 text-body",children:"Franais uniquement (focus spcialis)"})]})]})]})}),r.jsx("div",{className:"md:hidden space-y-4",children:[{label:" Focus principal",duolingo:"Vocabulaire + Grammaire",vread:"Lecture + Comprhension"},{label:" Type de contenu",duolingo:"Exercices courts (5-10 min)",vread:"Livres complets (romans, classiques)"},{label:" Gamification",duolingo:" Srie quotidienne, leagues",vread:" Stats de lecture, badges"},{label:" Niveau recommand",duolingo:"Dbutant  intermdiaire (A1-B1)",vread:"Intermdiaire avanc (B2-C2)"},{label:" Prix gratuit",duolingo:"Trs gnreux, presque tout accessible",vread:"Catalogue complet de classiques"},{label:" Premium",duolingo:"Super Duolingo : 6,99/mois",vread:"VREAD Premium : 29  vie (offre lancement)"},{label:" Disponibilit",duolingo:"iOS, Android, Web",vread:"iOS, Web"},{label:" Langues disponibles",duolingo:"40+ langues",vread:"Franais uniquement (focus spcialis)"}].map((e,t)=>r.jsx(Px,{children:r.jsxs(Ox,{className:"p-4",children:[r.jsx("h3",{className:"text-body font-semibold mb-3",children:e.label}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-body-sm font-medium text-muted-foreground",children:"Duolingo"}),r.jsx("p",{className:"text-body",children:e.duolingo})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-body-sm font-medium text-muted-foreground",children:"VREAD"}),r.jsx("p",{className:"text-body",children:e.vread})]})]})]})},t))})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Duolingo : Pourquoi c'est excellent"}),r.jsxs("div",{className:"prose prose-lg max-w-none",children:[r.jsx("p",{className:"text-body mb-6",children:"Duolingo est l'application d'apprentissage des langues la plus populaire au monde, avec plus de 500 millions d'utilisateurs. Et pour cause :"}),r.jsxs("div",{className:"space-y-6 mb-8",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Parfait pour dbuter"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Si vous n'avez jamais appris le franais, Duolingo vous prend par la main avec des exercices progressifs adapts aux dbutants."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Gamification addictive"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Le systme de sries quotidiennes (streaks), les leagues et les XP rendent l'apprentissage ludique et motivant."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Vocabulaire structur"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Vous apprenez le vocabulaire de base dans des contextes simples et pratiques."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Gratuit gnreux"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"La version gratuite offre accs  presque tout le contenu. Le premium enlve juste les pubs et ajoute des vies illimites."})]})]}),r.jsx(Px,{className:"bg-primary/5 border-primary/20",children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-3",children:"Duolingo est idal si :"}),r.jsxs("ul",{className:"space-y-2 text-body",children:[r.jsx("li",{children:" Vous dbutez le franais (niveau A1-A2)"}),r.jsx("li",{children:" Vous voulez apprendre du vocabulaire quotidien"}),r.jsx("li",{children:" Vous aimez les exercices courts et gamifis"}),r.jsx("li",{children:" Vous apprenez plusieurs langues"})]})]})})]})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"VREAD : Une approche complmentaire"}),r.jsxs("div",{className:"prose prose-lg max-w-none",children:[r.jsx("p",{className:"text-body mb-6",children:"VREAD prend une approche diffrente : l'apprentissage par la lecture immersive."}),r.jsxs("div",{className:"space-y-6 mb-8",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Vraie littrature"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Lisez de vrais livres franais (Molire, Hugo, Verne, Dumas) et des romans contemporains, pas des exercices artificiels."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Comprhension contextuelle"}),r.jsx("p",{className:"text-body text-muted-foreground",children:'Aprs chaque chapitre, validez votre comprhension avec des questions tires du texte. Vous ne lisez pas "en pilote automatique".'})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Culture franaise"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"En lisant la littrature franaise, vous dcouvrez la culture, l'histoire et les rfrences culturelles que tout francophone connat."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Stats motivantes"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Suivez vos pages lues, votre taux de comprhension, vos sries de lecture, comme sur une app de sport."})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:" Demandez n'importe quel livre"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Avec Premium, demandez l'ajout de n'importe quel livre franais (ajout en 48h)."})]})]}),r.jsx(Px,{className:"bg-secondary/10 border-secondary/30",children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-3",children:"VREAD est idal si :"}),r.jsxs("ul",{className:"space-y-2 text-body",children:[r.jsx("li",{children:" Vous avez dj un niveau B2+ en franais"}),r.jsx("li",{children:" Vous voulez lire de vrais livres, pas juste des exercices"}),r.jsx("li",{children:" Vous cherchez  comprendre la culture franaise en profondeur"}),r.jsx("li",{children:" Vous aimez suivre votre progression comme sur Strava"})]})]})})]})]}),r.jsx("section",{className:"mb-16",children:r.jsx(Px,{className:"bg-accent/10 border-accent/30",children:r.jsxs(Ox,{className:"p-8",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Notre recommandation : Utilisez les deux !"}),r.jsxs("p",{className:"text-body mb-6",children:["VREAD et Duolingo ne sont pas concurrents, ils sont ",r.jsx("strong",{children:"complmentaires"})," :"]}),r.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-3",children:" Le matin : Duolingo (15 min)"}),r.jsxs("ul",{className:"space-y-2 text-body",children:[r.jsx("li",{children:" Rvisez votre vocabulaire"}),r.jsx("li",{children:" Faites vos exercices de grammaire"}),r.jsx("li",{children:" Maintenez votre srie quotidienne"})]})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-3",children:" Le soir : VREAD (30 min)"}),r.jsxs("ul",{className:"space-y-2 text-body",children:[r.jsx("li",{children:" Lisez un chapitre de votre livre en cours"}),r.jsx("li",{children:" Validez votre comprhension"}),r.jsx("li",{children:" Progressez dans la vraie littrature franaise"})]})]})})]}),r.jsxs("p",{className:"text-h4 font-sans font-semibold text-foreground",children:[r.jsx("strong",{children:"Rsultat :"})," Une progression rapide et complte en franais, avec  la fois les bases solides (Duolingo) et la pratique immersive (VREAD)."]})]})})}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Questions frquentes"}),r.jsxs(dN,{type:"single",collapsible:!0,className:"w-full",children:[r.jsxs(uN,{value:"item-1",children:[r.jsx(mN,{className:"text-left text-body font-semibold",children:"VREAD peut-il remplacer Duolingo ?"}),r.jsx(hN,{className:"text-body text-muted-foreground",children:"Non, ils servent des objectifs diffrents. Duolingo est excellent pour le vocabulaire de base et la grammaire. VREAD se concentre sur la lecture et la comprhension de textes authentiques."})]}),r.jsxs(uN,{value:"item-2",children:[r.jsx(mN,{className:"text-left text-body font-semibold",children:"Peut-on utiliser VREAD en tant que dbutant ?"}),r.jsx(hN,{className:"text-body text-muted-foreground",children:"VREAD est optimis pour les niveaux B2 et plus. Si vous tes dbutant (A1-A2), nous vous recommandons de commencer par Duolingo pendant 6-12 mois, puis d'ajouter VREAD quand vous serez  l'aise avec les bases."})]}),r.jsxs(uN,{value:"item-3",children:[r.jsx(mN,{className:"text-left text-body font-semibold",children:"Lequel est le meilleur pour passer le DELF/DALF ?"}),r.jsx(hN,{className:"text-body text-muted-foreground",children:"Pour le DELF B1-B2 : Duolingo + VREAD. Pour le DALF C1-C2 : VREAD est plus adapt car vous devez lire des textes complexes."})]})]})]}),r.jsx("section",{className:"text-center mb-16",children:r.jsx(Px,{className:"bg-gradient-to-br from-primary/10 to-accent/10 border-primary/20",children:r.jsxs(Ox,{className:"p-12",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-4",children:"Prt  commencer avec VREAD ?"}),r.jsx("p",{className:"text-body text-muted-foreground mb-8",children:"Gratuit  iPhone & Web  Catalogue de classiques inclus"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[r.jsx(qn,{asChild:!0,size:"lg",className:"text-body",children:r.jsx(T,{to:"/auth",children:"Essayer VREAD gratuitement"})}),r.jsx(qn,{asChild:!0,variant:"outline",size:"lg",className:"text-body",children:r.jsx(T,{to:"/a-propos",children:"En savoir plus sur VREAD"})})]})]})})}),r.jsx("footer",{className:"border-t border-border pt-8",children:r.jsx("p",{className:"text-caption text-muted-foreground",children:"Cette page a t cre  titre informatif. Duolingo est une marque dpose de Duolingo Inc. VREAD n'est pas affili, associ, autoris, approuv par, ou de quelque manire que ce soit officiellement li  Duolingo Inc."})})]})]})}function fN(){return r.jsxs(cN,{children:[r.jsx(aN,{title:"Le Strava de la lecture : VREAD | Suivez votre progression comme un runner",description:"Vous aimez Strava pour le running ? Dcouvrez VREAD, qui applique la mme approche de tracking et motivation  la lecture de livres franais.",canonical:"https://www.vread.fr/strava",ogType:"article",tags:["strava","lecture","tracking","progression","stats","gamification","habitude lecture"]}),r.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:"VREAD : Le Strava de la lecture",description:"Dcouvrez comment VREAD applique les principes de tracking et gamification de Strava  la lecture de livres franais. Stats, sries, badges et progression.",url:"https://www.vread.fr/strava",author:{"@type":"Organization",name:"VREAD"},publisher:{"@type":"Organization",name:"VREAD",logo:{"@type":"ImageObject",url:"https://www.vread.fr/logo.png"}},datePublished:"2025-01-15",dateModified:(new Date).toISOString().split("T")[0],mainEntityOfPage:"https://www.vread.fr/strava",keywords:"strava lecture, tracking lecture, stats lecture, progression lecture, gamification, habitude lecture, sries lecture"})}),r.jsxs("article",{className:"container mx-auto px-4 py-12 max-w-4xl",children:[r.jsxs("nav",{className:"text-body-sm text-muted-foreground mb-6","aria-label":"Breadcrumb",children:[r.jsx(T,{to:"/",className:"hover:text-foreground transition-colors",children:"Accueil"}),r.jsx("span",{className:"mx-2",children:"/"}),r.jsx("span",{children:"Le Strava de la lecture"})]}),r.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 mb-8",children:r.jsx("p",{className:"text-body-sm text-muted-foreground",children:" VREAD n'est pas affili  Strava Inc. Nous utilisons Strava comme rfrence pour expliquer notre approche de la lecture."})}),r.jsxs("header",{className:"mb-12",children:[r.jsx("h1",{className:"text-h1 font-serif text-foreground mb-4",children:"VREAD : Le Strava de la lecture"}),r.jsx("p",{className:"text-h4 text-muted-foreground font-sans",children:"Vous adorez Strava pour tracker vos runs et battre vos records ? Imaginez la mme chose... mais pour la lecture."})]}),r.jsx("section",{className:"mb-16",children:r.jsx(Px,{className:"bg-gradient-to-br from-primary/5 to-accent/5 border-primary/20",children:r.jsxs(Ox,{className:"p-8",children:[r.jsx("p",{className:"text-body mb-4",children:"Si vous utilisez Strava pour vos courses, vous connaissez cette sensation :"}),r.jsxs("ul",{className:"space-y-3 text-body mb-6",children:[r.jsx("li",{children:" Voir vos kilomtres s'accumuler semaine aprs semaine"}),r.jsx("li",{children:" Battre votre record personnel"}),r.jsx("li",{children:" Maintenir votre srie de jours conscutifs"}),r.jsx("li",{children:" Observer votre progression sur des graphiques motivants"})]}),r.jsx("p",{className:"text-h3 font-serif text-foreground font-semibold",children:"Et si vous pouviez avoir la mme chose pour la lecture ?"}),r.jsx("p",{className:"text-h4 font-sans text-foreground mt-4",children:"C'est exactement ce que fait VREAD."})]})})}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Strava pour le running, VREAD pour la lecture"}),r.jsx("div",{className:"hidden md:block overflow-x-auto",children:r.jsxs("table",{className:"w-full border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"border-b-2 border-border",children:[r.jsx("th",{className:"text-left p-4 text-body font-semibold",children:"STRAVA (Running) "}),r.jsx("th",{className:"text-left p-4 text-body font-semibold",children:"VREAD (Lecture) "})]})}),r.jsx("tbody",{children:[["Tu cours des kilomtres","Tu lis des pages"],["Tu bats tes records de temps","Tu amliores ton taux de comprhension"],["Tu vois ton volution sur 30j","Tu vois tes pages lues sur 30j"],["Tu maintiens ta srie de runs","Tu maintiens ta srie de lecture"],["Tu partages tes exploits","Tu dbloques des badges de lecture"],["Tu fixes des objectifs (20km)","Tu fixes des objectifs (100 pages)"],["Tu analyses tes performances","Tu analyses ta comprhension"],["Tu rejoins des challenges","Tu progresses dans des qutes"]].map((e,t)=>r.jsxs("tr",{className:"border-b border-border "+(t%2==0?"bg-muted/20":""),children:[r.jsx("td",{className:"p-4 text-body",children:e[0]}),r.jsx("td",{className:"p-4 text-body",children:e[1]})]},t))})]})}),r.jsx("div",{className:"md:hidden space-y-4",children:[["Tu cours des kilomtres","Tu lis des pages"],["Tu bats tes records de temps","Tu amliores ton taux de comprhension"],["Tu vois ton volution sur 30j","Tu vois tes pages lues sur 30j"],["Tu maintiens ta srie de runs","Tu maintiens ta srie de lecture"],["Tu partages tes exploits","Tu dbloques des badges de lecture"],["Tu fixes des objectifs (20km)","Tu fixes des objectifs (100 pages)"],["Tu analyses tes performances","Tu analyses ta comprhension"],["Tu rejoins des challenges","Tu progresses dans des qutes"]].map((e,t)=>r.jsx(Px,{children:r.jsx(Ox,{className:"p-4",children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-body-sm font-medium text-muted-foreground",children:"Strava "}),r.jsx("p",{className:"text-body",children:e[0]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-body-sm font-medium text-muted-foreground",children:"VREAD "}),r.jsx("p",{className:"text-body",children:e[1]})]})]})})},t))})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Pourquoi Strava fonctionne (et VREAD aussi)"}),r.jsxs("div",{className:"prose prose-lg max-w-none",children:[r.jsxs("p",{className:"text-body mb-6",children:["Strava a rvolutionn le running en appliquant un principe simple : ",r.jsx("strong",{children:"ce qui est mesur est amlior"}),"."]}),r.jsx("p",{className:"text-body mb-6",children:"Quand vous voyez vos stats, trois choses se produisent :"}),r.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Motivation"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Vous voulez battre votre record"})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Habitude"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Vous ne voulez pas casser votre srie"})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Progression"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Vous voyez concrtement que vous progressez"})]})})]}),r.jsx(Px,{className:"bg-accent/10 border-accent/30",children:r.jsxs(Ox,{className:"p-8",children:[r.jsx("p",{className:"text-h4 font-sans font-semibold text-foreground mb-4",children:"VREAD applique exactement la mme psychologie  la lecture."}),r.jsx("p",{className:"text-body mb-4",children:'Au lieu de lire "passivement" un livre sans savoir si vous comprenez vraiment, VREAD vous permet de :'}),r.jsxs("ul",{className:"space-y-2 text-body",children:[r.jsx("li",{children:" Valider votre comprhension aprs chaque chapitre"}),r.jsx("li",{children:" Voir vos stats de lecture (pages, taux de comprhension, srie)"}),r.jsx("li",{children:" Suivre votre progression comme un athlte suit ses entranements"}),r.jsx("li",{children:" Rester motiv grce aux badges et objectifs"})]})]})})]})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Ce que disent les utilisateurs Strava qui utilisent VREAD"}),r.jsxs("div",{className:"space-y-6",children:[r.jsx(Px,{className:"border-l-4 border-l-primary",children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("p",{className:"text-body italic mb-4",children:'"En tant que runner qui check Strava tous les jours, j\'adore avoir la mme chose pour mes livres. Je vois enfin combien de pages je lis par semaine."'}),r.jsx("p",{className:"text-body-sm text-muted-foreground",children:" Marie, 34 ans, utilisatrice Strava et VREAD"})]})}),r.jsx(Px,{className:"border-l-4 border-l-secondary",children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("p",{className:"text-body italic mb-4",children:'"Le principe de srie de jours conscutifs fonctionne aussi bien pour la lecture que pour le running. J\'en suis  47 jours de lecture !"'}),r.jsx("p",{className:"text-body-sm text-muted-foreground",children:" Thomas, 28 ans, marathonien"})]})})]})]}),r.jsxs("section",{className:"mb-16",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Les features qui vous rappelleront Strava"}),r.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Dashboard de stats"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Comme votre dashboard Strava, voyez d'un coup d'il : pages lues cette semaine, taux de comprhension moyen, srie actuelle"})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Sries quotidiennes"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Exactement comme votre streak Strava. Lisez au moins 10 pages par jour pour maintenir votre srie."})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Graphiques de progression"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Graphiques sur 7j, 30j, 12 mois. Voyez votre volution exactement comme sur Strava."})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Badges d'accomplissement"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Dbloquez des badges : Premier livre termin, 1000 pages lues, Srie de 30 jours..."})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Objectifs personnaliss"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Fixez-vous un objectif : 500 pages ce mois, 1 livre par semaine, 15 min de lecture quotidienne."})]})}),r.jsx(Px,{children:r.jsxs(Ox,{className:"p-6",children:[r.jsx("div",{className:"text-4xl mb-3",children:""}),r.jsx("h3",{className:"text-h4 font-sans font-semibold text-foreground mb-2",children:"Niveaux et XP"}),r.jsx("p",{className:"text-body text-muted-foreground",children:"Comme les niveaux Strava, progressez de Lecteur Dbutant  Lecteur Expert."})]})})]})]}),r.jsx("section",{className:"mb-16",children:r.jsx(Px,{className:"bg-secondary/10 border-secondary/30",children:r.jsxs(Ox,{className:"p-8",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-6",children:"Pour qui ?"}),r.jsx("p",{className:"text-body mb-4",children:"VREAD est parfait si :"}),r.jsxs("ul",{className:"space-y-3 text-body",children:[r.jsx("li",{children:" Vous utilisez Strava (ou une app de fitness tracking)"}),r.jsx("li",{children:" Vous aimez les stats et la gamification"}),r.jsx("li",{children:" Vous voulez lire plus mais manquez de motivation"}),r.jsx("li",{children:" Vous avez un niveau B2+ en franais"}),r.jsx("li",{children:" Vous voulez transformer la lecture en habitude, comme le running"})]})]})})}),r.jsx("section",{className:"text-center mb-16",children:r.jsx(Px,{className:"bg-gradient-to-br from-primary/10 to-accent/10 border-primary/20",children:r.jsxs(Ox,{className:"p-12",children:[r.jsx("h2",{className:"text-h2 font-serif text-foreground mb-4",children:"Commencer comme sur Strava"}),r.jsx("p",{className:"text-body text-muted-foreground mb-8",children:"Gratuit  iPhone & Web  Catalogue de classiques inclus"}),r.jsx(qn,{asChild:!0,size:"lg",className:"text-body",children:r.jsx(T,{to:"/auth",children:"Essayer VREAD gratuitement"})})]})})}),r.jsx("footer",{className:"border-t border-border pt-8",children:r.jsx("p",{className:"text-caption text-muted-foreground",children:"Cette page a t cre  titre informatif pour expliquer l'approche de tracking de VREAD. Strava est une marque dpose de Strava Inc. VREAD n'est pas affili, associ, autoris, approuv par, ou de quelque manire que ce soit officiellement li  Strava Inc. Nous utilisons Strava comme rfrence pour illustrer notre philosophie de suivi de progression applique  la lecture."})})]})]})}function gN(){return r.jsxs("main",{className:"container mx-auto max-w-3xl px-4 py-16 text-center",children:[r.jsxs(A,{children:[r.jsx("title",{children:"404  Page introuvable | VREAD"}),r.jsx("meta",{name:"robots",content:"noindex"})]}),r.jsxs("div",{"data-testid":"not-found",children:[r.jsx("div",{className:"text-6xl font-extrabold mb-4",children:"404"}),r.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Page introuvable"}),r.jsx("p",{className:"text-base",children:"La page que tu cherches n'existe pas."})]})]})}hN.displayName=hs.displayName;const xN=()=>{const[e]=Be(),t=e.get("q")||"";return r.jsxs(r.Fragment,{children:[r.jsxs(A,{prioritizeSeoTags:!0,children:[r.jsx("title",{children:t?`Recherche: ${t} | VREAD`:"Recherche | VREAD"}),r.jsx("meta",{name:"description",content:"Recherchez vos livres et contenus prfrs sur VREAD"}),r.jsx("meta",{name:"robots",content:"noindex,follow"}),r.jsx("meta",{name:"googlebot",content:"noindex,follow"}),r.jsx("meta",{name:"application-name",content:"VREAD"}),r.jsx("meta",{property:"og:site_name",content:"VREAD"}),r.jsx("link",{rel:"canonical",href:"https://www.vread.fr/search"+(t?`?q=${encodeURIComponent(t)}`:"")})]}),r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsxs("div",{className:"max-w-2xl mx-auto",children:[r.jsx("h1",{className:"text-h1 font-bold mb-8 text-center",children:"Recherche VREAD"}),r.jsxs("div",{className:"relative mb-8",children:[r.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),r.jsx(Jg,{type:"search",placeholder:"Rechercher...",value:t,className:"pl-10",readOnly:!0})]}),t?r.jsxs("div",{className:"text-center",children:[r.jsxs("p",{className:"text-body mb-4",children:["Rsultats pour  ",r.jsx("span",{className:"font-semibold",children:t}),"  (bientt)"]}),r.jsx("p",{className:"text-body-sm text-muted-foreground",children:"La fonctionnalit de recherche sera bientt disponible."})]}):r.jsx("div",{className:"text-center text-muted-foreground",children:r.jsx("p",{className:"text-body",children:"Entrez votre recherche dans l'URL ou utilisez le formulaire ci-dessus."})})]})})]})};function vN(){const e=H();return r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsx("title",{children:"Politique de Confidentialit - VREAD"}),r.jsx("meta",{name:"description",content:"Politique de confidentialit de VREAD : collecte, utilisation et protection de vos donnes personnelles."}),r.jsx("meta",{name:"robots",content:"index, follow"})]}),r.jsx("div",{className:"min-h-screen bg-background p-4",children:r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs(qn,{variant:"ghost",size:"sm",onClick:()=>e(-1),className:"flex items-center gap-2",children:[r.jsx(At,{className:"h-4 w-4"}),"Retour"]})}),r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsx(Dx,{className:"text-2xl font-serif text-coffee-darker",children:"Politique de Confidentialit"})}),r.jsxs(Ox,{className:"prose prose-coffee max-w-none space-y-6",children:[r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"1. Introduction"}),r.jsx("p",{className:"text-coffee-darker/80",children:'VREAD ("nous", "notre") s\'engage  protger la vie prive de ses utilisateurs. Cette politique dcrit comment nous collectons, utilisons et protgeons vos donnes personnelles lorsque vous utilisez notre application mobile et web.'})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"2. Donnes collectes"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous collectons les donnes suivantes :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"Informations de compte"})," : adresse e-mail, nom d'utilisateur"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Donnes de lecture"})," : livres lus, progression, objectifs, statistiques"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Prfrences"})," : paramtres de l'application, thme, langue"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Donnes d'utilisation"})," : interactions avec l'application, fonctionnalits utilises"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Donnes techniques"})," : type d'appareil, systme d'exploitation, identifiants d'appareil"]})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"3. Utilisation des donnes"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Vos donnes sont utilises pour :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsx("li",{children:"Fournir et amliorer nos services"}),r.jsx("li",{children:"Personnaliser votre exprience de lecture"}),r.jsx("li",{children:"Suivre votre progression et vos objectifs"}),r.jsx("li",{children:"Communiquer avec vous concernant votre compte"}),r.jsx("li",{children:"Analyser l'utilisation de l'application pour l'amliorer"}),r.jsx("li",{children:"Assurer la scurit et prvenir les abus"})]}),r.jsx("p",{className:"text-coffee-darker/80 mt-2",children:r.jsx("strong",{children:"Nous ne vendons jamais vos donnes  des tiers."})})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"4. Partage des donnes"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous partageons vos donnes uniquement avec :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"Supabase"})," : hbergement de la base de donnes (tats-Unis)"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"RevenueCat"})," : gestion des abonnements et achats in-app"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Fournisseurs de services"})," : uniquement pour les services essentiels"]})]}),r.jsx("p",{className:"text-coffee-darker/80 mt-2",children:"Ces tiers sont contractuellement tenus de protger vos donnes et de les utiliser uniquement pour les services demands."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"5. Scurit des donnes"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous mettons en uvre des mesures de scurit techniques et organisationnelles appropries :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsx("li",{children:"Chiffrement des donnes en transit (HTTPS/TLS)"}),r.jsx("li",{children:"Chiffrement des donnes au repos"}),r.jsx("li",{children:"Authentification scurise"}),r.jsx("li",{children:"Accs limit aux donnes personnelles"}),r.jsx("li",{children:"Surveillance et journalisation des accs"})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"6. Conservation des donnes"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous conservons vos donnes aussi longtemps que votre compte est actif ou que cela est ncessaire pour vous fournir nos services. Lorsque vous supprimez votre compte, vos donnes personnelles sont supprimes dfinitivement dans un dlai de 30 jours."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"7. Vos droits (RGPD)"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Conformment au RGPD, vous disposez des droits suivants :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsxs("li",{children:[r.jsx("strong",{children:"Droit d'accs"})," : consulter vos donnes personnelles"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Droit de rectification"})," : corriger vos donnes inexactes"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Droit  l'effacement"})," : supprimer votre compte et vos donnes"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Droit  la portabilit"})," : recevoir vos donnes dans un format structur"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Droit d'opposition"})," : vous opposer au traitement de vos donnes"]}),r.jsxs("li",{children:[r.jsx("strong",{children:"Droit de limitation"})," : limiter le traitement de vos donnes"]})]}),r.jsx("p",{className:"text-coffee-darker/80 mt-2",children:"Pour exercer ces droits, vous pouvez :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsx("li",{children:"Grer vos donnes directement depuis les rglages de l'application"}),r.jsxs("li",{children:["Nous contacter  : ",r.jsx("a",{href:"mailto:privacy@vread.fr",className:"text-coffee-dark underline",children:"privacy@vread.fr"})]})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"8. Donnes des mineurs"}),r.jsx("p",{className:"text-coffee-darker/80",children:"VREAD est destin aux utilisateurs de 13 ans et plus. Nous ne collectons pas sciemment de donnes personnelles d'enfants de moins de 13 ans. Si vous pensez qu'un enfant nous a fourni des donnes personnelles, contactez-nous immdiatement."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"9. Cookies et technologies similaires"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous utilisons des cookies et technologies similaires pour amliorer votre exprience, analyser l'utilisation et personnaliser le contenu. Vous pouvez grer vos prfrences de cookies dans les paramtres de votre navigateur."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"10. Modifications de cette politique"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Nous pouvons modifier cette politique de confidentialit occasionnellement. Les modifications seront publies sur cette page avec une date de mise  jour actualise. Nous vous encourageons  consulter rgulirement cette page."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"11. Contact et rclamations"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Pour toute question concernant cette politique ou vos donnes personnelles :"}),r.jsxs("ul",{className:"text-coffee-darker/80 list-disc pl-6",children:[r.jsxs("li",{children:["Email : ",r.jsx("a",{href:"mailto:privacy@vread.fr",className:"text-coffee-dark underline",children:"privacy@vread.fr"})]}),r.jsxs("li",{children:["Support : ",r.jsx("a",{href:"mailto:support@vread.fr",className:"text-coffee-dark underline",children:"support@vread.fr"})]})]}),r.jsx("p",{className:"text-coffee-darker/80 mt-2",children:"Vous avez galement le droit de dposer une plainte auprs de la CNIL (Commission Nationale de l'Informatique et des Liberts) si vous estimez que vos droits ne sont pas respects."})]}),r.jsxs("p",{className:"text-sm text-coffee-darker/60 border-t pt-4",children:["Dernire mise  jour : ",(new Date).toLocaleDateString("fr-FR"),r.jsx("br",{}),"Version 1.1"]})]})]})]})})]})}function bN(){const e=H();return r.jsx("div",{className:"min-h-screen bg-background p-4",children:r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs(qn,{variant:"ghost",size:"sm",onClick:()=>e(-1),className:"flex items-center gap-2",children:[r.jsx(At,{className:"h-4 w-4"}),"Retour"]})}),r.jsxs(Px,{children:[r.jsx(Ix,{children:r.jsx(Dx,{className:"text-2xl font-serif text-coffee-darker",children:"Conditions d'Utilisation"})}),r.jsxs(Ox,{className:"prose prose-coffee max-w-none space-y-6",children:[r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"1. Service"}),r.jsx("p",{className:"text-coffee-darker/80",children:"VREAD est une application de suivi de lecture qui vous accompagne dans votre progression littraire page aprs page."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"2. Utilisation acceptable"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Vous vous engagez  utiliser VREAD de manire responsable, sans perturber le service ou porter atteinte aux autres utilisateurs."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"3. Proprit intellectuelle"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Le contenu et la technologie de VREAD sont protgs par les droits d'auteur. Les livres rfrencs appartiennent  leurs auteurs respectifs."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"4. Limitation de responsabilit"}),r.jsx("p",{className:"text-coffee-darker/80",children:"VREAD est fourni \"en l'tat\". Nous nous efforons d'assurer la disponibilit du service mais ne garantissons pas son fonctionnement ininterrompu."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"5. Achats In-App"}),r.jsxs("div",{className:"space-y-3 text-coffee-darker/80",children:[r.jsxs("p",{children:["VREAD propose un abonnement Premium  ",r.jsx("strong",{children:"29"})," en achat unique (",r.jsx("strong",{children:"Lifetime"}),")."]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Politique de remboursement :"})," Les achats effectus via Apple App Store sont soumis  la politique de remboursement d'Apple. Pour demander un remboursement, veuillez contacter directement le support Apple via"," ",r.jsx("a",{href:"https://reportaproblem.apple.com/",target:"_blank",rel:"noopener noreferrer",className:"text-coffee-dark underline",children:"reportaproblem.apple.com"})]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Support :"})," Pour toute question concernant votre abonnement, contactez-nous "," ",r.jsx("a",{href:"mailto:contact@vread.fr",className:"text-coffee-dark underline",children:"contact@vread.fr"})]})]})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"6. Modification des conditions"}),r.jsx("p",{className:"text-coffee-darker/80",children:"Ces conditions peuvent tre modifies. Les utilisateurs seront notifis des changements importants."})]}),r.jsxs("section",{children:[r.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"7. Contact"}),r.jsxs("p",{className:"text-coffee-darker/80",children:["Pour toute question : ",r.jsx("a",{href:"mailto:contact@vread.fr",className:"text-coffee-dark underline",children:"contact@vread.fr"})]})]}),r.jsxs("p",{className:"text-sm text-coffee-darker/60 border-t pt-4",children:["Dernire mise  jour : ",(new Date).toLocaleDateString("fr-FR")]})]})]})]})})}function yN(){const e=H(),[t,n]=s.useState(!1),[a,i]=s.useState(!1),o=s.useCallback(async()=>{Ex.info(" handleDelete: Starting account deletion flow");try{n(!0),Ex.info("Step 1: Calling requestAccountDeletion"),await async function(){Ex.info(" Starting account deletion request");const{data:{session:e},error:t}=await en.auth.getSession();if(t||!e?.access_token)throw Ex.error("No valid session found:",t),new Error("Aucune session valide trouve. Veuillez vous reconnecter.");Ex.info("Session found, calling delete-account edge function");const s=await en.functions.invoke("delete-account",{headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(Ex.info("Raw Edge Function response:",{data:s.data,error:s.error,dataType:typeof s.data,errorType:typeof s.error}),s.data&&Ex.info("Response data details:",JSON.stringify(s.data,null,2)),s.error){Ex.error("Edge function error details:",{message:s.error.message,context:s.error.context,name:s.error.name,fullError:JSON.stringify(s.error,null,2)});const e=s.data,t=e?.details||e?.error||e?.message||("string"==typeof e?e:null);if(Ex.error("Extracted error details:",{detailedError:t,errorDataKeys:e?Object.keys(e):null}),s.error.message?.includes("FunctionsRelayError"))throw new Error("Service temporairement indisponible. Ressayez dans quelques instants.");if(s.error.message?.includes("Unauthorized")||s.error.message?.includes("401"))throw new Error("Session expire. Reconnectez-vous pour confirmer la suppression.");if(s.error.message?.includes("404")||s.error.message?.includes("not found"))throw new Error("Fonction de suppression non disponible. Contactez le support.");if(s.error.message?.includes("non-2xx status code")){if(t)throw Ex.error("Actual server error:",t),new Error(`Erreur serveur: ${t}`);{const e=JSON.stringify(s.data);throw Ex.error("Could not extract error, full data:",e),new Error(`Erreur serveur (dtails): ${e}`)}}throw new Error(`Erreur lors de la suppression: ${s.error.message||"Erreur inconnue"}`)}const{data:r,error:n}=s;if(Ex.info("Edge function response data:",r),!r)throw Ex.error("Edge function returned no data"),new Error("La suppression a chou: Aucune rponse du serveur");if("object"==typeof r&&"success"in r&&!r.success){const e=r.details||r.error||"Erreur inconnue";throw Ex.error("Edge function returned unsuccessful response:",{data:r,errorDetails:e}),new Error(`La suppression a chou: ${e}`)}return"object"!=typeof r||"success"in r||Ex.warn("Edge function response missing success flag:",r),Ex.info(" Account deletion successful"),r}(),Ex.info("Step 1:  Account deleted on server"),Ex.info("Step 2: Signing out locally");try{await en.auth.signOut({scope:"local"}),Ex.info("Step 2:  Local signout successful")}catch(t){Ex.info("Step 2:  Signout error (expected if user already deleted):",t)}Ex.info("Step 3: Clearing local storage");try{localStorage.clear(),sessionStorage.clear(),Ex.info("Step 3:  Local storage cleared")}catch(s){Ex.warn("Step 3:  Storage clearing error:",s)}Ex.info("Step 4:  Account deletion complete, redirecting"),mn.success("Compte supprim avec succs",{duration:3e3}),setTimeout(()=>{e("/",{replace:!0})},500)}catch(V_){Ex.error(" Account deletion failed:",V_);const t=V_?.message||"Erreur lors de la suppression du compte";mn.error(t,{duration:5e3,description:"Si le problme persiste, contactez le support"})}finally{n(!1),i(!1),Ex.info(" handleDelete: Flow completed")}},[e]);return r.jsxs("div",{className:"mx-auto w-full max-w-xl p-4 md:p-6",children:[r.jsxs("button",{onClick:()=>e(-1),className:"mb-4 inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground",children:[r.jsx(At,{className:"h-4 w-4"}),"Retour"]}),r.jsx("h1",{className:"mb-2 text-2xl font-semibold",children:"Supprimer mon compte"}),r.jsxs("p",{className:"mb-6 text-sm text-muted-foreground",children:["Cette action est ",r.jsx("span",{className:"font-semibold text-red-600",children:"dfinitive"})," et"," ",r.jsx("span",{className:"font-semibold",children:"irrversible"}),"."]}),r.jsxs("div",{className:"rounded-2xl border p-4 md:p-6",children:[r.jsxs("div",{className:"mb-4 flex items-start gap-3",children:[r.jsx(It,{className:"mt-0.5 h-5 w-5 text-red-600"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:"Consquences de la suppression"}),r.jsxs("ul",{className:"mt-2 list-disc pl-5 text-sm text-muted-foreground",children:[r.jsx("li",{children:"Suppression de votre profil et de vos donnes de lecture"}),r.jsx("li",{children:"Perte de votre progression, historique et badges"}),r.jsx("li",{children:"Aucune rcupration possible"})]})]})]}),r.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[r.jsx("button",{onClick:()=>i(!0),disabled:t,className:"inline-flex h-10 items-center justify-center rounded-lg bg-red-600 px-4 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-60",children:t?"Suppression...":"Supprimer dfinitivement mon compte"}),r.jsx("button",{onClick:()=>e(-1),className:"inline-flex h-10 items-center justify-center rounded-lg border px-4 text-sm font-medium hover:bg-accent",children:"Annuler"})]})]}),a&&r.jsx("div",{className:"fixed inset-0 z-[100] grid place-items-center bg-black/40 p-4",children:r.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-background p-5 shadow-xl",children:[r.jsx("p",{className:"text-lg font-semibold",children:"Confirmer la suppression"}),r.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"tes-vous absolument certain de vouloir supprimer votre compte VREAD ? Cette action est dfinitive."}),r.jsxs("div",{className:"mt-5 flex items-center justify-end gap-3",children:[r.jsx("button",{onClick:()=>i(!1),className:"inline-flex h-9 items-center justify-center rounded-lg border px-4 text-sm font-medium hover:bg-accent",children:"Annuler"}),r.jsx("button",{onClick:o,disabled:t,className:"inline-flex h-9 items-center justify-center rounded-lg bg-red-600 px-4 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-60",children:t?"Suppression...":"Oui, supprimer mon compte"})]})]})})]})}var jN,wN,NN,_N,kN,SN,EN,RN,CN,AN,TN,PN,IN,DN,LN,ON,MN,VN,qN,BN,zN,UN,FN,$N,WN,ZN,HN,GN,KN,YN,QN,XN,JN,e_,t_,s_,r_,n_,a_,i_,o_=function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function r(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}();(wN=jN||(jN={})).UNKNOWN_ERROR="0",wN.PURCHASE_CANCELLED_ERROR="1",wN.STORE_PROBLEM_ERROR="2",wN.PURCHASE_NOT_ALLOWED_ERROR="3",wN.PURCHASE_INVALID_ERROR="4",wN.PRODUCT_NOT_AVAILABLE_FOR_PURCHASE_ERROR="5",wN.PRODUCT_ALREADY_PURCHASED_ERROR="6",wN.RECEIPT_ALREADY_IN_USE_ERROR="7",wN.INVALID_RECEIPT_ERROR="8",wN.MISSING_RECEIPT_FILE_ERROR="9",wN.NETWORK_ERROR="10",wN.INVALID_CREDENTIALS_ERROR="11",wN.UNEXPECTED_BACKEND_RESPONSE_ERROR="12",wN.RECEIPT_IN_USE_BY_OTHER_SUBSCRIBER_ERROR="13",wN.INVALID_APP_USER_ID_ERROR="14",wN.OPERATION_ALREADY_IN_PROGRESS_ERROR="15",wN.UNKNOWN_BACKEND_ERROR="16",wN.INVALID_APPLE_SUBSCRIPTION_KEY_ERROR="17",wN.INELIGIBLE_ERROR="18",wN.INSUFFICIENT_PERMISSIONS_ERROR="19",wN.PAYMENT_PENDING_ERROR="20",wN.INVALID_SUBSCRIBER_ATTRIBUTES_ERROR="21",wN.LOG_OUT_ANONYMOUS_USER_ERROR="22",wN.CONFIGURATION_ERROR="23",wN.UNSUPPORTED_ERROR="24",wN.EMPTY_SUBSCRIBER_ATTRIBUTES_ERROR="25",wN.PRODUCT_DISCOUNT_MISSING_IDENTIFIER_ERROR="26",wN.PRODUCT_DISCOUNT_MISSING_SUBSCRIPTION_GROUP_IDENTIFIER_ERROR="28",wN.CUSTOMER_INFO_ERROR="29",wN.SYSTEM_INFO_ERROR="30",wN.BEGIN_REFUND_REQUEST_ERROR="31",wN.PRODUCT_REQUEST_TIMED_OUT_ERROR="32",wN.API_ENDPOINT_BLOCKED="33",wN.INVALID_PROMOTIONAL_OFFER_ERROR="34",wN.OFFLINE_CONNECTION_ERROR="35",wN.TEST_STORE_SIMULATED_PURCHASE_ERROR="42",function(e){function t(){var s=e.call(this,"There is no singleton instance. Make sure you configure Purchases before trying to get the default instance. More info here: https://errors.rev.cat/configuring-sdk")||this;return Object.setPrototypeOf(s,t.prototype),s}o_(t,e)}(Error),function(e){function t(){var s=e.call(this,"This method is not available in the current platform.")||this;return Object.setPrototypeOf(s,t.prototype),s}o_(t,e)}(Error),(_N=NN||(NN={})).UNKNOWN="UNKNOWN",_N.CUSTOM="CUSTOM",_N.LIFETIME="LIFETIME",_N.ANNUAL="ANNUAL",_N.SIX_MONTH="SIX_MONTH",_N.THREE_MONTH="THREE_MONTH",_N.TWO_MONTH="TWO_MONTH",_N.MONTHLY="MONTHLY",_N.WEEKLY="WEEKLY",(SN=kN||(kN={}))[SN.INTRO_ELIGIBILITY_STATUS_UNKNOWN=0]="INTRO_ELIGIBILITY_STATUS_UNKNOWN",SN[SN.INTRO_ELIGIBILITY_STATUS_INELIGIBLE=1]="INTRO_ELIGIBILITY_STATUS_INELIGIBLE",SN[SN.INTRO_ELIGIBILITY_STATUS_ELIGIBLE=2]="INTRO_ELIGIBILITY_STATUS_ELIGIBLE",SN[SN.INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS=3]="INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS",(RN=EN||(EN={})).NON_SUBSCRIPTION="NON_SUBSCRIPTION",RN.SUBSCRIPTION="SUBSCRIPTION",RN.UNKNOWN="UNKNOWN",(AN=CN||(CN={})).CONSUMABLE="CONSUMABLE",AN.NON_CONSUMABLE="NON_CONSUMABLE",AN.NON_RENEWABLE_SUBSCRIPTION="NON_RENEWABLE_SUBSCRIPTION",AN.AUTO_RENEWABLE_SUBSCRIPTION="AUTO_RENEWABLE_SUBSCRIPTION",AN.PREPAID_SUBSCRIPTION="PREPAID_SUBSCRIPTION",AN.UNKNOWN="UNKNOWN",(PN=TN||(TN={}))[PN.UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY=0]="UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY",PN[PN.IMMEDIATE_WITH_TIME_PRORATION=1]="IMMEDIATE_WITH_TIME_PRORATION",PN[PN.IMMEDIATE_AND_CHARGE_PRORATED_PRICE=2]="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",PN[PN.IMMEDIATE_WITHOUT_PRORATION=3]="IMMEDIATE_WITHOUT_PRORATION",PN[PN.DEFERRED=6]="DEFERRED",PN[PN.IMMEDIATE_AND_CHARGE_FULL_PRICE=5]="IMMEDIATE_AND_CHARGE_FULL_PRICE",(DN=IN||(IN={}))[DN.INFINITE_RECURRING=1]="INFINITE_RECURRING",DN[DN.FINITE_RECURRING=2]="FINITE_RECURRING",DN[DN.NON_RECURRING=3]="NON_RECURRING",(ON=LN||(LN={})).FREE_TRIAL="FREE_TRIAL",ON.SINGLE_PAYMENT="SINGLE_PAYMENT",ON.DISCOUNTED_RECURRING_PAYMENT="DISCOUNTED_RECURRING_PAYMENT",(VN=MN||(MN={})).DAY="DAY",VN.WEEK="WEEK",VN.MONTH="MONTH",VN.YEAR="YEAR",VN.UNKNOWN="UNKNOWN",(BN=qN||(qN={})).INAPP="inapp",BN.SUBS="subs",(UN=zN||(zN={}))[UN.SUBSCRIPTIONS=0]="SUBSCRIPTIONS",UN[UN.SUBSCRIPTIONS_UPDATE=1]="SUBSCRIPTIONS_UPDATE",UN[UN.IN_APP_ITEMS_ON_VR=2]="IN_APP_ITEMS_ON_VR",UN[UN.SUBSCRIPTIONS_ON_VR=3]="SUBSCRIPTIONS_ON_VR",UN[UN.PRICE_CHANGE_CONFIRMATION=4]="PRICE_CHANGE_CONFIRMATION",($N=FN||(FN={}))[$N.SUCCESS=0]="SUCCESS",$N[$N.USER_CANCELLED=1]="USER_CANCELLED",$N[$N.ERROR=2]="ERROR",(ZN=WN||(WN={})).VERBOSE="VERBOSE",ZN.DEBUG="DEBUG",ZN.INFO="INFO",ZN.WARN="WARN",ZN.ERROR="ERROR",(GN=HN||(HN={}))[GN.BILLING_ISSUE=0]="BILLING_ISSUE",GN[GN.PRICE_INCREASE_CONSENT=1]="PRICE_INCREASE_CONSENT",GN[GN.GENERIC=2]="GENERIC",GN[GN.WIN_BACK_OFFER=3]="WIN_BACK_OFFER",(YN=KN||(KN={})).DISABLED="DISABLED",YN.INFORMATIONAL="INFORMATIONAL",(XN=QN||(QN={})).NOT_REQUESTED="NOT_REQUESTED",XN.VERIFIED="VERIFIED",XN.FAILED="FAILED",XN.VERIFIED_ON_DEVICE="VERIFIED_ON_DEVICE",(e_=JN||(JN={})).NOT_PRESENTED="NOT_PRESENTED",e_.ERROR="ERROR",e_.CANCELLED="CANCELLED",e_.PURCHASED="PURCHASED",e_.RESTORED="RESTORED",(s_=t_||(t_={})).STOREKIT_1="STOREKIT_1",s_.STOREKIT_2="STOREKIT_2",s_.DEFAULT="DEFAULT",(n_=r_||(r_={})).MY_APP="MY_APP",n_.REVENUECAT="REVENUECAT",(i_=a_||(a_={})).SUCCESS="SUCCESS",i_.ERROR="ERROR",i_.PURCHASE_BELONGS_TO_OTHER_USER="PURCHASE_BELONGS_TO_OTHER_USER",i_.INVALID_TOKEN="INVALID_TOKEN",i_.EXPIRED="EXPIRED";const l_=As("Purchases",{web:()=>_s(()=>import("./web-9276I1Kp.js"),__vite__mapDeps([5,1,2,3])).then(e=>new e.PurchasesWeb)});const c_=new class{constructor(){t(this,"productId","com.vread.app.lifetime"),t(this,"isInitialized",!1),t(this,"apiKey","appl_LqGBafbkvvzjeVyWijvguTTOQyB")}hasAnyLifetimeEntitlement(e={}){const t=["premium","Premium","Single Purchase","lifetime","Lifetime"];for(const s of t)if(void 0!==e[s])return!0;return!1}async initialize(){if(this.isIOS()&&!this.isInitialized){if(!this.apiKey||!this.apiKey.startsWith("appl_")){throw new Error("[IAP] Invalid or missing VITE_RC_IOS_KEY (must start with appl_)")}try{await l_.setLogLevel({level:WN.WARN}),await l_.configure({apiKey:this.apiKey}),this.isInitialized=!0}catch(e){throw e}}}async getProducts(){if(!this.isIOS())return[];this.isInitialized||await this.initialize();try{const e=await l_.getOfferings();if(!e.current)return mn.error("Configuration RevenueCat manquante. Contacte le support."),[];const t=e.current.availablePackages.find(e=>"$rc_lifetime"===e.identifier||e.product.identifier===this.productId);return t?[t.product]:(mn.error("Produit Premium non configur. Contacte le support."),[])}catch(e){return mn.error("Impossible de charger les produits. Vrifie ta connexion."),[]}}async purchaseLifetime(){if(!this.isIOS())return mn.error("Les achats in-app ne sont disponibles que sur iOS"),!1;if(!this.isInitialized)try{await this.initialize()}catch(e){return mn.error("Impossible d'initialiser les achats. Redmarre l'app."),!1}try{const e=await l_.getOfferings();if(!e.current)throw mn.error("Configuration manquante. Contacte le support."),new Error("No current offering available");const t=e.current.availablePackages.find(e=>"$rc_lifetime"===e.identifier||e.product.identifier===this.productId);if(!t)throw mn.error("Produit introuvable. Contacte le support."),new Error("Lifetime package not found");const s=await l_.purchasePackage({aPackage:t});this.hasAnyLifetimeEntitlement(s.customerInfo.entitlements.active);return await this.activatePremium("apple"),mn.success("Tu as maintenant accs  Premium  vie "),!0}catch(t){return"1"===t.code||t.message?.includes("cancelled")?mn("Tu as annul l'achat"):mn.error("Impossible de finaliser l'achat. Ressaye plus tard."),!1}}async restorePurchases(){if(!this.isIOS())return mn.error("Les achats in-app ne sont disponibles que sur iOS"),!1;try{const e=await l_.restorePurchases();return this.hasAnyLifetimeEntitlement(e.customerInfo.entitlements.active)?(mn.success("Ton accs Premium a t restaur"),await this.activatePremium("apple"),!0):(mn("Aucun achat Premium n'a t trouv sur ce compte Apple"),!1)}catch(e){return mn.error("Impossible de restaurer les achats. Ressaye plus tard."),!1}}async activatePremium(e){try{const{data:{user:t}}=await en.auth.getUser();if(!t)return;const{error:s}=await en.from("profiles").update({is_premium:!0,premium_since:(new Date).toISOString(),premium_type:e}).eq("id",t.id)}catch(t){}}isIOS(){return"ios"===Cs.getPlatform()}},d_=Object.freeze(Object.defineProperty({__proto__:null,appleIAPService:c_},Symbol.toStringTag,{value:"Module"}));function u_(){const{t:e}=Tn(),{pollForPremiumStatus:t,supabase:n,isPremium:a}=kn(),i=a,[o,l]=s.useState(!0),[c,d]=s.useState(!1),[u,m]=s.useState(!1),[h,p]=s.useState(null),[f,g]=s.useState(null);s.useEffect(()=>{(async()=>{try{l(!0),await c_.initialize();const t=await c_.getProducts();t&&t.length>0?(p(t[0]),g(null)):(p(null),g("Impossible de charger le produit. Ressaie plus tard."),mn.error(e.premium.toast.error))}catch(t){p(null),g("Impossible de charger le produit. Ressaie plus tard."),mn.error(e.premium.toast.error)}finally{l(!1)}})()},[]);const x=async(e=!0)=>{try{return await t(e)}catch(s){return await t(e)}};if(o)return r.jsx(Px,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50",children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Ne,{className:"h-12 w-12 animate-spin text-orange-500 mx-auto mb-4"}),r.jsx("p",{className:"text-lg md:text-xl font-semibold text-foreground",children:e.premium.loading.storeApple}),r.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:e.premium.loading.connecting})]})});const v=h?.priceString||"29,99 ";return r.jsxs(Px,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50 md:scale-105 md:z-10",children:[r.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center gap-1 whitespace-nowrap",children:e.premium.earlyBirdBadge}),r.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2",children:[r.jsx("h3",{className:"text-2xl font-bold",children:e.premium.cards.lifetime.titleAlt}),r.jsx(gh,{size:"md",variant:"compact"})]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground line-through",children:e.premium.cards.lifetime.originalPrice}),r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"text-5xl font-bold text-orange-600",children:v}),r.jsx(De,{className:"h-6 w-6 text-orange-500 animate-pulse"})]}),r.jsx("span",{className:"text-lg font-semibold text-orange-700",children:e.premium.cards.lifetime.period})]}),r.jsx("p",{className:"text-sm font-semibold text-orange-600 mb-6",children:e.premium.cards.lifetime.iosNote}),r.jsxs("ul",{className:"space-y-4 mb-8",children:[r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"font-semibold",children:e.premium.cards.lifetime.features.requestBooks})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.processing})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.advancedStats})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.exclusiveBadges})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.prioritySupport})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.earlyAccess})]})]}),r.jsx(qn,{onClick:async()=>{if(!h){const e="Le produit n'est pas disponible pour le moment. Ressaie plus tard.";return g(e),void mn.error(e)}if(!c){d(!0);try{if(await c_.purchaseLifetime()){const e=await x();g(e?null:"Premium a bien t achet mais lactivation a pris du retard. Ressaie plus tard ou contacte le support.")}else g("Lachat a t annul ou na pas pu tre confirm.")}catch(e){g("Une erreur est survenue pendant lachat. Ressaie plus tard.")}finally{d(!1)}}},disabled:c||i,className:"w-full bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold mb-3 min-h-[56px] text-lg",size:"lg",children:i?"Vous tes dj Premium":c?r.jsxs("span",{className:"flex items-center gap-3",children:[r.jsx(Ne,{className:"h-6 w-6 animate-spin"}),e.premium.loading.purchase]}):`${e.premium.buttons.buy} - ${v}`}),r.jsx(qn,{onClick:async()=>{m(!0);try{if(await c_.restorePurchases()){const e=await x(!1);g(e?null:"Premium a t restaur mais l'activation complte a pris du retard.'")}}catch(e){g("Une erreur est survenue pendant la restauration. Ressaie plus tard.")}finally{m(!1)}},disabled:u,variant:"outline",className:"w-full min-h-[48px] text-base",size:"lg",children:u?r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(Ne,{className:"h-5 w-5 animate-spin"}),e.premium.loading.restoring]}):e.premium.buttons.restore}),f&&r.jsx("p",{className:"mt-4 text-sm text-red-600",children:f}),i&&r.jsx("p",{className:"mt-3 text-sm text-muted-foreground text-center",children:"Vous avez dj achet l'accs Premium  vie avec ce compte."}),r.jsx("p",{className:"text-xs text-muted-foreground text-center mt-4",children:e.premium.trust.appleNote})]})}const m_="goog_PpwsSZEzKLiCLKVWfLevsudaVBb";function h_(){const{t:e}=Tn(),[t,n]=s.useState(!0),[a,i]=s.useState(!1),[o,l]=s.useState(!1),[c,d]=s.useState(!1),[u,m]=s.useState(null);s.useEffect(()=>{h()},[]);const h=async()=>{try{n(!0);const e=await async function(){try{const{customerInfo:e}=await l_.getCustomerInfo();return Boolean(e.entitlements.active?.premium)}catch(V_){return!1}}();d(e);const t=await async function(){try{const{current:e}=await l_.getOfferings();return e&&e.availablePackages.find(e=>"$rc_lifetime"===e.identifier)||null}catch(V_){return null}}();m(t)}catch(t){mn.error(e.premium.toast.error)}finally{n(!1)}};if(c)return r.jsx(Px,{className:"p-8 border-2 border-green-500 bg-gradient-to-br from-green-50/50 to-emerald-50/50",children:r.jsxs("div",{className:"text-center space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx(K,{className:"h-10 w-10 text-yellow-500"}),r.jsx("h2",{className:"text-3xl font-bold",children:e.premium.active.title})]}),r.jsx("p",{className:"text-lg text-muted-foreground",children:e.premium.active.message})]})});if(t)return r.jsx(Px,{className:"p-8",children:r.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-8",children:[r.jsx(Ne,{className:"h-12 w-12 animate-spin text-primary"}),r.jsx("p",{className:"text-lg text-muted-foreground",children:e.premium.loading.storeAndroid})]})});const p=u?.product.priceString||"29,99";return r.jsxs(Px,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50",children:[r.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center gap-1 whitespace-nowrap",children:e.premium.earlyBirdBadge}),r.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2",children:[r.jsx("h3",{className:"text-2xl font-bold",children:e.premium.cards.lifetime.title}),r.jsx(K,{className:"h-6 w-6 text-orange-500"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("div",{className:"flex items-baseline gap-2",children:r.jsx("span",{className:"text-5xl font-bold text-orange-600",children:p})}),r.jsx("span",{className:"text-lg font-semibold text-orange-700",children:e.premium.cards.lifetime.periodOnce})]}),r.jsxs("ul",{className:"space-y-3 mb-6",children:[r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"font-semibold",children:e.premium.cards.lifetime.features.requestBooks})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.processing})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.advancedStats})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.exclusiveBadges})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.prioritySupport})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:e.premium.cards.lifetime.features.earlyAccess})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(qn,{onClick:async()=>{i(!0);try{await async function(){try{const{current:e}=await l_.getOfferings();if(!e)throw new Error("Aucun offering disponible");const t=e.availablePackages.find(e=>"$rc_lifetime"===e.identifier);if(!t)throw new Error("Package $rc_lifetime introuvable dans l'offering par dfaut");const{customerInfo:s}=await l_.purchasePackage({aPackage:t});return Boolean(s.entitlements.active?.premium)}catch(V_){throw V_}}()?(mn.success(e.premium.toast.activated,{description:e.premium.toast.activatedDesc}),d(!0)):mn.error(e.premium.toast.notConfirmed,{description:e.premium.toast.notConfirmedDesc})}catch(t){"1"===t.code||t.message?.includes("cancelled")?mn(e.premium.toast.cancelled):mn.error(e.premium.toast.error,{description:e.premium.toast.errorDesc})}finally{i(!1)}},disabled:a||o,className:"w-full bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold min-h-[56px] text-lg",size:"lg",children:a?r.jsxs("span",{className:"flex items-center gap-3",children:[r.jsx(Ne,{className:"h-6 w-6 animate-spin"}),e.premium.loading.purchase]}):`${e.premium.buttons.buy} - ${p}`}),r.jsx(qn,{onClick:async()=>{l(!0);try{await async function(){try{const{customerInfo:e}=await l_.restorePurchases();return Boolean(e.entitlements.active?.premium)}catch(V_){throw V_}}()?(mn.success(e.premium.toast.restored,{description:e.premium.toast.restoredDesc}),d(!0)):mn.info(e.premium.toast.noRestore,{description:e.premium.toast.noRestoreDesc})}catch(t){mn.error(e.premium.toast.restoreError,{description:e.premium.toast.errorDesc})}finally{l(!1)}},disabled:a||o,variant:"outline",className:"w-full min-h-[56px] text-base",size:"lg",children:o?r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(Ne,{className:"h-5 w-5 animate-spin"}),e.premium.loading.restoring]}):r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(Re,{className:"h-5 w-5"}),e.premium.buttons.restore]})})]}),r.jsx("p",{className:"text-center text-sm text-muted-foreground mt-4",children:e.premium.trust.appleManaged})]})}function p_(){const{user:e,isPremium:t}=kn(),{t:n}=Tn(),a=H(),[i,o]=s.useState(!1),[l,c]=s.useState(!1),d=Cs.getPlatform(),u="ios"===d,m="android"===d;s.useEffect(()=>{t&&a("/home",{replace:!0})},[t,a]),s.useEffect(()=>{o(!1),c(!1)},[e,d]);const h=async t=>{if(!e)return void(window.location.href="/auth");c(!0),o(!0);const s=`${t}?prefilled_email=${encodeURIComponent(e.email||"")}&client_reference_id=${e.id}`;window.location.href=s};return r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("div",{className:"container mx-auto px-4 py-8 md:py-12",children:r.jsxs("div",{className:"max-w-5xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8 md:mb-12 px-4",children:[r.jsxs("div",{className:"flex items-center justify-center gap-3 mb-6",children:[r.jsx(K,{className:"h-12 w-12 md:h-14 md:w-14 text-yellow-500"}),r.jsx("h1",{className:"text-4xl md:text-6xl font-bold",children:n.premium.title})]}),r.jsxs("div",{className:"bg-gradient-to-r from-orange-500/10 to-yellow-500/10 rounded-xl p-6 md:p-8 mb-6",children:[r.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-4 text-orange-600",children:n.premium.earlyBirdTitle}),r.jsx("p",{className:"text-lg md:text-xl text-foreground leading-relaxed max-w-3xl mx-auto font-medium",children:n.premium.earlyBirdDesc})]}),!e&&r.jsxs("div",{className:"bg-blue-500/10 border-2 border-blue-500 rounded-lg p-4 md:p-6 max-w-2xl mx-auto",children:[r.jsx("p",{className:"text-base md:text-lg font-semibold text-blue-600",children:n.premium.loginRequired}),r.jsx("p",{className:"text-sm md:text-base text-muted-foreground mt-2",children:n.premium.loginRequiredDesc})]})]}),u?r.jsxs("div",{className:"max-w-md mx-auto mb-12",children:[r.jsx(u_,{}),r.jsx("p",{className:"text-center text-sm text-muted-foreground mt-6",children:n.premium.iosPurchaseNote}),r.jsxs("div",{className:"text-center space-y-2 mt-8 text-sm text-muted-foreground",children:[r.jsx("p",{children:"By purchasing, you agree to our"}),r.jsxs("div",{className:"flex gap-4 justify-center",children:[r.jsx("a",{href:"/legal/terms",className:"underline hover:text-foreground transition-colors",children:"Terms of Service"}),r.jsx("a",{href:"/legal/privacy",className:"underline hover:text-foreground transition-colors",children:"Privacy Policy"})]})]})]}):m?r.jsxs("div",{className:"max-w-md mx-auto mb-12",children:[r.jsx(h_,{}),r.jsx("p",{className:"text-center text-sm text-muted-foreground mt-6",children:n.premium.androidPurchaseNote})]}):r.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mb-12",children:[r.jsxs(Px,{className:"p-8",children:[r.jsx("h3",{className:"text-2xl font-bold mb-2",children:n.premium.cards.free.title}),r.jsxs("div",{className:"mb-6",children:[r.jsx("span",{className:"text-4xl font-bold",children:n.premium.cards.free.price}),r.jsx("span",{className:"text-muted-foreground ml-2 block text-sm mt-1",children:n.premium.cards.free.period})]}),r.jsxs("ul",{className:"space-y-4 mb-6",children:[r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.free.features.catalog})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.free.features.checkpoints})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.free.features.tracking})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.free.features.badges})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.free.features.community})]})]})]}),r.jsxs(Px,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50 md:scale-105 md:z-10",children:[r.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center gap-1 whitespace-nowrap",children:n.premium.earlyBirdBadge}),r.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2",children:[r.jsx("h3",{className:"text-2xl font-bold",children:n.premium.cards.lifetime.title}),r.jsx(K,{className:"h-6 w-6 text-orange-500"})]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground line-through",children:n.premium.cards.lifetime.originalPrice}),r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"text-5xl font-bold text-orange-600",children:n.premium.cards.lifetime.price}),r.jsx(De,{className:"h-6 w-6 text-orange-500 animate-pulse"})]}),r.jsx("span",{className:"text-lg font-semibold text-orange-700",children:n.premium.cards.lifetime.period})]}),r.jsx("p",{className:"text-sm font-semibold text-orange-600 mb-6",children:n.premium.cards.lifetime.validUntil}),r.jsxs("ul",{className:"space-y-4 mb-8",children:[r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"font-semibold",children:n.premium.cards.lifetime.features.requestBooks})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.processing})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.advancedStats})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.exclusiveBadges})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.prioritySupport})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.earlyAccess})]})]}),r.jsx(qn,{onClick:()=>h("https://buy.stripe.com/cNi28q73k0oE7u3bBuejK00"),disabled:l,className:"w-full bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold min-h-[56px] text-lg",size:"lg",children:l?r.jsxs("span",{className:"flex items-center gap-3",children:[r.jsx(Ne,{className:"h-6 w-6 animate-spin"}),n.premium.loading.purchase]}):n.premium.cards.lifetime.priceWithValue.replace("{price}","29")})]}),r.jsxs(Px,{className:"p-8 border relative shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h3",{className:"text-2xl font-bold",children:n.premium.cards.annual.title}),r.jsx(K,{className:"h-6 w-6 text-yellow-500"})]}),r.jsxs("div",{className:"mb-2",children:[r.jsx("span",{className:"text-4xl font-bold",children:n.premium.cards.annual.price}),r.jsx("span",{className:"text-xl text-muted-foreground",children:n.premium.cards.annual.period})]}),r.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:n.premium.cards.annual.pricePerMonth}),r.jsxs("ul",{className:"space-y-4 mb-8",children:[r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"font-semibold",children:n.premium.cards.lifetime.features.requestBooks})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.processing})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.advancedStats})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.exclusiveBadges})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.prioritySupport})]}),r.jsxs("li",{className:"flex items-start gap-3",children:[r.jsx(y,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),r.jsx("span",{children:n.premium.cards.lifetime.features.earlyAccess})]})]}),r.jsx(qn,{onClick:()=>h("https://buy.stripe.com/7sYbJ0fzQ5IY5lV0WQejK01"),disabled:l,className:"w-full min-h-[56px] text-lg",size:"lg",children:l?r.jsxs("span",{className:"flex items-center gap-3",children:[r.jsx(Ne,{className:"h-6 w-6 animate-spin"}),n.premium.loading.purchase]}):n.premium.cards.annual.priceWithValue.replace("{price}","50")})]})]}),!u&&!m&&r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:n.premium.trust.securePayment}),r.jsx("p",{className:"text-sm text-muted-foreground",children:n.premium.trust.cancelAnytime}),r.jsx("p",{className:"text-sm text-muted-foreground",children:n.premium.trust.immediateAccess})]}),r.jsxs("div",{className:"mt-16 max-w-3xl mx-auto",children:[r.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:n.premium.faq.title}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:n.premium.faq.howItWorks.question}),r.jsx("p",{className:"text-muted-foreground",children:n.premium.faq.howItWorks.answer})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:n.premium.faq.howMany.question}),r.jsx("p",{className:"text-muted-foreground",children:n.premium.faq.howMany.answer})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:n.premium.faq.cancel.question}),r.jsx("p",{className:"text-muted-foreground",children:n.premium.faq.cancel.answer})]})]})]})]})})]})}function f_(){const{user:e,isPremium:t}=kn(),{t:n}=Tn(),a=H(),[i,o]=s.useState(!1),[l,c]=s.useState({title:"",author:"",isbn:"",reason:""});if(!t){const e="ios"===Cs.getPlatform();return r.jsx("div",{className:"max-w-2xl mx-auto p-6",children:r.jsxs(Px,{className:"p-8 text-center",children:[r.jsx(K,{className:"mx-auto h-16 w-16 text-yellow-500 mb-4"}),r.jsx("h2",{className:"text-2xl font-bold mb-2",children:n.requestBook.paywall.title}),r.jsx("p",{className:"text-muted-foreground mb-6",children:n.requestBook.paywall.description}),r.jsx(qn,{onClick:()=>a("/premium"),size:"lg",children:e?n.requestBook.paywall.ctaIOS:n.requestBook.paywall.cta})]})})}return r.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[r.jsx($,{className:"h-6 w-6 text-primary"}),r.jsx("h2",{className:"text-2xl font-bold",children:n.requestBook.title})]}),r.jsx(Px,{className:"p-6",children:r.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),!e)return mn.error(n.requestBook.toast.loginRequired),void a("/auth");if(!t)return mn.error(n.requestBook.toast.premiumRequired),void a("/premium");if(l.title.trim()){o(!0);try{const{error:t}=await en.from("book_requests").insert({user_id:e.id,book_title:l.title.trim(),book_author:l.author.trim()||null,isbn:l.isbn.trim()||null,reason:l.reason.trim()||null});if(t)throw t;mn.success(n.requestBook.toast.success),c({title:"",author:"",isbn:"",reason:""})}catch(r){mn.error(n.requestBook.toast.error)}finally{o(!1)}}else mn.error(n.requestBook.toast.titleRequired)},className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"title",className:"block text-sm font-medium mb-2",children:n.requestBook.form.title}),r.jsx(Jg,{id:"title",value:l.title,onChange:e=>c({...l,title:e.target.value}),placeholder:n.requestBook.form.titlePlaceholder,required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"author",className:"block text-sm font-medium mb-2",children:n.requestBook.form.author}),r.jsx(Jg,{id:"author",value:l.author,onChange:e=>c({...l,author:e.target.value}),placeholder:n.requestBook.form.authorPlaceholder})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"isbn",className:"block text-sm font-medium mb-2",children:n.requestBook.form.isbn}),r.jsx(Jg,{id:"isbn",value:l.isbn,onChange:e=>c({...l,isbn:e.target.value}),placeholder:n.requestBook.form.isbnPlaceholder})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium mb-2",children:n.requestBook.form.reason}),r.jsx($v,{id:"reason",value:l.reason,onChange:e=>c({...l,reason:e.target.value}),placeholder:n.requestBook.form.reasonPlaceholder,rows:4})]}),r.jsx(qn,{type:"submit",disabled:i,className:"w-full",size:"lg",children:i?n.requestBook.form.submitting:n.requestBook.form.submit}),r.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:[n.requestBook.form.info,r.jsx("br",{}),n.requestBook.form.infoEmail]})]})})]})}function g_(){return r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsx("main",{className:"container mx-auto py-8",children:r.jsx(f_,{})})]})}function x_(){return s.useEffect(()=>{(async()=>{const e=await async function(){const{data:e}=await en.from("blog_posts").select("slug, updated_at, published_at").eq("published",!0).order("published_at",{ascending:!1}),t="https://www.vread.fr";return`<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n  <url>\n    <loc>${t}</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>daily</changefreq>\n    <priority>1.0</priority>\n  </url>\n  <url>\n    <loc>${t}/blog</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>daily</changefreq>\n    <priority>0.9</priority>\n  </url>\n  <url>\n    <loc>${t}/premium</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>weekly</changefreq>\n    <priority>0.9</priority>\n  </url>\n  <url>\n    <loc>${t}/duolingo</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.8</priority>\n  </url>\n  <url>\n    <loc>${t}/strava</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.8</priority>\n  </url>\n  ${e?.map(e=>`\n  <url>\n    <loc>${t}/blog/${e.slug}</loc>\n    <lastmod>${e.updated_at}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.8</priority>\n  </url>`).join("")}\n</urlset>`}(),t=new Blob([e],{type:"application/xml"});URL.createObjectURL(t),document.open(),document.write(e),document.close()})()},[]),null}async function v_(e){const{data:{user:t}}=await en.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await en.from("feedback_votes").insert({feedback_id:e,user_id:t.id});if(s){if("23505"===s.code)return void(await async function(e){const{data:{user:t}}=await en.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await en.from("feedback_votes").delete().match({feedback_id:e,user_id:t.id});if(s)throw s}(e));throw s}}const b_=[{rating:5,emoji:"",label:"Gnial"},{rating:4,emoji:"",label:"Bien"},{rating:3,emoji:"",label:"Correct"},{rating:2,emoji:"",label:"Bof"},{rating:1,emoji:"",label:"Frustrant"}];function y_(){const{user:e}=kn(),[t,n]=s.useState(null),[a,i]=s.useState([0,0,0,0,0]),[o,l]=s.useState(!1);async function c(){try{const e=await async function(){const{data:e,error:t}=await en.from("feedback_quick_ratings").select("rating");if(t)throw t;const s=[0,0,0,0,0];return e?.forEach(e=>{e.rating>=1&&e.rating<=5&&s[e.rating-1]++}),s}();i(e)}catch(e){}}async function d(t){if(e){l(!0);try{await async function(e){const{data:{user:t}}=await en.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await en.from("feedback_quick_ratings").insert({user_id:t.id,rating:e});if(s)throw s}(t),n(t);const e=document.createElement("div");e.textContent="+5 pts ",e.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-bold text-green-600 animate-bounce z-50",document.body.appendChild(e),setTimeout(()=>e.remove(),1500),mn.success("Tu viens de gagner 5 points",{description:"Merci ! "}),await c()}catch(s){mn.error(s.message||"Impossible d'envoyer ton avis",{description:"Erreur"})}finally{l(!1)}}else mn.error("Connecte-toi pour donner ton avis !",{description:"Connexion requise"})}return s.useEffect(()=>{c()},[]),r.jsxs(Px,{className:"p-6",children:[r.jsx("h2",{className:"text-xl font-semibold mb-2",children:" Feedback Express"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Comment tait ton exprience aujourd'hui ?"}),r.jsx("div",{className:"flex justify-between gap-2 mb-4",children:b_.map(({rating:e,emoji:s,label:n})=>r.jsxs(qn,{variant:"outline",className:"flex-1 flex flex-col gap-2 h-auto py-4 transition-all "+(t===e?"border-primary border-2 scale-105":""),onClick:()=>d(e),disabled:o||null!==t,children:[r.jsx("span",{className:"text-4xl",children:s}),r.jsx("span",{className:"text-xs",children:n}),a[e-1]>0&&r.jsx("span",{className:"text-xs text-muted-foreground",children:a[e-1]})]},e))}),t&&r.jsx("p",{className:"text-center text-sm text-green-600 font-medium animate-in fade-in",children:" +5 pts  Ton vote compte !"})]})}const j_=[{type:"bug",emoji:"",label:"Bug",points:10,color:"bg-red-100 hover:bg-red-200 border-red-300"},{type:"feature",emoji:"",label:"Feature",points:15,color:"bg-blue-100 hover:bg-blue-200 border-blue-300"},{type:"idea",emoji:"",label:"Ide",points:20,color:"bg-yellow-100 hover:bg-yellow-200 border-yellow-300"},{type:"love",emoji:"",label:"J'adore!",points:10,color:"bg-pink-100 hover:bg-pink-200 border-pink-300"},{type:"suggestion",emoji:"",label:"Suggestion",points:15,color:"bg-purple-100 hover:bg-purple-200 border-purple-300"},{type:"question",emoji:"",label:"Question",points:5,color:"bg-gray-100 hover:bg-gray-200 border-gray-300"}],w_=[{value:"reading",label:"Lecture"},{value:"interface",label:"Interface"},{value:"performance",label:"Performance"},{value:"other",label:"Autre"}];function N_({onSuccess:e,onCancel:t}){const{user:n}=kn(),[a,i]=s.useState(1),[o,l]=s.useState(!1),[c,d]=s.useState({is_anonymous:!1});if(1===a)return r.jsxs(Px,{className:"p-6",children:[r.jsx("h2",{className:"text-2xl font-bold mb-2",children:" De quoi veux-tu parler ?"}),r.jsx("p",{className:"text-muted-foreground mb-6",children:"Choisis le type de feedback que tu veux partager"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:j_.map(({type:e,emoji:t,label:s,points:n,color:a})=>r.jsxs(qn,{variant:"outline",className:`h-auto py-6 flex flex-col gap-2 ${a} ${c.type===e?"border-2":""}`,onClick:()=>{d({...c,type:e}),i(2)},children:[r.jsx("span",{className:"text-4xl",children:t}),r.jsx("span",{className:"font-semibold",children:s}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",n," pts"]})]},e))})]});if(2===a){const t=j_.find(e=>e.type===c.type);return r.jsxs(Px,{className:"p-6",children:[r.jsxs("h2",{className:"text-2xl font-bold mb-2",children:[t?.emoji," ",t?.label]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"title",children:"Titre *"}),r.jsx(Jg,{id:"title",placeholder:"bug"===c.type?"Ex: Bug lors du clic sur X":"feature"===c.type?"Ex: Pouvoir faire X":"Ex: Mon ide gniale...",value:c.title||"",onChange:e=>d({...c,title:e.target.value})})]}),r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"description",children:"Description *"}),r.jsx($v,{id:"description",placeholder:"bug"===c.type?"Quand je fais X, il se passe Y au lieu de Z":"feature"===c.type?"J'aimerais pouvoir X parce que Y":"Raconte-nous en dtail...",value:c.description||"",onChange:e=>d({...c,description:e.target.value}),rows:6,maxLength:500}),r.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[c.description?.length||0,"/500"]})]}),r.jsxs("div",{children:[r.jsx(Vx,{htmlFor:"category",children:"Catgorie"}),r.jsxs("select",{id:"category",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",value:c.category||"",onChange:e=>d({...c,category:e.target.value}),children:[r.jsx("option",{value:"",children:"Slectionne une catgorie"}),w_.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"anonymous",checked:c.is_anonymous,onChange:e=>d({...c,is_anonymous:e.target.checked}),className:"h-4 w-4"}),r.jsx(Vx,{htmlFor:"anonymous",className:"cursor-pointer",children:"Rester anonyme (ton nom ne sera pas affich)"})]}),r.jsxs("div",{className:"flex gap-2 pt-4",children:[r.jsx(qn,{variant:"outline",onClick:()=>i(1),className:"flex-1",children:" Retour"}),r.jsx(qn,{onClick:async function(){if(n)if(c.type&&c.title&&c.description){l(!0);try{const t=await async function(e){const{data:{user:t}}=await en.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:s,error:r}=await en.from("feedback_submissions").insert({type:e.type,title:e.title,description:e.description,category:e.category,is_anonymous:e.is_anonymous||!1,image_url:e.image_url,user_id:t.id}).select("\n      *,\n      profiles!inner(username, avatar_url)\n    ").single();if(r)throw r;return s}(c);i(3),mn.success(`Tu viens de gagner +${t.points_awarded} points !`,{description:" Merci champion !"}),setTimeout(()=>{e?.()},3e3)}catch(t){mn.error(t.message||"Impossible d'envoyer ton feedback",{description:"Erreur"})}finally{l(!1)}}else mn.error("Remplis tous les champs obligatoires",{description:"Champs manquants"});else mn.error("Connecte-toi pour donner ton feedback !",{description:"Connexion requise"})},disabled:o||!c.title||!c.description,className:"flex-1",children:o?r.jsxs(r.Fragment,{children:[r.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):"Envoyer "})]})]})]})}const u=j_.find(e=>e.type===c.type);return r.jsxs(Px,{className:"p-6 text-center",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Merci champion ! "}),r.jsxs("p",{className:"text-xl text-green-600 font-semibold",children:["Tu viens de gagner +",u?.points," points !"]})]}),r.jsxs("div",{className:"bg-muted p-6 rounded-lg mb-6",children:[r.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:" Ton feedback fait grandir VREAD"}),r.jsx("p",{className:"text-lg font-semibold",children:"Continue comme a ! "})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(qn,{variant:"outline",onClick:t,className:"flex-1",children:" Retour"}),r.jsx(qn,{onClick:()=>{d({is_anonymous:!1}),i(1)},className:"flex-1",children:" Donner un autre feedback"})]})]})}const __={bug:{emoji:"",label:"Bug",color:"bg-red-100 text-red-800"},feature:{emoji:"",label:"Feature",color:"bg-blue-100 text-blue-800"},idea:{emoji:"",label:"Ide",color:"bg-yellow-100 text-yellow-800"},love:{emoji:"",label:"J'adore",color:"bg-pink-100 text-pink-800"},suggestion:{emoji:"",label:"Suggestion",color:"bg-purple-100 text-purple-800"},question:{emoji:"",label:"Question",color:"bg-gray-100 text-gray-800"}},k_={pending:{label:"En attente",color:"bg-gray-100 text-gray-800"},in_progress:{label:"En cours",color:"bg-blue-100 text-blue-800"},done:{label:"Ralis",color:"bg-green-100 text-green-800"},rejected:{label:"Rejet",color:"bg-red-100 text-red-800"}};function S_({feedback:e,onVoteChange:t}){const[n,a]=s.useState(!1),[i,o]=s.useState(e.has_voted),[l,c]=s.useState(e.votes_count),d=__[e.type],u=k_[e.status];return r.jsx(Px,{className:"p-4 hover:shadow-md transition-shadow",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs(qn,{variant:i?"default":"outline",size:"sm",className:"flex-col h-auto py-2 px-3",onClick:async function(){a(!0);try{await v_(e.id),o(!i),c(i?l-1:l+1),i||mn.success("+2 points gagns",{description:"Vote enregistr ! "}),t?.()}catch(s){mn.error(s.message||"Impossible de voter",{description:"Erreur"})}finally{a(!1)}},disabled:n,children:[r.jsx(me,{className:"h-4 w-4 "+(i?"fill-current":"")}),r.jsx("span",{className:"text-xs font-semibold",children:l})]}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(Dh,{className:d.color,children:[d.emoji," ",d.label]}),e.category&&r.jsx(Dh,{variant:"outline",className:"text-xs",children:e.category}),r.jsx(Dh,{className:u.color,children:u.label})]}),r.jsx("h3",{className:"font-semibold text-lg",children:e.title}),r.jsx("p",{className:"text-muted-foreground text-sm",children:e.description}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[!e.is_anonymous&&e.profiles&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(xh,{className:"h-5 w-5",children:[r.jsx(vh,{src:e.profiles.avatar_url}),r.jsx(bh,{children:e.profiles.username?.[0]?.toUpperCase()||"?"})]}),r.jsxs("span",{children:["@",e.profiles.username]})]}),e.is_anonymous&&r.jsx("span",{className:"italic",children:"Anonyme"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(bt,{className:"h-3 w-3"}),he(new Date(e.created_at),{addSuffix:!0,locale:pe})]}),e.comments_count>0&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Z,{className:"h-3 w-3"}),e.comments_count]})]})]})]})})}function E_(){const[e,t]=s.useState([]),[n,a]=s.useState(!0),[i,o]=s.useState({sortBy:"votes"});async function l(){a(!0);try{const e=await async function(e={}){let t=en.from("feedback_submissions").select("\n      *,\n      profiles(username, avatar_url)\n    ");switch(e.type&&(t=t.eq("type",e.type)),e.status&&(t=t.eq("status",e.status)),e.sortBy){case"votes":t=t.order("votes_count",{ascending:!1});break;case"comments":t=t.order("comments_count",{ascending:!1});break;default:t=t.order("created_at",{ascending:!1})}const{data:s,error:r}=await t;if(r)throw r;const{data:{user:n}}=await en.auth.getUser();if(n&&s){const e=s.map(e=>e.id),{data:t}=await en.from("feedback_votes").select("feedback_id").eq("user_id",n.id).in("feedback_id",e),r=new Set(t?.map(e=>e.feedback_id)||[]);return s.map(e=>({...e,has_voted:r.has(e.id)}))}return s||[]}(i);t(e)}catch(e){}finally{a(!1)}}return s.useEffect(()=>{l()},[i]),n?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(Ne,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold",children:" Suggestions de la communaut"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(qn,{variant:"votes"===i.sortBy?"default":"outline",size:"sm",onClick:()=>o({...i,sortBy:"votes"}),children:" Top votes"}),r.jsx(qn,{variant:"recent"===i.sortBy?"default":"outline",size:"sm",onClick:()=>o({...i,sortBy:"recent"}),children:" Rcent"})]})]}),0===e.length?r.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Aucun feedback pour le moment. Sois le premier ! "}):r.jsx("div",{className:"space-y-3",children:e.map(e=>r.jsx(S_,{feedback:e,onVoteChange:l},e.id))})]})}function R_(){const{user:e}=kn(),{t:t}=Tn(),n=H(),[a,i]=s.useState(!1);return r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsx(Zh,{}),r.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[r.jsxs("div",{className:"text-center mb-12 space-y-4",children:[r.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:t.feedback.title}),r.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:t.feedback.subtitle}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[r.jsx(qn,{size:"lg",onClick:()=>{e?i(!0):n("/auth")},className:"text-lg",children:t.feedback.buttons.give}),r.jsx(qn,{size:"lg",variant:"outline",onClick:()=>document.getElementById("feedback-list")?.scrollIntoView({behavior:"smooth"}),children:t.feedback.buttons.view})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:t.feedback.realTime})]}),!a&&r.jsx("div",{className:"mb-8",children:r.jsx(y_,{})}),a&&r.jsx("div",{className:"mb-8",children:r.jsx(N_,{onSuccess:()=>{i(!1),window.scrollTo({top:0,behavior:"smooth"})},onCancel:()=>i(!1)})}),r.jsx("div",{id:"feedback-list",children:r.jsx(E_,{})})]})]})}const C_=()=>r.jsxs(fs,{children:[r.jsx(gs,{path:"/",element:r.jsx(sh,{})}),r.jsx(gs,{path:"/landing",element:r.jsx(sh,{})}),r.jsx(gs,{path:"/home",element:r.jsx(Tx,{})}),r.jsx(gs,{path:"/auth",element:r.jsx(Bx,{})}),r.jsx(gs,{path:"/reset-password",element:r.jsx($x,{})}),r.jsx(gs,{path:"/profile/:userId",element:r.jsx(Ov,{})}),r.jsx(gs,{path:"/profile",element:r.jsx(Ov,{})}),r.jsx(gs,{path:"/u/:userId",element:r.jsx(Ov,{})}),r.jsx(gs,{path:"/book/:id",element:r.jsx(Ny,{})}),r.jsx(gs,{path:"/books/:id",element:r.jsx(Ny,{})}),r.jsx(gs,{path:"/blog",element:r.jsx(Cy,{})}),r.jsx(gs,{path:"/blog/page/1",element:r.jsx(Ct,{to:"/blog",replace:!0})}),r.jsx(gs,{path:"/blog/page/:page",element:r.jsx(Cy,{})}),r.jsx(gs,{path:"/blog/:slug",element:r.jsx(Oj,{})}),r.jsx(gs,{path:"/reading-list",element:r.jsx(Fj,{})}),r.jsx(gs,{path:"/discover",element:r.jsx(sw,{})}),r.jsx(gs,{path:"/explore",element:r.jsx(rw,{})}),r.jsx(gs,{path:"/search",element:r.jsx(xN,{})}),r.jsx(gs,{path:"/achievements",element:r.jsx(cw,{})}),r.jsx(gs,{path:"/followers/:type/:userId",element:r.jsx(uw,{})}),r.jsx(gs,{path:"/finished-chat/:slug",element:r.jsx(nN,{})}),r.jsx(gs,{path:"/feedback",element:r.jsx(R_,{})}),r.jsx(gs,{path:"/a-propos",element:r.jsx(iN,{})}),r.jsx(gs,{path:"/presse",element:r.jsx(oN,{})}),r.jsx(gs,{path:"/duolingo",element:r.jsx(pN,{})}),r.jsx(gs,{path:"/strava",element:r.jsx(fN,{})}),r.jsx(gs,{path:"/sitemap.xml",element:r.jsx(x_,{})}),r.jsx(gs,{path:"/apropos",element:r.jsx(Ct,{to:"/a-propos",replace:!0})}),r.jsx(gs,{path:"/about",element:r.jsx(Ct,{to:"/a-propos",replace:!0})}),r.jsx(gs,{path:"/press",element:r.jsx(Ct,{to:"/presse",replace:!0})}),r.jsx(gs,{path:"/a-propos/index.html",element:r.jsx(Ct,{to:"/a-propos",replace:!0})}),r.jsx(gs,{path:"/presse/index.html",element:r.jsx(Ct,{to:"/presse",replace:!0})}),r.jsx(gs,{path:"/legal/privacy",element:r.jsx(vN,{})}),r.jsx(gs,{path:"/legal/terms",element:r.jsx(bN,{})}),r.jsx(gs,{path:"/premium",element:r.jsx(p_,{})}),r.jsx(gs,{path:"/request-book",element:r.jsx(Hh,{children:r.jsx(g_,{})})}),r.jsx(gs,{path:"/settings/delete-account",element:r.jsx(Hh,{children:r.jsx(yN,{})})}),r.jsx(gs,{path:"/admin",element:r.jsx(eN,{})}),r.jsx(gs,{path:"/admin/auto-covers",element:r.jsx(mw,{children:r.jsx(tN,{})})}),r.jsx(gs,{path:"/admin/audit",element:r.jsx(mw,{children:r.jsx(sN,{})})}),r.jsx(gs,{path:"/admin/book-requests",element:r.jsx(mw,{children:r.jsx(rN,{})})}),r.jsx(gs,{path:"*",element:r.jsx(gN,{})})]}),A_="https://www.vread.fr/";function T_(){const{pathname:e}=Et();return s.useEffect(()=>{const t=document.head.querySelector('link[rel="canonical"]:not([data-rh])');t&&("/"===e||"/index.html"===e?t.href!==A_&&(t.href=A_):t.parentElement?.removeChild(t))},[e]),null}function P_(){const{pathname:e}=Et();return s.useEffect(()=>{document.head.querySelectorAll('meta[property="og:url"]:not([data-rh])').forEach(e=>e.parentElement?.removeChild(e))},[e]),null}const I_=()=>{const[e,t]=s.useState(!1);return s.useEffect(()=>{const s=()=>{e||(t(!0),mn.error("La connexion  VREAD semble perdue",{description:"Recharge la page pour continuer",duration:1/0,action:{label:"Recharger",onClick:()=>window.location.reload()},position:"top-center"}))};return window.addEventListener("auth-expired",s),()=>window.removeEventListener("auth-expired",s)},[e]),null};function D_(){const e=xs(),t=s.useRef(null),r=s.useRef(!1);return s.useEffect(()=>(e>0?null===t.current&&(t.current=window.setTimeout(()=>{e>0&&!r.current&&(r.current=!0,window.dispatchEvent(new Event("auth-expired")))},1e4)):null!==t.current&&(window.clearTimeout(t.current),t.current=null),()=>{null!==t.current&&(window.clearTimeout(t.current),t.current=null)}),[e]),null}const L_=s.lazy(()=>_s(()=>import("./sonner-BGHkHUJU.js"),__vite__mapDeps([6,1,2,3])).then(e=>({default:e.Sonner}))),O_=()=>{const e="/landing"===Et().pathname;kn();const t=Cs.isNativePlatform();return r.jsxs(r.Fragment,{children:[r.jsx(I_,{}),r.jsx(D_,{}),r.jsx(s.Suspense,{fallback:null,children:r.jsx(L_,{richColors:!1,position:"top-right",visibleToasts:e?0:void 0,className:"toaster w-full max-w-sm sm:max-w-sm"})}),!t&&r.jsx(En,{}),r.jsx(T_,{}),r.jsx(P_,{}),r.jsx(C_,{}),!1]})},M_=()=>r.jsx(vs,{children:r.jsx(bs,{client:Sn,children:r.jsx(An,{children:r.jsx(_n,{children:r.jsx(Ur,{children:r.jsx(ys,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:r.jsx(O_,{})})})})})})});(async()=>{try{const e=Cs.getPlatform();if("ios"===e){await zs.setOverlaysWebView({overlay:!1}),await zs.setStyle({style:Ms.Dark}),await Zs.setAccessoryBarVisible({isVisible:!1});const e=document.body;Zs.addListener("keyboardWillShow",t=>{e.classList.add("keyboard-open"),t?.keyboardHeight&&e.style.setProperty("--keyboard-height",`${t.keyboardHeight}px`)}),Zs.addListener("keyboardWillHide",()=>{e.classList.remove("keyboard-open"),e.style.removeProperty("--keyboard-height")});const{appleIAPService:t}=await _s(async()=>{const{appleIAPService:e}=await Promise.resolve().then(()=>d_);return{appleIAPService:e}},void 0);await t.initialize()}"android"===e&&await async function(){if(!m_.startsWith("goog_"))throw new Error("[RevenueCat] Invalid or missing VITE_RC_ANDROID_KEY (must start with goog_)");try{await l_.setLogLevel({level:WN.WARN}),await l_.configure({apiKey:m_})}catch(V_){throw V_}}()}catch(V_){throw V_}js.createRoot(document.getElementById("root")).render(r.jsx(l.StrictMode,{children:r.jsx(vs,{children:r.jsx(nb,{children:r.jsx(M_,{})})})}))})(),_s(async()=>{const{registerPWA:e}=await import("./pwa-BGgcqMez.js");return{registerPWA:e}},__vite__mapDeps([7,1,2,3])).then(({registerPWA:e})=>e());export{FN as R,QN as V,Ts as W,_s as _,a_ as a,bn as i};
