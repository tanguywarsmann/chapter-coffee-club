const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-DfyDiBA2.js","assets/vendor-supabase-DaKTKCtH.js","assets/vendor-react-C4414gbf.js","assets/vendor-ui-ByoYm48K.js","assets/web-8fJlM3e4.js","assets/toaster-hlmAukfb.js","assets/sonner-BZcbXegF.js","assets/pwa-D2T-wxvP.js"])))=>i.map(i=>d[i]);
var e,t,s,r=Object.defineProperty,a=(e,t,s)=>((e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);import{c as n,_ as i}from"./vendor-supabase-DaKTKCtH.js";import{r as o,j as l,C as c,P as d,R as u,T as m,a as h,v as p,Q as f,S as g,H as x,L as v,O as b,b as y,d as w,e as j,X as N,f as k,D as _,h as S,i as E,k as C,B as R,l as T,m as A,n as P,U as I,M as D,u as L,o as O,p as M,I as V,F as z,q as U,s as B,t as F,w as q,x as $,y as W,z as H,A as Z,E as G,G as K,J as Y,K as Q,N as X,V as J,W as ee,Y as te,Z as se,_ as re,$ as ae,a0 as ne,a1 as ie,a2 as oe,a3 as le,a4 as ce,a5 as de,a6 as ue,a7 as me,a8 as he,a9 as pe,aa as fe,ab as ge,ac as xe,ad as ve,ae as be,af as ye,ag as we,ah as je,ai as Ne,aj as ke,ak as _e,al as Se,am as Ee,an as Ce,ao as Re,ap as Te,aq as Ae,ar as Pe,as as Ie,at as De,au as Le,av as Oe,aw as Me,ax as Ve,ay as ze,az as Ue,aA as Be,aB as Fe,aC as qe,aD as $e,aE as We,aF as He,aG as Ze,aH as Ge,aI as Ke,aJ as Ye,aK as Qe,aL as Xe,aM as Je,aN as et,aO as tt,aP as st,aQ as rt,aR as at,aS as nt,aT as it,aU as ot,aV as lt,aW as ct,aX as dt,aY as ut,aZ as mt,a_ as ht,a$ as pt,b0 as ft,b1 as gt,b2 as xt,b3 as vt,b4 as bt,b5 as yt,b6 as wt,b7 as jt,b8 as Nt,b9 as kt,ba as _t,bb as St,bc as Et,bd as Ct,be as Rt,bf as Tt,bg as At,bh as Pt,bi as It,bj as Dt,bk as Lt,bl as Ot,bm as Mt,bn as Vt,bo as zt,bp as Ut,bq as Bt,br as Ft,bs as qt,bt as $t,bu as Wt,bv as Ht,bw as Zt,bx as Gt,by as Kt,bz as Yt,bA as Qt,bB as Xt,bC as Jt,bD as es,bE as ts,bF as ss,bG as rs,bH as as,bI as ns,bJ as is,bK as os,bL as ls,bM as cs,bN as ds,bO as us,bP as ms,bQ as hs,bR as ps,bS as fs,bT as gs,bU as xs,bV as vs,bW as bs,bX as ys,bY as ws,bZ as js}from"./vendor-react-C4414gbf.js";import"./vendor-ui-ByoYm48K.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),(s=t||(t={})).Unimplemented="UNIMPLEMENTED",s.Unavailable="UNAVAILABLE";class Ns extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const ks=e=>{const s=e.CapacitorCustomPlatform||null,r=e.Capacitor||{},a=r.Plugins=r.Plugins||{},n=()=>null!==s?s.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e),i=e=>{var t;return null===(t=r.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return r.convertFileSrc||(r.convertFileSrc=e=>e),r.getPlatform=n,r.handleError=t=>e.console.error(t),r.isNativePlatform=()=>"web"!==n(),r.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(n()))||!!i(e)},r.registerPlugin=(e,l={})=>{const c=o.get(e);if(c)return c.proxy;const d=n(),u=i(e);let m;const h=a=>{let n;const i=(...i)=>{const o=(async()=>(!m&&d in l?m=m="function"==typeof l[d]?await l[d]():l[d]:null!==s&&!m&&"web"in l&&(m=m="function"==typeof l.web?await l.web():l.web),m))().then(s=>{const o=((s,a)=>{var n,i;if(!u){if(s)return null===(i=s[a])||void 0===i?void 0:i.bind(s);throw new Ns(`"${e}" plugin is not implemented on ${d}`,t.Unimplemented)}{const t=null==u?void 0:u.methods.find(e=>a===e.name);if(t)return"promise"===t.rtype?t=>r.nativePromise(e,a.toString(),t):(t,s)=>r.nativeCallback(e,a.toString(),t,s);if(s)return null===(n=s[a])||void 0===n?void 0:n.bind(s)}})(s,a);if(o){const e=o(...i);return n=null==e?void 0:e.remove,e}throw new Ns(`"${e}.${a}()" is not implemented on ${d}`,t.Unimplemented)});return"addListener"===a&&(o.remove=async()=>n()),o};return i.toString=()=>`${a.toString()}() { [capacitor code] }`,Object.defineProperty(i,"name",{value:a,writable:!1,configurable:!1}),i},p=h("addListener"),f=h("removeListener"),g=(e,t)=>{const s=p({eventName:e},t),r=async()=>{const r=await s;f({eventName:e,callbackId:r},t)},a=new Promise(e=>s.then(()=>e({remove:r})));return a.remove=async()=>{await r()},a},x=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return u?g:p;case"removeListener":return f;default:return h(t)}}});return a[e]=x,o.set(e,{name:e,proxy:x,platforms:new Set([...Object.keys(l),...u?[d]:[]])}),x},r.Exception=Ns,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},_s=(e=>e.Capacitor=ks(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),Ss=_s.registerPlugin;class Es{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const r=this.listeners[e];if(r)r.forEach(e=>e(t));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new _s.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new _s.Exception(e,t.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const r=s.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const Cs=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Rs=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ts extends Es{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=Rs(s).trim(),r=Rs(r).trim(),t[s]=r}),t}async setCookie(e){try{const t=Cs(e.key),s=Cs(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),n=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${r}; path=${a}; ${n};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ss("CapacitorCookies",{web:()=>new Ts});const As=(e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((s,r,a)=>(s[r]=e[t[a]],s),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(r.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,r]of Object.entries(e.data||{}))t.set(s,r);s.body=t.toString()}else if(r.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const r=new Headers(s.headers);r.delete("content-type"),s.headers=r}else(r.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s};class Ps extends Es{async request(e){const t=As(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{const[r,a]=s;let n,i;return Array.isArray(a)?(i="",a.forEach(e=>{n=t?encodeURIComponent(e):e,i+=`${r}=${n}&`}),i.slice(0,-1)):(n=t?encodeURIComponent(a):a,i=`${r}=${n}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=s?`${e.url}?${s}`:e.url,a=await fetch(r,t),n=a.headers.get("content-type")||"";let i,o,{responseType:l="text"}=a.ok?e:{};switch(n.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":o=await a.blob(),i=await(async e=>new Promise((t,s)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>s(e),r.readAsDataURL(e)}))(o);break;case"json":i=await a.json();break;default:i=await a.text()}const c={};return a.headers.forEach((e,t)=>{c[t]=e}),{data:i,headers:c,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}var Is,Ds,Ls,Os;Ss("CapacitorHttp",{web:()=>new Ps}),(Ds=Is||(Is={})).Dark="DARK",Ds.Light="LIGHT",Ds.Default="DEFAULT",(Os=Ls||(Ls={})).None="NONE",Os.Slide="SLIDE",Os.Fade="FADE";const Ms=Ss("StatusBar");function Vs(e){var t,s,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(s=Vs(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}function zs(){for(var e,t,s=0,r="",a=arguments.length;s<a;s++)(e=arguments[s])&&(t=Vs(e))&&(r&&(r+=" "),r+=t);return r}const Us=e=>{const t=$s(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),Bs(s,t)||qs(e)},getConflictingClassGroupIds:(e,t)=>{const a=s[e]||[];return t&&r[e]?[...a,...r[e]]:a}}},Bs=(e,t)=>{if(0===e.length)return t.classGroupId;const s=e[0],r=t.nextPart.get(s),a=r?Bs(e.slice(1),r):void 0;if(a)return a;if(0===t.validators.length)return;const n=e.join("-");return t.validators.find(({validator:e})=>e(n))?.classGroupId},Fs=/^\[(.+)\]$/,qs=e=>{if(Fs.test(e)){const t=Fs.exec(e)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},$s=e=>{const{theme:t,prefix:s}=e,r={nextPart:new Map,validators:[]};return Gs(Object.entries(e.classGroups),s).forEach(([e,s])=>{Ws(s,r,e,t)}),r},Ws=(e,t,s,r)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:Hs(t,e)).classGroupId=s)}if("function"==typeof e)return Zs(e)?void Ws(e(r),t,s,r):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach(([e,a])=>{Ws(a,Hs(t,e),s,r)})})},Hs=(e,t)=>{let s=e;return t.split("-").forEach(e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)}),s},Zs=e=>e.isThemeGetter,Gs=(e,t)=>t?e.map(([e,s])=>[e,s.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,s])=>[t+e,s])):e)]):e,Ks=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,r=new Map;const a=(a,n)=>{s.set(a,n),t++,t>e&&(t=0,r=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(a(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):a(e,t)}}},Ys=e=>{const{separator:t,experimentalParseClassName:s}=e,r=1===t.length,a=t[0],n=t.length,i=e=>{const s=[];let i,o=0,l=0;for(let u=0;u<e.length;u++){let c=e[u];if(0===o){if(c===a&&(r||e.slice(u,u+n)===t)){s.push(e.slice(l,u)),l=u+n;continue}if("/"===c){i=u;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:i&&i>l?i-l:void 0}};return s?e=>s({className:e,parseClassName:i}):i},Qs=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach(e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)}),t.push(...s.sort()),t},Xs=/\s+/;function Js(){let e,t,s=0,r="";for(;s<arguments.length;)(e=arguments[s++])&&(t=er(e))&&(r&&(r+=" "),r+=t);return r}const er=e=>{if("string"==typeof e)return e;let t,s="";for(let r=0;r<e.length;r++)e[r]&&(t=er(e[r]))&&(s&&(s+=" "),s+=t);return s};function tr(e,...t){let s,r,a,n=function(o){const l=t.reduce((e,t)=>t(e),e());return s=(e=>({cache:Ks(e.cacheSize),parseClassName:Ys(e),...Us(e)}))(l),r=s.cache.get,a=s.cache.set,n=i,i(o)};function i(e){const t=r(e);if(t)return t;const n=((e,t)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:a}=t,n=[],i=e.trim().split(Xs);let o="";for(let l=i.length-1;l>=0;l-=1){const e=i[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:u}=s(e);let m=Boolean(u),h=r(m?d.substring(0,u):d);if(!h){if(!m){o=e+(o.length>0?" "+o:o);continue}if(h=r(d),!h){o=e+(o.length>0?" "+o:o);continue}m=!1}const p=Qs(t).join(":"),f=c?p+"!":p,g=f+h;if(n.includes(g))continue;n.push(g);const x=a(h,m);for(let s=0;s<x.length;++s){const e=x[s];n.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return a(e,n),n}return function(){return n(Js.apply(null,arguments))}}const sr=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},rr=/^\[(?:([a-z-]+):)?(.+)\]$/i,ar=/^\d+\/\d+$/,nr=new Set(["px","full","screen"]),ir=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,or=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,lr=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,cr=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,dr=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ur=e=>hr(e)||nr.has(e)||ar.test(e),mr=e=>Sr(e,"length",Er),hr=e=>Boolean(e)&&!Number.isNaN(Number(e)),pr=e=>Sr(e,"number",hr),fr=e=>Boolean(e)&&Number.isInteger(Number(e)),gr=e=>e.endsWith("%")&&hr(e.slice(0,-1)),xr=e=>rr.test(e),vr=e=>ir.test(e),br=new Set(["length","size","percentage"]),yr=e=>Sr(e,br,Cr),wr=e=>Sr(e,"position",Cr),jr=new Set(["image","url"]),Nr=e=>Sr(e,jr,Tr),kr=e=>Sr(e,"",Rr),_r=()=>!0,Sr=(e,t,s)=>{const r=rr.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):s(r[2]))},Er=e=>or.test(e)&&!lr.test(e),Cr=()=>!1,Rr=e=>cr.test(e),Tr=e=>dr.test(e),Ar=tr(()=>{const e=sr("colors"),t=sr("spacing"),s=sr("blur"),r=sr("brightness"),a=sr("borderColor"),n=sr("borderRadius"),i=sr("borderSpacing"),o=sr("borderWidth"),l=sr("contrast"),c=sr("grayscale"),d=sr("hueRotate"),u=sr("invert"),m=sr("gap"),h=sr("gradientColorStops"),p=sr("gradientColorStopPositions"),f=sr("inset"),g=sr("margin"),x=sr("opacity"),v=sr("padding"),b=sr("saturate"),y=sr("scale"),w=sr("sepia"),j=sr("skew"),N=sr("space"),k=sr("translate"),_=()=>["auto",xr,t],S=()=>[xr,t],E=()=>["",ur,mr],C=()=>["auto",hr,xr],R=()=>["","0",xr],T=()=>[hr,xr];return{cacheSize:500,separator:":",theme:{colors:[_r],spacing:[ur,mr],blur:["none","",vr,xr],brightness:T(),borderColor:[e],borderRadius:["none","","full",vr,xr],borderSpacing:S(),borderWidth:E(),contrast:T(),grayscale:R(),hueRotate:T(),invert:R(),gap:S(),gradientColorStops:[e],gradientColorStopPositions:[gr,mr],inset:_(),margin:_(),opacity:T(),padding:S(),saturate:T(),scale:T(),sepia:R(),skew:T(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",xr]}],container:["container"],columns:[{columns:[vr]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",xr]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",fr,xr]}],basis:[{basis:_()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",xr]}],grow:[{grow:R()}],shrink:[{shrink:R()}],order:[{order:["first","last","none",fr,xr]}],"grid-cols":[{"grid-cols":[_r]}],"col-start-end":[{col:["auto",{span:["full",fr,xr]},xr]}],"col-start":[{"col-start":C()}],"col-end":[{"col-end":C()}],"grid-rows":[{"grid-rows":[_r]}],"row-start-end":[{row:["auto",{span:[fr,xr]},xr]}],"row-start":[{"row-start":C()}],"row-end":[{"row-end":C()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",xr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",xr]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",xr,t]}],"min-w":[{"min-w":[xr,t,"min","max","fit"]}],"max-w":[{"max-w":[xr,t,"none","full","min","max","fit","prose",{screen:[vr]},vr]}],h:[{h:[xr,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[xr,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[xr,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[xr,t,"auto","min","max","fit"]}],"font-size":[{text:["base",vr,mr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",pr]}],"font-family":[{font:[_r]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",xr]}],"line-clamp":[{"line-clamp":["none",hr,pr]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ur,xr]}],"list-image":[{"list-image":["none",xr]}],"list-style-type":[{list:["none","disc","decimal",xr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ur,mr]}],"underline-offset":[{"underline-offset":["auto",ur,xr]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",xr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",xr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",wr]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",yr]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Nr]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[ur,xr]}],"outline-w":[{outline:[ur,mr]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:E()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[ur,mr]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",vr,kr]}],"shadow-color":[{shadow:[_r]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",vr,xr]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[b]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",xr]}],duration:[{duration:T()}],ease:[{ease:["linear","in","out","in-out",xr]}],delay:[{delay:T()}],animate:[{animate:["none","spin","ping","pulse","bounce",xr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[y]}],"scale-x":[{"scale-x":[y]}],"scale-y":[{"scale-y":[y]}],rotate:[{rotate:[fr,xr]}],"translate-x":[{"translate-x":[k]}],"translate-y":[{"translate-y":[k]}],"skew-x":[{"skew-x":[j]}],"skew-y":[{"skew-y":[j]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",xr]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",xr]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",xr]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[ur,mr,pr]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function Pr(...e){return Ar(zs(e))}const Ir=d,Dr=u,Lr=m,Or=o.forwardRef(({className:e,sideOffset:t=4,...s},r)=>l.jsx(c,{ref:r,sideOffset:t,className:Pr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));Or.displayName=c.displayName;let Mr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqdW1zcmp1eXp2c2l4dmZ3b2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxNTU1NjYsImV4cCI6MjA2MDczMTU2Nn0.GXAF1p5iTeI3mLwwYi4rnXLsWHSUwglmdQJ7SoC3rH8";const Vr=n("https://xjumsrjuyzvsixvfwoiz.supabase.co",Mr,{auth:{storage:{getItem:e=>{try{return localStorage.getItem(e)}catch(t){return null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch(s){}},removeItem:e=>{try{localStorage.removeItem(e)}catch(t){}}},persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{apikey:Mr}}});(async()=>{try{const{error:e}=await Vr.from("books").select("id").limit(1)}catch(e){}})();var zr=Array(12).fill(0),Ur=({visible:e,className:t})=>h.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},h.createElement("div",{className:"sonner-spinner"},zr.map((e,t)=>h.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),Br=h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},h.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Fr=h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},h.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),qr=h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},h.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),$r=h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},h.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Wr=h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},h.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),h.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Hr=1,Zr=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:s,...r}=e,a="number"==typeof(null==e?void 0:e.id)||(null==(t=e.id)?void 0:t.length)>0?e.id:Hr++,n=this.toasts.find(e=>e.id===a),i=void 0===e.dismissible||e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),n?this.toasts=this.toasts.map(t=>t.id===a?(this.publish({...t,...e,id:a,title:s}),{...t,...e,id:a,dismissible:i,title:s}):t):this.addToast({title:s,...r,dismissible:i,id:a}),a},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let s;void 0!==t.loading&&(s=this.create({...t,promise:e,type:"loading",message:t.loading,description:"function"!=typeof t.description?t.description:void 0}));let r,a=e instanceof Promise?e:e(),n=void 0!==s,i=a.then(async e=>{if(r=["resolve",e],h.isValidElement(e))n=!1,this.create({id:s,type:"default",message:e});else if(Gr(e)&&!e.ok){n=!1;let r="function"==typeof t.error?await t.error(`HTTP error! status: ${e.status}`):t.error,a="function"==typeof t.description?await t.description(`HTTP error! status: ${e.status}`):t.description;this.create({id:s,type:"error",message:r,description:a})}else if(void 0!==t.success){n=!1;let r="function"==typeof t.success?await t.success(e):t.success,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:s,type:"success",message:r,description:a})}}).catch(async e=>{if(r=["reject",e],void 0!==t.error){n=!1;let r="function"==typeof t.error?await t.error(e):t.error,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:s,type:"error",message:r,description:a})}}).finally(()=>{var e;n&&(this.dismiss(s),s=void 0),null==(e=t.finally)||e.call(t)}),o=()=>new Promise((e,t)=>i.then(()=>"reject"===r[0]?t(r[1]):e(r[1])).catch(t));return"string"!=typeof s&&"number"!=typeof s?{unwrap:o}:Object.assign(s,{unwrap:o})},this.custom=(e,t)=>{let s=(null==t?void 0:t.id)||Hr++;return this.create({jsx:e(s),id:s,...t}),s},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Gr=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,Kr=(e,t)=>{let s=(null==t?void 0:t.id)||Hr++;return Zr.addToast({title:e,...t,id:s}),s},Yr=Object.assign(Kr,{success:Zr.success,info:Zr.info,warning:Zr.warning,error:Zr.error,custom:Zr.custom,message:Zr.message,promise:Zr.promise,dismiss:Zr.dismiss,loading:Zr.loading},{getHistory:()=>Zr.toasts,getToasts:()=>Zr.getActiveToasts()});function Qr(e){return void 0!==e.label}!function(e,{insertAt:t}={}){if("undefined"==typeof document)return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}(':where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\n');var Xr=3,Jr=14;function ea(...e){return e.filter(Boolean).join(" ")}var ta=e=>{var t,s,r,a,n,i,l,c,d,u,m;let{invert:p,toast:f,unstyled:g,interacting:x,setHeights:v,visibleToasts:b,heights:y,index:w,toasts:j,expanded:N,removeToast:k,defaultRichColors:_,closeButton:S,style:E,cancelButtonStyle:C,actionButtonStyle:R,className:T="",descriptionClassName:A="",duration:P,position:I,gap:D,loadingIcon:L,expandByDefault:O,classNames:M,icons:V,closeButtonAriaLabel:z="Close toast",pauseWhenPageIsHidden:U}=e,[B,F]=h.useState(null),[q,$]=h.useState(null),[W,H]=h.useState(!1),[Z,G]=h.useState(!1),[K,Y]=h.useState(!1),[Q,X]=h.useState(!1),[J,ee]=h.useState(!1),[te,se]=h.useState(0),[re,ae]=h.useState(0),ne=h.useRef(f.duration||P||4e3),ie=h.useRef(null),oe=h.useRef(null),le=0===w,ce=w+1<=b,de=f.type,ue=!1!==f.dismissible,me=f.className||"",he=f.descriptionClassName||"",pe=h.useMemo(()=>y.findIndex(e=>e.toastId===f.id)||0,[y,f.id]),fe=h.useMemo(()=>{var e;return null!=(e=f.closeButton)?e:S},[f.closeButton,S]),ge=h.useMemo(()=>f.duration||P||4e3,[f.duration,P]),xe=h.useRef(0),ve=h.useRef(0),be=h.useRef(0),ye=h.useRef(null),[we,je]=I.split("-"),Ne=h.useMemo(()=>y.reduce((e,t,s)=>s>=pe?e:e+t.height,0),[y,pe]),ke=(()=>{let[e,t]=h.useState(document.hidden);return h.useEffect(()=>{let e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)},[]),e})(),_e=f.invert||p,Se="loading"===de;ve.current=h.useMemo(()=>pe*D+Ne,[pe,Ne]),h.useEffect(()=>{ne.current=ge},[ge]),h.useEffect(()=>{H(!0)},[]),h.useEffect(()=>{let e=oe.current;if(e){let t=e.getBoundingClientRect().height;return ae(t),v(e=>[{toastId:f.id,height:t,position:f.position},...e]),()=>v(e=>e.filter(e=>e.toastId!==f.id))}},[v,f.id]),h.useLayoutEffect(()=>{if(!W)return;let e=oe.current,t=e.style.height;e.style.height="auto";let s=e.getBoundingClientRect().height;e.style.height=t,ae(s),v(e=>e.find(e=>e.toastId===f.id)?e.map(e=>e.toastId===f.id?{...e,height:s}:e):[{toastId:f.id,height:s,position:f.position},...e])},[W,f.title,f.description,v,f.id]);let Ee=h.useCallback(()=>{G(!0),se(ve.current),v(e=>e.filter(e=>e.toastId!==f.id)),setTimeout(()=>{k(f)},200)},[f,k,v,ve]);return h.useEffect(()=>{if(f.promise&&"loading"===de||f.duration===1/0||"loading"===f.type)return;let e;return N||x||U&&ke?(()=>{if(be.current<xe.current){let e=(new Date).getTime()-xe.current;ne.current=ne.current-e}be.current=(new Date).getTime()})():ne.current!==1/0&&(xe.current=(new Date).getTime(),e=setTimeout(()=>{var e;null==(e=f.onAutoClose)||e.call(f,f),Ee()},ne.current)),()=>clearTimeout(e)},[N,x,f,de,U,ke,Ee]),h.useEffect(()=>{f.delete&&Ee()},[Ee,f.delete]),h.createElement("li",{tabIndex:0,ref:oe,className:ea(T,me,null==M?void 0:M.toast,null==(t=null==f?void 0:f.classNames)?void 0:t.toast,null==M?void 0:M.default,null==M?void 0:M[de],null==(s=null==f?void 0:f.classNames)?void 0:s[de]),"data-sonner-toast":"","data-rich-colors":null!=(r=f.richColors)?r:_,"data-styled":!(f.jsx||f.unstyled||g),"data-mounted":W,"data-promise":!!f.promise,"data-swiped":J,"data-removed":Z,"data-visible":ce,"data-y-position":we,"data-x-position":je,"data-index":w,"data-front":le,"data-swiping":K,"data-dismissible":ue,"data-type":de,"data-invert":_e,"data-swipe-out":Q,"data-swipe-direction":q,"data-expanded":!!(N||O&&W),style:{"--index":w,"--toasts-before":w,"--z-index":j.length-w,"--offset":`${Z?te:ve.current}px`,"--initial-height":O?"auto":`${re}px`,...E,...f.style},onDragEnd:()=>{Y(!1),F(null),ye.current=null},onPointerDown:e=>{Se||!ue||(ie.current=new Date,se(ve.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(Y(!0),ye.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,t,s,r;if(Q||!ue)return;ye.current=null;let a=Number((null==(e=oe.current)?void 0:e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),n=Number((null==(t=oe.current)?void 0:t.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),i=(new Date).getTime()-(null==(s=ie.current)?void 0:s.getTime()),o="x"===B?a:n,l=Math.abs(o)/i;if(Math.abs(o)>=20||l>.11)return se(ve.current),null==(r=f.onDismiss)||r.call(f,f),$("x"===B?a>0?"right":"left":n>0?"down":"up"),Ee(),X(!0),void ee(!1);Y(!1),F(null)},onPointerMove:t=>{var s,r,a,n;if(!ye.current||!ue||(null==(s=window.getSelection())?void 0:s.toString().length)>0)return;let i=t.clientY-ye.current.y,o=t.clientX-ye.current.x,l=null!=(r=e.swipeDirections)?r:function(e){let[t,s]=e.split("-"),r=[];return t&&r.push(t),s&&r.push(s),r}(I);!B&&(Math.abs(o)>1||Math.abs(i)>1)&&F(Math.abs(o)>Math.abs(i)?"x":"y");let c={x:0,y:0};"y"===B?(l.includes("top")||l.includes("bottom"))&&(l.includes("top")&&i<0||l.includes("bottom")&&i>0)&&(c.y=i):"x"===B&&(l.includes("left")||l.includes("right"))&&(l.includes("left")&&o<0||l.includes("right")&&o>0)&&(c.x=o),(Math.abs(c.x)>0||Math.abs(c.y)>0)&&ee(!0),null==(a=oe.current)||a.style.setProperty("--swipe-amount-x",`${c.x}px`),null==(n=oe.current)||n.style.setProperty("--swipe-amount-y",`${c.y}px`)}},fe&&!f.jsx?h.createElement("button",{"aria-label":z,"data-disabled":Se,"data-close-button":!0,onClick:Se||!ue?()=>{}:()=>{var e;Ee(),null==(e=f.onDismiss)||e.call(f,f)},className:ea(null==M?void 0:M.closeButton,null==(a=null==f?void 0:f.classNames)?void 0:a.closeButton)},null!=(n=null==V?void 0:V.close)?n:Wr):null,f.jsx||o.isValidElement(f.title)?f.jsx?f.jsx:"function"==typeof f.title?f.title():f.title:h.createElement(h.Fragment,null,de||f.icon||f.promise?h.createElement("div",{"data-icon":"",className:ea(null==M?void 0:M.icon,null==(i=null==f?void 0:f.classNames)?void 0:i.icon)},f.promise||"loading"===f.type&&!f.icon?f.icon||(null!=V&&V.loading?h.createElement("div",{className:ea(null==M?void 0:M.loader,null==(Ce=null==f?void 0:f.classNames)?void 0:Ce.loader,"sonner-loader"),"data-visible":"loading"===de},V.loading):L?h.createElement("div",{className:ea(null==M?void 0:M.loader,null==(Re=null==f?void 0:f.classNames)?void 0:Re.loader,"sonner-loader"),"data-visible":"loading"===de},L):h.createElement(Ur,{className:ea(null==M?void 0:M.loader,null==(Te=null==f?void 0:f.classNames)?void 0:Te.loader),visible:"loading"===de})):null,"loading"!==f.type?f.icon||(null==V?void 0:V[de])||(e=>{switch(e){case"success":return Br;case"info":return qr;case"warning":return Fr;case"error":return $r;default:return null}})(de):null):null,h.createElement("div",{"data-content":"",className:ea(null==M?void 0:M.content,null==(l=null==f?void 0:f.classNames)?void 0:l.content)},h.createElement("div",{"data-title":"",className:ea(null==M?void 0:M.title,null==(c=null==f?void 0:f.classNames)?void 0:c.title)},"function"==typeof f.title?f.title():f.title),f.description?h.createElement("div",{"data-description":"",className:ea(A,he,null==M?void 0:M.description,null==(d=null==f?void 0:f.classNames)?void 0:d.description)},"function"==typeof f.description?f.description():f.description):null),o.isValidElement(f.cancel)?f.cancel:f.cancel&&Qr(f.cancel)?h.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||C,onClick:e=>{var t,s;Qr(f.cancel)&&ue&&(null==(s=(t=f.cancel).onClick)||s.call(t,e),Ee())},className:ea(null==M?void 0:M.cancelButton,null==(u=null==f?void 0:f.classNames)?void 0:u.cancelButton)},f.cancel.label):null,o.isValidElement(f.action)?f.action:f.action&&Qr(f.action)?h.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||R,onClick:e=>{var t,s;Qr(f.action)&&(null==(s=(t=f.action).onClick)||s.call(t,e),!e.defaultPrevented&&Ee())},className:ea(null==M?void 0:M.actionButton,null==(m=null==f?void 0:f.classNames)?void 0:m.actionButton)},f.action.label):null));var Ce,Re,Te};function sa(){if("undefined"==typeof window||"undefined"==typeof document)return"ltr";let e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}function ra(e,t){let s={};return[e,t].forEach((e,t)=>{let r=1===t,a=r?"--mobile-offset":"--offset",n=r?"16px":"32px";function i(e){["top","right","bottom","left"].forEach(t=>{s[`${a}-${t}`]="number"==typeof e?`${e}px`:e})}"number"==typeof e||"string"==typeof e?i(e):"object"==typeof e?["top","right","bottom","left"].forEach(t=>{void 0===e[t]?s[`${a}-${t}`]=n:s[`${a}-${t}`]="number"==typeof e[t]?`${e[t]}px`:e[t]}):i(n)}),s}var aa=o.forwardRef(function(e,t){let{invert:s,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:n,closeButton:i,className:o,offset:l,mobileOffset:c,theme:d="light",richColors:u,duration:m,style:f,visibleToasts:g=Xr,toastOptions:x,dir:v=sa(),gap:b=Jr,loadingIcon:y,icons:w,containerAriaLabel:j="Notifications",pauseWhenPageIsHidden:N}=e,[k,_]=h.useState([]),S=h.useMemo(()=>Array.from(new Set([r].concat(k.filter(e=>e.position).map(e=>e.position)))),[k,r]),[E,C]=h.useState([]),[R,T]=h.useState(!1),[A,P]=h.useState(!1),[I,D]=h.useState("system"!==d?d:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),L=h.useRef(null),O=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),M=h.useRef(null),V=h.useRef(!1),z=h.useCallback(e=>{_(t=>{var s;return null!=(s=t.find(t=>t.id===e.id))&&s.delete||Zr.dismiss(e.id),t.filter(({id:t})=>t!==e.id)})},[]);return h.useEffect(()=>Zr.subscribe(e=>{e.dismiss?_(t=>t.map(t=>t.id===e.id?{...t,delete:!0}:t)):setTimeout(()=>{p.flushSync(()=>{_(t=>{let s=t.findIndex(t=>t.id===e.id);return-1!==s?[...t.slice(0,s),{...t[s],...e},...t.slice(s+1)]:[e,...t]})})})}),[]),h.useEffect(()=>{if("system"!==d)return void D(d);if("system"===d&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?D("dark"):D("light")),"undefined"==typeof window)return;let e=window.matchMedia("(prefers-color-scheme: dark)");try{e.addEventListener("change",({matches:e})=>{D(e?"dark":"light")})}catch(t){e.addListener(({matches:e})=>{try{D(e?"dark":"light")}catch(t){}})}},[d]),h.useEffect(()=>{k.length<=1&&T(!1)},[k]),h.useEffect(()=>{let e=e=>{var t,s;a.every(t=>e[t]||e.code===t)&&(T(!0),null==(t=L.current)||t.focus()),"Escape"===e.code&&(document.activeElement===L.current||null!=(s=L.current)&&s.contains(document.activeElement))&&T(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]),h.useEffect(()=>{if(L.current)return()=>{M.current&&(M.current.focus({preventScroll:!0}),M.current=null,V.current=!1)}},[L.current]),h.createElement("section",{ref:t,"aria-label":`${j} ${O}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((t,r)=>{var a;let[d,p]=t.split("-");return k.length?h.createElement("ol",{key:t,dir:"auto"===v?sa():v,tabIndex:-1,ref:L,className:o,"data-sonner-toaster":!0,"data-theme":I,"data-y-position":d,"data-lifted":R&&k.length>1&&!n,"data-x-position":p,style:{"--front-toast-height":`${(null==(a=E[0])?void 0:a.height)||0}px`,"--width":"356px","--gap":`${b}px`,...f,...ra(l,c)},onBlur:e=>{V.current&&!e.currentTarget.contains(e.relatedTarget)&&(V.current=!1,M.current&&(M.current.focus({preventScroll:!0}),M.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||V.current||(V.current=!0,M.current=e.relatedTarget)},onMouseEnter:()=>T(!0),onMouseMove:()=>T(!0),onMouseLeave:()=>{A||T(!1)},onDragEnd:()=>T(!1),onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||P(!0)},onPointerUp:()=>P(!1)},k.filter(e=>!e.position&&0===r||e.position===t).map((r,a)=>{var o,l;return h.createElement(ta,{key:r.id,icons:w,index:a,toast:r,defaultRichColors:u,duration:null!=(o=null==x?void 0:x.duration)?o:m,className:null==x?void 0:x.className,descriptionClassName:null==x?void 0:x.descriptionClassName,invert:s,visibleToasts:g,closeButton:null!=(l=null==x?void 0:x.closeButton)?l:i,interacting:A,position:t,style:null==x?void 0:x.style,unstyled:null==x?void 0:x.unstyled,classNames:null==x?void 0:x.classNames,cancelButtonStyle:null==x?void 0:x.cancelButtonStyle,actionButtonStyle:null==x?void 0:x.actionButtonStyle,removeToast:z,toasts:k.filter(e=>e.position==r.position),heights:E.filter(e=>e.position==r.position),setHeights:C,expandByDefault:n,gap:b,loadingIcon:y,expanded:R,pauseWhenPageIsHidden:N,swipeDirections:e.swipeDirections})})):null}))});const na=Object.freeze(Object.defineProperty({__proto__:null,Toaster:aa,toast:Yr,useSonner:function(){let[e,t]=h.useState([]);return h.useEffect(()=>Zr.subscribe(e=>{e.dismiss?setTimeout(()=>{p.flushSync(()=>{t(t=>t.filter(t=>t.id!==e.id))})}):setTimeout(()=>{p.flushSync(()=>{t(t=>{let s=t.findIndex(t=>t.id===e.id);return-1!==s?[...t.slice(0,s),{...t[s],...e},...t.slice(s+1)]:[e,...t]})})})}),[]),{toasts:e}}},Symbol.toStringTag,{value:"Module"})),ia=()=>({toasts:[],toast:function(e){return{id:crypto.randomUUID(),...e}}}),oa=e=>({id:crypto.randomUUID(),...e});async function la(e){if(!e)return null;try{const{data:t}=await Vr.auth.getSession(),s=t.session?.user?.id||null;if(s&&s===e){const{data:t,error:s}=await Vr.from("profiles").select("*").eq("id",e).maybeSingle();return s?(oa({title:"Erreur : Impossible de charger votre profil",variant:"destructive"}),null):t}const{data:r,error:a}=await Vr.rpc("get_public_profile",{target_id:e}).maybeSingle();if(a)return oa({title:"Erreur : Impossible de charger le profil public",variant:"destructive"}),null;if(!r)return null;return{id:r.id,username:r.username??null,avatar_url:r.avatar_url??null,created_at:r.created_at??null,updated_at:null,email:null,is_admin:null}}catch(t){return oa({title:"Erreur inattendue lors du chargement du profil",variant:"destructive"}),null}}function ca(e,t,s){return e||(t?function(e){if(!e)return"";const t=e.indexOf("@");return t>8?`${e.substring(0,8)}...`:t>0?`${e.substring(0,t)}...`:e}(t):`Lecteur ${s.substring(0,4)}`)}async function da(e,t){if(!e)return!1;try{const{data:s,error:r}=await Vr.from("profiles").select("id, username, email, avatar_url, is_premium, premium_since, is_admin, created_at, updated_at").eq("id",e).maybeSingle();if(r)return oa({title:"Erreur de synchronisation : Impossible de vrifier le profil existant",variant:"destructive"}),!1;if(s){if(t){const{error:s}=await Vr.from("profiles").update({email:t}).eq("id",e);if(s)return oa({title:"Erreur de mise  jour : Impossible de mettre  jour l'email du profil",variant:"destructive"}),!1}}else{const{error:s}=await Vr.from("profiles").insert({id:e,email:t,username:null,is_admin:!1});if(s)return oa({title:"Erreur de cration : Impossible de crer le profil utilisateur",variant:"destructive"}),!1}return!0}catch(s){return oa({title:"Erreur inattendue lors de la synchronisation du profil",variant:"destructive"}),!1}}const ua=o.createContext({supabase:Vr,session:null,user:null,isLoading:!0,isInitialized:!1,isAdmin:!1,isPremium:!1,error:null,setError:()=>{},signUp:async()=>{},signIn:async()=>{},signOut:async()=>{}});function ma({children:e}){const[t,s]=o.useState(null),[r,a]=o.useState(null),[n,i]=o.useState(!0),[c,d]=o.useState(!1),[u,m]=o.useState(!1),[h,p]=o.useState(!1),[f,g]=o.useState(null),x=async e=>{try{if(!e)return{isAdmin:!1,isPremium:!1};const{data:t,error:s}=await Vr.from("profiles").select("is_admin, is_premium, premium_since").eq("id",e).single();if(s)return m(!1),p(!1),{isAdmin:!1,isPremium:!1};const r=t?.is_admin||!1,n=t?.is_premium||!1;return m(r),p(n),a(e=>{if(!e)return e;return{...e,is_admin:r,is_premium:n,premium_since:t?.premium_since}}),{isAdmin:r,isPremium:n}}catch(t){return m(!1),p(!1),{isAdmin:!1,isPremium:!1}}};return o.useEffect(()=>{const{data:{subscription:e}}=Vr.auth.onAuthStateChange(async(e,t)=>{s(t),a(t?.user??null),t?.user&&setTimeout(async()=>{try{await da(t.user.id,t.user.email),await x(t.user.id)}catch(e){}},0),d(!0),i(!1)});return(async()=>{try{const{data:{session:e},error:t}=await Vr.auth.getSession();t&&(Yr.error("Error connecting to Supabase"),g("Error connecting to Supabase")),s(e),a(e?.user??null),e?.user&&setTimeout(async()=>{try{await da(e.user.id,e.user.email),await x(e.user.id)}catch(t){}},0),d(!0),i(!1)}catch(e){d(!0),i(!1)}})(),()=>{e.unsubscribe()}},[]),l.jsx(ua.Provider,{value:{supabase:Vr,session:t,user:r,isLoading:n,isInitialized:c,isAdmin:u,isPremium:h,error:f,setError:g,signUp:async function(e,t){g(null);const{error:s}=await Vr.auth.signUp({email:e,password:t});if(s)throw new Error(s.message)},signIn:async function(e,t){g(null);const{error:s}=await Vr.auth.signInWithPassword({email:e,password:t});if(s)throw new Error(s.message)},signOut:async function(){g(null);const{error:e}=await Vr.auth.signOut();if(e)throw new Error(e.message)}},children:e})}const ha=()=>o.useContext(ua),pa=new f({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:3e5}}}),fa=()=>null,ga=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,xa=zs,va=(e,t)=>s=>{var r;if(null==(null==t?void 0:t.variants))return xa(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:a,defaultVariants:n}=t,i=Object.keys(a).map(e=>{const t=null==s?void 0:s[e],r=null==n?void 0:n[e];if(null===t)return null;const i=ga(t)||ga(r);return a[e][i]}),o=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),l=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...a}=t;return Object.entries(a).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...n,...o}[t]):{...n,...o}[t]===s})?[...e,s,r]:e},[]);return xa(e,i,l,null==s?void 0:s.class,null==s?void 0:s.className)},ba=va("inline-flex items-center justify-center gap-2 whitespace-normal break-words text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",bookCta:"bg-coffee-dark text-white hover:bg-coffee-darker"},size:{default:"h-auto min-h-[44px] px-6 py-3 rounded-md text-base sm:text-sm sm:min-h-10 sm:px-4 sm:py-2",sm:"h-auto min-h-[40px] px-4 py-2 rounded-md text-sm sm:h-9 sm:px-3",lg:"h-auto min-h-[48px] px-8 py-4 rounded-md text-lg sm:h-11 sm:px-8 sm:text-base",icon:"h-[44px] w-[44px] rounded-md sm:h-10 sm:w-10"}},defaultVariants:{variant:"default",size:"default"}}),ya=o.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...a},n)=>{const i=r?g:"button";return l.jsx(i,{className:Pr(ba({variant:t,size:s,className:e})),ref:n,...a})});function wa({size:e=32,className:t="",...s}){return l.jsx("img",{src:"/branding/vread-logo-512.png",width:e,height:e,alt:"VREAD logo",className:t,loading:"eager",decoding:"async",style:{imageRendering:"auto"},...s})}ya.displayName="Button";var ja={};!function e(t,s,r,a){var n=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),i="function"==typeof Path2D&&"function"==typeof DOMMatrix;function o(){}function l(e){var r=s.exports.Promise,a=void 0!==r?r:t.Promise;return"function"==typeof a?new a(e):(e(o,o),null)}var c,d,u,m,h,p,f=function(e,t){return{transform:function(s){if(e)return s;if(t.has(s))return t.get(s);var r=new OffscreenCanvas(s.width,s.height);return r.getContext("2d").drawImage(s,0,0),t.set(s,r),r},clear:function(){t.clear()}}}(function(){if(!t.OffscreenCanvas)return!1;var e=new OffscreenCanvas(1,1),s=e.getContext("2d");s.fillRect(0,0,1,1);var r=e.transferToImageBitmap();try{s.createPattern(r,"no-repeat")}catch(a){return!1}return!0}(),new Map),g=(u=Math.floor(1e3/60),m={},h=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(c=function(e){var t=Math.random();return m[t]=requestAnimationFrame(function s(r){h===r||h+u-1<r?(h=r,delete m[t],e()):m[t]=requestAnimationFrame(s)}),t},d=function(e){m[e]&&cancelAnimationFrame(m[e])}):(c=function(e){return setTimeout(e,u)},d=function(e){return clearTimeout(e)}),{frame:c,cancel:d}),x=function(){var t,s,a={};return function(){if(t)return t;if(!r&&n){var i=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{t=new Worker(URL.createObjectURL(new Blob([i])))}catch(o){return void 0!==typeof console&&console.warn,null}!function(e){function t(t,s){e.postMessage({options:t||{},callback:s})}e.init=function(t){var s=t.transferControlToOffscreen();e.postMessage({canvas:s},[s])},e.fire=function(r,n,i){if(s)return t(r,null),s;var o=Math.random().toString(36).slice(2);return s=l(function(n){function l(t){t.data.callback===o&&(delete a[o],e.removeEventListener("message",l),s=null,f.clear(),i(),n())}e.addEventListener("message",l),t(r,o),a[o]=l.bind(null,{data:{callback:o}})})},e.reset=function(){for(var t in e.postMessage({reset:!0}),a)a[t](),delete a[t]}}(t)}return t}}(),v={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function b(e,t,s){return function(e,t){return t?t(e):e}(e&&null!=e[t]?e[t]:v[t],s)}function y(e){return e<0?0:Math.floor(e)}function w(e,t){return Math.floor(Math.random()*(t-e))+e}function j(e){return parseInt(e,16)}function N(e){return e.map(k)}function k(e){var t=String(e).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:j(t.substring(0,2)),g:j(t.substring(2,4)),b:j(t.substring(4,6))}}function _(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function S(e){var t=e.getBoundingClientRect();e.width=t.width,e.height=t.height}function E(e){var t=e.angle*(Math.PI/180),s=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-t+(.5*s-Math.random()*s),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function C(e,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var s=t.tick++/t.totalTicks,r=t.x+t.random*t.tiltCos,a=t.y+t.random*t.tiltSin,n=t.wobbleX+t.random*t.tiltCos,o=t.wobbleY+t.random*t.tiltSin;if(e.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-s)+")",e.beginPath(),i&&"path"===t.shape.type&&"string"==typeof t.shape.path&&Array.isArray(t.shape.matrix))e.fill(function(e,t,s,r,a,n,i){var o=new Path2D(e),l=new Path2D;l.addPath(o,new DOMMatrix(t));var c=new Path2D;return c.addPath(l,new DOMMatrix([Math.cos(i)*a,Math.sin(i)*a,-Math.sin(i)*n,Math.cos(i)*n,s,r])),c}(t.shape.path,t.shape.matrix,t.x,t.y,.1*Math.abs(n-r),.1*Math.abs(o-a),Math.PI/10*t.wobble));else if("bitmap"===t.shape.type){var l=Math.PI/10*t.wobble,c=.1*Math.abs(n-r),d=.1*Math.abs(o-a),u=t.shape.bitmap.width*t.scalar,m=t.shape.bitmap.height*t.scalar,h=new DOMMatrix([Math.cos(l)*c,Math.sin(l)*c,-Math.sin(l)*d,Math.cos(l)*d,t.x,t.y]);h.multiplySelf(new DOMMatrix(t.shape.matrix));var p=e.createPattern(f.transform(t.shape.bitmap),"no-repeat");p.setTransform(h),e.globalAlpha=1-s,e.fillStyle=p,e.fillRect(t.x-u/2,t.y-m/2,u,m),e.globalAlpha=1}else if("circle"===t.shape)e.ellipse?e.ellipse(t.x,t.y,Math.abs(n-r)*t.ovalScalar,Math.abs(o-a)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):function(e,t,s,r,a,n,i,o,l){e.save(),e.translate(t,s),e.rotate(n),e.scale(r,a),e.arc(0,0,1,i,o,l),e.restore()}(e,t.x,t.y,Math.abs(n-r)*t.ovalScalar,Math.abs(o-a)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if("star"===t.shape)for(var g=Math.PI/2*3,x=4*t.scalar,v=8*t.scalar,b=t.x,y=t.y,w=5,j=Math.PI/w;w--;)b=t.x+Math.cos(g)*v,y=t.y+Math.sin(g)*v,e.lineTo(b,y),g+=j,b=t.x+Math.cos(g)*x,y=t.y+Math.sin(g)*x,e.lineTo(b,y),g+=j;else e.moveTo(Math.floor(t.x),Math.floor(t.y)),e.lineTo(Math.floor(t.wobbleX),Math.floor(a)),e.lineTo(Math.floor(n),Math.floor(o)),e.lineTo(Math.floor(r),Math.floor(t.wobbleY));return e.closePath(),e.fill(),t.tick<t.totalTicks}function R(e,s){var i,o=!e,c=!!b(s||{},"resize"),d=!1,u=b(s,"disableForReducedMotion",Boolean),m=n&&!!b(s||{},"useWorker")?x():null,h=o?_:S,p=!(!e||!m)&&!!e.__confetti_initialized,v="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function j(t,s,n){for(var o=b(t,"particleCount",y),c=b(t,"angle",Number),d=b(t,"spread",Number),u=b(t,"startVelocity",Number),m=b(t,"decay",Number),p=b(t,"gravity",Number),x=b(t,"drift",Number),v=b(t,"colors",N),j=b(t,"ticks",Number),k=b(t,"shapes"),_=b(t,"scalar"),S=!!b(t,"flat"),R=function(e){var t=b(e,"origin",Object);return t.x=b(t,"x",Number),t.y=b(t,"y",Number),t}(t),T=o,A=[],P=e.width*R.x,I=e.height*R.y;T--;)A.push(E({x:P,y:I,angle:c,spread:d,startVelocity:u,color:v[T%v.length],shape:k[w(0,k.length)],ticks:j,decay:m,gravity:p,drift:x,scalar:_,flat:S}));return i?i.addFettis(A):(i=function(e,t,s,n,i){var o,c,d=t.slice(),u=e.getContext("2d"),m=l(function(t){function l(){o=c=null,u.clearRect(0,0,n.width,n.height),f.clear(),i(),t()}o=g.frame(function t(){!r||n.width===a.width&&n.height===a.height||(n.width=e.width=a.width,n.height=e.height=a.height),n.width||n.height||(s(e),n.width=e.width,n.height=e.height),u.clearRect(0,0,n.width,n.height),(d=d.filter(function(e){return C(u,e)})).length?o=g.frame(t):l()}),c=l});return{addFettis:function(e){return d=d.concat(e),m},canvas:e,promise:m,reset:function(){o&&g.cancel(o),c&&c()}}}(e,A,h,s,n),i.promise)}function k(s){var r=u||b(s,"disableForReducedMotion",Boolean),a=b(s,"zIndex",Number);if(r&&v)return l(function(e){e()});o&&i?e=i.canvas:o&&!e&&(e=function(e){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=e,t}(a),document.body.appendChild(e)),c&&!p&&h(e);var n={width:e.width,height:e.height};function f(){if(m){var t={getBoundingClientRect:function(){if(!o)return e.getBoundingClientRect()}};return h(t),void m.postMessage({resize:{width:t.width,height:t.height}})}n.width=n.height=null}function g(){i=null,c&&(d=!1,t.removeEventListener("resize",f)),o&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,p=!1)}return m&&!p&&m.init(e),p=!0,m&&(e.__confetti_initialized=!0),c&&!d&&(d=!0,t.addEventListener("resize",f,!1)),m?m.fire(s,n,g):j(s,n,g)}return k.reset=function(){m&&m.reset(),i&&i.reset()},k}function T(){return p||(p=R(null,{useWorker:!0,resize:!0})),p}s.exports=function(){return T().apply(this,arguments)},s.exports.reset=function(){T().reset()},s.exports.create=R,s.exports.shapeFromPath=function(e){if(!i)throw new Error("path confetti are not supported in this browser");var t,s;"string"==typeof e?t=e:(t=e.path,s=e.matrix);var r=new Path2D(t),a=document.createElement("canvas").getContext("2d");if(!s){for(var n,o,l=1e3,c=l,d=l,u=0,m=0,h=0;h<l;h+=2)for(var p=0;p<l;p+=2)a.isPointInPath(r,h,p,"nonzero")&&(c=Math.min(c,h),d=Math.min(d,p),u=Math.max(u,h),m=Math.max(m,p));n=u-c,o=m-d;var f=Math.min(10/n,10/o);s=[f,0,0,f,-Math.round(n/2+c)*f,-Math.round(o/2+d)*f]}return{type:"path",path:t,matrix:s}},s.exports.shapeFromText=function(e){var t,s=1,r="#000000",a='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?t=e:(t=e.text,s="scalar"in e?e.scalar:s,a="fontFamily"in e?e.fontFamily:a,r="color"in e?e.color:r);var n=10*s,i=n+"px "+a,o=new OffscreenCanvas(n,n),l=o.getContext("2d");l.font=i;var c=l.measureText(t),d=Math.ceil(c.actualBoundingBoxRight+c.actualBoundingBoxLeft),u=Math.ceil(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent),m=c.actualBoundingBoxLeft+2,h=c.actualBoundingBoxAscent+2;d+=4,u+=4,(l=(o=new OffscreenCanvas(d,u)).getContext("2d")).font=i,l.fillStyle=r,l.fillText(t,m,h);var p=1/s;return{type:"bitmap",bitmap:o.transferToImageBitmap(),matrix:[p,0,0,p,-d*p/2,-u*p/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),ja,!1);const Na=ja.exports;function ka(){const[e,t]=o.useState(!1),[s,r]=o.useState(!1);o.useEffect(()=>{const e=()=>{r(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const a=["D","E","U","X","L","I","V","R","E","S"],n=["#8B4513","#A0522D","#8B7355","#996633","#8B6F47","#704214","#9C6644","#A67B5B","#8B6F47","#B85C38"],i=()=>{Na({particleCount:200,spread:70,origin:{y:.6},colors:["#10b981","#3b82f6","#f59e0b"]}),window.confetti&&setTimeout(()=>{window.confetti({particleCount:100,angle:60,spread:55,origin:{x:0}})},500)};return l.jsxs(l.Fragment,{children:[l.jsxs(x,{children:[l.jsx("title",{children:"VREAD  Si ce n'est pas sur VREAD, tu ne l'as pas lu"}),l.jsx("meta",{name:"description",content:"En moyenne, sur 10 livres achets, on finit seulement 2 livres."})]}),l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-primary to-reed-secondary flex flex-col overflow-x-hidden md:overflow-x-visible",children:[l.jsx("div",{className:"flex-1 flex items-center justify-center px-4 md:px-6 py-8 w-full",children:l.jsxs("div",{className:"w-full max-w-4xl space-y-8 text-center flex flex-col items-center",children:[l.jsxs("div",{className:"relative inline-block mb-6",children:[l.jsx("div",{className:"absolute inset-0 bg-white/20 blur-3xl animate-pulse"}),l.jsx("div",{className:"relative bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-10 border-2 border-white/20 shadow-2xl",children:l.jsx(wa,{size:120,className:"md:w-[140px]"})})]}),l.jsxs("h1",{className:"text-hero text-white font-serif text-center w-full",children:["En moyenne,",l.jsx("br",{}),"sur dix livres achets,",l.jsx("br",{}),"on finit seulement"]}),l.jsxs("div",{className:"py-8 cursor-pointer flex flex-col items-center w-full",onClick:()=>{t(!0),i()},onTouchStart:e=>{e.preventDefault(),t(!0),i()},children:[l.jsx("div",{className:"relative mx-auto",style:{width:"200px",height:"300px"},children:[0,1,2,3,4,5,6,7,8,9].map(t=>{const s=8===t,r=s||9===t;return l.jsxs("div",{className:"absolute left-0 right-0 transition-all duration-700",style:{bottom:e?r?s?"0px":"60px":"-120px":26*(9-t)+"px",opacity:e&&!r?0:1},children:[l.jsxs("div",{className:"w-full h-14 rounded-xl flex items-center justify-center relative border-2 transition-all duration-700",style:{backgroundColor:r&&e?"#FFFFFF":n[t],borderColor:r&&e?"#EEDCC8":"rgba(255,255,255,0.2)",boxShadow:r&&e?"0 15px 60px rgba(238,220,200,1), 0 0 100px rgba(238,220,200,0.8)":"0 5px 20px rgba(0,0,0,0.4)"},children:[!e&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"absolute top-3 left-4 right-4 h-px bg-white/20"}),l.jsx("div",{className:"absolute bottom-3 left-4 right-4 h-px bg-white/20"})]}),l.jsx("span",{className:"font-bold transition-all duration-700",style:{color:r&&e?"#B85C38":"#FFFFFF",textShadow:e?"none":"0 3px 8px rgba(0,0,0,0.7)",fontSize:e&&r?"32px":"56px",letterSpacing:e&&r?"-1px":"0px"},children:e&&r?s?"LIVRES":"DEUX":a[t]}),r&&e&&l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/60 via-transparent to-transparent rounded-xl pointer-events-none"})]}),l.jsx("div",{className:"absolute -right-2.5 top-0 w-2.5 h-14 rounded-r-xl transition-all duration-700",style:{backgroundColor:r&&e?"#F5E6D3":n[t],opacity:e&&!r?0:1,boxShadow:"3px 0 10px rgba(0,0,0,0.4)"}})]},t)})}),!e&&l.jsx("p",{className:"text-white/60 text-body-sm mt-10 animate-bounce text-center w-full",children:s?"Touche pour rvler":"Clique pour rvler"}),e&&l.jsx("button",{onClick:e=>{e.stopPropagation(),t(!1)},className:"text-white/70 hover:text-white text-body-sm underline underline-offset-4 mt-10 transition-colors",children:"Recommencer"})]}),l.jsxs("h2",{className:"text-hero text-white font-serif text-center w-full",children:["Avec Vread,",l.jsx("br",{}),"tu les finis tous."]}),l.jsx("div",{className:"pt-16 w-full flex flex-col items-center gap-6",children:l.jsx(ya,{size:"lg",className:"group relative bg-[#E8DCC8] hover:bg-[#E8DCC8] text-[#6B4423] px-12 sm:px-20 md:px-28 lg:px-36 py-7 sm:py-8 md:py-10 lg:py-11 text-xl sm:text-3xl md:text-5xl lg:text-5xl font-serif font-bold rounded-full shadow-[0_25px_80px_rgba(0,0,0,0.4)] hover:shadow-[0_30px_100px_rgba(0,0,0,0.5)] hover:scale-105 transition-all duration-300 border-2 border-[#D4C4B0] whitespace-nowrap w-[90%] sm:w-auto max-w-full",asChild:!0,children:l.jsxs(v,{to:"/auth",className:"flex items-center justify-center",children:[l.jsx("span",{className:"relative z-10",children:"Commence gratuitement"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"})]})})}),l.jsx("div",{className:"pt-20 pb-12 w-full flex justify-center px-4",children:l.jsxs("div",{className:"relative w-full max-w-4xl mx-auto",children:[l.jsx("div",{className:"absolute inset-0 bg-reed-primary/30 blur-3xl scale-150"}),l.jsx("div",{className:"relative bg-gradient-to-br from-reed-primary/80 to-reed-secondary/80 backdrop-blur-sm rounded-2xl md:rounded-[2rem] px-8 md:px-16 py-10 md:py-14 border-2 border-white/20 shadow-[0_20px_60px_rgba(0,0,0,0.4)]",children:l.jsxs("p",{className:"text-h2 font-serif text-center",children:[l.jsx("span",{className:"text-white/95",children:"Si ce n'est pas sur"})," ",l.jsx("span",{className:"text-white font-bold",children:"Vread"}),l.jsx("span",{className:"text-white/95",children:","}),l.jsx("br",{}),l.jsx("span",{className:"text-white/95",children:"tu ne l'as pas lu."})]})})]})})]})}),l.jsx("footer",{className:"py-12 border-t border-white/10 w-full",children:l.jsxs("nav",{className:"flex flex-wrap items-center justify-center gap-6 md:gap-12 text-body-sm px-4",children:[l.jsx(v,{to:"/blog",className:"text-white/50 hover:text-white transition-colors",children:"Blog"}),l.jsx("span",{className:"text-white/30 text-xl md:text-2xl",children:""}),l.jsx(v,{to:"/press",className:"text-white/50 hover:text-white transition-colors",children:"Presse"}),l.jsx("span",{className:"text-white/30 text-xl md:text-2xl",children:""}),l.jsx(v,{to:"/about",className:"text-white/50 hover:text-white transition-colors",children:"Contact"})]})})]})]})}ja.exports.create;let _a;if("undefined"!=typeof window){const e=()=>{_a="undefined"!=typeof window&&window.matchMedia("(max-width: 768px)").matches};e();try{window.matchMedia("(max-width: 767px)").addEventListener("change",e)}catch(yN){window.addEventListener("resize",e)}}function Sa(){const[e,t]=o.useState(()=>void 0!==_a&&_a);return o.useEffect(()=>{if("undefined"==typeof window)return;t(_a||!1);const s=()=>{_a!==e&&t(_a||!1)};let r=null;const a=()=>{"visible"===document.visibilityState?r=window.setInterval(s,1e3):r&&(clearInterval(r),r=null)};return document.addEventListener("visibilitychange",a),a(),()=>{r&&clearInterval(r),document.removeEventListener("visibilitychange",a)}},[e]),e}const Ea=S,Ca=E,Ra=y,Ta=o.forwardRef(({className:e,...t},s)=>l.jsx(b,{className:Pr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));Ta.displayName=b.displayName;const Aa=va("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Pa=o.forwardRef(({side:e="right",className:t,children:s,...r},a)=>l.jsxs(Ra,{children:[l.jsx(Ta,{}),l.jsxs(w,{ref:a,className:Pr(Aa({side:e}),t),...r,children:[s,l.jsxs(j,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[l.jsx(N,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Pa.displayName=w.displayName;const Ia=({className:e,...t})=>l.jsx("div",{className:Pr("flex flex-col space-y-2 text-center sm:text-left",e),...t});Ia.displayName="SheetHeader";const Da=o.forwardRef(({className:e,...t},s)=>l.jsx(k,{ref:s,className:Pr("text-lg font-semibold text-foreground",e),...t}));Da.displayName=k.displayName;o.forwardRef(({className:e,...t},s)=>l.jsx(_,{ref:s,className:Pr("text-sm text-muted-foreground",e),...t})).displayName=_.displayName;const La="Accueil",Oa="Explorer",Ma="Lecteurs",Va="Ma liste",za="Rcompenses",Ua="Administration",Ba="Profil",Fa="Paramtres",qa="Menu",$a="Voir tout",Wa="Lectures en cours",Ha="Reprends ta lecture",Za="Voir mes statistiques",Ga="Aucune lecture en cours",Ka="Commencez votre prochaine aventure de lecture",Ya="Explorer les livres",Qa="Recherche en cours...",Xa="Validation des livres",Ja="Continuer la lecture",en="Tableau d'administration",tn="Section en cours de dveloppement",sn="Les paramtres d'administration seront bientt disponibles",rn="Exporter les donnes",an="Chargement...";function nn(e={}){const{isPremium:t}=e;return[{to:"/home",label:La,icon:C,ariaLabel:`Aller  ${La}`},{to:"/explore",label:Oa,icon:R,ariaLabel:`Aller  ${Oa}`},{to:"/achievements",label:za,icon:T,ariaLabel:`Aller  ${za}`},t?{to:"/request-book",label:"Demander un livre",icon:A,ariaLabel:"Demander un livre"}:{to:"/premium",label:"Premium",icon:P,ariaLabel:"Passer Premium"},{to:"/reading-list",label:Va,icon:R,ariaLabel:`Aller  ${Va}`},{to:"/discover",label:Ma,icon:I,ariaLabel:`Aller  ${Ma}`},{to:"/feedback",label:"Feedback",icon:D,ariaLabel:"Aller au Feedback"}]}const on=({isAdmin:e,isPremium:t})=>{const s=nn({isPremium:t}),r=L(),[a,n]=o.useState(!1),i=e=>{n(!1),r(e)};return l.jsxs(Ea,{open:a,onOpenChange:n,children:[l.jsx(Ca,{asChild:!0,children:l.jsxs(ya,{variant:"ghost",size:"icon",className:"md:hidden focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2","aria-label":qa,"aria-expanded":a,"aria-controls":"mobile-menu",children:[l.jsx(O,{className:"h-5 w-5"}),l.jsx("span",{className:"sr-only",children:qa})]})}),l.jsxs(Pa,{side:"left",className:"w-72 overflow-y-auto focus-visible:outline-none",id:"mobile-menu",onOpenAutoFocus:e=>{e.preventDefault();const t=e.currentTarget.querySelector('[role="button"]');t&&t.focus()},children:[l.jsx(Ia,{className:"pb-4",children:l.jsx(Da,{className:"text-left text-h4",children:qa})}),l.jsx("nav",{className:"mt-4",role:"navigation","aria-label":"Navigation principale",children:l.jsx("ul",{className:"space-y-1",role:"list",children:s.map(({to:e,label:t,icon:s,ariaLabel:r})=>l.jsx("li",{role:"listitem",children:l.jsxs(ya,{variant:"ghost",className:"mobile-nav-item focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2",onClick:()=>i(e),onKeyDown:t=>{return r=()=>i(e),void("Enter"!==(s=t).key&&" "!==s.key||(s.preventDefault(),r()));var s,r},tabIndex:0,role:"button","aria-label":r??t,children:[s&&l.jsx(s,{className:"h-5 w-5 mr-3","aria-hidden":"true"}),t]})},e))})})]})]})},ln=({isAdmin:e,isPremium:t})=>{const s=nn({isPremium:t});return l.jsx("nav",{className:"hidden md:flex items-center space-x-6 text-body-sm font-medium flex-1",children:s.map(({to:e,label:t,icon:s,ariaLabel:r})=>l.jsx(v,{to:e,children:l.jsxs(ya,{variant:"ghost",className:"hover:text-logo-accent","aria-label":r??t,children:[s&&l.jsx(s,{className:"mr-2 h-4 w-4"}),t]})},e))})},cn=o.forwardRef(({className:e,...t},s)=>l.jsx(M,{ref:s,className:Pr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));cn.displayName=M.displayName;const dn=o.forwardRef(({className:e,...t},s)=>l.jsx(V,{ref:s,className:Pr("aspect-square h-full w-full",e),...t}));dn.displayName=V.displayName;const un=o.forwardRef(({className:e,...t},s)=>l.jsx(z,{ref:s,className:Pr("flex h-full w-full items-center justify-center rounded-full bg-muted text-muted-foreground font-medium",e),...t}));un.displayName=z.displayName;const mn=o.forwardRef(({src:e,alt:t,fallbackText:s,className:r,size:a="md"},n)=>{const i=s?function(e){if(!e||"string"!=typeof e)return"??";const t=e.trim().split(/\s+/).filter(Boolean);return 0===t.length?"??":1===t.length?t[0][0].toUpperCase():t[0][0].toUpperCase()+t[t.length-1][0].toUpperCase()}(s):"U";return l.jsxs(cn,{ref:n,className:Pr({sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-16 w-16 text-xl",xl:"h-24 w-24 text-2xl"}[a],r),children:[l.jsx(dn,{src:e??void 0,alt:t}),l.jsx(un,{className:"bg-muted/50 text-muted-foreground border border-border/20",children:i})]})});mn.displayName="EnhancedAvatar";const hn=J,pn=ee;o.forwardRef(({className:e,inset:t,children:s,...r},a)=>l.jsxs(U,{ref:a,className:Pr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...r,children:[s,l.jsx(B,{className:"ml-auto h-4 w-4"})]})).displayName=U.displayName;o.forwardRef(({className:e,...t},s)=>l.jsx(F,{ref:s,className:Pr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=F.displayName;const fn=o.forwardRef(({className:e,sideOffset:t=4,...s},r)=>l.jsx(q,{children:l.jsx($,{ref:r,sideOffset:t,className:Pr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));fn.displayName=$.displayName;const gn=o.forwardRef(({className:e,inset:t,...s},r)=>l.jsx(W,{ref:r,className:Pr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));gn.displayName=W.displayName;o.forwardRef(({className:e,children:t,checked:s,...r},a)=>l.jsxs(H,{ref:a,className:Pr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...r,children:[l.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(Z,{children:l.jsx(G,{className:"h-4 w-4"})})}),t]})).displayName=H.displayName;o.forwardRef(({className:e,children:t,...s},r)=>l.jsxs(K,{ref:r,className:Pr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[l.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(Z,{children:l.jsx(Y,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=K.displayName;const xn=o.forwardRef(({className:e,inset:t,...s},r)=>l.jsx(Q,{ref:r,className:Pr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...s}));xn.displayName=Q.displayName;const vn=o.forwardRef(({className:e,...t},s)=>l.jsx(X,{ref:s,className:Pr("-mx-1 my-1 h-px bg-muted",e),...t}));vn.displayName=X.displayName;const bn=({size:e="md",variant:t="full",className:s})=>l.jsxs("div",{className:Pr("inline-flex items-center rounded-full font-semibold","bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600","text-gray-900 shadow-lg","animate-in fade-in zoom-in duration-300","hover:scale-105 transition-transform","border-2 border-amber-300/50",{sm:"text-xs px-2 py-0.5 gap-1",md:"text-sm px-3 py-1 gap-1.5",lg:"text-base px-4 py-1.5 gap-2"}[e],s),children:[l.jsx(P,{className:Pr({sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[e],"fill-gray-900")}),"full"===t&&l.jsx("span",{children:"Premium"})]}),yn=()=>{const e=L(),{user:t,isAdmin:s,isPremium:r}=ha();return t?l.jsxs(hn,{children:[l.jsx(pn,{asChild:!0,children:l.jsx(ya,{variant:"ghost",className:"relative h-10 w-10 rounded-full hover:ring-2 hover:ring-logo-accent",children:l.jsx(mn,{src:"/avatar.png",alt:"Avatar",fallbackText:t?.email||"Utilisateur",size:"sm",className:"border border-logo-accent"})})}),l.jsxs(fn,{className:"w-56 bg-background border border-border",align:"end",forceMount:!0,children:[l.jsx(xn,{className:"font-normal",children:l.jsxs("div",{className:"flex flex-col space-y-2",children:[l.jsx("p",{className:"text-body-sm font-medium leading-none",children:t.email}),l.jsx("p",{className:"text-caption leading-none text-muted-foreground",children:t.email}),r&&l.jsx("div",{className:"pt-1",children:l.jsx(bn,{size:"sm",variant:"full"})})]})}),l.jsx(vn,{}),l.jsxs(gn,{onClick:()=>e("/profile"),className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[l.jsx(te,{className:"mr-2 h-4 w-4"}),l.jsx("span",{children:Ba})]}),l.jsxs(gn,{onClick:()=>e("/admin"),className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[l.jsx(se,{className:"mr-2 h-4 w-4"}),l.jsx("span",{children:Ua})]}),l.jsx(vn,{}),l.jsxs(gn,{onClick:async()=>{try{const{error:t}=await Vr.auth.signOut();if(t)return void Yr.error("Erreur lors de la dconnexion");localStorage.removeItem("user"),Yr.success("Dconnexion russie"),setTimeout(()=>{e("/")},100)}catch(yN){Yr.error("Erreur inattendue lors de la dconnexion")}},className:"cursor-pointer hover:bg-accent focus:bg-accent",children:[l.jsx(re,{className:"mr-2 h-4 w-4"}),l.jsx("span",{children:"Dconnexion"})]})]})]}):null},wn=()=>l.jsxs(v,{to:"/home",className:"flex items-center gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2 rounded-md","aria-label":"VREAD - Retour  l'accueil",children:[l.jsx(wa,{size:32,className:"h-8 w-8"}),l.jsx("span",{className:"text-xl font-medium text-logo-text",children:"VREAD"})]}),jn=va("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Nn({className:e,variant:t,...s}){return l.jsx("div",{className:Pr(jn({variant:t}),e),...s})}const kn=oe,_n=o.forwardRef(({className:e,...t},s)=>l.jsx(ae,{ref:s,className:Pr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));_n.displayName=ae.displayName;const Sn=o.forwardRef(({className:e,...t},s)=>l.jsx(ne,{ref:s,className:Pr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Sn.displayName=ne.displayName;const En=o.forwardRef(({className:e,...t},s)=>l.jsx(ie,{ref:s,className:Pr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));En.displayName=ie.displayName;const Cn=o.forwardRef(({className:e,children:t,...s},r)=>l.jsxs(le,{ref:r,className:Pr("relative overflow-hidden",e),...s,children:[l.jsx(ce,{className:"h-full w-full rounded-[inherit]",children:t}),l.jsx(Rn,{}),l.jsx(de,{})]}));Cn.displayName=le.displayName;const Rn=o.forwardRef(({className:e,orientation:t="vertical",...s},r)=>l.jsx(ue,{ref:r,orientation:t,className:Pr("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:l.jsx(me,{className:"relative flex-1 rounded-full bg-border"})}));function Tn({notifications:e,loading:t,onMarkAsRead:s}){const[r,a]=o.useState(null),n=L(),i=e.filter(e=>["streak_nudge","streak_kept","streak_lost"].includes(e.type)),c=e.filter(e=>["booky_received","friend_finished"].includes(e.type)),d=e.filter(e=>"weekly_digest"===e.type),u=async e=>{if(!e.read_at&&r!==e.id){a(e.id);try{await async function(e){const{error:t}=await Vr.from("notifications").update({read_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}(e.id),s(e.id)}catch(t){}finally{a(null)}}},m=e=>{switch(e){case"streak_nudge":case"streak_kept":case"streak_lost":return l.jsx(pe,{className:"h-4 w-4 text-orange-500"});case"booky_received":return l.jsx(fe,{className:"h-4 w-4",style:{color:"#AE6841"}});case"friend_finished":return l.jsx(be,{className:"h-4 w-4 text-green-600"});case"weekly_digest":return l.jsx(ve,{className:"h-4 w-4 text-blue-500"});default:return l.jsx(he,{className:"h-4 w-4 text-gray-500"})}},h=e=>{switch(e.type){case"booky_received":return l.jsxs("span",{children:[l.jsx("strong",{children:e.actor?.username||"Quelqu'un"})," t'a donn un Booky pour"," ",l.jsx("strong",{children:e.book_title})]});case"friend_finished":return l.jsxs("span",{children:[l.jsx("strong",{children:e.actor?.username||"Quelqu'un"})," a termin"," ",l.jsx("strong",{children:e.book_title})]});case"streak_nudge":case"streak_kept":case"streak_lost":return e.meta?.msg||"Notification de srie";case"weekly_digest":return e.meta?.msg||"Ton rsum hebdomadaire est prt";default:return"Notification"}},p=({notification:e})=>{const t=!!e.read_at,s=ge(new Date(e.created_at),{addSuffix:!0,locale:ye}),a=(e=>{switch(e.type){case"friend_finished":case"booky_received":return e.book_id?"Voir l'activit":null;case"streak_nudge":return"Lire maintenant";case"weekly_digest":return"Voir les stats";default:return null}})(e);return l.jsx("div",{className:"p-3 border-b border-border last:border-b-0 transition-colors "+(t?"opacity-60":"bg-muted/30"),children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:"mt-1 flex-shrink-0",children:m(e.type)}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm text-foreground",children:h(e)}),l.jsxs("div",{className:"flex items-center justify-between mt-2",children:[l.jsx("span",{className:"text-xs text-muted-foreground",children:s}),l.jsxs("div",{className:"flex items-center gap-2",children:[a&&l.jsx(ya,{size:"sm",variant:"outline",onClick:()=>(e=>{switch(e.type){case"friend_finished":case"booky_received":n("/discover");break;case"streak_nudge":n("/reading-list");break;case"weekly_digest":n("/achievements")}})(e),className:"text-xs h-7",children:a}),!t&&l.jsx(ya,{size:"sm",variant:"ghost",onClick:()=>u(e),disabled:r===e.id,className:"text-xs h-7",children:r===e.id?l.jsx(xe,{className:"h-3 w-3 animate-spin"}):l.jsx(xe,{className:"h-3 w-3"})})]})]})]})]})})};if(t)return l.jsx("div",{className:"p-4",children:l.jsx("div",{className:"space-y-3",children:[...Array(3)].map((e,t)=>l.jsx("div",{className:"h-16 bg-muted rounded-lg animate-pulse"},t))})});const f=e.filter(e=>!e.read_at).length,g=i.filter(e=>!e.read_at).length,x=c.filter(e=>!e.read_at).length;return l.jsxs("div",{className:"w-full",children:[l.jsxs("div",{className:"p-4 border-b border-border",children:[l.jsx("h3",{className:"font-medium text-foreground",children:"Notifications"}),f>0&&l.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[f," non lue",f>1?"s":""]})]}),l.jsxs(kn,{defaultValue:"all",className:"w-full",children:[l.jsxs(_n,{className:"grid w-full grid-cols-3 rounded-none",children:[l.jsxs(Sn,{value:"all",className:"text-xs relative",children:["Tous",f>0&&l.jsx(Nn,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:f>9?"9+":f})]}),l.jsxs(Sn,{value:"streaks",className:"text-xs relative",children:["Sries",g>0&&l.jsx(Nn,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:g})]}),l.jsxs(Sn,{value:"social",className:"text-xs relative",children:["Social",x>0&&l.jsx(Nn,{variant:"destructive",className:"ml-2 h-4 w-4 p-0 text-[10px]",children:x})]})]}),l.jsx(En,{value:"all",className:"m-0",children:l.jsx(Cn,{className:"h-96",children:0===e.length?l.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[l.jsx(he,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),l.jsx("p",{className:"text-sm",children:"Aucune notification"})]}):l.jsx("div",{children:e.map(e=>l.jsx(p,{notification:e},e.id))})})}),l.jsx(En,{value:"streaks",className:"m-0",children:l.jsx(Cn,{className:"h-96",children:0===i.length?l.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[l.jsx(pe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),l.jsx("p",{className:"text-sm",children:"Aucune notification de srie"})]}):l.jsx("div",{children:i.map(e=>l.jsx(p,{notification:e},e.id))})})}),l.jsx(En,{value:"social",className:"m-0",children:l.jsx(Cn,{className:"h-96",children:0===[...c,...d].length?l.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[l.jsx(fe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),l.jsx("p",{className:"text-sm",children:"Aucune notification sociale"})]}):l.jsx("div",{children:[...c,...d].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).map(e=>l.jsx(p,{notification:e},e.id))})})})]})]})}Rn.displayName=ue.displayName;const An=Ne,Pn=ke,In=o.forwardRef(({className:e,align:t="center",sideOffset:s=4,...r},a)=>l.jsx(we,{children:l.jsx(je,{ref:a,align:t,sideOffset:s,className:Pr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));function Dn(){const[e,t]=o.useState([]),[s,r]=o.useState(0),[a,n]=o.useState(!1),[i,c]=o.useState(!0),{toast:d}=ia();o.useEffect(()=>{(async()=>{try{const e=await async function(){const{data:e,error:t}=await Vr.from("notifications").select("*, actor:actor_id(id, username, avatar_url)").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return e}();t(e),r(e.filter(e=>!e.read_at).length)}catch(e){}finally{c(!1)}})()},[]),o.useEffect(()=>{let e=null;return(async()=>{const{unsubscribe:s}=await async function(e){const{data:t}=await Vr.auth.getSession(),s=t?.session?.user?.id;if(!s)return{unsubscribe:()=>{}};const r=Vr.channel("notif-"+s).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`recipient_id=eq.${s}`},t=>e(t.new)).subscribe();return{unsubscribe:()=>Vr.removeChannel(r)}}(e=>{t(t=>[e,...t]),r(e=>e+1);const s="booky_received"===e.type?`${e.actor?.username??"Quelqu'un"} t'a donn un Booky pour ${e.book_title}`:"friend_finished"===e.type?`${e.actor?.username??"Quelqu'un"} a termin ${e.book_title}`:"streak_nudge"===e.type?e.meta?.msg??"Tu n'as pas valid aujourd'hui. Garde ta srie.":"streak_kept"===e.type?e.meta?.msg??"Srie maintenue. Continue.":"streak_lost"===e.type?e.meta?.msg??"Srie interrompue. On relance ce soir.":"weekly_digest"===e.type?e.meta?.msg??"Ton rsum hebdomadaire est prt":"Nouvelle notification";d({title:" Notification",description:s})});e=s})(),()=>{e&&e()}},[d]);return l.jsxs(An,{open:a,onOpenChange:n,children:[l.jsx(Pn,{asChild:!0,children:l.jsxs(ya,{variant:"ghost",size:"sm",className:"relative","aria-label":"Notifications "+(s>0?`(${s} non lues)`:""),children:[l.jsx(_e,{className:"h-5 w-5"}),s>0&&l.jsx(Nn,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 p-0 text-xs flex items-center justify-center",children:s>99?"99+":s})]})}),l.jsx(In,{className:"w-96 p-0",align:"end",sideOffset:8,children:l.jsx(Tn,{notifications:e,loading:i,onMarkAsRead:e=>{t(t=>t.map(t=>t.id===e?{...t,read_at:(new Date).toISOString()}:t)),r(e=>Math.max(0,e-1))}})})]})}function Ln(){const e=Sa(),{user:t,isAdmin:s,isPremium:r}=ha();return l.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-logo-accent/20 bg-logo-background/95 backdrop-blur supports-[backdrop-filter]:bg-logo-background/60",role:"banner",children:l.jsxs("div",{className:"mx-auto w-full px-4 max-w-none flex h-16 sm:h-14 items-center gap-4",children:[e&&l.jsx("div",{role:"navigation","aria-label":"Menu mobile",children:l.jsx(on,{isAdmin:s,isPremium:r})}),l.jsx(wn,{}),l.jsx("nav",{role:"navigation","aria-label":"Navigation principale",className:"hidden md:block",children:l.jsx(ln,{isAdmin:s,isPremium:r})}),t?l.jsxs("div",{role:"navigation","aria-label":"Menu utilisateur",className:"flex items-center gap-2",children:[l.jsx(Dn,{}),l.jsx(yn,{})]}):l.jsx(ya,{variant:"default",className:"bg-logo-accent hover:bg-logo-accent/90 text-logo-background focus:ring-2 focus:ring-logo-accent focus:ring-offset-2",asChild:!0,children:l.jsx(v,{to:"/","aria-label":"Se connecter  votre compte VREAD",children:"Se connecter"})})]})})}In.displayName=je.displayName;const On=o.forwardRef(({className:e,type:t,...s},r)=>l.jsx("input",{type:t,className:Pr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...s}));function Mn({onSearch:e,placeholder:t="Rechercher un livre par titre, auteur...",isSearching:s=!1}){const[r,a]=o.useState("");return l.jsxs("form",{onSubmit:t=>{t.preventDefault(),e(r)},className:"relative w-full",children:[l.jsx(On,{type:"search",placeholder:t,value:r,onChange:e=>a(e.target.value),className:"pr-12 border-coffee-light focus-visible:ring-coffee-dark bg-white h-12 text-md"}),l.jsxs(ya,{type:"submit",size:"icon",className:"absolute right-1 top-1 h-10 w-10 bg-coffee-dark hover:bg-coffee-darker",disabled:s,children:[s?l.jsx(Se,{className:"h-5 w-5 animate-spin"}):l.jsx(Ee,{className:"h-5 w-5"}),l.jsx("span",{className:"sr-only",children:s?"Recherche en cours...":"Rechercher"})]})]})}function Vn({children:e}){const t=L(),{user:s,isLoading:r,isInitialized:a}=ha();return o.useEffect(()=>{!a||r||s||t("/auth",{replace:!0})},[a,r,s,t]),!a||r?l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):s?l.jsx(l.Fragment,{children:e}):l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Redirection..."})]})})}On.displayName="Input";const zn=new Set,Un=()=>Array.from(zn);const Bn=new class{constructor(){a(this,"events",[])}trackAddToReadingList(e){const t={...e,timestamp:(new Date).toISOString()};this.events.push(t)}getEvents(){return[...this.events]}clearEvents(){this.events=[]}},Fn=(e,t,s={})=>{Bn.trackAddToReadingList({book_id:e,book_title:s.bookTitle,outcome:t,error_code:s.errorCode,user_id:s.userId})};class qn extends Error{constructor(e,t){super(e),this.code=t,this.name="ReadingListError"}}class $n extends qn{constructor(e){super(`Le livre "${e}" est dj dans votre liste de lecture`,"ALREADY_EXISTS"),this.name="AlreadyInListError"}}class Wn extends qn{constructor(e){super(`Livre invalide: ${e}`,"INVALID_BOOK"),this.name="InvalidBookError"}}class Hn extends qn{constructor(){super("Vous devez tre connect pour ajouter un livre  votre liste","AUTH_REQUIRED"),this.name="AuthenticationRequiredError"}}const Zn=e=>(e=>e instanceof qn)(e)||e instanceof Error?e.message:"Une erreur inattendue est survenue";var Gn,Kn,Yn;(Kn=Gn||(Gn={})).assertEqual=e=>{},Kn.assertIs=function(e){},Kn.assertNever=function(e){throw new Error},Kn.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},Kn.getValidEnumValues=e=>{const t=Kn.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),s={};for(const r of t)s[r]=e[r];return Kn.objectValues(s)},Kn.objectValues=e=>Kn.objectKeys(e).map(function(t){return e[t]}),Kn.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},Kn.find=(e,t)=>{for(const s of e)if(t(s))return s},Kn.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,Kn.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},Kn.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Yn||(Yn={})).mergeShapes=(e,t)=>({...e,...t});const Qn=Gn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Xn=e=>{switch(typeof e){case"undefined":return Qn.undefined;case"string":return Qn.string;case"number":return Number.isNaN(e)?Qn.nan:Qn.number;case"boolean":return Qn.boolean;case"function":return Qn.function;case"bigint":return Qn.bigint;case"symbol":return Qn.symbol;case"object":return Array.isArray(e)?Qn.array:null===e?Qn.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Qn.promise:"undefined"!=typeof Map&&e instanceof Map?Qn.map:"undefined"!=typeof Set&&e instanceof Set?Qn.set:"undefined"!=typeof Date&&e instanceof Date?Qn.date:Qn.object;default:return Qn.unknown}},Jn=Gn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ei extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},r=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(r);else if("invalid_return_type"===a.code)r(a.returnTypeError);else if("invalid_arguments"===a.code)r(a.argumentsError);else if(0===a.path.length)s._errors.push(t(a));else{let e=s,r=0;for(;r<a.path.length;){const s=a.path[r];r===a.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(a))):e[s]=e[s]||{_errors:[]},e=e[s],r++}}};return r(this),s}static assert(e){if(!(e instanceof ei))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Gn.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const r of this.issues)if(r.path.length>0){const s=r.path[0];t[s]=t[s]||[],t[s].push(e(r))}else s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}ei.create=e=>new ei(e);const ti=(e,t)=>{let s;switch(e.code){case Jn.invalid_type:s=e.received===Qn.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Jn.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,Gn.jsonStringifyReplacer)}`;break;case Jn.unrecognized_keys:s=`Unrecognized key(s) in object: ${Gn.joinValues(e.keys,", ")}`;break;case Jn.invalid_union:s="Invalid input";break;case Jn.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${Gn.joinValues(e.options)}`;break;case Jn.invalid_enum_value:s=`Invalid enum value. Expected ${Gn.joinValues(e.options)}, received '${e.received}'`;break;case Jn.invalid_arguments:s="Invalid function arguments";break;case Jn.invalid_return_type:s="Invalid function return type";break;case Jn.invalid_date:s="Invalid date";break;case Jn.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:Gn.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Jn.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Jn.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Jn.custom:s="Invalid input";break;case Jn.invalid_intersection_types:s="Intersection results could not be merged";break;case Jn.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case Jn.not_finite:s="Number must be finite";break;default:s=t.defaultError,Gn.assertNever(e)}return{message:s}};let si=ti;function ri(e,t){const s=si,r=(e=>{const{data:t,path:s,errorMaps:r,issueData:a}=e,n=[...s,...a.path||[]],i={...a,path:n};if(void 0!==a.message)return{...a,path:n,message:a.message};let o="";const l=r.filter(e=>!!e).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...a,path:n,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===ti?void 0:ti].filter(e=>!!e)});e.common.issues.push(r)}class ai{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if("aborted"===r.status)return ni;"dirty"===r.status&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const e=await r.key,t=await r.value;s.push({key:e,value:t})}return ai.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:t,value:a}=r;if("aborted"===t.status)return ni;if("aborted"===a.status)return ni;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||void 0===a.value&&!r.alwaysSet||(s[t.value]=a.value)}return{status:e.value,value:s}}}const ni=Object.freeze({status:"aborted"}),ii=e=>({status:"dirty",value:e}),oi=e=>({status:"valid",value:e}),li=e=>"aborted"===e.status,ci=e=>"dirty"===e.status,di=e=>"valid"===e.status,ui=e=>"undefined"!=typeof Promise&&e instanceof Promise;var mi,hi;(hi=mi||(mi={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},hi.toString=e=>"string"==typeof e?e:e?.message;class pi{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const fi=(e,t)=>{if(di(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ei(e.common.issues);return this._error=t,this._error}}};function gi(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:r,description:a}=e;if(t&&(s||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:a};return{errorMap:(t,a)=>{const{message:n}=e;return"invalid_enum_value"===t.code?{message:n??a.defaultError}:void 0===a.data?{message:n??r??a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:n??s??a.defaultError}},description:a}}class xi{get description(){return this._def.description}_getType(e){return Xn(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Xn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ai,ctx:{common:e.parent.common,data:e.data,parsedType:Xn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ui(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){const s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Xn(e)},r=this._parseSync({data:e,path:s.path,parent:s});return fi(s,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Xn(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return di(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>di(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Xn(e)},r=this._parse({data:e,path:s.path,parent:s}),a=await(ui(r)?r:Promise.resolve(r));return fi(s,a)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const a=e(t),n=()=>r.addIssue({code:Jn.custom,...s(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(n(),!1)):!!a||(n(),!1)})}refinement(e,t){return this._refinement((s,r)=>!!e(s)||(r.addIssue("function"==typeof t?t(s,r):t),!1))}_refinement(e){return new go({schema:this,typeName:_o.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return xo.create(this,this._def)}nullable(){return vo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eo.create(this)}promise(){return fo.create(this,this._def)}or(e){return ro.create([this,e],this._def)}and(e){return no.create(this,e,this._def)}transform(e){return new go({...gi(this._def),schema:this,typeName:_o.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new bo({...gi(this._def),innerType:this,defaultValue:t,typeName:_o.ZodDefault})}brand(){return new jo({typeName:_o.ZodBranded,type:this,...gi(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new yo({...gi(this._def),innerType:this,catchValue:t,typeName:_o.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return No.create(this,e)}readonly(){return ko.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const vi=/^c[^\s-]{8,}$/i,bi=/^[0-9a-z]+$/,yi=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wi=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ji=/^[a-z0-9_-]{21}$/i,Ni=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ki=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_i=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Si;const Ei=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ci=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ri=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ti=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ai=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Pi=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ii="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Di=new RegExp(`^${Ii}$`);function Li(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Oi(e){return new RegExp(`^${Li(e)}$`)}function Mi(e){let t=`${Ii}T${Li(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function Vi(e,t){return!("v4"!==t&&t||!Ei.test(e))||!("v6"!==t&&t||!Ri.test(e))}function zi(e,t){if(!Ni.test(e))return!1;try{const[s]=e.split(".");if(!s)return!1;const r=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),a=JSON.parse(atob(r));return"object"==typeof a&&null!==a&&((!("typ"in a)||"JWT"===a?.typ)&&(!!a.alg&&(!t||a.alg===t)))}catch{return!1}}function Ui(e,t){return!("v4"!==t&&t||!Ci.test(e))||!("v6"!==t&&t||!Ti.test(e))}class Bi extends xi{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Qn.string){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.string,received:t.parsedType}),ni}const t=new ai;let s;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const a=e.data.length>r.value,n=e.data.length<r.value;(a||n)&&(s=this._getOrReturnCtx(e,s),a?ri(s,{code:Jn.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):n&&ri(s,{code:Jn.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)_i.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"email",code:Jn.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)Si||(Si=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Si.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"emoji",code:Jn.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)wi.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"uuid",code:Jn.invalid_string,message:r.message}),t.dirty());else if("nanoid"===r.kind)ji.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"nanoid",code:Jn.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)vi.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"cuid",code:Jn.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)bi.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"cuid2",code:Jn.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)yi.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"ulid",code:Jn.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),ri(s,{validation:"url",code:Jn.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"regex",code:Jn.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){Mi(r).test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else if("date"===r.kind){Di.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:"date",message:r.message}),t.dirty())}else if("time"===r.kind){Oi(r).test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.invalid_string,validation:"time",message:r.message}),t.dirty())}else"duration"===r.kind?ki.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"duration",code:Jn.invalid_string,message:r.message}),t.dirty()):"ip"===r.kind?Vi(e.data,r.version)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"ip",code:Jn.invalid_string,message:r.message}),t.dirty()):"jwt"===r.kind?zi(e.data,r.alg)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"jwt",code:Jn.invalid_string,message:r.message}),t.dirty()):"cidr"===r.kind?Ui(e.data,r.version)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"cidr",code:Jn.invalid_string,message:r.message}),t.dirty()):"base64"===r.kind?Ai.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"base64",code:Jn.invalid_string,message:r.message}),t.dirty()):"base64url"===r.kind?Pi.test(e.data)||(s=this._getOrReturnCtx(e,s),ri(s,{validation:"base64url",code:Jn.invalid_string,message:r.message}),t.dirty()):Gn.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:Jn.invalid_string,...mi.errToObj(s)})}_addCheck(e){return new Bi({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...mi.errToObj(e)})}url(e){return this._addCheck({kind:"url",...mi.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...mi.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...mi.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...mi.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...mi.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...mi.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...mi.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...mi.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...mi.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...mi.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...mi.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...mi.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...mi.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...mi.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...mi.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...mi.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...mi.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...mi.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...mi.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...mi.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...mi.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...mi.errToObj(t)})}nonempty(e){return this.min(1,mi.errToObj(e))}trim(){return new Bi({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bi({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bi({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Fi(e,t){const s=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=s>r?s:r;return Number.parseInt(e.toFixed(a).replace(".",""))%Number.parseInt(t.toFixed(a).replace(".",""))/10**a}Bi.create=e=>new Bi({checks:[],typeName:_o.ZodString,coerce:e?.coerce??!1,...gi(e)});class qi extends xi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Qn.number){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.number,received:t.parsedType}),ni}let t;const s=new ai;for(const r of this._def.checks)if("int"===r.kind)Gn.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else"multipleOf"===r.kind?0!==Fi(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.not_finite,message:r.message}),s.dirty()):Gn.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,mi.toString(t))}gt(e,t){return this.setLimit("min",e,!1,mi.toString(t))}lte(e,t){return this.setLimit("max",e,!0,mi.toString(t))}lt(e,t){return this.setLimit("max",e,!1,mi.toString(t))}setLimit(e,t,s,r){return new qi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:mi.toString(r)}]})}_addCheck(e){return new qi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:mi.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:mi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:mi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:mi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:mi.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:mi.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:mi.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:mi.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:mi.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&Gn.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}qi.create=e=>new qi({checks:[],typeName:_o.ZodNumber,coerce:e?.coerce||!1,...gi(e)});class $i extends xi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Qn.bigint)return this._getInvalidInput(e);let t;const s=new ai;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),ri(t,{code:Jn.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):Gn.assertNever(r);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.bigint,received:t.parsedType}),ni}gte(e,t){return this.setLimit("min",e,!0,mi.toString(t))}gt(e,t){return this.setLimit("min",e,!1,mi.toString(t))}lte(e,t){return this.setLimit("max",e,!0,mi.toString(t))}lt(e,t){return this.setLimit("max",e,!1,mi.toString(t))}setLimit(e,t,s,r){return new $i({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:mi.toString(r)}]})}_addCheck(e){return new $i({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:mi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:mi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:mi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:mi.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:mi.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}$i.create=e=>new $i({checks:[],typeName:_o.ZodBigInt,coerce:e?.coerce??!1,...gi(e)});class Wi extends xi{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Qn.boolean){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.boolean,received:t.parsedType}),ni}return oi(e.data)}}Wi.create=e=>new Wi({typeName:_o.ZodBoolean,coerce:e?.coerce||!1,...gi(e)});class Hi extends xi{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Qn.date){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.date,received:t.parsedType}),ni}if(Number.isNaN(e.data.getTime())){return ri(this._getOrReturnCtx(e),{code:Jn.invalid_date}),ni}const t=new ai;let s;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(s=this._getOrReturnCtx(e,s),ri(s,{code:Jn.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):Gn.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Hi({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:mi.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:mi.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Hi.create=e=>new Hi({checks:[],coerce:e?.coerce||!1,typeName:_o.ZodDate,...gi(e)});class Zi extends xi{_parse(e){if(this._getType(e)!==Qn.symbol){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.symbol,received:t.parsedType}),ni}return oi(e.data)}}Zi.create=e=>new Zi({typeName:_o.ZodSymbol,...gi(e)});class Gi extends xi{_parse(e){if(this._getType(e)!==Qn.undefined){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.undefined,received:t.parsedType}),ni}return oi(e.data)}}Gi.create=e=>new Gi({typeName:_o.ZodUndefined,...gi(e)});class Ki extends xi{_parse(e){if(this._getType(e)!==Qn.null){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.null,received:t.parsedType}),ni}return oi(e.data)}}Ki.create=e=>new Ki({typeName:_o.ZodNull,...gi(e)});class Yi extends xi{constructor(){super(...arguments),this._any=!0}_parse(e){return oi(e.data)}}Yi.create=e=>new Yi({typeName:_o.ZodAny,...gi(e)});class Qi extends xi{constructor(){super(...arguments),this._unknown=!0}_parse(e){return oi(e.data)}}Qi.create=e=>new Qi({typeName:_o.ZodUnknown,...gi(e)});class Xi extends xi{_parse(e){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.never,received:t.parsedType}),ni}}Xi.create=e=>new Xi({typeName:_o.ZodNever,...gi(e)});class Ji extends xi{_parse(e){if(this._getType(e)!==Qn.undefined){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.void,received:t.parsedType}),ni}return oi(e.data)}}Ji.create=e=>new Ji({typeName:_o.ZodVoid,...gi(e)});class eo extends xi{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==Qn.array)return ri(t,{code:Jn.invalid_type,expected:Qn.array,received:t.parsedType}),ni;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(e||a)&&(ri(t,{code:e?Jn.too_big:Jn.too_small,minimum:a?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(ri(t,{code:Jn.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(ri(t,{code:Jn.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>r.type._parseAsync(new pi(t,e,t.path,s)))).then(e=>ai.mergeArray(s,e));const a=[...t.data].map((e,s)=>r.type._parseSync(new pi(t,e,t.path,s)));return ai.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new eo({...this._def,minLength:{value:e,message:mi.toString(t)}})}max(e,t){return new eo({...this._def,maxLength:{value:e,message:mi.toString(t)}})}length(e,t){return new eo({...this._def,exactLength:{value:e,message:mi.toString(t)}})}nonempty(e){return this.min(1,e)}}function to(e){if(e instanceof so){const t={};for(const s in e.shape){const r=e.shape[s];t[s]=xo.create(to(r))}return new so({...e._def,shape:()=>t})}return e instanceof eo?new eo({...e._def,type:to(e.element)}):e instanceof xo?xo.create(to(e.unwrap())):e instanceof vo?vo.create(to(e.unwrap())):e instanceof io?io.create(e.items.map(e=>to(e))):e}eo.create=(e,t)=>new eo({type:e,minLength:null,maxLength:null,exactLength:null,typeName:_o.ZodArray,...gi(t)});class so extends xi{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Gn.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Qn.object){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.object,received:t.parsedType}),ni}const{status:t,ctx:s}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),n=[];if(!(this._def.catchall instanceof Xi&&"strip"===this._def.unknownKeys))for(const o in s.data)a.includes(o)||n.push(o);const i=[];for(const o of a){const e=r[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new pi(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof Xi){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of n)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)n.length>0&&(ri(s,{code:Jn.unrecognized_keys,keys:n}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of n){const r=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new pi(s,r,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const s=await t.key,r=await t.value;e.push({key:s,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>ai.mergeObjectSync(t,e)):ai.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return mi.errToObj,new so({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{const r=this._def.errorMap?.(t,s).message??s.defaultError;return"unrecognized_keys"===t.code?{message:mi.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new so({...this._def,unknownKeys:"strip"})}passthrough(){return new so({...this._def,unknownKeys:"passthrough"})}extend(e){return new so({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new so({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:_o.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new so({...this._def,catchall:e})}pick(e){const t={};for(const s of Gn.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new so({...this._def,shape:()=>t})}omit(e){const t={};for(const s of Gn.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new so({...this._def,shape:()=>t})}deepPartial(){return to(this)}partial(e){const t={};for(const s of Gn.objectKeys(this.shape)){const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}return new so({...this._def,shape:()=>t})}required(e){const t={};for(const s of Gn.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof xo;)e=e._def.innerType;t[s]=e}return new so({...this._def,shape:()=>t})}keyof(){return mo(Gn.objectKeys(this.shape))}}so.create=(e,t)=>new so({shape:()=>e,unknownKeys:"strip",catchall:Xi.create(),typeName:_o.ZodObject,...gi(t)}),so.strictCreate=(e,t)=>new so({shape:()=>e,unknownKeys:"strict",catchall:Xi.create(),typeName:_o.ZodObject,...gi(t)}),so.lazycreate=(e,t)=>new so({shape:e,unknownKeys:"strip",catchall:Xi.create(),typeName:_o.ZodObject,...gi(t)});class ro extends xi{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const s=e.map(e=>new ei(e.ctx.common.issues));return ri(t,{code:Jn.invalid_union,unionErrors:s}),ni});{let e;const r=[];for(const n of s){const s={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:s});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:s}),s.common.issues.length&&r.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=r.map(e=>new ei(e));return ri(t,{code:Jn.invalid_union,unionErrors:a}),ni}}get options(){return this._def.options}}function ao(e,t){const s=Xn(e),r=Xn(t);if(e===t)return{valid:!0,data:e};if(s===Qn.object&&r===Qn.object){const s=Gn.objectKeys(t),r=Gn.objectKeys(e).filter(e=>-1!==s.indexOf(e)),a={...e,...t};for(const n of r){const s=ao(e[n],t[n]);if(!s.valid)return{valid:!1};a[n]=s.data}return{valid:!0,data:a}}if(s===Qn.array&&r===Qn.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<e.length;r++){const a=ao(e[r],t[r]);if(!a.valid)return{valid:!1};s.push(a.data)}return{valid:!0,data:s}}return s===Qn.date&&r===Qn.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}ro.create=(e,t)=>new ro({options:e,typeName:_o.ZodUnion,...gi(t)});class no extends xi{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=(e,r)=>{if(li(e)||li(r))return ni;const a=ao(e.value,r.value);return a.valid?((ci(e)||ci(r))&&t.dirty(),{status:t.value,value:a.data}):(ri(s,{code:Jn.invalid_intersection_types}),ni)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}no.create=(e,t,s)=>new no({left:e,right:t,typeName:_o.ZodIntersection,...gi(s)});class io extends xi{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Qn.array)return ri(s,{code:Jn.invalid_type,expected:Qn.array,received:s.parsedType}),ni;if(s.data.length<this._def.items.length)return ri(s,{code:Jn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ni;!this._def.rest&&s.data.length>this._def.items.length&&(ri(s,{code:Jn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...s.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new pi(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(r).then(e=>ai.mergeArray(t,e)):ai.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new io({...this._def,rest:e})}}io.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new io({items:e,typeName:_o.ZodTuple,rest:null,...gi(t)})};class oo extends xi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Qn.map)return ri(s,{code:Jn.invalid_type,expected:Qn.map,received:s.parsedType}),ni;const r=this._def.keyType,a=this._def.valueType,n=[...s.data.entries()].map(([e,t],n)=>({key:r._parse(new pi(s,e,s.path,[n,"key"])),value:a._parse(new pi(s,t,s.path,[n,"value"]))}));if(s.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const s of n){const r=await s.key,a=await s.value;if("aborted"===r.status||"aborted"===a.status)return ni;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}})}{const e=new Map;for(const s of n){const r=s.key,a=s.value;if("aborted"===r.status||"aborted"===a.status)return ni;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}}}oo.create=(e,t,s)=>new oo({valueType:t,keyType:e,typeName:_o.ZodMap,...gi(s)});class lo extends xi{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Qn.set)return ri(s,{code:Jn.invalid_type,expected:Qn.set,received:s.parsedType}),ni;const r=this._def;null!==r.minSize&&s.data.size<r.minSize.value&&(ri(s,{code:Jn.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&s.data.size>r.maxSize.value&&(ri(s,{code:Jn.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function n(e){const s=new Set;for(const r of e){if("aborted"===r.status)return ni;"dirty"===r.status&&t.dirty(),s.add(r.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map((e,t)=>a._parse(new pi(s,e,s.path,t)));return s.common.async?Promise.all(i).then(e=>n(e)):n(i)}min(e,t){return new lo({...this._def,minSize:{value:e,message:mi.toString(t)}})}max(e,t){return new lo({...this._def,maxSize:{value:e,message:mi.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}lo.create=(e,t)=>new lo({valueType:e,minSize:null,maxSize:null,typeName:_o.ZodSet,...gi(t)});class co extends xi{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}co.create=(e,t)=>new co({getter:e,typeName:_o.ZodLazy,...gi(t)});class uo extends xi{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ri(t,{received:t.data,code:Jn.invalid_literal,expected:this._def.value}),ni}return{status:"valid",value:e.data}}get value(){return this._def.value}}function mo(e,t){return new ho({values:e,typeName:_o.ZodEnum,...gi(t)})}uo.create=(e,t)=>new uo({value:e,typeName:_o.ZodLiteral,...gi(t)});class ho extends xi{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return ri(t,{expected:Gn.joinValues(s),received:t.parsedType,code:Jn.invalid_type}),ni}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return ri(t,{received:t.data,code:Jn.invalid_enum_value,options:s}),ni}return oi(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ho.create(e,{...this._def,...t})}exclude(e,t=this._def){return ho.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}ho.create=mo;class po extends xi{_parse(e){const t=Gn.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==Qn.string&&s.parsedType!==Qn.number){const e=Gn.objectValues(t);return ri(s,{expected:Gn.joinValues(e),received:s.parsedType,code:Jn.invalid_type}),ni}if(this._cache||(this._cache=new Set(Gn.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=Gn.objectValues(t);return ri(s,{received:s.data,code:Jn.invalid_enum_value,options:e}),ni}return oi(e.data)}get enum(){return this._def.values}}po.create=(e,t)=>new po({values:e,typeName:_o.ZodNativeEnum,...gi(t)});class fo extends xi{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Qn.promise&&!1===t.common.async)return ri(t,{code:Jn.invalid_type,expected:Qn.promise,received:t.parsedType}),ni;const s=t.parsedType===Qn.promise?t.data:Promise.resolve(t.data);return oi(s.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}fo.create=(e,t)=>new fo({type:e,typeName:_o.ZodPromise,...gi(t)});class go extends xi{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_o.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:e=>{ri(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===r.type){const e=r.transform(s.data,a);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return ni;const r=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===r.status?ni:"dirty"===r.status||"dirty"===t.value?ii(r.value):r});{if("aborted"===t.value)return ni;const r=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===r.status?ni:"dirty"===r.status||"dirty"===t.value?ii(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,a);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const r=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===r.status?ni:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?ni:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))))}if("transform"===r.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!di(e))return ni;const n=r.transform(e.value,a);if(n instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>di(e)?Promise.resolve(r.transform(e.value,a)).then(e=>({status:t.value,value:e})):ni)}Gn.assertNever(r)}}go.create=(e,t,s)=>new go({schema:e,typeName:_o.ZodEffects,effect:t,...gi(s)}),go.createWithPreprocess=(e,t,s)=>new go({schema:t,effect:{type:"preprocess",transform:e},typeName:_o.ZodEffects,...gi(s)});class xo extends xi{_parse(e){return this._getType(e)===Qn.undefined?oi(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}xo.create=(e,t)=>new xo({innerType:e,typeName:_o.ZodOptional,...gi(t)});class vo extends xi{_parse(e){return this._getType(e)===Qn.null?oi(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}vo.create=(e,t)=>new vo({innerType:e,typeName:_o.ZodNullable,...gi(t)});class bo extends xi{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===Qn.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}bo.create=(e,t)=>new bo({innerType:e,typeName:_o.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...gi(t)});class yo extends xi{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return ui(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ei(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new ei(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}yo.create=(e,t)=>new yo({innerType:e,typeName:_o.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...gi(t)});class wo extends xi{_parse(e){if(this._getType(e)!==Qn.nan){const t=this._getOrReturnCtx(e);return ri(t,{code:Jn.invalid_type,expected:Qn.nan,received:t.parsedType}),ni}return{status:"valid",value:e.data}}}wo.create=e=>new wo({typeName:_o.ZodNaN,...gi(e)});class jo extends xi{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class No extends xi{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?ni:"dirty"===e.status?(t.dirty(),ii(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?ni:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new No({in:e,out:t,typeName:_o.ZodPipeline})}}class ko extends xi{_parse(e){const t=this._def.innerType._parse(e),s=e=>(di(e)&&(e.value=Object.freeze(e.value)),e);return ui(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}var _o,So;ko.create=(e,t)=>new ko({innerType:e,typeName:_o.ZodReadonly,...gi(t)}),(So=_o||(_o={})).ZodString="ZodString",So.ZodNumber="ZodNumber",So.ZodNaN="ZodNaN",So.ZodBigInt="ZodBigInt",So.ZodBoolean="ZodBoolean",So.ZodDate="ZodDate",So.ZodSymbol="ZodSymbol",So.ZodUndefined="ZodUndefined",So.ZodNull="ZodNull",So.ZodAny="ZodAny",So.ZodUnknown="ZodUnknown",So.ZodNever="ZodNever",So.ZodVoid="ZodVoid",So.ZodArray="ZodArray",So.ZodObject="ZodObject",So.ZodUnion="ZodUnion",So.ZodDiscriminatedUnion="ZodDiscriminatedUnion",So.ZodIntersection="ZodIntersection",So.ZodTuple="ZodTuple",So.ZodRecord="ZodRecord",So.ZodMap="ZodMap",So.ZodSet="ZodSet",So.ZodFunction="ZodFunction",So.ZodLazy="ZodLazy",So.ZodLiteral="ZodLiteral",So.ZodEnum="ZodEnum",So.ZodEffects="ZodEffects",So.ZodNativeEnum="ZodNativeEnum",So.ZodOptional="ZodOptional",So.ZodNullable="ZodNullable",So.ZodDefault="ZodDefault",So.ZodCatch="ZodCatch",So.ZodPromise="ZodPromise",So.ZodBranded="ZodBranded",So.ZodPipeline="ZodPipeline",So.ZodReadonly="ZodReadonly";const Eo=Bi.create;qi.create,$i.create;const Co=Wi.create;Hi.create,Xi.create,eo.create;const Ro=so.create;ro.create,no.create,io.create,ho.create,fo.create,xo.create,vo.create;const To=e=>qi.create({...e,coerce:!0}),Ao=Ro({id:Eo().min(1,"L'ID du livre ne peut pas tre vide"),title:Eo().min(1,"Le titre ne peut pas tre vide"),author:Eo().optional(),slug:Eo().optional()}).refine(e=>{const t=e.id&&e.id.trim().length>0,s=e.slug&&e.slug.trim().length>0;return t||s},{message:"Le livre doit avoir un ID ou un slug valide",path:["id"]});function Po(e){if(!e)throw new Wn("Le livre ne peut pas tre null ou undefined");try{Ao.parse(e)}catch(t){if(t instanceof ei){const e=t.errors[0];throw new Wn(e?.message||"Livre invalide")}throw new Wn("Validation du livre choue")}}async function Io(e,t){try{const{count:s,error:r}=await Vr.from("reading_validations").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("book_id",t);return r?0:s||0}catch(s){return 0}}function Do(e){const t=e.filter(e=>"completed"===e.status),s=e.filter(e=>"in_progress"===e.status),r=e.filter(e=>"to_read"===e.status);return{toRead:r,inProgress:s,completed:t,toReadCount:r.length,inProgressCount:s.length,completedCount:t.length}}async function Lo(e){const{data:t,error:s}=await Vr.from("reading_progress").select("\n      id,\n      user_id,\n      book_id,\n      current_page,\n      total_pages,\n      status,\n      updated_at,\n      started_at,\n      books:books_public(\n        id, slug, title, author, cover_url, total_chapters, expected_segments\n      )\n    ").eq("user_id",e).order("updated_at",{ascending:!1});return Do(s?[]:t??[])}const Oo=async(e,t,s)=>{if(!e||!s)return[];if(e.toRead&&e.inProgress&&e.completed){const r={to_read:e.toRead,in_progress:e.inProgress,completed:e.completed}[t]||[];return Promise.all(r.map(async e=>{const r=await Io(s,e.book_id),a=e.books?.expected_segments||e.books?.total_chapters||10,n=Math.round(r/(a||1)*100);return{id:e.books?.id||e.book_id,title:e.books?.title||"Titre inconnu",author:e.books?.author||"Auteur inconnu",description:e.books?.description||"",coverImage:e.books?.cover_url||"",cover_url:e.books?.cover_url||"",pages:e.books?.total_pages||0,categories:e.books?.tags||[],tags:e.books?.tags||[],totalChapters:a,chaptersRead:r,currentSegment:r,progressPercent:n,expectedSegments:a,language:"fr",publicationYear:(new Date).getFullYear(),slug:e.books?.slug||e.books?.id||e.book_id,isCompleted:"completed"===t}}))}return[]};const Mo=()=>{const[e,t]=o.useState([]),[s,r]=o.useState([]),[a,n]=o.useState([]),[i,l]=o.useState(!0),[c,d]=o.useState(null),[u,m]=o.useState(!1),{sortBy:h,setSortBy:p,sortBooks:f}=function(){const[e,t]=o.useState("date");return{sortBy:e,setSortBy:t,sortBooks:o.useCallback((e,t)=>e&&Array.isArray(e)?[...e].sort((e,s)=>{switch(t){case"author":return(e.author||"").localeCompare(s.author||"");case"pages":return(s.pages||0)-(e.pages||0);default:return s.id.localeCompare(e.id)}}):[],[])}}(),g=o.useRef(!0);o.useEffect(()=>()=>{g.current=!1},[]);return{books:{toRead:e,inProgress:s,completed:a},sortState:{sortBy:h,setSortBy:p},loading:{isLoading:i,setIsLoading:l,isFetching:u,setIsFetching:m},error:{current:c,setError:d},updateBooks:(e,s,a)=>{g.current&&(t(f(e,h)),r(f(s,h)),n(f(a,h)))},isMounted:g}},Vo={};function zo(e,t){Vo[e]=t}function Uo(){Object.keys(Vo).forEach(e=>{delete Vo[e]})}function Bo(e){const t=o.useRef(e);return t.current=e,o.useCallback((...e)=>t.current(...e),[])}class Fo{static reportError(e,t,s){const r={error:e,info:t,timestamp:Date.now(),component:s};this.errors.push(r)}static getErrorHistory(){return this.errors}static clearErrors(){this.errors=[]}}a(Fo,"errors",[]);const qo=(e,t)=>(...s)=>{try{return e(...s)}catch(r){throw Fo.reportError(r,{componentStack:t,errorBoundary:t},t),r}};const $o=new class{constructor(){a(this,"dbName","ReadAppCache"),a(this,"dbVersion",1),a(this,"storeName","cache"),a(this,"db",null)}async init(){if(!this.db)return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=()=>{const e=s.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName)}})}async set(e,t,s=3e5){if(await this.init(),!this.db)return;const r={data:t,timestamp:Date.now(),ttl:s};return new Promise((t,s)=>{const a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(r,e);a.onerror=()=>s(a.error),a.onsuccess=()=>t()})}async get(e){return await this.init(),this.db?new Promise((t,s)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onerror=()=>s(r.error),r.onsuccess=()=>{const s=r.result;if(s)return Date.now()-s.timestamp>s.ttl?(this.delete(e),void t(null)):void t(s.data);t(null)}}):null}async delete(e){if(await this.init(),this.db)return new Promise((t,s)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onerror=()=>s(r.error),r.onsuccess=()=>t()})}async clear(){if(await this.init(),this.db)return new Promise((e,t)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onerror=()=>t(s.error),s.onsuccess=()=>e()})}},Wo=()=>{const e=Ce(),{user:t}=ha(),s=o.useRef(!1),r=o.useRef(0),a=o.useRef(!1),n=function(e,t){const[s,r]=o.useState(e);return o.useEffect(()=>{const s=setTimeout(()=>{r(e)},t);return()=>{clearTimeout(s)}},[e,t]),s}(t?.id,300),{books:i,sortState:l,loading:{isLoading:c,setIsLoading:d,isFetching:u,setIsFetching:m},error:{current:h,setError:p},updateBooks:f,isMounted:g}=Mo(),x=o.useMemo(()=>({queryKey:["reading_list",n],queryFn:async()=>{const e=`reading_list_${n}`;performance.now();try{const t=await $o.get(e);if(t)return t}catch(s){}const t=await Lo(n||"");try{await $o.set(e,t,3e5)}catch(s){}return t},enabled:!!n,staleTime:3e5,refetchOnMount:!s.current,refetchOnReconnect:!1,refetchOnWindowFocus:!1,retry:2,gcTime:6e5}),[n]),{data:v,isLoading:b,error:y,isSuccess:w,refetch:j}=Re(x);o.useEffect(()=>{w&&!s.current&&(s.current=!0)},[w]),o.useEffect(()=>{n?(Uo(),e.invalidateQueries({queryKey:["reading_list"]})):(e.resetQueries({queryKey:["reading_list"]}),r.current=0,s.current=!1,Uo(),$o.clear())},[n,e]);const N=Bo(qo(async t=>{if(!n||!v)return[];if("completed"===t){const s=await Oo(v,t,n);return zo(t,s),e.setQueryData(["books_by_status",n,t],s),s}const s=function(e){return Vo[e]}(t);if(s&&s.length>0)return s;const r=e.getQueryData(["books_by_status",n,t]);if(r&&r.length>0)return zo(t,r),r;const a=await Oo(v,t,n);return zo(t,a),e.setQueryData(["books_by_status",n,t],a),a},"useReadingList.getBooksByStatus")),k=Bo(qo(async t=>{if(!n)return Yr.error("Vous devez tre connect pour ajouter un livre  votre liste"),!1;if(!t?.id)return Yr.error("Erreur: livre invalide"),!1;try{const s=await(async e=>{Po(e);try{const{data:{user:t}}=await Vr.auth.getUser();if(!t)return Fn(e.id,"auth_required",{bookTitle:e.title}),!1;const{data:s,error:r}=await Vr.from("reading_progress").select("*").eq("user_id",t.id).eq("book_id",e.id).maybeSingle();if(r)return Fn(e.id,"error",{bookTitle:e.title,errorCode:r.code}),!1;if(s)throw Fn(e.id,"already_exists",{bookTitle:e.title}),new $n(e.title);const{data:a,error:n}=await Vr.from("reading_progress").insert([{user_id:t.id,book_id:e.id,status:"to_read",current_page:0,total_pages:e.pages||0}]).select().single();return n?(Fn(e.id,"error",{bookTitle:e.title,errorCode:n.code}),!1):(Fn(e.id,"success",{bookTitle:e.title,userId:t.id}),!0)}catch(h){if(h instanceof $n)throw h;return h instanceof Wn&&Fn(e.id,"invalid_book",{bookTitle:e.title,errorCode:h.code}),!1}})(t);return s?(await Promise.all([e.invalidateQueries({queryKey:["reading_list"]}),e.invalidateQueries({queryKey:["books_by_status"]})]),j(),Yr.success(`"${t.title}" ajout  votre liste de lecture`),!0):(Yr.error(`Impossible d'ajouter "${t.title}"  votre liste`),!1)}catch(s){const e=s instanceof Error?s.message:"Une erreur est survenue";return Yr.error(`Erreur: ${e}`),!1}},"useReadingList.addToReadingList"));o.useEffect(()=>{if(!n||!v||a.current||u)return;if(i.inProgress.length>0&&s.current&&w)return;(async()=>{try{a.current=!0,m(!0),d(!0),p(null);const[e,t,s]=await Promise.all([N("to_read"),N("in_progress"),N("completed")]);g.current&&(f(e,t,s),zo("to_read",e),zo("in_progress",t),zo("completed",s))}catch(e){g.current&&(p(e),r.current<2&&(Yr.error("Erreur lors du chargement de vos livres"),r.current++))}finally{g.current&&(d(!1),m(!1)),a.current=!1}})()},[n,v,w,N,i.inProgress.length,u,m,d,p,f,g]),y&&0===r.current&&(Yr.error("Impossible de rcuprer votre liste de lecture",{id:"reading-list-error"}),r.current++);const _=Bo(()=>{Uo(),e.invalidateQueries({queryKey:["reading_list"]}),e.invalidateQueries({queryKey:["books_by_status"]}),j()}),S=Bo(qo(async()=>{if(n&&v){Uo();try{e.removeQueries({queryKey:["books_by_status",n,"completed"]});const t=await Oo(v,"completed",n);g.current&&f(i.toRead,i.inProgress,t)}catch(t){}}},"useReadingList.syncCompletedBooks"));return o.useMemo(()=>({...i,isLoadingReadingList:b,readingListError:y,sortBy:l.sortBy,setSortBy:l.setSortBy,isLoading:c,error:h,readingList:v,userId:n,getFailedBookIds:()=>Un(),hasFetchedInitialData:()=>s.current,getBooksByStatus:N,addToReadingList:k,forceRefresh:_,syncCompletedBooks:S}),[i,b,y,l.sortBy,l.setSortBy,c,h,v,n,N,k,_,S])},Ho=o.forwardRef(({className:e,value:t,indicatorClassName:s,...r},a)=>l.jsx(Te,{ref:a,className:Pr("relative h-4 w-full overflow-hidden rounded-full bg-coffee-lightest",e),...r,children:l.jsx(Ae,{className:Pr("h-full w-full flex-1 bg-coffee-dark transition-all",s),style:{transform:`translateX(-${100-(t||0)}%)`}})}));Ho.displayName=Te.displayName;const Zo=({src:e,alt:t,className:s,priority:r=!1,sizes:a,...n})=>{const[i,c]=o.useState(!1),[d,u]=o.useState(!1);if(e.startsWith("http")||e.startsWith("data:"))return l.jsx("img",{src:e,alt:t,className:s,loading:r?"eager":"lazy",decoding:"async",sizes:a,onError:()=>u(!0),...n});const{avif:m,webp:h}=(e=>{const t=e.lastIndexOf(".");if(-1===t)return{avif:null,webp:null};const s=e.substring(0,t),r=e.substring(t);return[".jpg",".jpeg",".png"].includes(r.toLowerCase())?{avif:`${s}.avif`,webp:`${s}.webp`}:{avif:null,webp:null}})(e);if(i||d)return l.jsx("img",{src:e,alt:t,className:s,loading:r?"eager":"lazy",decoding:"async",sizes:a,onError:()=>{u(!0)},...n});const p=()=>{c(!0)},f=!e.includes("lovable-uploads");return(m||h)&&f?l.jsxs("picture",{children:[m&&l.jsx("source",{srcSet:m,type:"image/avif",sizes:a}),h&&l.jsx("source",{srcSet:h,type:"image/webp",sizes:a}),l.jsx("img",{src:e,alt:t,className:s,loading:r?"eager":"lazy",decoding:"async",sizes:a,onError:p,...n})]}):l.jsx("img",{src:e,alt:t,className:s,loading:r?"eager":"lazy",decoding:"async",sizes:a,onError:()=>{u(!0)},...n})},Go=({book:e,showProgress:t,size:s="md",image:r,title:a,priority:n=!1,className:i,fluid:o=!1})=>{const c=r||e?.coverImage||e?.cover_url||e?.book_cover,d=a||e?.title||"Unknown",u=e?e.chaptersRead/e.totalChapters*100:0,m=e?Math.floor(e.pages/e.totalChapters*e.chaptersRead):0;return l.jsxs("div",{className:`book-cover bg-coffee-medium relative aspect-[2/3] ${o?"w-full":{sm:"w-24 h-36",md:"w-32 h-48",lg:"w-40 h-60"}[s]} ${i||""}`,children:[c?l.jsx(Zo,{src:c,alt:d,className:"absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",priority:n,sizes:o?"(max-width: 768px) 50vw, 25vw":{sm:"(max-width: 768px) 80px, 96px",md:"(max-width: 768px) 120px, 128px",lg:"(max-width: 768px) 140px, 160px"}[s]}):l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-coffee-medium",children:l.jsx("span",{className:"text-white font-serif italic text-h4",children:d.substring(0,1)})}),t&&e&&e.chaptersRead>0&&l.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/50 p-2",children:[l.jsx(Ho,{value:u,className:"h-2"}),l.jsxs("p",{className:"text-white text-caption mt-1 text-center",children:[m," / ",e.pages," pages"]})]})]})},Ko=({book:e,isAdding:t,showAddButton:s,showDeleteButton:r,actionLabel:a,onAdd:n,onDelete:i,onAction:o})=>l.jsxs(l.Fragment,{children:[a&&l.jsxs(ya,{size:"sm",variant:"outline",className:"mt-3 w-full border-coffee-medium text-coffee-darker hover:bg-coffee-light/20",onClick:o,disabled:t,children:[e.isCompleted?l.jsx(Pe,{className:"h-4 w-4 mr-1"}):l.jsx(Ie,{className:"h-4 w-4 mr-1"}),a]}),s&&l.jsx(ya,{"data-testid":"add-to-reading-list-button",size:"sm",variant:"outline",className:"mt-3 w-full border-coffee-medium text-coffee-darker hover:bg-coffee-light/20",onClick:n,disabled:t,children:t?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"h-4 w-4 mr-1 animate-spin"}),"Ajout en cours..."]}):l.jsxs(l.Fragment,{children:[l.jsx(A,{className:"h-4 w-4 mr-1"}),"Ajouter  ma liste"]})}),r&&l.jsxs(ya,{size:"sm",variant:"outline",className:"mt-2 w-full border-destructive text-destructive hover:bg-destructive/10",onClick:i,children:[l.jsx(De,{className:"h-4 w-4 mr-1"}),"Retirer"]})]});function Yo({book:e,showProgress:t=!1,showDate:s=!1,showAddButton:r=!1,showDeleteButton:a=!1,actionLabel:n,onAction:i}){const[c,d]=o.useState(!1),{user:u}=ha(),{addToReadingList:m}=Wo();if(!e)return null;try{Po(e)}catch(f){return null}const h=e.id||e.slug||"",p=()=>e.isCompleted?"Termin":e.chaptersRead&&e.chaptersRead>0?"En cours de lecture":" lire";return l.jsx(v,{"data-testid":"book-card",to:`/books/${h}`,className:"block h-full group focus:outline-none focus-visible:ring-2 focus-visible:ring-coffee-dark focus-visible:ring-offset-2 rounded-md transition-all duration-200","aria-label":`${e.title} par ${e.author}. Statut: ${p()}. Appuyez sur Entre pour ouvrir.`,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.preventDefault()},tabIndex:0,role:"link",children:l.jsxs("article",{className:"book-card flex flex-col h-full min-h-[520px] sm:min-h-[540px] bg-white border border-coffee-light rounded-md overflow-hidden transition-all duration-300 hover:shadow-md relative transform hover:scale-[1.02] hover:border-coffee-medium focus-within:ring-2 focus-within:ring-coffee-dark focus-within:ring-offset-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx(Go,{book:e,showProgress:t,fluid:!0,className:"w-full"}),e.isCompleted?l.jsx(xe,{className:"h-5 w-5 text-green-600 absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}):e.chaptersRead&&e.chaptersRead>0?l.jsx(be,{className:"h-5 w-5 text-coffee-dark absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}):l.jsx(Le,{className:"h-5 w-5 text-coffee-medium absolute top-2 right-2 bg-white bg-opacity-70 rounded-full p-0.5","aria-hidden":"true"}),l.jsx("span",{className:"sr-only",children:p()})]}),l.jsxs("div",{className:"p-3 flex-grow flex flex-col",children:[l.jsx("h3",{className:"font-medium text-coffee-darker mb-1 line-clamp-2 min-h-[3.25rem] focus:outline-none",children:((e,t=50)=>e?e.length<=t?e:e.substring(0,t)+"...":"Titre inconnu")(e.title)}),l.jsx("p",{className:"text-body-sm text-muted-foreground line-clamp-1 min-h-[1.25rem]",children:e.author||"Auteur inconnu"}),l.jsx("div",{className:"mt-2 flex flex-wrap gap-1 min-h-[36px] overflow-hidden",children:(e.categories||[]).slice(0,3).map((e,t)=>l.jsx(Nn,{variant:"outline",className:"text-caption border-coffee-light","aria-label":`Catgorie: ${e}`,children:e},t))}),l.jsx("div",{className:"mt-auto pt-2",children:l.jsx(Ko,{book:e,isAdding:c,showAddButton:r,showDeleteButton:a,actionLabel:n,onAdd:async t=>{if(t.preventDefault(),t.stopPropagation(),!u?.id){const e=new Hn;return void Yr.error(e.message)}if(!c)try{d(!0);await m(e)}catch(f){const t=(e=>e instanceof $n?"info":"error")(f),s=Zn(f);"info"===t?Yr.info(s):Yr.error(s)}finally{d(!1)}},onDelete:e=>{e.preventDefault(),e.stopPropagation(),Yr.info("Fonction de suppression  implmenter")},onAction:e=>{e.preventDefault(),e.stopPropagation(),u?.id?i?.():Yr.error("Vous devez tre connect pour effectuer cette action")}})})]})]})})}const Qo=(e,t={})=>{const{initialPageSize:s=12,pageSize:r=8}=t,[a,n]=o.useState(1),i=o.useMemo(()=>{const t=s+(a-1)*r;return e.slice(0,t)},[e,a,s,r]),l=i.length<e.length,c=Math.ceil((e.length-s)/r)+1;return{paginatedBooks:i,hasMore:l,isLoading:!1,loadMore:()=>{l&&n(e=>e+1)},reset:()=>{n(1)},currentPage:a,totalPages:c,totalItems:e.length,showingItems:i.length}},Xo=({onLoadMore:e,hasMore:t,isLoading:s=!1,showingCount:r,totalCount:a,className:n=""})=>t?l.jsxs("div",{className:`flex flex-col items-center space-y-3 ${n}`,children:[l.jsx(ya,{variant:"outline",onClick:e,disabled:s,className:"min-w-[200px] bg-white hover:bg-coffee-light/20 border-coffee-medium text-coffee-dark",children:s?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Chargement..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Voir plus de livres"]})}),l.jsxs("p",{className:"text-body-sm text-muted-foreground",children:[r," sur ",a," livres affichs"]})]}):null;function Jo({books:e,title:t,description:s,showProgress:r=!1,showDate:a=!1,showAddButton:n=!1,showDeleteButton:i=!1,actionLabel:o,onAction:c,enablePagination:d=!1,initialPageSize:u=12,pageSize:m=8}){L();const{paginatedBooks:h,hasMore:p,loadMore:f,showingItems:g,totalItems:x}=Qo(e,{initialPageSize:u,pageSize:m}),v=d?h:e;return e.length?l.jsxs("div",{className:"space-y-4",children:[t&&l.jsxs("div",{className:"mb-4",children:[l.jsx("h2",{className:"text-h4 font-serif text-coffee-darker",children:t}),s&&l.jsx("p",{className:"text-muted-foreground text-body-sm mt-1",children:s})]}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 2xl:grid-cols-8 gap-4 md:gap-6",children:v.map(e=>{const t=e.id||e.slug||"";return l.jsx("div",{className:"h-full",children:l.jsx(Yo,{book:e,showProgress:r,showDate:a,showAddButton:n,showDeleteButton:i,actionLabel:o,onAction:()=>c?.(t)})},t)})}),d&&l.jsx(Xo,{onLoadMore:f,hasMore:p,showingCount:g,totalCount:x,className:"mt-8"})]}):l.jsxs("div",{className:"text-center p-8 border border-dashed border-coffee-light rounded-lg bg-muted/50",children:[l.jsx("h3",{className:"text-h4 font-medium text-coffee-darker mb-2",children:"Aucun livre trouv"}),l.jsx("p",{className:"text-muted-foreground",children:"Essayez une autre recherche ou explorez notre catalogue"})]})}const el=o.forwardRef(({className:e,...t},s)=>l.jsx("div",{ref:s,className:Pr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));el.displayName="Card";const tl=o.forwardRef(({className:e,...t},s)=>l.jsx("div",{ref:s,className:Pr("flex flex-col space-y-1.5 p-6",e),...t}));tl.displayName="CardHeader";const sl=o.forwardRef(({className:e,...t},s)=>l.jsx("h3",{ref:s,className:Pr("text-2xl font-semibold leading-none tracking-tight",e),...t}));sl.displayName="CardTitle";const rl=o.forwardRef(({className:e,...t},s)=>l.jsx("p",{ref:s,className:Pr("text-sm text-muted-foreground",e),...t}));rl.displayName="CardDescription";const al=o.forwardRef(({className:e,...t},s)=>l.jsx("div",{ref:s,className:Pr("p-6 pt-0",e),...t}));al.displayName="CardContent";function nl({className:e,shimmer:t=!1,...s}){return l.jsx("div",{className:Pr("animate-pulse rounded-md bg-muted",t&&"animate-shimmer loading-pulse",e),...s})}function il({progressItems:e,isLoading:t=!1}){const s=Sa(),r=o.useMemo(()=>e&&Array.isArray(e)?e:[],[e]);if(t)return s?l.jsxs(el,{className:"border-coffee-light mobile-optimized",children:[l.jsx(tl,{className:"pb-4",children:l.jsx(nl,{className:"loading-skeleton-title"})}),l.jsx(al,{className:"space-y-4",children:[1,2].map(e=>l.jsxs("div",{className:"flex gap-4",children:[l.jsx(nl,{className:"h-20 w-16 rounded"}),l.jsxs("div",{className:"flex-1 space-y-2",children:[l.jsx(nl,{className:"loading-skeleton-text"}),l.jsx(nl,{className:"h-2 w-full"}),l.jsx(nl,{className:"h-3 w-1/2"})]})]},e))})]}):l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{className:"flex flex-row items-center justify-between",children:l.jsxs("div",{className:"space-y-2",children:[l.jsx(nl,{className:"h-7 w-52"}),l.jsx(nl,{className:"h-4 w-40"})]})}),l.jsx(al,{children:l.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>l.jsxs("div",{className:"flex gap-4",children:[l.jsx(nl,{className:"h-24 w-16 rounded"}),l.jsxs("div",{className:"flex-1 space-y-2",children:[l.jsx(nl,{className:"loading-skeleton-text"}),l.jsx(nl,{className:"h-4 w-24"}),l.jsx(nl,{className:"h-2 w-full"}),l.jsx(nl,{className:"h-3 w-1/2"})]})]},e))})})]});const a=r;return l.jsxs(el,{className:"border-coffee-light mobile-optimized",children:[l.jsxs(tl,{className:"flex flex-row items-center justify-between "+(s?"pb-4":""),children:[l.jsxs("div",{children:[l.jsx(sl,{className:"mobile-title",children:Wa}),l.jsx(rl,{className:"text-body sm:text-body-sm",children:Ha})]}),a.length>0&&!s&&l.jsx(ya,{variant:"ghost",size:"sm",asChild:!0,className:"hover:bg-coffee-light/20",children:l.jsxs(v,{to:"/reading-list",className:"text-coffee-dark hover:text-coffee-darker",children:[$a," ",l.jsx(Me,{className:"ml-1 h-4 w-4"})]})})]}),l.jsx(al,{className:s?"pt-0":"",children:0===a.length?l.jsxs("div",{className:"text-center p-8 sm:p-6 border border-dashed border-coffee-light rounded-lg mobile-optimized",children:[l.jsx(be,{className:"mx-auto h-12 w-12 sm:h-8 sm:w-8 text-muted-foreground mb-4 sm:mb-2"}),l.jsx("h3",{className:"mobile-subtitle",children:Ga}),l.jsx("p",{className:"text-muted-foreground mb-6 sm:mb-4 text-body sm:text-body-sm",children:Ka}),l.jsx(ya,{className:"bg-coffee-dark hover:bg-coffee-darker",asChild:!0,children:l.jsx(v,{to:"/explore",children:Ya})})]}):l.jsxs("div",{className:"space-y-6 sm:space-y-4",children:[a.slice(0,s?2:3).map(e=>{if(!e)return null;const{chaptersRead:t,progressPercent:r,totalSegments:a}=e;if(!a)return null;return s?l.jsx("div",{className:"mobile-book-card group",children:l.jsxs("div",{className:"flex gap-4",children:[e.book_cover?l.jsx("img",{src:e.book_cover,alt:e.book_title||"Couverture de livre",className:"w-16 h-20 object-cover rounded",loading:"lazy"}):l.jsx("div",{className:"w-16 h-20 flex items-center justify-center bg-chocolate-medium rounded",children:l.jsx("span",{className:"font-serif italic text-white text-h4",children:(e.book_title||"?").substring(0,1)})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs(v,{to:`/books/${e.book_id}`,className:"block",children:[l.jsx("h3",{className:"font-medium text-coffee-darker group-hover:underline text-body mb-2 line-clamp-2",children:e.book_title||"Titre inconnu"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"h-2 w-full bg-gray-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full rounded-full bg-coffee-dark transition-all duration-500 ease-out",style:{width:`${r}%`}})}),l.jsxs("div",{className:"flex justify-between text-body-sm text-muted-foreground",children:[l.jsxs("span",{children:[r,"% termin"]}),l.jsxs("span",{children:[t,"/",a]})]})]})]}),t>0&&"completed"!==e.status&&l.jsx(ya,{size:"sm",className:"mt-3 w-full bg-coffee-dark hover:bg-coffee-darker",asChild:!0,children:l.jsxs(v,{to:`/books/${e.book_id}`,children:[l.jsx(Ie,{className:"h-4 w-4 mr-2"}),Ja]})})]})]})},e.id):l.jsxs("div",{className:"flex gap-4 group transition-all duration-300 hover:scale-[1.01] p-3 rounded-lg hover:bg-coffee-light/10",children:[l.jsxs("div",{className:"book-cover w-16 h-24 overflow-hidden relative",children:[e.book_cover?l.jsx("img",{src:e.book_cover,alt:e.book_title||"Couverture de livre",className:"w-full h-full object-cover",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-chocolate-medium",children:l.jsx("span",{className:"font-serif italic text-white",children:(e.book_title||"?").substring(0,1)})}),l.jsx("div",{className:"absolute top-1 right-1 bg-white bg-opacity-70 rounded-full p-0.5",children:"completed"===e.status?l.jsx(xe,{className:"h-3 w-3 text-green-600"}):t>0?l.jsx(be,{className:"h-3 w-3 text-coffee-dark"}):l.jsx(Le,{className:"h-3 w-3 text-coffee-medium"})})]}),l.jsxs("div",{className:"flex-1",children:[l.jsxs(v,{to:`/books/${e.book_id}`,className:"block",children:[l.jsxs("h3",{className:"font-medium line-clamp-1 group-hover:underline text-coffee-darker flex items-center",children:[l.jsx("span",{className:"hidden md:inline-block",children:"completed"===e.status?l.jsx(xe,{className:"h-4 w-4 text-green-600 mr-1"}):t>0?l.jsx(be,{className:"h-4 w-4 text-coffee-dark mr-1"}):l.jsx(Le,{className:"h-4 w-4 text-coffee-medium mr-1"})}),e.book_title||"Titre inconnu"]}),l.jsx("p",{className:"text-caption text-muted-foreground",children:e.book_author||"Auteur inconnu"}),l.jsxs("div",{className:"mt-2 space-y-1",children:[l.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full rounded-full bg-coffee-dark transition-all duration-500 ease-out",style:{width:`${r}%`}})}),l.jsxs("div",{className:"flex justify-between text-caption text-muted-foreground",children:[l.jsxs("span",{children:[r,"% termin"]}),l.jsx("span",{children:`${t}/${a} segments`})]})]})]}),t>0&&"completed"!==e.status&&l.jsx(ya,{size:"sm",className:"mt-2 bg-coffee-dark hover:bg-coffee-darker",asChild:!0,children:l.jsxs(v,{to:`/books/${e.book_id}`,children:[l.jsx(Ie,{className:"h-4 w-4 mr-1"}),Ja]})})]})]},e.id)}),s&&a.length>2&&l.jsx("div",{className:"text-center pt-4",children:l.jsx(ya,{variant:"outline",size:"sm",asChild:!0,className:"w-full",children:l.jsxs(v,{to:"/reading-list",children:["Voir les ",a.length," livres"]})})})]})})]})}o.forwardRef(({className:e,...t},s)=>l.jsx("div",{ref:s,className:Pr("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";const ol=class e{constructor(){a(this,"logLevel",2),a(this,"logs",[]),a(this,"maxLogs",1e3)}static getInstance(){return e.instance||(e.instance=new e),e.instance}log(e,t,s,r,a){if(e>this.logLevel)return;const n={timestamp:(new Date).toISOString(),level:e,component:t,message:s,data:r,error:a};this.logs.push(n),this.logs.length>this.maxLogs&&this.logs.shift()}error(e,t,s,r){this.log(0,e,t,r,s)}warn(e,t,s){this.log(1,e,t,s)}info(e,t,s){this.log(2,e,t,s)}debug(e,t,s){this.log(3,e,t,s)}getLogs(e){return void 0===e?[...this.logs]:this.logs.filter(t=>t.level<=e)}clearLogs(){this.logs=[]}setLogLevel(e){this.logLevel=e}};a(ol,"instance");const ll=ol.getInstance(),cl=e=>({error:(t,s,r)=>ll.error(e,t,s,r),warn:(t,s)=>ll.warn(e,t,s),info:(t,s)=>ll.info(e,t,s),debug:(t,s)=>ll.debug(e,t,s)}),dl=o.memo(function({readingProgress:e,isLoading:t,onProgressUpdate:s}){const r=L(),{user:a}=ha(),n=cl("HomeContent");return o.useEffect(()=>{e&&Array.isArray(e)&&e.forEach((e,t)=>{})},[e,t,a]),o.useEffect(()=>{if(a?.id&&e&&e.length>0){setTimeout(async()=>{try{const e=await(async e=>{if(!e)return{success:!1,message:"User ID manquant"};try{const{data:s,error:r}=await Vr.from("reading_progress").select("\n        *,\n        books (\n          id,\n          expected_segments,\n          total_chapters\n        )\n      ").eq("user_id",e);if(r)return{success:!1,message:"Erreur lors de la rcupration des donnes"};if(!s||0===s.length)return{success:!0,message:"Aucun progrs trouv  corriger"};let a=0,n=0;for(const i of s)try{const t=i.book_id,s=i.books?.expected_segments||i.books?.total_chapters||1,r=await Io(e,t);let o;o=r>=s?"completed":r>0?"in_progress":"to_read";const l=Math.floor(r/s*i.total_pages);if(i.status!==o||Math.abs(i.current_page-l)>10){const{error:e}=await Vr.from("reading_progress").update({status:o,current_page:l,updated_at:(new Date).toISOString()}).eq("id",i.id);e?n++:a++}}catch(t){n++}return{success:!0,message:`${a} livres corrigs, ${n} erreurs`,corrected:a,errors:n}}catch(t){return{success:!1,message:"Erreur lors de la correction des donnes"}}})(a.id);e.success&&e.corrected>0&&n.info("Data consistency fixed",{corrected:e.corrected})}catch(e){n.error("Failed to fix data consistency",e)}},2e3)}},[a?.id,e,n]),e&&Array.isArray(e)?l.jsxs("div",{className:"space-y-6",children:[l.jsx(il,{progressItems:e,isLoading:t}),l.jsx("div",{className:"text-center p-4",children:l.jsxs(ya,{className:"w-full bg-coffee-dark text-white hover:bg-coffee-darker rounded-xl text-body font-semibold px-6 py-3 transition-all duration-200 shadow-sm hover:shadow-md",onClick:()=>r("/achievements"),children:[Za," "]})})]}):l.jsxs("div",{children:[an,"..."]})});const ul=(e=class{constructor(){a(this,"renderMetrics",new Map),a(this,"apiMetrics",new Map),a(this,"enabled",!1)}static getInstance(){return e.instance||(e.instance=new e),e.instance}trackComponentRender(e,t,s=[]){if(!this.enabled)return;const r=performance.now()-t,a=this.renderMetrics.get(e);a?(a.renderCount++,a.lastRenderTime=Date.now(),a.averageRenderTime=(a.averageRenderTime+r)/2,a.propsChanged=s):this.renderMetrics.set(e,{componentName:e,renderCount:1,lastRenderTime:Date.now(),averageRenderTime:r,propsChanged:s});this.renderMetrics.get(e).renderCount}trackAPICall(e,t,s=!1){if(!this.enabled)return;const r=this.apiMetrics.get(e);r?(r.callCount++,r.averageResponseTime=(r.averageResponseTime+t)/2,s&&r.errorCount++):this.apiMetrics.set(e,{endpoint:e,callCount:1,averageResponseTime:t,errorCount:s?1:0})}getPerformanceReport(){let e=" RAPPORT DE PERFORMANCE v0.15\n\n";return e+=" COMPOSANTS (Re-rendus):\n",this.renderMetrics.forEach(t=>{e+=`  ${t.componentName}: ${t.renderCount} rendus (${t.averageRenderTime.toFixed(1)}ms moy.)\n`}),e+="\n API (Rponses):\n",this.apiMetrics.forEach(t=>{const s=(t.errorCount/t.callCount*100).toFixed(1);e+=`  ${t.endpoint}: ${t.callCount} calls (${t.averageResponseTime.toFixed(0)}ms moy., ${s}% erreurs)\n`}),e}logReport(){this.enabled}reset(){this.renderMetrics.clear(),this.apiMetrics.clear()}},a(e,"instance"),e).getInstance(),ml=o.memo(function({searchResults:e,onReset:t,redirecting:s=!1}){return L(),e?l.jsxs("div",{className:"space-y-6 "+(s?"opacity-80 transition-opacity duration-300":""),children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h2",{className:"text-h4 font-serif font-medium text-coffee-darker",children:e.length>0?`Rsultats de recherche (${e.length})`:"Aucun rsultat trouv"}),l.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker font-medium flex items-center",onClick:t,disabled:s,children:"Retour  l'accueil"})]}),e.length>0?l.jsx(Jo,{books:e,showAddButton:!0}):l.jsxs("div",{className:"text-center p-8 border border-dashed border-coffee-light rounded-lg bg-muted/50",children:[l.jsx("h3",{className:"text-h4 font-medium text-coffee-darker mb-2",children:"Aucun livre trouv"}),l.jsx("p",{className:"text-muted-foreground",children:"Essayez une autre recherche ou explorez notre catalogue"})]})]}):null}),hl=o.memo(dl),pl=o.memo(function({searchResults:e,onResetSearch:t,readingProgress:s,isLoading:r,isSearching:a=!1,isRedirecting:n=!1,onProgressUpdate:i,currentReading:c,isLoadingCurrentBook:d,onContinueReading:u}){((e,t)=>{const s=performance.now(),r=h.useRef(t);h.useEffect(()=>{const a=[];t&&r.current&&Object.keys(t).forEach(e=>{t[e]!==r.current[e]&&a.push(e)}),ul.trackComponentRender(e,s,a),r.current=t})})("MainContent",{hasSearchResults:!!e,searchResultsLength:e?.length||0,readingProgressLength:s?.length||0,isLoading:r,isSearching:a,isRedirecting:n});const m=o.useMemo(()=>({searchResultsKey:e?.map(e=>e.id).join("-")||"no-search",readingProgressKey:s?.map(e=>`${e.book_id}-${e.chaptersRead}`).join("-")||"no-progress",inProgressCount:s?.length||0}),[e,s]),p=o.useMemo(()=>l.jsx("div",{className:"flex items-center justify-center p-8",children:l.jsxs("div",{className:"text-center space-y-2",children:[l.jsx("div",{className:"animate-pulse flex justify-center",children:l.jsx(Ee,{className:"h-8 w-8 text-coffee-dark"})}),l.jsx("p",{className:"text-coffee-dark",children:Qa})]})}),[]),f=o.useMemo(()=>l.jsx(hl,{readingProgress:s,isLoading:r,onProgressUpdate:i},`home-content-${m.readingProgressKey}`),[s,r,i,m.readingProgressKey]);return a?p:e?l.jsx(ml,{searchResults:e,onReset:t},m.searchResultsKey):f}),fl=e=>({id:e.id||"",title:e.title||"",author:e.author||"",coverImage:e.cover_url||void 0,description:e.description||"",totalChapters:("total_chapters"in e?e.total_chapters:null)||1,chaptersRead:0,isCompleted:!1,language:"fr",categories:e.tags||[],tags:e.tags||[],pages:("total_pages"in e?e.total_pages:null)||0,total_pages:("total_pages"in e?e.total_pages:null)||0,publicationYear:(new Date).getFullYear(),isPublished:!("is_published"in e)||!1!==e.is_published,slug:e.slug||"",expectedSegments:e.expected_segments||1,totalSegments:e.expected_segments||1}),gl=new Map,xl=async e=>{e?gl.delete(e):gl.clear()},vl=new Map,bl=async e=>{if(!e||"string"!=typeof e)return null;const t=e.trim();if(!t)return null;const s=vl.get(t);if(s&&Date.now()-s.timestamp<3e5)return s.data;try{const{data:e,error:s}=await Vr.from("books_public").select("*").eq("slug",t).maybeSingle();if(s&&s.code,e){const s=fl(e);return vl.set(t,{data:s,timestamp:Date.now()}),vl.set(s.id,{data:s,timestamp:Date.now()}),s}const r=(e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))(t);if(r){const{data:e,error:s}=await Vr.from("books_public").select("*").eq("id",t).maybeSingle();if(s&&s.code,e){const s=fl(e);return vl.set(t,{data:s,timestamp:Date.now()}),s.slug&&vl.set(s.slug,{data:s,timestamp:Date.now()}),s}}else{const{data:e,error:s}=await Vr.from("books_public").select("*").eq("slug",t).maybeSingle();if(s&&s.code,e){const s=fl(e);return vl.set(t,{data:s,timestamp:Date.now()}),s}}return null}catch(r){return null}};async function yl(e,t){const{total_pages:s,current_page:r,expected_segments:a,total_chapters:n}=e,i=await Io(e.user_id,e.book_id||e.id),o=r>2*s,l=e.expected_segments??n??1,c=l,d=Math.min(i,c),u="completed"===t?.status||d>=c;return{...e,...t,coverImage:e.cover_url,expectedSegments:l,totalSegments:c,chaptersRead:d,progressPercent:Math.round(d/(c||1)*100),nextSegmentPage:o?8e3*(d+1):30*(d+1),currentSegment:d,isCompleted:u,book_id:e.book_id||e.id,book_title:e.title,book_author:e.author,book_cover:e.cover_url}}async function wl(e,t=3,s=1e3){try{return await e()}catch(r){const a=r?.message?.includes("fetch")||r?.message?.includes("timeout")||"PGRST301"===r?.code||"429"===r?.code||500===r?.status||503===r?.status;if(t>0&&a)return await new Promise(e=>setTimeout(e,s)),wl(e,t-1,2*s);throw r}}const jl=async e=>{if(!e)return[];if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return[];const t=gl.get(e);if(t&&Date.now()-t.timestamp<3e4)return t.data;try{const{data:t,error:s}=await wl(async()=>{const t=await Vr.from("reading_progress").select("\n          *,\n          books:books_public(\n            id, slug, title, author, cover_url, total_chapters, expected_segments\n          )\n        ").eq("user_id",e);if(t.error)throw t.error;return t});if(s)return Nl(e);if(!t||0===t.length)return[];const r=await Promise.all(t.map(async(e,t)=>{const s=e.books,r={...e,...s,total_chapters:s?.total_chapters??s?.expected_segments??1,book_title:s?.title??"Titre inconnu",book_author:s?.author??"Auteur inconnu",book_slug:s?.slug??"slug inconnu",book_cover:s?.cover_url??"",validations:[]};return await yl(r)}));return gl.set(e,{data:r,timestamp:Date.now()}),r}catch(s){return[]}},Nl=async e=>{try{const{data:t,error:s}=await Vr.from("reading_progress").select("*").eq("user_id",e);if(s||!t)return[];return await Promise.all(t.map(async e=>{const t=await bl(e.book_id),s={...e,...t,total_chapters:t?.total_chapters??t?.expectedSegments??1,book_title:t?.title??"Titre inconnu",book_author:t?.author??"Auteur inconnu",book_slug:t?.slug??"slug inconnu",book_cover:t?.cover_url??"",validations:[]};return await yl(s)}))}catch(t){return[]}},kl=async(e,t)=>{if(!e)return null;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return null;try{const{data:s,error:r}=await wl(async()=>{const s=await Vr.from("reading_progress").select("\n          *,\n          books:books_public(\n            id, slug, title, author, cover_url, total_chapters, expected_segments\n          )\n        ").eq("user_id",e).eq("book_id",t).maybeSingle();if(s.error)throw s.error;return s});if(r)return _l(e,t);if(!s)return null;const a=s.books;if(!a){const e=await bl(t);if(!e)return null;const r={...s,...e,total_chapters:e?.total_chapters??e?.expected_segments??1,book_title:e?.title??"Titre inconnu",book_author:e?.author??"Auteur inconnu",book_slug:e?.slug??"slug inconnu",book_cover:e?.cover_url??""};return await yl(r)}const n={...s,...a,total_chapters:a?.total_chapters??a?.expected_segments??1,book_title:a?.title??"Titre inconnu",book_author:a?.author??"Auteur inconnu",book_slug:a?.slug??"slug inconnu",book_cover:a?.cover_url??"",validations:[]};return await yl(n)}catch(s){return null}},_l=async(e,t)=>{try{const{data:s,error:r}=await Vr.from("reading_progress").select("*").eq("user_id",e).eq("book_id",t).maybeSingle();if(r||!s)return null;const a=await bl(t);if(!a)return null;const n={...s,...a,total_chapters:a?.total_chapters??a?.expectedSegments??1,book_title:a?.title??"Titre inconnu",book_author:a?.author??"Auteur inconnu",book_slug:a?.slug??"slug inconnu",book_cover:a?.cover_url??"",validations:[]};return await yl(n)}catch(s){return null}},Sl=()=>{const{user:e}=ha(),{inProgress:t}=Wo(),[s,r]=o.useState(null),[a,n]=o.useState(!0),i=o.useRef(!0),l=o.useRef(!1),c=o.useRef(null),d=o.useRef(0),u=o.useMemo(()=>{if(t&&t.length>0){const e=t.filter(e=>!e.isUnavailable);if(e.length>0)return e[0];if(t.length>0)return{...t[0],isStableUnavailable:!0}}return null},[t]);o.useEffect(()=>{if(i.current&&u){const e=s?.id;e===u.id&&s||r(u)}},[u,s]);const m=o.useCallback(async()=>{if(!e?.id||l.current)return;const a=Date.now();if(!(a-d.current<3e4)&&(!(t&&t.length>0)||l.current))if(e.id===c.current&&s)n(!1);else try{l.current=!0,n(!0),d.current=a;const t=await(async(e,t)=>{if(!e)return[];try{const{data:s,error:r}=await Vr.from("reading_progress").select("\n        *,\n        books:books_public(\n          id, slug, title, author, cover_url, total_chapters, expected_segments\n        )\n      ").eq("user_id",e).eq("status",t);return r?[]:s&&0!==s.length?await Promise.all(s.map(async e=>{const t=e.books,s={...e,...t,total_chapters:t?.total_chapters??t?.expected_segments??1,book_title:t?.title??"Titre inconnu",book_author:t?.author??"Auteur inconnu",book_slug:t?.slug??"slug inconnu",book_cover:t?.cover_url??"",completed_at:null};return await yl(s)})):[]}catch(s){return[]}})(e.id,"in_progress");if(!i.current)return;if(t&&t.length>0){const e=t.filter(e=>!e.isUnavailable);if(e.length>0)r(e[0]);else if(t.length>0){const e={...t[0],isStableUnavailable:!0};r(e)}else r(null)}else r(null);c.current=e.id}catch(o){i.current&&Yr.error("Impossible de charger votre lecture en cours",{id:"current-reading-error"})}finally{i.current&&(n(!1),l.current=!1)}},[e?.id,t,s]);return o.useEffect(()=>{e?.id&&i.current?u?n(!1):m():n(!1)},[e?.id,m,u]),o.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]),{currentReading:s,isLoadingCurrentBook:a,refetch:m}},El=()=>{const{user:e}=ha(),[t,s]=o.useState([]),[r,a]=o.useState(!0),[n,i]=o.useState(null),[l,c]=o.useState(0),[d,u]=o.useState(0),m=o.useRef(!0),h=o.useRef(!1),p=o.useRef(!1),f=o.useRef(0);o.useEffect(()=>(m.current=!0,e?.id&&(h.current=!1),()=>{m.current=!1}),[e]);const g=o.useCallback(async(t=!1)=>{if(!e?.id||!m.current||p.current)return;const r=Date.now();if(t||!(r-f.current<500)){f.current=r;try{p.current=!0,a(!0),i(null),t&&await xl(e.id);const r=await jl(e.id);if(!m.current)return;const n=r.filter(e=>"in_progress"===e.status);s(n),h.current=!0,l>0&&c(0)}catch(n){if(m.current){const e=n instanceof Error?n.message:String(n);if(i(e),l<3&&Yr.error("Erreur lors du chargement de vos lectures en cours",{description:"Nous ressayerons automatiquement",duration:3e3}),l<5&&m.current){const e=Math.min(1e3*Math.pow(2,l),3e4);setTimeout(()=>{m.current&&(c(e=>e+1),g())},e)}}}finally{m.current&&(a(!1),p.current=!1)}}},[e,l]);o.useEffect(()=>{try{!e?.id||h.current||p.current?e?.id||a(!1):g()}catch(yN){}},[e,g]),o.useEffect(()=>{d>0&&e?.id&&g(!0)},[d,g,e?.id]);const x=o.useCallback(()=>{u(e=>e+1)},[]),v=o.useCallback(async()=>{if(e?.id)try{await xl(e.id),h.current=!1,u(e=>e+1),await g(!0),Yr.success("Donnes rafrachies",{duration:2e3})}catch(t){Yr.error("Erreur lors du rafrachissement")}},[e?.id,g]);return{readingProgress:t,isLoading:r,error:n,handleProgressUpdate:o.useCallback(async t=>{if(e?.id)try{await xl(e.id),a(!0),await g(!0),Yr.success("Progression mise  jour",{duration:2e3})}catch(s){m.current&&Yr.error("Erreur lors de la mise  jour de votre progression",{description:"Veuillez ressayer ultrieurement",duration:5e3})}finally{m.current&&a(!1)}else Yr.error("Vous devez tre connect pour mettre  jour votre progression",{duration:5e3})},[e?.id,g]),refetch:g,forceRefresh:x,forceClearAndRefresh:v}};function Cl(){const e=cl("Home"),t=Sa(),s=o.useRef(!0);o.useEffect(()=>(e.info("Component mounted",{pathname:window.location.pathname}),()=>{e.info("Component unmounting")}),[e]);const{searchResults:r,setSearchResults:a,handleSearch:n,isSearching:i,isRedirecting:c}=(()=>{const[e,t]=o.useState(null),[s,r]=o.useState(!1),[a,n]=o.useState(!1),[i,l]=o.useState(null),c=L();return o.useEffect(()=>{const e="read_app_last_search";localStorage.getItem(e)&&localStorage.removeItem(e),t(null)},[]),{searchResults:e,setSearchResults:t,handleSearch:async e=>{if(!e?.trim())return t(null),void l(null);r(!0),n(!1),l(null);try{const{data:s,error:r}=await Vr.from("books_public").select("*").or(`title.ilike.%${e}%,author.ilike.%${e}%`);if(r)return l("Erreur lors de la recherche"),void Yr.error("Erreur de recherche : Impossible d'effectuer votre recherche",{duration:3e3});const a=s?s.map(fl):[];1===a.length?(n(!0),t(a),setTimeout(()=>{c(`/books/${a[0].id}`)},300)):(t(a),0===a.length&&Yr.info("Aucun livre ne correspond  votre recherche"))}catch(s){l(s.message||"Une erreur est survenue"),Yr.error("Erreur de recherche : Une erreur est survenue pendant la recherche",{duration:3e3})}finally{r(!1)}},isSearching:s,isRedirecting:a,error:i,clearSearch:()=>{t(null),l(null)}}})(),{currentReading:d,isLoadingCurrentBook:u}=Sl(),{readingProgress:m,isLoading:h,handleProgressUpdate:p}=El(),f=L();o.useEffect(()=>{s.current&&(s.current=!1,e.info("Initial render completed",{pathname:window.location.pathname,hasSearchResults:!!r,isRedirecting:c}),r&&(e.info("Clearing search results on initial render to prevent auto-redirect"),a(null)))},[r,a,c,e]),o.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"WARM_CACHE"})},[]);const g=o.useCallback(()=>{if(d){if(d.isUnavailable)return void Yr.error("Ce livre est actuellement indisponible",{id:"book-unavailable"});f(`/books/${d.id}?segment=${Math.floor(d.chaptersRead)}`)}},[d,f]);o.useMemo(()=>!!r,[r]);const x=o.useMemo(()=>({searchResults:r,onResetSearch:()=>a(null),currentReading:d,isLoadingCurrentBook:u,readingProgress:m,isLoading:h,isSearching:i,isRedirecting:c,onProgressUpdate:p,onContinueReading:g}),[r,a,d,u,m,h,i,c,p,g]);return l.jsx(Vn,{children:l.jsxs("section",{className:"relative isolate w-screen left-1/2 right-1/2 -translate-x-1/2 min-h-screen bg-logo-background text-logo-text transition-all duration-300",children:[l.jsx(Ln,{}),l.jsxs("main",{className:`mx-auto w-full px-4 max-w-none mobile-optimized ${t?"py-4":"py-4 sm:py-6"} animate-fade-in focus:outline-none`,tabIndex:-1,children:[l.jsxs("div",{className:"max-w-none mx-auto px-2 sm:px-0 mb-6 sm:mb-8",children:[l.jsxs("h1",{className:"sr-only",children:[La," - VREAD"]}),l.jsx(Mn,{onSearch:n,isSearching:i})]}),l.jsx("div",{className:"animate-fade-in transition-all duration-300",children:l.jsx(pl,{...x})})]}),l.jsx("footer",{className:"py-12 border-t border-white/10 bg-gradient-to-br from-reed-primary to-reed-secondary",children:l.jsxs("nav",{className:"flex items-center justify-center gap-12 text-lg",children:[l.jsx("a",{href:"/blog",className:"text-white/50 hover:text-white transition-colors font-light",children:"Blog"}),l.jsx("span",{className:"text-white/30 text-2xl",children:""}),l.jsx("a",{href:"/presse",className:"text-white/50 hover:text-white transition-colors font-light",children:"Presse"}),l.jsx("span",{className:"text-white/30 text-2xl",children:""}),l.jsx("a",{href:"/a-propos",className:"text-white/50 hover:text-white transition-colors font-light",children:"Contact"})]})})]})})}const Rl=va("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Tl=o.forwardRef(({className:e,...t},s)=>l.jsx(Ve,{ref:s,className:Pr(Rl(),e),...t}));Tl.displayName=Ve.displayName;const Al=()=>l.jsx("footer",{className:"border-t border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:l.jsx("div",{className:"container mx-auto px-4 py-6",children:l.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[l.jsxs("div",{className:"flex items-center gap-6 text-sm text-muted-foreground",children:[l.jsx(v,{to:"/a-propos",className:"hover:text-foreground transition-colors",children:" propos"}),l.jsx(v,{to:"/presse",className:"hover:text-foreground transition-colors",children:"Presse"}),l.jsx(v,{to:"/blog",className:"hover:text-foreground transition-colors",children:"Blog"})]}),l.jsxs("div",{className:"flex items-center gap-2 text-caption text-muted-foreground italic",children:[l.jsx("span",{children:"v.021"}),l.jsx("span",{"data-build":!0,className:"text-xs opacity-60",children:"2025-11-05T14:00:38.045Z"})]})]})})});function Pl(){const[e]=ze(),t=L(),s="login"===e.get("mode")?"login":"signup",[r,a]=o.useState(s),{signUp:n,signIn:i,setError:c}=ha(),[d,u]=o.useState(""),[m,h]=o.useState(""),[p,f]=o.useState(""),[g,v]=o.useState(!1),[b,y]=o.useState(null),[w,j]=o.useState(""),[N,k]=o.useState(""),[_,S]=o.useState(!1),[E,C]=o.useState(null);return l.jsxs(l.Fragment,{children:[l.jsxs(x,{children:[l.jsx("title",{children:"VREAD | Crer un compte ou se connecter"}),l.jsx("meta",{name:"description",content:"Cre un compte en 30 secondes ou connecte-toi  VREAD."})]}),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-reed-primary via-reed-primary to-reed-secondary",children:l.jsx("section",{className:"px-4 py-16",children:l.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center text-center",children:[l.jsx("div",{className:"rounded-3xl border-4 border-[#EEDCC8] p-4 shadow-xl bg-white/5 backdrop-blur-sm",children:l.jsx(wa,{size:72,className:"h-16 w-16"})}),l.jsx("h1",{className:"mt-6 font-serif text-3xl text-white",children:"Bienvenue"}),l.jsxs("p",{className:"mt-1 text-white/90",children:["Premire fois ici ? ",l.jsx("strong",{children:"Cre un compte"})," en 30 s."]}),l.jsx(el,{className:"mt-8 w-full rounded-2xl bg-white/10 ring-1 ring-white/20 backdrop-blur-sm",children:l.jsx(al,{className:"pt-6",children:l.jsxs(kn,{value:r,onValueChange:e=>a(e),className:"w-full",children:[l.jsxs(_n,{className:"grid w-full grid-cols-2 rounded-xl bg-white/10 p-1",children:[l.jsx(Sn,{value:"signup",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:text-reed-primary data-[state=inactive]:text-white/90",children:"Crer un compte"}),l.jsx(Sn,{value:"login",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:text-reed-primary data-[state=inactive]:text-white/90",children:"Se connecter"})]}),l.jsx(En,{value:"signup",className:"mt-6",children:l.jsxs(el,{className:"border-0 bg-transparent shadow-none",children:[l.jsxs(tl,{className:"px-0",children:[l.jsx(sl,{className:"text-left text-white",children:"Crer un compte"}),l.jsx(rl,{className:"text-left text-white/90",children:"Accde  VREAD en quelques secondes."})]}),l.jsx(al,{className:"px-0",children:l.jsxs("form",{id:"signup-form",onSubmit:async function(e){if(e.preventDefault(),y(null),c(null),m===p){v(!0);try{await n(d,m),t("/home")}catch(s){y(s?.message??"Inscription impossible.")}finally{v(!1)}}else y("Les mots de passe ne correspondent pas.")},className:"space-y-4",children:[l.jsxs("div",{className:"text-left",children:[l.jsx(Tl,{htmlFor:"s-email",className:"text-white/90",children:"Email"}),l.jsx(On,{id:"s-email",type:"email",value:d,onChange:e=>u(e.target.value),className:"bg-white",required:!0,autoComplete:"email"})]}),l.jsxs("div",{className:"text-left",children:[l.jsx(Tl,{htmlFor:"s-pwd",className:"text-white/90",children:"Mot de passe"}),l.jsx(On,{id:"s-pwd",type:"password",value:m,onChange:e=>h(e.target.value),className:"bg-white",required:!0,minLength:6,autoComplete:"new-password"})]}),l.jsxs("div",{className:"text-left",children:[l.jsx(Tl,{htmlFor:"s-pwd2",className:"text-white/90",children:"Confirmer le mot de passe"}),l.jsx(On,{id:"s-pwd2",type:"password",value:p,onChange:e=>f(e.target.value),className:"bg-white",required:!0,minLength:6,autoComplete:"new-password"})]}),b&&l.jsx("p",{className:"text-left text-sm text-red-200",children:b}),l.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[l.jsx(ya,{type:"submit",disabled:g,className:"bg-white px-6 py-5 font-bold text-reed-primary hover:bg-reed-light hover:text-reed-darker disabled:opacity-60",children:g?"Cration...":"Crer mon compte"}),l.jsx("button",{type:"button",onClick:()=>a("login"),className:"text-sm text-white/90 underline decoration-white/60 underline-offset-4",children:"Dj inscrit ? Se connecter"})]})]})})]})}),l.jsx(En,{value:"login",className:"mt-6",children:l.jsxs(el,{className:"border-0 bg-transparent shadow-none",children:[l.jsxs(tl,{className:"px-0",children:[l.jsx(sl,{className:"text-left text-white",children:"Se connecter"}),l.jsx(rl,{className:"text-left text-white/90",children:"Reprends ta lecture."})]}),l.jsx(al,{className:"px-0",children:l.jsxs("form",{id:"login-form",onSubmit:async function(e){e.preventDefault(),C(null),c(null),S(!0);try{await i(w,N),t("/home")}catch(s){C(s?.message??"Connexion impossible.")}finally{S(!1)}},className:"space-y-4",children:[l.jsxs("div",{className:"text-left",children:[l.jsx(Tl,{htmlFor:"l-email",className:"text-white/90",children:"Email"}),l.jsx(On,{id:"l-email",type:"email",value:w,onChange:e=>j(e.target.value),className:"bg-white",required:!0,autoComplete:"email"})]}),l.jsxs("div",{className:"text-left",children:[l.jsx(Tl,{htmlFor:"l-pwd",className:"text-white/90",children:"Mot de passe"}),l.jsx(On,{id:"l-pwd",type:"password",value:N,onChange:e=>k(e.target.value),className:"bg-white",required:!0,autoComplete:"current-password"})]}),E&&l.jsx("p",{className:"text-left text-sm text-red-200",children:E}),l.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[l.jsx(ya,{type:"submit",disabled:_,className:"bg-white px-6 py-5 font-bold text-reed-primary hover:bg-reed-light hover:text-reed-darker disabled:opacity-60",children:_?"Connexion...":"Se connecter"}),l.jsx("button",{type:"button",onClick:()=>a("signup"),className:"text-sm text-white/90 underline decoration-white/60 underline-offset-4",children:"Premire fois ? Crer un compte"})]})]})})]})})]})})}),l.jsx("p",{className:"mt-4 text-xs text-white/80",children:"En crant un compte, tu acceptes nos conditions d'utilisation."})]})})}),l.jsx(Al,{})]})}const Il=va("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Dl=o.forwardRef(({className:e,variant:t,...s},r)=>l.jsx("div",{ref:r,role:"alert",className:Pr(Il({variant:t}),e),...s}));Dl.displayName="Alert";o.forwardRef(({className:e,...t},s)=>l.jsx("h5",{ref:s,className:Pr("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const Ll=o.forwardRef(({className:e,...t},s)=>l.jsx("div",{ref:s,className:Pr("text-sm [&_p]:leading-relaxed",e),...t}));function Ol(){const[e,t]=o.useState(""),[s,r]=o.useState(""),[a,n]=o.useState(!1),[i,c]=o.useState(!1),[d,u]=o.useState(!1),[m,h]=o.useState(null),p=L();o.useEffect(()=>{const{data:{subscription:e}}=Vr.auth.onAuthStateChange((e,t)=>{"PASSWORD_RECOVERY"===e&&c(!0)});return Vr.auth.getSession().then(({data:{session:e}})=>{e&&c(!0)}),()=>{e.unsubscribe()}},[]);return d?l.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:l.jsx(el,{className:"w-full max-w-md border-coffee-medium",children:l.jsx(al,{className:"pt-6",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx(Ue,{className:"w-16 h-16 text-green-600 mx-auto"}),l.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Mot de passe mis  jour !"}),l.jsx("p",{className:"text-gray-600",children:"Votre mot de passe a t mis  jour avec succs. Vous allez tre redirig vers la page de connexion."})]})})})}):i?l.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:l.jsxs("div",{className:"w-full max-w-md mx-auto",children:[l.jsxs("div",{className:"mb-8 text-center",children:[l.jsx(Zo,{src:"/branding/vread-logo.svg",alt:"VREAD Logo",className:"mx-auto mb-4 w-40 h-auto"}),l.jsx("p",{className:"text-logo-text text-lg mb-6",children:"Choisissez un nouveau mot de passe"})]}),l.jsxs(el,{className:"border-coffee-medium",children:[l.jsxs(tl,{children:[l.jsx(sl,{className:"text-2xl text-center",children:"Nouveau mot de passe"}),l.jsx(rl,{className:"text-center",children:"Saisissez votre nouveau mot de passe pour scuriser votre compte"})]}),l.jsx(al,{children:l.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),h(null),!e||!s)return void h("Veuillez remplir tous les champs");if(e!==s)return void h("Les mots de passe ne correspondent pas");const r=(e=>{if(e.length<8)return"Le mot de passe doit contenir au moins 8 caractres";const t=/[A-Z]/.test(e),s=/[a-z]/.test(e),r=/[0-9]/.test(e);return t&&s&&r?null:"Le mot de passe doit contenir au moins une majuscule, une minuscule et un chiffre"})(e);if(r)h(r);else{n(!0);try{const{error:t}=await Vr.auth.updateUser({password:e});if(t){if(t.message.includes("expired")||t.message.includes("invalid"))throw new Error("Le lien de rinitialisation a expir. Veuillez relancer une nouvelle demande.");throw t}u(!0),Yr.success("Mot de passe mis  jour avec succs!"),setTimeout(()=>{p("/auth")},2e3)}catch(a){h(a.message||"Erreur lors de la mise  jour. Veuillez ressayer."),Yr.error(a.message||"Erreur lors de la mise  jour")}finally{n(!1)}}},className:"space-y-4",children:[m&&l.jsxs(Dl,{variant:"destructive",children:[l.jsx(he,{className:"h-4 w-4"}),l.jsx(Ll,{children:m})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"password",children:"Nouveau mot de passe"}),l.jsx(On,{id:"password",type:"password",value:e,onChange:e=>t(e.target.value),className:"border-coffee-medium",placeholder:"Minimum 8 caractres",minLength:8,required:!0}),l.jsx("p",{className:"text-xs text-gray-500",children:"Au moins 8 caractres avec une majuscule, une minuscule et un chiffre"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"confirm-password",children:"Confirmer le mot de passe"}),l.jsx(On,{id:"confirm-password",type:"password",value:s,onChange:e=>r(e.target.value),className:"border-coffee-medium",placeholder:"Rptez le mot de passe",minLength:8,required:!0})]}),l.jsx(ya,{type:"submit",className:"w-full bg-coffee-dark hover:bg-coffee-darker",disabled:a,children:a?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}),"Mise  jour en cours..."]}):"Mettre  jour le mot de passe"})]})})]})]})}):l.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-logo-background p-4",children:l.jsx(el,{className:"w-full max-w-md border-coffee-medium",children:l.jsx(al,{className:"pt-6",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx(he,{className:"w-16 h-16 text-red-600 mx-auto"}),l.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Lien invalide ou expir"}),l.jsx("p",{className:"text-gray-600",children:"Le lien de rinitialisation est invalide ou a expir. Veuillez relancer une nouvelle demande de rinitialisation."}),l.jsx(ya,{onClick:()=>p("/auth"),className:"bg-coffee-dark hover:bg-coffee-darker",children:"Retour  la connexion"})]})})})})}async function Ml(e){try{const{data:t,error:s}=await Vr.from("followers").select("id",{count:"exact"}).eq("following_id",e);if(s)throw s;const{data:r,error:a}=await Vr.from("followers").select("id",{count:"exact"}).eq("follower_id",e);if(a)throw a;return{followers:t.length,following:r.length}}catch(t){return{followers:0,following:0}}}Ll.displayName="AlertDescription";let Vl=null;const zl=async()=>{if(Vl)return Vl;try{const{data:e,error:t}=await Vr.from("badges").select("id, slug, label, description, icon, color, rarity").order("created_at",{ascending:!0});return t?[]:(Vl=e||[],Vl)}catch(e){return[]}};let Ul=[];zl().then(e=>{Ul=e});const Bl=async(e,t)=>{try{const{data:s,error:r}=await Vr.from("user_badges").select("id").eq("user_id",e).eq("badge_id",t).maybeSingle();return!r&&!!s}catch(s){return!1}},Fl=async(e,t)=>{try{const s=await zl();if(!s.some(e=>e.id===t||e.slug===t))return!1;if(await Bl(e,t))return!0;const{data:r,error:a}=await Vr.from("user_badges").insert({user_id:e,badge_id:t,earned_at:(new Date).toISOString()}).select().single();if(a)return!1;const n=s.find(e=>e.id===t);return n&&Yr.success(`Nouveau badge dbloqu : ${n.label}`),!0}catch(s){return!1}},ql=async e=>{try{const{data:t,error:s}=await Vr.from("user_badges").select("\n        badge_id,\n        earned_at,\n        badges:badge_id (\n          id,\n          slug,\n          label,\n          description,\n          icon,\n          color,\n          rarity,\n          category\n        )\n      ").eq("user_id",e);if(s)return[];return t.filter(e=>e.badges).map(e=>{const t=e.badges;return{id:t.id,slug:t.slug,label:t.label,description:t.description,icon:t.icon,color:t.color,rarity:t.rarity,category:t.category,dateEarned:new Date(e.earned_at).toLocaleDateString("fr-FR")}})}catch(t){return[]}};async function $l(e){const{data:t,error:s}=await Vr.rpc("get_user_stats",{uid:e}).single();if(s)throw s;return{booksRead:t.books_read,pagesRead:t.pages_read,badgesCount:t.badges_count,streakCurrent:t.streak_current,streakBest:t.streak_best,questsDone:t.quests_done,xp:t.xp,lvl:t.lvl}}async function Wl(e){return(await $l(e)).booksRead}async function Hl(e){return(await $l(e)).pagesRead}async function Zl(e){const{count:t}=await Vr.from("reading_validations").select("id",{count:"exact",head:!0}).eq("user_id",e);return t||0}async function Gl(e){const t=2*(await $l(e)).pagesRead;return Math.round(t/60)}function Kl({targetUserId:e,onFollowChange:t,hideUnfollow:s=!1}){const[r,a]=o.useState(!1),[n,i]=o.useState(!1),{toast:c}=ia(),{user:d}=ha();if(o.useEffect(()=>{d&&d.id!==e&&async function(){try{const t=await async function(e){try{const{data:t}=await Vr.auth.getSession(),s=t.session?.user?.id;if(!s)return!1;const{data:r,error:a}=await Vr.from("followers").select("id").match({follower_id:s,following_id:e}).maybeSingle();if(a)throw a;return!!r}catch(t){return!1}}(e);a(t)}catch(t){}}()},[e,d]),!d||d.id===e||r&&s)return null;return l.jsx(ya,{onClick:async()=>{i(!0);try{r?(await async function(e){try{const{data:t}=await Vr.auth.getSession(),s=t.session?.user?.id;if(!s)throw new Error("User not authenticated");const{error:r}=await Vr.from("followers").delete().match({follower_id:s,following_id:e});if(r)throw r}catch(t){const e=t instanceof Error?t.message:"Could not unfollow user";throw new Error(e)}}(e),c({title:"Dsabonn",description:"Vous ne suivez plus cet utilisateur.",variant:"default"}),a(!1)):(await async function(e){try{const{data:s}=await Vr.auth.getSession(),r=s.session?.user?.id;if(!r)throw new Error("User not authenticated");const{error:a}=await Vr.from("followers").insert({follower_id:r,following_id:e});if(a)throw a;try{const{error:t}=await Vr.functions.invoke("send-follow-notification",{body:{followerId:r,followingId:e}})}catch(t){}}catch(s){const e=s instanceof Error?s.message:"Could not follow user";throw new Error(e)}}(e),c({title:"Abonn",description:"Vous suivez maintenant cet utilisateur.",variant:"default"}),a(!0)),t&&t()}catch(s){c({title:"Erreur",description:s.message||"Une erreur est survenue",variant:"destructive"})}finally{i(!1)}},disabled:n,variant:r?"outline":"default",size:"sm",className:"flex items-center gap-1 transition-all duration-300","aria-label":r?"Se dsabonner":"S'abonner",children:r?l.jsxs(l.Fragment,{children:[l.jsx(Be,{className:"h-4 w-4"}),l.jsx("span",{children:"Se dsabonner"})]}):l.jsxs(l.Fragment,{children:[l.jsx(Fe,{className:"h-4 w-4"}),l.jsx("span",{children:"S'abonner"})]})})}const Yl=$e,Ql=o.createContext({}),Xl=({...e})=>l.jsx(Ql.Provider,{value:{name:e.name},children:l.jsx(We,{...e})}),Jl=()=>{const e=o.useContext(Ql),t=o.useContext(ec),{getFieldState:s,formState:r}=qe(),a=s(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:n}=t;return{id:n,name:e.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...a}},ec=o.createContext({}),tc=o.forwardRef(({className:e,...t},s)=>{const r=o.useId();return l.jsx(ec.Provider,{value:{id:r},children:l.jsx("div",{ref:s,className:Pr("space-y-2",e),...t})})});tc.displayName="FormItem";const sc=o.forwardRef(({className:e,...t},s)=>{const{error:r,formItemId:a}=Jl();return l.jsx(Tl,{ref:s,className:Pr(r&&"text-destructive",e),htmlFor:a,...t})});sc.displayName="FormLabel";const rc=o.forwardRef(({...e},t)=>{const{error:s,formItemId:r,formDescriptionId:a,formMessageId:n}=Jl();return l.jsx(g,{ref:t,id:r,"aria-describedby":s?`${a} ${n}`:`${a}`,"aria-invalid":!!s,...e})});rc.displayName="FormControl";o.forwardRef(({className:e,...t},s)=>{const{formDescriptionId:r}=Jl();return l.jsx("p",{ref:s,id:r,className:Pr("text-sm text-muted-foreground",e),...t})}).displayName="FormDescription";const ac=o.forwardRef(({className:e,children:t,...s},r)=>{const{error:a,formMessageId:n}=Jl(),i=a?String(a?.message):t;return i?l.jsx("p",{ref:r,id:n,className:Pr("text-sm font-medium text-destructive",e),...s,children:i}):null});ac.displayName="FormMessage";const nc=(e,t,s)=>{if(e&&"reportValidity"in e){const r=He(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},ic=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?nc(r.ref,s,e):r.refs&&r.refs.forEach(t=>nc(t,s,e))}},oc=(e,t)=>{t.shouldUseNativeValidation&&ic(e,t);const s={};for(const r in e){const a=He(t.fields,r),n=Object.assign(e[r]||{},{ref:a&&a.ref});if(lc(t.names||Object.keys(e),r)){const e=Object.assign({},He(s,r));Ze(e,"root",n),Ze(s,r,e)}else Ze(s,r,n)}return s},lc=(e,t)=>e.some(e=>e.startsWith(t+"."));var cc=function(e,t){for(var s={};e.length;){var r=e[0],a=r.code,n=r.message,i=r.path.join(".");if(!s[i])if("unionErrors"in r){var o=r.unionErrors[0].errors[0];s[i]={message:o.message,type:o.code}}else s[i]={message:n,type:a};if("unionErrors"in r&&r.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var l=s[i].types,c=l&&l[r.code];s[i]=Ge(i,t,s,a,c?[].concat(c,r.message):r.message)}e.shift()}return s},dc=function(e,t,s){return void 0===s&&(s={}),function(r,a,n){try{return Promise.resolve(function(a,i){try{var o=Promise.resolve(e["sync"===s.mode?"parse":"parseAsync"](r,t)).then(function(e){return n.shouldUseNativeValidation&&ic({},n),{errors:{},values:s.raw?r:e}})}catch(l){return i(l)}return o&&o.then?o.then(void 0,i):o}(0,function(e){if(t=e,Array.isArray(null==t?void 0:t.errors))return{values:{},errors:oc(cc(e.errors,!n.shouldUseNativeValidation&&"all"===n.criteriaMode),n)};var t;throw e}))}catch(i){return Promise.reject(i)}}};const uc=Ro({username:Eo().min(3,"Le nom doit contenir au moins 3 caractres").max(50,"Le nom est trop long")});function mc({currentUsername:e,onSave:t}){const{user:s}=ha(),{toast:r}=ia(),[a,n]=o.useState(!1),i=Ke({resolver:dc(uc),defaultValues:{username:e||""}});return l.jsx(Yl,{...i,children:l.jsxs("form",{onSubmit:i.handleSubmit(async e=>{if(s?.id){n(!0);try{const{error:a}=await Vr.from("profiles").update({username:e.username}).eq("id",s.id);if(a)throw a;r({title:"Nom de profil enregistr",description:"Votre nom public a t mis  jour avec succs."}),t()}catch(a){r({title:"Erreur",description:a.message||"Une erreur est survenue lors de l'enregistrement du nom.",variant:"destructive"})}finally{n(!1)}}}),className:"space-y-4",children:[l.jsx(Xl,{control:i.control,name:"username",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{className:"text-coffee-darker",children:"Nom de profil"}),l.jsx(rc,{children:l.jsx(On,{placeholder:"Choisissez un nom public",className:"bg-background",...e})}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce nom sera visible par les autres utilisateurs."}),l.jsx(ac,{})]})}),l.jsx(ya,{type:"submit",className:"w-full bg-coffee-dark hover:bg-coffee-darker",disabled:a,children:a?"Enregistrement...":"Enregistrer mon nom de profil"})]})})}const hc=o.forwardRef(({className:e,...t},s)=>l.jsx(Ye,{className:Pr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:s,children:l.jsx(Qe,{className:Pr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));hc.displayName=Ye.displayName;const pc=mt,fc=ht,gc=o.forwardRef(({className:e,children:t,...s},r)=>l.jsxs(Xe,{ref:r,className:Pr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,l.jsx(Je,{asChild:!0,children:l.jsx(et,{className:"h-4 w-4 opacity-50"})})]}));gc.displayName=Xe.displayName;const xc=o.forwardRef(({className:e,...t},s)=>l.jsx(tt,{ref:s,className:Pr("flex cursor-default items-center justify-center py-1",e),...t,children:l.jsx(st,{className:"h-4 w-4"})}));xc.displayName=tt.displayName;const vc=o.forwardRef(({className:e,...t},s)=>l.jsx(rt,{ref:s,className:Pr("flex cursor-default items-center justify-center py-1",e),...t,children:l.jsx(et,{className:"h-4 w-4"})}));vc.displayName=rt.displayName;const bc=o.forwardRef(({className:e,children:t,position:s="popper",...r},a)=>l.jsx(at,{children:l.jsxs(nt,{ref:a,className:Pr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[l.jsx(xc,{}),l.jsx(it,{className:Pr("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),l.jsx(vc,{})]})}));bc.displayName=nt.displayName;o.forwardRef(({className:e,...t},s)=>l.jsx(ot,{ref:s,className:Pr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=ot.displayName;const yc=o.forwardRef(({className:e,children:t,...s},r)=>l.jsxs(lt,{ref:r,className:Pr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[l.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(ct,{children:l.jsx(G,{className:"h-4 w-4"})})}),l.jsx(dt,{children:t})]}));yc.displayName=lt.displayName;var wc,jc;o.forwardRef(({className:e,...t},s)=>l.jsx(ut,{ref:s,className:Pr("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=ut.displayName,(jc=wc||(wc={}))[jc.Sunday=1]="Sunday",jc[jc.Monday=2]="Monday",jc[jc.Tuesday=3]="Tuesday",jc[jc.Wednesday=4]="Wednesday",jc[jc.Thursday=5]="Thursday",jc[jc.Friday=6]="Friday",jc[jc.Saturday=7]="Saturday";const Nc=Ss("LocalNotifications",{web:()=>i(()=>import("./web-DfyDiBA2.js"),__vite__mapDeps([0,1,2,3])).then(e=>new e.LocalNotificationsWeb)});async function kc(e=20,t=0){await Nc.schedule({notifications:[{id:1001,title:"VREAD",body:"20 minutes de lecture ce soir ",schedule:{repeats:!0,on:{hour:e,minute:t}},smallIcon:"ic_stat_icon_config_sample"}]})}async function _c(){await Nc.cancel({notifications:[{id:1001}]})}function Sc(){const[e,t]=o.useState(!1),[s,r]=o.useState("20:00"),[a,n]=o.useState(!1);o.useEffect(()=>{const e=!!window.Capacitor;n(e),e&&async function(){const{display:e}=await Nc.checkPermissions();return"granted"===e}().then(t);const s=localStorage.getItem("reminder-time");s&&r(s)},[]);return a?l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(_e,{className:"h-5 w-5 text-coffee-dark"}),"Rappels de lecture"]})}),l.jsxs(al,{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"space-y-1",children:[l.jsx(Tl,{htmlFor:"notifications-toggle",className:"text-coffee-darker font-medium",children:"Rappel quotidien"}),l.jsx("p",{className:"text-sm text-coffee-darker/80",children:"Recevez un rappel pour votre session de lecture"})]}),l.jsx(hc,{id:"notifications-toggle",checked:e,onCheckedChange:async e=>{if(a)try{if(e){await async function(){const{display:e}=await Nc.checkPermissions();"granted"!==e&&await Nc.requestPermissions()}();const[e,t]=s.split(":").map(Number);await kc(e,t),Yr.success("Rappels de lecture activs")}else await _c(),Yr.success("Rappels de lecture dsactivs");t(e)}catch(r){Yr.error("Erreur lors de la configuration des notifications")}else Yr.error("Les notifications ne sont disponibles que dans l'application mobile")}})]}),e&&l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"reminder-time",className:"text-coffee-darker font-medium",children:"Heure du rappel"}),l.jsxs(pc,{value:s,onValueChange:async t=>{if(r(t),localStorage.setItem("reminder-time",t),e&&a)try{await _c();const[e,s]=t.split(":").map(Number);await kc(e,s),Yr.success("Heure du rappel mise  jour")}catch(s){Yr.error("Erreur lors de la mise  jour du rappel")}},children:[l.jsx(gc,{className:"w-full",children:l.jsx(fc,{})}),l.jsxs(bc,{children:[l.jsx(yc,{value:"18:00",children:"18h00"}),l.jsx(yc,{value:"19:00",children:"19h00"}),l.jsx(yc,{value:"20:00",children:"20h00"}),l.jsx(yc,{value:"21:00",children:"21h00"}),l.jsx(yc,{value:"22:00",children:"22h00"})]})]})]})]})]}):l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(_e,{className:"h-5 w-5 text-coffee-dark"}),"Notifications"]})}),l.jsx(al,{children:l.jsx("p",{className:"text-coffee-darker/80",children:"Les notifications de rappel sont disponibles uniquement dans l'application mobile VREAD."})})]})}function Ec(){const e=L();return l.jsxs("div",{className:"space-y-6",children:[l.jsx(Sc,{}),l.jsxs(el,{className:"border-coffee-light sticky top-20",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-xl font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(pt,{className:"h-5 w-5 text-coffee-dark"}),"Rglages"]})}),l.jsxs(al,{className:"space-y-4",children:[l.jsxs(ya,{variant:"outline",className:"w-full justify-start",children:[l.jsx(ft,{className:"h-4 w-4 mr-2"}),"Changer le mot de passe"]}),l.jsxs(ya,{variant:"outline",className:"w-full justify-start",onClick:()=>e("/legal/privacy"),children:[l.jsx(se,{className:"h-4 w-4 mr-2"}),"Politique de confidentialit"]}),l.jsxs(ya,{variant:"outline",className:"w-full justify-start",onClick:()=>e("/legal/terms"),children:[l.jsx(gt,{className:"h-4 w-4 mr-2"}),"Conditions d'utilisation"]}),l.jsxs(ya,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:()=>e("/settings/delete-account"),children:[l.jsx(De,{className:"h-4 w-4 mr-2"}),"Supprimer mon compte"]}),l.jsxs(ya,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:async()=>{try{const{error:t}=await Vr.auth.signOut();if(t)return void Yr.error("Erreur lors de la dconnexion");localStorage.clear(),Yr.success("Dconnexion russie"),e("/")}catch(t){Yr.error("Erreur lors de la dconnexion")}},children:[l.jsx(re,{className:"h-4 w-4 mr-2"}),"Se dconnecter"]})]})]})]})}function Cc(){const e=xt(),{user:t}=ha(),[s,r]=o.useState(null),[a,n]=o.useState({followers:0,following:0}),[i,c]=o.useState([]),[d,u]=o.useState([]),[m,h]=o.useState([]),[p,f]=o.useState({booksRead:0,totalPages:0,segmentsValidated:0,readingTime:0}),[g,x]=o.useState(!0),[b,y]=o.useState(!1),w=e.userId||t?.id,j=!e.userId||t&&t.id===e.userId;o.useEffect(()=>{w&&async function(){try{x(!0);const[e,t,s,a,i,o,l,d]=await Promise.all([la(w),Ml(w),ql(w),jl(w),j?Wl(w):Promise.resolve(0),j?Hl(w):Promise.resolve(0),j?Zl(w):Promise.resolve(0),j?Gl(w):Promise.resolve(0)]);if(r(e),n(t),c(s.slice(0,6)),a){const e=a.filter(e=>"in_progress"===e.status),t=a.filter(e=>"completed"===e.status||e.chaptersRead>=(e.totalChapters||e.expectedSegments||1)).slice(0,8);u(e),h(t)}j&&f({booksRead:i,totalPages:o,segmentsValidated:l,readingTime:d})}catch(e){}finally{x(!1)}}()},[w,j]);const N=ca(s?.username,s?.email||t?.email,w||"U");return g?l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("main",{className:"mx-auto w-full px-4 max-w-none py-8",children:l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-coffee-dark mx-auto"}),l.jsx("p",{className:"text-coffee-dark font-medium",children:"Chargement du profil..."})]})})})]})}):l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-coffee-light/20 via-background to-coffee-light/10",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-4 sm:py-8 px-4 sm:px-6 lg:px-8 space-y-6 sm:space-y-8",children:[l.jsx(el,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm shadow-xl overflow-hidden",children:l.jsx(al,{className:"p-4 sm:p-6 lg:p-8",children:l.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[l.jsxs("div",{className:"flex flex-col items-center lg:items-start text-center lg:text-left flex-shrink-0",children:[l.jsx(mn,{src:s?.avatar,alt:N,fallbackText:N,size:"xl",className:"border-4 border-coffee-light shadow-lg mb-4"}),j&&!b&&l.jsxs(ya,{variant:"outline",size:"sm",className:"mb-4 border-coffee-light hover:bg-coffee-light/20 text-xs sm:text-sm",onClick:()=>y(!0),children:[l.jsx(vt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),l.jsx("span",{className:"hidden sm:inline",children:s?.username?"Modifier mon nom":"Ajouter un nom"}),l.jsx("span",{className:"sm:hidden",children:s?.username?"Modifier":"Ajouter"})]})]}),l.jsx("div",{className:"flex-1 min-w-0 space-y-4 sm:space-y-6",children:b&&j?l.jsxs("div",{className:"space-y-4",children:[l.jsx(mc,{currentUsername:s?.username,onSave:async()=>{if(w)try{const e=await la(w);r(e),y(!1)}catch(e){}}}),l.jsx(ya,{variant:"ghost",onClick:()=>y(!1),className:"text-sm",children:"Annuler"})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"min-w-0",children:[l.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-serif font-bold text-coffee-darker mb-2 break-words",children:N}),l.jsx("p",{className:"text-coffee-medium text-sm sm:text-base lg:text-lg break-all",children:s?.email||t?.email})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-4 sm:gap-6",children:[l.jsxs(v,{to:`/followers/followers/${w}`,className:"flex items-center gap-2 group min-w-0",children:[l.jsx(I,{className:"h-4 w-4 sm:h-5 sm:w-5 text-coffee-dark flex-shrink-0"}),l.jsx("span",{className:"font-semibold text-coffee-darker text-sm sm:text-base lg:text-lg",children:a.followers}),l.jsx("span",{className:"text-coffee-medium group-hover:underline text-sm sm:text-base hidden sm:inline",children:"Abonns"}),l.jsx("span",{className:"text-coffee-medium group-hover:underline text-xs sm:hidden",children:"Abonns"})]}),l.jsxs(v,{to:`/followers/following/${w}`,className:"flex items-center gap-2 group min-w-0",children:[l.jsx(I,{className:"h-4 w-4 sm:h-5 sm:w-5 text-coffee-dark flex-shrink-0"}),l.jsx("span",{className:"font-semibold text-coffee-darker text-sm sm:text-base lg:text-lg",children:a.following}),l.jsx("span",{className:"text-coffee-medium group-hover:underline text-sm sm:text-base hidden sm:inline",children:"Abonnements"}),l.jsx("span",{className:"text-coffee-medium group-hover:underline text-xs sm:hidden",children:"Suivis"})]}),!j&&w&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(Kl,{targetUserId:w})}),j&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(v,{to:"/settings/delete-account",className:"text-xs text-muted-foreground hover:text-destructive transition-colors underline-offset-4 hover:underline",children:"Supprimer mon compte"})})]}),j&&l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[l.jsx(be,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),l.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:p.booksRead}),l.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium break-words",children:"Livres termins"})]}),l.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[l.jsx(bt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),l.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:p.segmentsValidated}),l.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium",children:"Validations"})]}),l.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[l.jsx(yt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),l.jsxs("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:[Math.floor(p.readingTime/60),"h"]}),l.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium break-words",children:"Temps de lecture"})]}),l.jsxs("div",{className:"text-center p-2 sm:p-3 bg-coffee-light/20 rounded-lg min-w-0",children:[l.jsx(wt,{className:"h-4 w-4 sm:h-6 sm:w-6 text-coffee-dark mx-auto mb-1"}),l.jsx("div",{className:"text-lg sm:text-2xl font-bold text-coffee-darker",children:p.totalPages}),l.jsx("div",{className:"text-xs sm:text-sm text-coffee-medium",children:"Pages lues"})]})]})]})})]})})}),l.jsxs(kn,{defaultValue:"overview",className:"space-y-4 sm:space-y-6 w-full",children:[l.jsx("div",{className:"w-full overflow-x-auto scrollbar-hide",children:l.jsxs(_n,{className:"bg-white/80 backdrop-blur-sm border border-coffee-light/50 p-1 inline-flex min-w-full sm:min-w-0 justify-start sm:justify-center",children:[l.jsxs(Sn,{value:"overview",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:[l.jsx("span",{className:"hidden sm:inline",children:"Vue d'ensemble"}),l.jsx("span",{className:"sm:hidden",children:"Aperu"})]}),l.jsx(Sn,{value:"books",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:"Livres"}),l.jsx(Sn,{value:"badges",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:"Badges"}),j&&l.jsxs(Sn,{value:"settings",className:"data-[state=active]:bg-coffee-light data-[state=active]:text-coffee-darker text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap",children:[l.jsx("span",{className:"hidden sm:inline",children:"Paramtres"}),l.jsx("span",{className:"sm:hidden",children:"Config"})]})]})}),l.jsxs(En,{value:"overview",className:"space-y-4 sm:space-y-6 mt-0",children:[d.length>0&&l.jsxs(el,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[l.jsx(tl,{className:"pb-3 sm:pb-4",children:l.jsxs(sl,{className:"text-lg sm:text-xl font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(be,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),l.jsx("span",{className:"break-words",children:"Lecture en cours"})]})}),l.jsx(al,{className:"pt-0",children:l.jsx("div",{className:"space-y-3 sm:space-y-4",children:d.slice(0,2).map(e=>l.jsxs("div",{className:"flex gap-3 sm:gap-4 p-3 sm:p-4 bg-coffee-light/10 rounded-lg overflow-hidden",children:[l.jsx("div",{className:"w-12 h-16 sm:w-16 sm:h-20 bg-coffee-light rounded flex-shrink-0"}),l.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[l.jsx("h4",{className:"font-medium text-coffee-darker text-sm sm:text-base break-words line-clamp-2",children:e.book_title}),l.jsx("p",{className:"text-xs sm:text-sm text-coffee-medium break-words line-clamp-1",children:e.book_author}),l.jsx(Ho,{value:e.progressPercent||0,className:"h-1.5 sm:h-2"}),l.jsxs("p",{className:"text-xs text-coffee-medium",children:[e.progressPercent||0,"% termin"]})]})]},e.id))})})]}),i.length>0&&l.jsxs(el,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[l.jsxs(tl,{className:"flex flex-row items-center justify-between space-y-0 pb-3 sm:pb-4",children:[l.jsxs(sl,{className:"text-lg sm:text-xl font-serif text-coffee-darker flex items-center gap-2 min-w-0",children:[l.jsx(jt,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0"}),l.jsx("span",{className:"break-words",children:"Badges rcents"})]}),l.jsx(ya,{variant:"outline",size:"sm",asChild:!0,className:"flex-shrink-0 text-xs sm:text-sm",children:l.jsxs(v,{to:"/achievements",children:[l.jsx("span",{className:"hidden sm:inline",children:"Voir tout"}),l.jsx("span",{className:"sm:hidden",children:"Tout"})]})})]}),l.jsx(al,{className:"pt-0",children:l.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-3 sm:gap-4",children:i.map(e=>l.jsxs("div",{className:"text-center group",children:[l.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-coffee-light to-coffee-medium rounded-full mx-auto mb-2 flex items-center justify-center text-lg sm:text-2xl group-hover:scale-110 transition-transform",children:e.icon||""}),l.jsx("p",{className:"text-xs text-coffee-darker font-medium line-clamp-2 break-words",children:e.label})]},e.id))})})]})]}),l.jsx(En,{value:"books",className:"space-y-4 sm:space-y-6 mt-0",children:l.jsxs(el,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[l.jsx(tl,{className:"pb-3 sm:pb-4",children:l.jsxs(sl,{className:"text-lg sm:text-xl font-serif text-coffee-darker break-words",children:["Livres termins (",m.length,")"]})}),l.jsx(al,{className:"pt-0",children:m.length>0?l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3 sm:gap-4",children:m.map(e=>l.jsxs(v,{to:`/books/${e.book_id}`,className:"group",children:[l.jsx("div",{className:"w-full aspect-[3/4] bg-coffee-light rounded-lg group-hover:scale-105 transition-transform"}),l.jsx("p",{className:"text-xs text-coffee-darker font-medium mt-2 line-clamp-2 break-words",children:e.book_title})]},e.id))}):l.jsx("div",{className:"text-center py-8 sm:py-12 text-coffee-medium",children:l.jsx("p",{className:"text-sm sm:text-base",children:"Aucun livre termin pour le moment"})})})]})}),l.jsx(En,{value:"badges",className:"mt-0",children:l.jsxs(el,{className:"border-coffee-light/50 bg-white/80 backdrop-blur-sm overflow-hidden",children:[l.jsx(tl,{className:"pb-3 sm:pb-4",children:l.jsxs(sl,{className:"text-lg sm:text-xl font-serif text-coffee-darker break-words",children:["Tous les badges (",i.length,")"]})}),l.jsx(al,{className:"pt-0",children:i.length>0?l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6",children:i.map(e=>l.jsxs("div",{className:"text-center p-3 sm:p-4 bg-coffee-light/10 rounded-lg",children:[l.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-coffee-light to-coffee-medium rounded-full mx-auto mb-3 flex items-center justify-center text-2xl sm:text-3xl",children:e.icon||""}),l.jsx("h4",{className:"font-medium text-coffee-darker mb-1 text-sm sm:text-base break-words",children:e.label}),l.jsx("p",{className:"text-xs sm:text-sm text-coffee-medium line-clamp-2 break-words",children:e.description})]},e.id))}):l.jsx("div",{className:"text-center py-8 sm:py-12 text-coffee-medium",children:l.jsx("p",{className:"text-sm sm:text-base",children:"Aucun badge obtenu pour le moment"})})})]})}),j&&l.jsx(En,{value:"settings",className:"mt-0",children:l.jsx("div",{className:"overflow-hidden",children:l.jsx(Ec,{})})})]})]})]})})}const Rc=({title:e})=>l.jsx(tl,{children:l.jsx(sl,{className:"text-h2 font-serif text-coffee-darker",children:e})}),Tc=({book:e})=>{const t=e?.coverImage||e?.cover_url||e?.book_cover;return l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"book-cover w-32 h-48 flex-shrink-0",children:t?l.jsx(Zo,{src:t,alt:e.title,className:"w-full h-full object-cover",sizes:"(max-width: 768px) 120px, 128px"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-chocolate-medium",children:l.jsx("span",{className:"text-white font-serif italic text-h1",children:e.title.substring(0,1)})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-h4 font-medium text-coffee-darker",children:e.title}),l.jsx("p",{className:"text-body-sm text-muted-foreground",children:e.author}),l.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(e.categories||e.tags||[]).map((e,t)=>l.jsx("span",{className:"px-2 py-1 bg-coffee-light/30 text-coffee-darker rounded-full text-caption",children:e},t))})]})]})},Ac=({description:e})=>l.jsx("p",{className:"text-body text-coffee-darker",children:e}),Pc=o.forwardRef(({progressPercent:e,jokersUsed:t=0,jokersAllowed:s=0},r)=>(o.useEffect(()=>{e>0&&r&&"function"!=typeof r&&r.current&&setTimeout(()=>{r.current?.scrollIntoView({behavior:"smooth",block:"center"})},350)},[e,r]),l.jsxs("div",{ref:r,className:"my-3",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Ho,{value:e}),l.jsxs("span",{className:"text-caption font-medium text-coffee-darker",children:[e,"%"]})]}),s>0&&l.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[l.jsx(Nt,{className:"h-3 w-3 text-amber-500"}),l.jsxs("span",{className:"text-caption text-muted-foreground",children:["Jokers : ",t," / ",s," utiliss"]})]}),e>0&&e<100&&l.jsx("div",{className:"flex justify-center mt-1 animate-bounce",children:l.jsx(et,{className:"h-4 w-4 text-coffee-medium opacity-60"})})]})));Pc.displayName="BookProgressBar";const Ic=S,Dc=E,Lc=y,Oc=o.forwardRef(({className:e,...t},s)=>l.jsx(b,{ref:s,className:Pr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Oc.displayName=b.displayName;const Mc=o.forwardRef(({className:e,children:t,...s},r)=>l.jsxs(Lc,{children:[l.jsx(Oc,{}),l.jsxs(w,{ref:r,className:Pr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[t,l.jsxs(j,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[l.jsx(N,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Mc.displayName=w.displayName;const Vc=({className:e,...t})=>l.jsx("div",{className:Pr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Vc.displayName="DialogHeader";const zc=({className:e,...t})=>l.jsx("div",{className:Pr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});zc.displayName="DialogFooter";const Uc=o.forwardRef(({className:e,...t},s)=>l.jsx(k,{ref:s,className:Pr("text-lg font-semibold leading-none tracking-tight",e),...t}));Uc.displayName=k.displayName;const Bc=o.forwardRef(({className:e,...t},s)=>l.jsx(_,{ref:s,className:Pr("text-sm text-muted-foreground",e),...t}));Bc.displayName=_.displayName;const Fc=o.forwardRef(({className:e,...t},s)=>l.jsx(kt,{ref:s,className:Pr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:l.jsx(_t,{className:Pr("flex items-center justify-center text-current"),children:l.jsx(G,{className:"h-4 w-4"})})}));function qc({remainingSeconds:e,onExpire:t}){const[s,r]=o.useState(e),a=o.useCallback(()=>{const e=Math.floor(s/3600),t=Math.floor(s%3600/60),r=s%60;let a;return a=e>0?`${e} heure${e>1?"s":""} et ${t} minute${t>1?"s":""}`:t>0?`${t} minute${t>1?"s":""} et ${r} seconde${r>1?"s":""}`:`${r} seconde${r>1?"s":""}`,a},[s]);o.useEffect(()=>{if(s<=0)return void t();const e=setInterval(()=>{r(s=>s<=1?(clearInterval(e),setTimeout(t,0),0):s-1)},1e3);return()=>clearInterval(e)},[s,t]);const n=a();return l.jsx(Dl,{className:"bg-amber-50 border-amber-200",children:l.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[l.jsx(yt,{className:"h-4 w-4"}),l.jsxs(Ll,{className:"text-body-sm",children:["Vous pourrez ressayer dans ",l.jsx("span",{className:"font-medium",children:n})]})]})})}function $c({bookTitle:e,segment:t,isOpen:s,isValidating:r,isLocked:a=!1,remainingLockTime:n=null,jokersUsed:i=0,jokersAllowed:c=0,onClose:d,onValidate:u,onLockExpire:m}){const[h,p]=o.useState(!1);return l.jsx(Ic,{open:s,onOpenChange:d,"aria-labelledby":"validation-modal-title","aria-describedby":"validation-modal-description",children:l.jsxs(Mc,{className:"sm:max-w-md border-coffee-medium",role:"dialog","aria-modal":"true",children:[l.jsxs(Vc,{children:[l.jsxs(Uc,{id:"validation-modal-title",className:"text-center text-coffee-darker font-serif",children:["Validation de lecture : pages ",30*(t-1)+1,"-",30*t]}),l.jsxs(Bc,{id:"validation-modal-description",className:"text-center text-body-sm text-foreground/80",children:['Confirmez votre lecture de "',e,'"']})]}),l.jsxs("div",{className:"py-4 space-y-4",children:[l.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg border border-coffee-light",children:[l.jsxs("div",{className:"flex items-center gap-2 text-body-sm text-muted-foreground",children:[l.jsx(Nt,{className:"h-4 w-4"}),l.jsxs("span",{className:i>=c?"text-muted-foreground line-through":"","data-testid":"jokers-remaining",children:["Jokers disponibles : ",Math.max(0,c-i)," / ",c]})]}),0===c&&l.jsx("p",{className:"text-caption text-muted-foreground mt-1",children:"Jokers disponibles  partir de 3 segments"}),c>0&&i>=c&&l.jsx("p",{className:"text-caption text-muted-foreground mt-1",children:"Tous vos jokers ont t utiliss pour ce livre"})]}),a&&n&&n>0?l.jsx("div",{role:"status","aria-live":"polite",children:l.jsx(qc,{remainingSeconds:n,onExpire:()=>m?.()})}):l.jsxs("div",{className:"flex items-start space-x-2",children:[l.jsx(Fc,{id:"hasRead",checked:h,onCheckedChange:e=>p(e),"aria-describedby":"checkbox-description"}),l.jsxs("div",{className:"grid gap-1.5 leading-none",children:[l.jsx(Tl,{htmlFor:"hasRead",className:"text-body-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-foreground",children:"J'ai lu ces pages et je souhaite valider cette tape"}),l.jsx("p",{id:"checkbox-description",className:"text-caption text-foreground/70",children:"Cochez cette case pour confirmer que vous avez termin la lecture de cette section"})]})]})]}),l.jsxs(zc,{className:"sm:justify-center gap-2",children:[l.jsx(ya,{variant:"outline",onClick:d,className:"border-coffee-medium text-foreground hover:bg-muted","aria-label":"Annuler la validation de lecture",children:"Annuler"}),!a&&l.jsx(ya,{onClick:()=>{h&&u()},disabled:!h||r,className:"bg-coffee-dark hover:bg-coffee-darker text-white","aria-label":r?"Validation en cours":"Valider cette tape de lecture","aria-describedby":h?void 0:"validation-requirement",children:r?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"h-4 w-4 mr-2 animate-spin","aria-hidden":"true"}),l.jsx("span",{children:"Validation..."})]}):"Valider cette tape"}),!h&&l.jsx("div",{id:"validation-requirement",className:"sr-only","aria-live":"polite",children:"Vous devez cocher la case pour valider votre lecture"})]})]})})}Fc.displayName=kt.displayName;const Wc=o.createContext({});function Hc(e){const t=o.useRef(null);return null===t.current&&(t.current=e()),t.current}const Zc="undefined"!=typeof window,Gc=Zc?o.useLayoutEffect:o.useEffect,Kc=o.createContext(null);function Yc(e,t){-1===e.indexOf(t)&&e.push(t)}function Qc(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}const Xc=(e,t,s)=>s>t?t:s<e?e:s;const Jc={},ed=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function td(e){return"object"==typeof e&&null!==e}const sd=e=>/^0[^.\s]+$/u.test(e);function rd(e){let t;return()=>(void 0===t&&(t=e()),t)}const ad=e=>e,nd=(e,t)=>s=>t(e(s)),id=(...e)=>e.reduce(nd),od=(e,t,s)=>{const r=t-e;return 0===r?1:(s-e)/r};class ld{constructor(){this.subscriptions=[]}add(e){return Yc(this.subscriptions,e),()=>Qc(this.subscriptions,e)}notify(e,t,s){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,s);else for(let a=0;a<r;a++){const r=this.subscriptions[a];r&&r(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const cd=e=>1e3*e,dd=e=>e/1e3;function ud(e,t){return t?e*(1e3/t):0}const md=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function hd(e,t,s,r){if(e===t&&s===r)return ad;const a=t=>function(e,t,s,r,a){let n,i,o=0;do{i=t+(s-t)/2,n=md(i,r,a)-e,n>0?s=i:t=i}while(Math.abs(n)>1e-7&&++o<12);return i}(t,0,1,e,s);return e=>0===e||1===e?e:md(a(e),t,r)}const pd=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,fd=e=>t=>1-e(1-t),gd=hd(.33,1.53,.69,.99),xd=fd(gd),vd=pd(xd),bd=e=>(e*=2)<1?.5*xd(e):.5*(2-Math.pow(2,-10*(e-1))),yd=e=>1-Math.sin(Math.acos(e)),wd=fd(yd),jd=pd(yd),Nd=hd(.42,0,1,1),kd=hd(0,0,.58,1),_d=hd(.42,0,.58,1),Sd=e=>Array.isArray(e)&&"number"==typeof e[0],Ed={linear:ad,easeIn:Nd,easeInOut:_d,easeOut:kd,circIn:yd,circInOut:jd,circOut:wd,backIn:xd,backInOut:vd,backOut:gd,anticipate:bd},Cd=e=>{if(Sd(e)){e.length;const[t,s,r,a]=e;return hd(t,s,r,a)}return"string"==typeof e?Ed[e]:e},Rd=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Td(e,t){let s=!1,r=!0;const a={delta:0,timestamp:0,isProcessing:!1},n=()=>s=!0,i=Rd.reduce((e,t)=>(e[t]=function(e){let t=new Set,s=new Set,r=!1,a=!1;const n=new WeakSet;let i={delta:0,timestamp:0,isProcessing:!1};function o(t){n.has(t)&&(l.schedule(t),e()),t(i)}const l={schedule:(e,a=!1,i=!1)=>{const o=i&&r?t:s;return a&&n.add(e),o.has(e)||o.add(e),e},cancel:e=>{s.delete(e),n.delete(e)},process:e=>{i=e,r?a=!0:(r=!0,[t,s]=[s,t],t.forEach(o),t.clear(),r=!1,a&&(a=!1,l.process(e)))}};return l}(n),e),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:d,update:u,preRender:m,render:h,postRender:p}=i,f=()=>{const n=Jc.useManualTiming?a.timestamp:performance.now();s=!1,Jc.useManualTiming||(a.delta=r?1e3/60:Math.max(Math.min(n-a.timestamp,40),1)),a.timestamp=n,a.isProcessing=!0,o.process(a),l.process(a),c.process(a),d.process(a),u.process(a),m.process(a),h.process(a),p.process(a),a.isProcessing=!1,s&&t&&(r=!1,e(f))};return{schedule:Rd.reduce((t,n)=>{const o=i[n];return t[n]=(t,n=!1,i=!1)=>(s||(s=!0,r=!0,a.isProcessing||e(f)),o.schedule(t,n,i)),t},{}),cancel:e=>{for(let t=0;t<Rd.length;t++)i[Rd[t]].cancel(e)},state:a,steps:i}}const{schedule:Ad,cancel:Pd,state:Id,steps:Dd}=Td("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:ad,!0);let Ld;function Od(){Ld=void 0}const Md={now:()=>(void 0===Ld&&Md.set(Id.isProcessing||Jc.useManualTiming?Id.timestamp:performance.now()),Ld),set:e=>{Ld=e,queueMicrotask(Od)}},Vd=e=>t=>"string"==typeof t&&t.startsWith(e),zd=Vd("--"),Ud=Vd("var(--"),Bd=e=>!!Ud(e)&&Fd.test(e.split("/*")[0].trim()),Fd=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qd={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},$d={...qd,transform:e=>Xc(0,1,e)},Wd={...qd,default:1},Hd=e=>Math.round(1e5*e)/1e5,Zd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Gd=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Kd=(e,t)=>s=>Boolean("string"==typeof s&&Gd.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),Yd=(e,t,s)=>r=>{if("string"!=typeof r)return r;const[a,n,i,o]=r.match(Zd);return{[e]:parseFloat(a),[t]:parseFloat(n),[s]:parseFloat(i),alpha:void 0!==o?parseFloat(o):1}},Qd={...qd,transform:e=>Math.round((e=>Xc(0,255,e))(e))},Xd={test:Kd("rgb","red"),parse:Yd("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:r=1})=>"rgba("+Qd.transform(e)+", "+Qd.transform(t)+", "+Qd.transform(s)+", "+Hd($d.transform(r))+")"};const Jd={test:Kd("#"),parse:function(e){let t="",s="",r="",a="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),r=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),r=e.substring(3,4),a=e.substring(4,5),t+=t,s+=s,r+=r,a+=a),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(r,16),alpha:a?parseInt(a,16)/255:1}},transform:Xd.transform},eu=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),tu=eu("deg"),su=eu("%"),ru=eu("px"),au=eu("vh"),nu=eu("vw"),iu=(()=>({...su,parse:e=>su.parse(e)/100,transform:e=>su.transform(100*e)}))(),ou={test:Kd("hsl","hue"),parse:Yd("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:r=1})=>"hsla("+Math.round(e)+", "+su.transform(Hd(t))+", "+su.transform(Hd(s))+", "+Hd($d.transform(r))+")"},lu={test:e=>Xd.test(e)||Jd.test(e)||ou.test(e),parse:e=>Xd.test(e)?Xd.parse(e):ou.test(e)?ou.parse(e):Jd.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Xd.transform(e):ou.transform(e),getAnimatableNone:e=>{const t=lu.parse(e);return t.alpha=0,lu.transform(t)}},cu=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const du="number",uu="color",mu=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function hu(e){const t=e.toString(),s=[],r={color:[],number:[],var:[]},a=[];let n=0;const i=t.replace(mu,e=>(lu.test(e)?(r.color.push(n),a.push(uu),s.push(lu.parse(e))):e.startsWith("var(")?(r.var.push(n),a.push("var"),s.push(e)):(r.number.push(n),a.push(du),s.push(parseFloat(e))),++n,"${}")).split("${}");return{values:s,split:i,indexes:r,types:a}}function pu(e){return hu(e).values}function fu(e){const{split:t,types:s}=hu(e),r=t.length;return e=>{let a="";for(let n=0;n<r;n++)if(a+=t[n],void 0!==e[n]){const t=s[n];a+=t===du?Hd(e[n]):t===uu?lu.transform(e[n]):e[n]}return a}}const gu=e=>"number"==typeof e?0:lu.test(e)?lu.getAnimatableNone(e):e;const xu={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(Zd)?.length||0)+(e.match(cu)?.length||0)>0},parse:pu,createTransformer:fu,getAnimatableNone:function(e){const t=pu(e);return fu(e)(t.map(gu))}};function vu(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function bu(e,t){return s=>s>0?t:e}const yu=(e,t,s)=>e+(t-e)*s,wu=(e,t,s)=>{const r=e*e,a=s*(t*t-r)+r;return a<0?0:Math.sqrt(a)},ju=[Jd,Xd,ou];function Nu(e){const t=(s=e,ju.find(e=>e.test(s)));var s;if(!Boolean(t))return!1;let r=t.parse(e);return t===ou&&(r=function({hue:e,saturation:t,lightness:s,alpha:r}){e/=360,s/=100;let a=0,n=0,i=0;if(t/=100){const r=s<.5?s*(1+t):s+t-s*t,o=2*s-r;a=vu(o,r,e+1/3),n=vu(o,r,e),i=vu(o,r,e-1/3)}else a=n=i=s;return{red:Math.round(255*a),green:Math.round(255*n),blue:Math.round(255*i),alpha:r}}(r)),r}const ku=(e,t)=>{const s=Nu(e),r=Nu(t);if(!s||!r)return bu(e,t);const a={...s};return e=>(a.red=wu(s.red,r.red,e),a.green=wu(s.green,r.green,e),a.blue=wu(s.blue,r.blue,e),a.alpha=yu(s.alpha,r.alpha,e),Xd.transform(a))},_u=new Set(["none","hidden"]);function Su(e,t){return s=>yu(e,t,s)}function Eu(e){return"number"==typeof e?Su:"string"==typeof e?Bd(e)?bu:lu.test(e)?ku:Tu:Array.isArray(e)?Cu:"object"==typeof e?lu.test(e)?ku:Ru:bu}function Cu(e,t){const s=[...e],r=s.length,a=e.map((e,s)=>Eu(e)(e,t[s]));return e=>{for(let t=0;t<r;t++)s[t]=a[t](e);return s}}function Ru(e,t){const s={...e,...t},r={};for(const a in s)void 0!==e[a]&&void 0!==t[a]&&(r[a]=Eu(e[a])(e[a],t[a]));return e=>{for(const t in r)s[t]=r[t](e);return s}}const Tu=(e,t)=>{const s=xu.createTransformer(t),r=hu(e),a=hu(t);return r.indexes.var.length===a.indexes.var.length&&r.indexes.color.length===a.indexes.color.length&&r.indexes.number.length>=a.indexes.number.length?_u.has(e)&&!a.values.length||_u.has(t)&&!r.values.length?function(e,t){return _u.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):id(Cu(function(e,t){const s=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const n=t.types[a],i=e.indexes[n][r[n]],o=e.values[i]??0;s[a]=o,r[n]++}return s}(r,a),a.values),s):bu(e,t)};function Au(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return yu(e,t,s);return Eu(e)(e,t)}const Pu=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>Ad.update(t,e),stop:()=>Pd(t),now:()=>Id.isProcessing?Id.timestamp:Md.now()}},Iu=(e,t,s=10)=>{let r="";const a=Math.max(Math.round(t/s),2);for(let n=0;n<a;n++)r+=Math.round(1e4*e(n/(a-1)))/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},Du=2e4;function Lu(e){let t=0;let s=e.next(t);for(;!s.done&&t<Du;)t+=50,s=e.next(t);return t>=Du?1/0:t}function Ou(e,t,s){const r=Math.max(t-5,0);return ud(s-e(r),t-r)}const Mu=100,Vu=10,zu=1,Uu=0,Bu=800,Fu=.3,qu=.3,$u={granular:.01,default:2},Wu={granular:.005,default:.5},Hu=.01,Zu=10,Gu=.05,Ku=1,Yu=.001;function Qu({duration:e=Bu,bounce:t=Fu,velocity:s=Uu,mass:r=zu}){let a,n,i=1-t;i=Xc(Gu,Ku,i),e=Xc(Hu,Zu,dd(e)),i<1?(a=t=>{const r=t*i,a=r*e,n=r-s,o=Ju(t,i),l=Math.exp(-a);return Yu-n/o*l},n=t=>{const r=t*i*e,n=r*s+s,o=Math.pow(i,2)*Math.pow(t,2)*e,l=Math.exp(-r),c=Ju(Math.pow(t,2),i);return(-a(t)+Yu>0?-1:1)*((n-o)*l)/c}):(a=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,n=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let r=s;for(let a=1;a<Xu;a++)r-=e(r)/t(r);return r}(a,n,5/e);if(e=cd(e),isNaN(o))return{stiffness:Mu,damping:Vu,duration:e};{const t=Math.pow(o,2)*r;return{stiffness:t,damping:2*i*Math.sqrt(r*t),duration:e}}}const Xu=12;function Ju(e,t){return e*Math.sqrt(1-t*t)}const em=["duration","bounce"],tm=["stiffness","damping","mass"];function sm(e,t){return t.some(t=>void 0!==e[t])}function rm(e=qu,t=Fu){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:a}=s;const n=s.keyframes[0],i=s.keyframes[s.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:u,velocity:m,isResolvedFromDuration:h}=function(e){let t={velocity:Uu,stiffness:Mu,damping:Vu,mass:zu,isResolvedFromDuration:!1,...e};if(!sm(e,tm)&&sm(e,em))if(e.visualDuration){const s=e.visualDuration,r=2*Math.PI/(1.2*s),a=r*r,n=2*Xc(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:zu,stiffness:a,damping:n}}else{const s=Qu(e);t={...t,...s,mass:zu},t.isResolvedFromDuration=!0}return t}({...s,velocity:-dd(s.velocity||0)}),p=m||0,f=c/(2*Math.sqrt(l*d)),g=i-n,x=dd(Math.sqrt(l/d)),v=Math.abs(g)<5;let b;if(r||(r=v?$u.granular:$u.default),a||(a=v?Wu.granular:Wu.default),f<1){const e=Ju(x,f);b=t=>{const s=Math.exp(-f*x*t);return i-s*((p+f*x*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===f)b=e=>i-Math.exp(-x*e)*(g+(p+x*g)*e);else{const e=x*Math.sqrt(f*f-1);b=t=>{const s=Math.exp(-f*x*t),r=Math.min(e*t,300);return i-s*((p+f*x*g)*Math.sinh(r)+e*g*Math.cosh(r))/e}}const y={calculatedDuration:h&&u||null,next:e=>{const t=b(e);if(h)o.done=e>=u;else{let s=0===e?p:0;f<1&&(s=0===e?cd(p):Ou(b,e,t));const n=Math.abs(s)<=r,l=Math.abs(i-t)<=a;o.done=n&&l}return o.value=o.done?i:t,o},toString:()=>{const e=Math.min(Lu(y),Du),t=Iu(t=>y.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return y}function am({keyframes:e,velocity:t=0,power:s=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:n=500,modifyTarget:i,min:o,max:l,restDelta:c=.5,restSpeed:d}){const u=e[0],m={done:!1,value:u},h=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let p=s*t;const f=u+p,g=void 0===i?f:i(f);g!==f&&(p=g-u);const x=e=>-p*Math.exp(-e/r),v=e=>g+x(e),b=e=>{const t=x(e),s=v(e);m.done=Math.abs(t)<=c,m.value=m.done?g:s};let y,w;const j=e=>{var t;(t=m.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(y=e,w=rm({keyframes:[m.value,h(m.value)],velocity:Ou(v,e,m.value),damping:a,stiffness:n,restDelta:c,restSpeed:d}))};return j(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==y||(t=!0,b(e),j(e)),void 0!==y&&e>=y?w.next(e-y):(!t&&b(e),m)}}}function nm(e,t,{clamp:s=!0,ease:r,mixer:a}={}){const n=e.length;if(t.length,1===n)return()=>t[0];if(2===n&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[n-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const r=[],a=s||Jc.mix||Au,n=e.length-1;for(let i=0;i<n;i++){let s=a(e[i],e[i+1]);if(t){const e=Array.isArray(t)?t[i]||ad:t;s=id(e,s)}r.push(s)}return r}(t,r,a),l=o.length,c=s=>{if(i&&s<e[0])return t[0];let r=0;if(l>1)for(;r<e.length-2&&!(s<e[r+1]);r++);const a=od(e[r],e[r+1],s);return o[r](a)};return s?t=>c(Xc(e[0],e[n-1],t)):c}function im(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let r=1;r<=t;r++){const a=od(0,t,r);e.push(yu(s,1,a))}}(t,e.length-1),t}function om({duration:e=300,keyframes:t,times:s,ease:r="easeInOut"}){const a=(e=>Array.isArray(e)&&"number"!=typeof e[0])(r)?r.map(Cd):Cd(r),n={done:!1,value:t[0]},i=function(e,t){return e.map(e=>e*t)}(s&&s.length===t.length?s:im(t),e),o=nm(i,t,{ease:Array.isArray(a)?a:(l=t,c=a,l.map(()=>c||_d).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(n.value=o(t),n.done=t>=e,n)}}rm.applyToOptions=e=>{const t=function(e,t=100,s){const r=s({...e,keyframes:[0,t]}),a=Math.min(Lu(r),Du);return{type:"keyframes",ease:e=>r.next(a*e).value/t,duration:dd(a)}}(e,100,rm);return e.ease=t.ease,e.duration=cd(t.duration),e.type="keyframes",e};const lm=e=>null!==e;function cm(e,{repeat:t,repeatType:s="loop"},r,a=1){const n=e.filter(lm),i=a<0||t&&"loop"!==s&&t%2==1?0:n.length-1;return i&&void 0!==r?r:n[i]}const dm={decay:am,inertia:am,tween:om,keyframes:om,spring:rm};function um(e){"string"==typeof e.type&&(e.type=dm[e.type])}class mm{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const hm=e=>e/100;class pm extends mm{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Md.now()&&this.tick(Md.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;um(e);const{type:t=om,repeat:s=0,repeatDelay:r=0,repeatType:a,velocity:n=0}=e;let{keyframes:i}=e;const o=t||om;o!==om&&"number"!=typeof i[0]&&(this.mixKeyframes=id(hm,Au(i[0],i[1])),i=[0,100]);const l=o({...e,keyframes:i});"mirror"===a&&(this.mirroredGenerator=o({...e,keyframes:[...i].reverse(),velocity:-n})),null===l.calculatedDuration&&(l.calculatedDuration=Lu(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+r,this.totalDuration=this.resolvedDuration*(s+1)-r,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:r,mixKeyframes:a,mirroredGenerator:n,resolvedDuration:i,calculatedDuration:o}=this;if(null===this.startTime)return s.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:u,repeatDelay:m,type:h,onUpdate:p,finalKeyframe:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),x=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=r);let v=this.currentTime,b=s;if(d){const e=Math.min(this.currentTime,r)/i;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===u?(s=1-s,m&&(s-=m/i)):"mirror"===u&&(b=n)),v=Xc(0,1,s)*i}const y=x?{done:!1,value:c[0]}:b.next(v);a&&(y.value=a(y.value));let{done:w}=y;x||null===o||(w=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const j=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return j&&h!==am&&(y.value=cm(c,this.options,f,this.speed)),p&&p(y.value),j&&this.finish(),y}then(e,t){return this.finished.then(e,t)}get duration(){return dd(this.calculatedDuration)}get time(){return dd(this.currentTime)}set time(e){e=cd(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Md.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=dd(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=Pu,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();const s=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=s):null!==this.holdTime?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Md.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}const fm=e=>180*e/Math.PI,gm=e=>{const t=fm(Math.atan2(e[1],e[0]));return vm(t)},xm={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:gm,rotateZ:gm,skewX:e=>fm(Math.atan(e[1])),skewY:e=>fm(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},vm=e=>((e%=360)<0&&(e+=360),e),bm=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),ym=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),wm={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:bm,scaleY:ym,scale:e=>(bm(e)+ym(e))/2,rotateX:e=>vm(fm(Math.atan2(e[6],e[5]))),rotateY:e=>vm(fm(Math.atan2(-e[2],e[0]))),rotateZ:gm,rotate:gm,skewX:e=>fm(Math.atan(e[4])),skewY:e=>fm(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function jm(e){return e.includes("scale")?1:0}function Nm(e,t){if(!e||"none"===e)return jm(t);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,a;if(s)r=wm,a=s;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=xm,a=t}if(!a)return jm(t);const n=r[t],i=a[1].split(",").map(km);return"function"==typeof n?n(i):i[n]}function km(e){return parseFloat(e.trim())}const _m=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Sm=(()=>new Set(_m))(),Em=e=>e===qd||e===ru,Cm=new Set(["x","y","z"]),Rm=_m.filter(e=>!Cm.has(e));const Tm={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Nm(t,"x"),y:(e,{transform:t})=>Nm(t,"y")};Tm.translateX=Tm.x,Tm.translateY=Tm.y;const Am=new Set;let Pm=!1,Im=!1,Dm=!1;function Lm(){if(Im){const e=Array.from(Am).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),s=new Map;t.forEach(e=>{const t=function(e){const t=[];return Rm.forEach(s=>{const r=e.getValue(s);void 0!==r&&(t.push([s,r.get()]),r.set(s.startsWith("scale")?1:0))}),t}(e);t.length&&(s.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=s.get(e);t&&t.forEach(([t,s])=>{e.getValue(t)?.set(s)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}Im=!1,Pm=!1,Am.forEach(e=>e.complete(Dm)),Am.clear()}function Om(){Am.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Im=!0)})}class Mm{constructor(e,t,s,r,a,n=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=r,this.element=a,this.isAsync=n}scheduleResolve(){this.state="scheduled",this.isAsync?(Am.add(this),Pm||(Pm=!0,Ad.read(Om),Ad.resolveKeyframes(Lm))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:r}=this;if(null===e[0]){const a=r?.get(),n=e[e.length-1];if(void 0!==a)e[0]=a;else if(s&&t){const r=s.readValue(t,n);null!=r&&(e[0]=r)}void 0===e[0]&&(e[0]=n),r&&void 0===a&&r.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Am.delete(this)}cancel(){"scheduled"===this.state&&(Am.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const Vm=rd(()=>void 0!==window.ScrollTimeline),zm={};function Um(e,t){const s=rd(e);return()=>zm[t]??s()}const Bm=Um(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(yN){return!1}return!0},"linearEasing"),Fm=([e,t,s,r])=>`cubic-bezier(${e}, ${t}, ${s}, ${r})`,qm={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Fm([0,.65,.55,1]),circOut:Fm([.55,0,1,.45]),backIn:Fm([.31,.01,.66,-.59]),backOut:Fm([.33,1.53,.69,.99])};function $m(e,t){return e?"function"==typeof e?Bm()?Iu(e,t):"ease-out":Sd(e)?Fm(e):Array.isArray(e)?e.map(e=>$m(e,t)||qm.easeOut):qm[e]:void 0}function Wm(e,t,s,{delay:r=0,duration:a=300,repeat:n=0,repeatType:i="loop",ease:o="easeOut",times:l}={},c=void 0){const d={[t]:s};l&&(d.offset=l);const u=$m(o,a);Array.isArray(u)&&(d.easing=u);const m={delay:r,duration:a,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:n+1,direction:"reverse"===i?"alternate":"normal"};c&&(m.pseudoElement=c);return e.animate(d,m)}function Hm(e){return"function"==typeof e&&"applyToOptions"in e}class Zm extends mm{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:r,pseudoElement:a,allowFlatten:n=!1,finalKeyframe:i,onComplete:o}=e;this.isPseudoElement=Boolean(a),this.allowFlatten=n,this.options=e,e.type;const l=function({type:e,...t}){return Hm(e)&&Bm()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Wm(t,s,r,l,a),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const e=cm(r,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,s){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,s):e.style[t]=s}(t,s,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(yN){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return dd(Number(e))}get time(){return dd(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=cd(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Vm()?(this.animation.timeline=e,ad):t(this)}}const Gm={anticipate:bd,backInOut:vd,circInOut:jd};function Km(e){"string"==typeof e.ease&&e.ease in Gm&&(e.ease=Gm[e.ease])}class Ym extends Zm{constructor(e){Km(e),um(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:r,element:a,...n}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const i=new pm({...n,autoplay:!1}),o=cd(this.finishedTime??this.time);t.setWithVelocity(i.sample(o-10).value,i.sample(o).value,10),i.stop()}}const Qm=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!xu.test(e)&&"0"!==e||e.startsWith("url(")));function Xm(e){e.duration=0,e.type}const Jm=new Set(["opacity","clipPath","filter","transform"]),eh=rd(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class th extends mm{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:r=0,repeatDelay:a=0,repeatType:n="loop",keyframes:i,name:o,motionValue:l,element:c,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Md.now();const u={autoplay:e,delay:t,type:s,repeat:r,repeatDelay:a,repeatType:n,name:o,motionValue:l,element:c,...d},m=c?.KeyframeResolver||Mm;this.keyframeResolver=new m(i,(e,t,s)=>this.onKeyframesResolved(e,t,u,!s),o,l,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,r){this.keyframeResolver=void 0;const{name:a,type:n,velocity:i,delay:o,isHandoff:l,onUpdate:c}=s;this.resolvedAt=Md.now(),function(e,t,s,r){const a=e[0];if(null===a)return!1;if("display"===t||"visibility"===t)return!0;const n=e[e.length-1],i=Qm(a,t),o=Qm(n,t);return!(!i||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Hm(s))&&r)}(e,a,n,i)||(!Jc.instantAnimations&&o||c?.(cm(e,s,t)),e[0]=e[e.length-1],Xm(s),s.repeat=0);const d={startTime:r?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},u=!l&&function(e){const{motionValue:t,name:s,repeatDelay:r,repeatType:a,damping:n,type:i}=e,o=t?.owner?.current;if(!(o instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=t.owner.getProps();return eh()&&s&&Jm.has(s)&&("transform"!==s||!c)&&!l&&!r&&"mirror"!==a&&0!==n&&"inertia"!==i}(d)?new Ym({...d,element:d.motionValue.owner.current}):new pm(d);u.finished.then(()=>this.notifyFinished()).catch(ad),this.pendingTimeline&&(this.stopTimeline=u.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=u}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Dm=!0,Om(),Lm(),Dm=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const sh=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function rh(e,t,s=1){const[r,a]=function(e){const t=sh.exec(e);if(!t)return[,];const[,s,r,a]=t;return[`--${s??r}`,a]}(e);if(!r)return;const n=window.getComputedStyle(t).getPropertyValue(r);if(n){const e=n.trim();return ed(e)?parseFloat(e):e}return Bd(a)?rh(a,t,s+1):a}function ah(e,t){return e?.[t]??e?.default??e}const nh=new Set(["width","height","top","left","right","bottom",..._m]),ih=e=>t=>t.test(e),oh=[qd,ru,su,tu,nu,au,{test:e=>"auto"===e,parse:e=>e}],lh=e=>oh.find(ih(e));function ch(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||sd(e))}const dh=new Set(["brightness","contrast","saturate","opacity"]);function uh(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[r]=s.match(Zd)||[];if(!r)return e;const a=s.replace(r,"");let n=dh.has(t)?1:0;return r!==s&&(n*=100),t+"("+n+a+")"}const mh=/\b([a-z-]*)\(.*?\)/gu,hh={...xu,getAnimatableNone:e=>{const t=e.match(mh);return t?t.map(uh).join(" "):e}},ph={...qd,transform:Math.round},fh={borderWidth:ru,borderTopWidth:ru,borderRightWidth:ru,borderBottomWidth:ru,borderLeftWidth:ru,borderRadius:ru,radius:ru,borderTopLeftRadius:ru,borderTopRightRadius:ru,borderBottomRightRadius:ru,borderBottomLeftRadius:ru,width:ru,maxWidth:ru,height:ru,maxHeight:ru,top:ru,right:ru,bottom:ru,left:ru,padding:ru,paddingTop:ru,paddingRight:ru,paddingBottom:ru,paddingLeft:ru,margin:ru,marginTop:ru,marginRight:ru,marginBottom:ru,marginLeft:ru,backgroundPositionX:ru,backgroundPositionY:ru,...{rotate:tu,rotateX:tu,rotateY:tu,rotateZ:tu,scale:Wd,scaleX:Wd,scaleY:Wd,scaleZ:Wd,skew:tu,skewX:tu,skewY:tu,distance:ru,translateX:ru,translateY:ru,translateZ:ru,x:ru,y:ru,z:ru,perspective:ru,transformPerspective:ru,opacity:$d,originX:iu,originY:iu,originZ:ru},zIndex:ph,fillOpacity:$d,strokeOpacity:$d,numOctaves:ph},gh={...fh,color:lu,backgroundColor:lu,outlineColor:lu,fill:lu,stroke:lu,borderColor:lu,borderTopColor:lu,borderRightColor:lu,borderBottomColor:lu,borderLeftColor:lu,filter:hh,WebkitFilter:hh},xh=e=>gh[e];function vh(e,t){let s=xh(e);return s!==hh&&(s=xu),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const bh=new Set(["auto","none","0"]);class yh extends Mm{constructor(e,t,s,r,a){super(e,t,s,r,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),Bd(s))){const r=rh(s,t.current);void 0!==r&&(e[o]=r),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!nh.has(s)||2!==e.length)return;const[r,a]=e,n=lh(r),i=lh(a);if(n!==i)if(Em(n)&&Em(i))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else Tm[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(null===e[r]||ch(e[r]))&&s.push(r);s.length&&function(e,t,s){let r,a=0;for(;a<e.length&&!r;){const t=e[a];"string"==typeof t&&!bh.has(t)&&hu(t).values.length&&(r=e[a]),a++}if(r&&s)for(const n of t)e[n]=vh(s,r)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Tm[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];void 0!==r&&e.getValue(s,r).jump(r,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const a=s.length-1,n=s[a];s[a]=Tm[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,s])=>{e.getValue(t).set(s)}),this.resolveNoneKeyframes()}}const wh=(e,t)=>t&&"number"==typeof e?t.transform(e):e;function jh(e){return td(e)&&"offsetHeight"in e}class Nh{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=Md.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Md.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new ld);const s=this.events[e].add(t);return"change"===e?()=>{s(),Ad.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Md.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return ud(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function kh(e,t){return new Nh(e,t)}const{schedule:_h}=Td(queueMicrotask,!1),Sh={x:!1,y:!1};function Eh(){return Sh.x||Sh.y}function Ch(e,t){const s=function(e,t,s){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document;const r=s?.[e]??t.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}(e),r=new AbortController;return[s,{passive:!0,...t,signal:r.signal},()=>r.abort()]}function Rh(e){return!("touch"===e.pointerType||Eh())}const Th=(e,t)=>!!t&&(e===t||Th(e,t.parentElement)),Ah=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Ph=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Ih=new WeakSet;function Dh(e){return t=>{"Enter"===t.key&&e(t)}}function Lh(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Oh(e){return Ah(e)&&!Eh()}function Mh(e,t,s={}){const[r,a,n]=Ch(e,s),i=e=>{const r=e.currentTarget;if(!Oh(e))return;Ih.add(r);const n=t(r,e),i=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Ih.has(r)&&Ih.delete(r),Oh(e)&&"function"==typeof n&&n(e,{success:t})},o=e=>{i(e,r===window||r===document||s.useGlobalTarget||Th(r,e.target))},l=e=>{i(e,!1)};window.addEventListener("pointerup",o,a),window.addEventListener("pointercancel",l,a)};return r.forEach(e=>{var t;(s.useGlobalTarget?window:e).addEventListener("pointerdown",i,a),jh(e)&&(e.addEventListener("focus",e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const r=Dh(()=>{if(Ih.has(s))return;Lh(s,"down");const e=Dh(()=>{Lh(s,"up")});s.addEventListener("keyup",e,t),s.addEventListener("blur",()=>Lh(s,"cancel"),t)});s.addEventListener("keydown",r,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",r),t)})(e,a)),t=e,Ph.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),n}function Vh(e){return td(e)&&"ownerSVGElement"in e}const zh=e=>Boolean(e&&e.getVelocity),Uh=[...oh,lu,xu],Bh=o.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Fh extends o.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,s=jh(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=s-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function qh({children:e,isPresent:t,anchorX:s,root:r}){const a=o.useId(),n=o.useRef(null),i=o.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=o.useContext(Bh);return o.useInsertionEffect(()=>{const{width:e,height:o,top:l,left:d,right:u}=i.current;if(t||!n.current||!e||!o)return;const m="left"===s?`left: ${d}`:`right: ${u}`;n.current.dataset.motionPopId=a;const h=document.createElement("style");c&&(h.nonce=c);const p=r??document.head;return p.appendChild(h),h.sheet&&h.sheet.insertRule(`\n          [data-motion-pop-id="${a}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${o}px !important;\n            ${m}px !important;\n            top: ${l}px !important;\n          }\n        `),()=>{p.contains(h)&&p.removeChild(h)}},[t]),l.jsx(Fh,{isPresent:t,childRef:n,sizeRef:i,children:o.cloneElement(e,{ref:n})})}const $h=({children:e,initial:t,isPresent:s,onExitComplete:r,custom:a,presenceAffectsLayout:n,mode:i,anchorX:c,root:d})=>{const u=Hc(Wh),m=o.useId();let h=!0,p=o.useMemo(()=>(h=!1,{id:m,initial:t,isPresent:s,custom:a,onExitComplete:e=>{u.set(e,!0);for(const t of u.values())if(!t)return;r&&r()},register:e=>(u.set(e,!1),()=>u.delete(e))}),[s,u,r]);return n&&h&&(p={...p}),o.useMemo(()=>{u.forEach((e,t)=>u.set(t,!1))},[s]),o.useEffect(()=>{!s&&!u.size&&r&&r()},[s]),"popLayout"===i&&(e=l.jsx(qh,{isPresent:s,anchorX:c,root:d,children:e})),l.jsx(Kc.Provider,{value:p,children:e})};function Wh(){return new Map}function Hh(e=!0){const t=o.useContext(Kc);if(null===t)return[!0,null];const{isPresent:s,onExitComplete:r,register:a}=t,n=o.useId();o.useEffect(()=>{if(e)return a(n)},[e]);const i=o.useCallback(()=>e&&r&&r(n),[n,r,e]);return!s&&r?[!1,i]:[!0]}const Zh=e=>e.key||"";function Gh(e){const t=[];return o.Children.forEach(e,e=>{o.isValidElement(e)&&t.push(e)}),t}const Kh=({children:e,custom:t,initial:s=!0,onExitComplete:r,presenceAffectsLayout:a=!0,mode:n="sync",propagate:i=!1,anchorX:c="left",root:d})=>{const[u,m]=Hh(i),h=o.useMemo(()=>Gh(e),[e]),p=i&&!u?[]:h.map(Zh),f=o.useRef(!0),g=o.useRef(h),x=Hc(()=>new Map),[v,b]=o.useState(h),[y,w]=o.useState(h);Gc(()=>{f.current=!1,g.current=h;for(let e=0;e<y.length;e++){const t=Zh(y[e]);p.includes(t)?x.delete(t):!0!==x.get(t)&&x.set(t,!1)}},[y,p.length,p.join("-")]);const j=[];if(h!==v){let e=[...h];for(let t=0;t<y.length;t++){const s=y[t],r=Zh(s);p.includes(r)||(e.splice(t,0,s),j.push(s))}return"wait"===n&&j.length&&(e=j),w(Gh(e)),b(h),null}const{forceRender:N}=o.useContext(Wc);return l.jsx(l.Fragment,{children:y.map(e=>{const o=Zh(e),v=!(i&&!u)&&(h===y||p.includes(o));return l.jsx($h,{isPresent:v,initial:!(f.current&&!s)&&void 0,custom:t,presenceAffectsLayout:a,mode:n,root:d,onExitComplete:v?void 0:()=>{if(!x.has(o))return;x.set(o,!0);let e=!0;x.forEach(t=>{t||(e=!1)}),e&&(N?.(),w(g.current),i&&m?.(),r&&r())},anchorX:c,children:e},o)})})},Yh=o.createContext({strict:!1}),Qh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Xh={};for(const wN in Qh)Xh[wN]={isEnabled:e=>Qh[wN].some(t=>!!e[t])};const Jh=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ep(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Jh.has(e)}let tp=e=>!ep(e);try{"function"==typeof(sp=require("@emotion/is-prop-valid").default)&&(tp=e=>e.startsWith("on")?!ep(e):sp(e))}catch{}var sp;const rp=o.createContext({});function ap(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function np(e){return"string"==typeof e||Array.isArray(e)}const ip=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],op=["initial",...ip];function lp(e){return ap(e.animate)||op.some(t=>np(e[t]))}function cp(e){return Boolean(lp(e)||e.variants)}function dp(e){const{initial:t,animate:s}=function(e,t){if(lp(e)){const{initial:t,animate:s}=e;return{initial:!1===t||np(t)?t:void 0,animate:np(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,o.useContext(rp));return o.useMemo(()=>({initial:t,animate:s}),[up(t),up(s)])}function up(e){return Array.isArray(e)?e.join(" "):e}const mp={};function hp(e,{layout:t,layoutId:s}){return Sm.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!mp[e]||"opacity"===e)}const pp={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},fp=_m.length;function gp(e,t,s){const{style:r,vars:a,transformOrigin:n}=e;let i=!1,o=!1;for(const l in t){const e=t[l];if(Sm.has(l))i=!0;else if(zd(l))a[l]=e;else{const t=wh(e,fh[l]);l.startsWith("origin")?(o=!0,n[l]=t):r[l]=t}}if(t.transform||(i||s?r.transform=function(e,t,s){let r="",a=!0;for(let n=0;n<fp;n++){const i=_m[n],o=e[i];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(i.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=wh(o,fh[i]);l||(a=!1,r+=`${pp[i]||i}(${e}) `),s&&(t[i]=e)}}return r=r.trim(),s?r=s(t,a?"":r):a&&(r="none"),r}(t,e.transform,s):r.transform&&(r.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=n;r.transformOrigin=`${e} ${t} ${s}`}}const xp=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function vp(e,t,s){for(const r in t)zh(t[r])||hp(r,s)||(e[r]=t[r])}function bp(e,t){const s={};return vp(s,e.style||{},e),Object.assign(s,function({transformTemplate:e},t){return o.useMemo(()=>{const s={style:{},transform:{},transformOrigin:{},vars:{}};return gp(s,t,e),Object.assign({},s.vars,s.style)},[t])}(e,t)),s}function yp(e,t){const s={},r=bp(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=r,s}const wp={offset:"stroke-dashoffset",array:"stroke-dasharray"},jp={offset:"strokeDashoffset",array:"strokeDasharray"};function Np(e,{attrX:t,attrY:s,attrScale:r,pathLength:a,pathSpacing:n=1,pathOffset:i=0,...o},l,c,d){if(gp(e,o,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:m}=e;u.transform&&(m.transform=u.transform,delete u.transform),(m.transform||u.transformOrigin)&&(m.transformOrigin=u.transformOrigin??"50% 50%",delete u.transformOrigin),m.transform&&(m.transformBox=d?.transformBox??"fill-box",delete u.transformBox),void 0!==t&&(u.x=t),void 0!==s&&(u.y=s),void 0!==r&&(u.scale=r),void 0!==a&&function(e,t,s=1,r=0,a=!0){e.pathLength=1;const n=a?wp:jp;e[n.offset]=ru.transform(-r);const i=ru.transform(t),o=ru.transform(s);e[n.array]=`${i} ${o}`}(u,a,n,i,!1)}const kp=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),_p=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Sp(e,t,s,r){const a=o.useMemo(()=>{const s={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Np(s,t,_p(r),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const t={};vp(t,e.style,e),a.style={...t,...a.style}}return a}const Ep=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Cp(e){return"string"==typeof e&&!e.includes("-")&&!!(Ep.indexOf(e)>-1||/[A-Z]/u.test(e))}function Rp(e,t,s,{latestValues:r},a,n=!1){const i=(Cp(e)?Sp:yp)(t,r,a,e),l=function(e,t,s){const r={};for(const a in e)"values"===a&&"object"==typeof e.values||(tp(a)||!0===s&&ep(a)||!t&&!ep(a)||e.draggable&&a.startsWith("onDrag"))&&(r[a]=e[a]);return r}(t,"string"==typeof e,n),c=e!==o.Fragment?{...l,...i,ref:s}:{},{children:d}=t,u=o.useMemo(()=>zh(d)?d.get():d,[d]);return o.createElement(e,{...c,children:u})}function Tp(e){const t=[{},{}];return e?.values.forEach((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()}),t}function Ap(e,t,s,r){if("function"==typeof t){const[a,n]=Tp(r);t=t(void 0!==s?s:e.custom,a,n)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[a,n]=Tp(r);t=t(void 0!==s?s:e.custom,a,n)}return t}function Pp(e){return zh(e)?e.get():e}function Ip(e,t,s,r){const a={},n=r(e,{});for(const m in n)a[m]=Pp(n[m]);let{initial:i,animate:o}=e;const l=lp(e),c=cp(e);t&&c&&!l&&!1!==e.inherit&&(void 0===i&&(i=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===i;const u=d?o:i;if(u&&"boolean"!=typeof u&&!ap(u)){const t=Array.isArray(u)?u:[u];for(let s=0;s<t.length;s++){const r=Ap(e,t[s]);if(r){const{transitionEnd:e,transition:t,...s}=r;for(const r in s){let e=s[r];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(a[r]=e)}for(const r in e)a[r]=e[r]}}}return a}const Dp=e=>(t,s)=>{const r=o.useContext(rp),a=o.useContext(Kc),n=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},s,r,a){return{latestValues:Ip(s,r,a,e),renderState:t()}}(e,t,r,a);return s?n():Hc(n)};function Lp(e,t,s){const{style:r}=e,a={};for(const n in r)(zh(r[n])||t.style&&zh(t.style[n])||hp(n,e)||void 0!==s?.getValue(n)?.liveStyle)&&(a[n]=r[n]);return a}const Op=Dp({scrapeMotionValuesFromProps:Lp,createRenderState:xp});function Mp(e,t,s){const r=Lp(e,t,s);for(const a in e)if(zh(e[a])||zh(t[a])){r[-1!==_m.indexOf(a)?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a]=e[a]}return r}const Vp=Dp({scrapeMotionValuesFromProps:Mp,createRenderState:kp}),zp=Symbol.for("motionComponentSymbol");function Up(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Bp(e,t,s){return o.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),s&&("function"==typeof s?s(r):Up(s)&&(s.current=r))},[t])}const Fp=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),qp="data-"+Fp("framerAppearId"),$p=o.createContext({});function Wp(e,t,s,r,a){const{visualElement:n}=o.useContext(rp),i=o.useContext(Yh),l=o.useContext(Kc),c=o.useContext(Bh).reducedMotion,d=o.useRef(null);r=r||i.renderer,!d.current&&r&&(d.current=r(e,{visualState:t,parent:n,props:s,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const u=d.current,m=o.useContext($p);!u||u.projection||!a||"html"!==u.type&&"svg"!==u.type||function(e,t,s,r){const{layoutId:a,layout:n,drag:i,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Hp(e.parent)),e.projection.setOptions({layoutId:a,layout:n,alwaysMeasureLayout:Boolean(i)||o&&Up(o),visualElement:e,animationType:"string"==typeof n?n:"both",initialPromotionConfig:r,crossfade:d,layoutScroll:l,layoutRoot:c})}(d.current,s,a,m);const h=o.useRef(!1);o.useInsertionEffect(()=>{u&&h.current&&u.update(s,l)});const p=s[qp],f=o.useRef(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Gc(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),f.current&&u.animationState&&u.animationState.animateChanges())}),o.useEffect(()=>{u&&(!f.current&&u.animationState&&u.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),f.current=!1),u.enteringChildren=void 0)}),u}function Hp(e){if(e)return!1!==e.options.allowProjection?e.projection:Hp(e.parent)}function Zp(e,{forwardMotionProps:t=!1}={},s,r){s&&function(e){for(const t in e)Xh[t]={...Xh[t],...e[t]}}(s);const a=Cp(e)?Vp:Op;function n(s,n){let i;const c={...o.useContext(Bh),...s,layoutId:Gp(s)},{isStatic:d}=c,u=dp(s),m=a(s,d);if(!d&&Zc){o.useContext(Yh).strict;const t=function(e){const{drag:t,layout:s}=Xh;if(!t&&!s)return{};const r={...t,...s};return{MeasureLayout:t?.isEnabled(e)||s?.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(c);i=t.MeasureLayout,u.visualElement=Wp(e,m,c,r,t.ProjectionNode)}return l.jsxs(rp.Provider,{value:u,children:[i&&u.visualElement?l.jsx(i,{visualElement:u.visualElement,...c}):null,Rp(e,s,Bp(m,u.visualElement,n),m,d,t)]})}n.displayName=`motion.${"string"==typeof e?e:`create(${e.displayName??e.name??""})`}`;const i=o.forwardRef(n);return i[zp]=e,i}function Gp({layoutId:e}){const t=o.useContext(Wc).id;return t&&void 0!==e?t+"-"+e:e}function Kp(e,t){if("undefined"==typeof Proxy)return Zp;const s=new Map,r=(s,r)=>Zp(s,r,e,t);return new Proxy((e,t)=>r(e,t),{get:(a,n)=>"create"===n?r:(s.has(n)||s.set(n,Zp(n,void 0,e,t)),s.get(n))})}function Yp({top:e,left:t,right:s,bottom:r}){return{x:{min:t,max:s},y:{min:e,max:r}}}function Qp(e){return void 0===e||1===e}function Xp({scale:e,scaleX:t,scaleY:s}){return!Qp(e)||!Qp(t)||!Qp(s)}function Jp(e){return Xp(e)||ef(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function ef(e){return tf(e.x)||tf(e.y)}function tf(e){return e&&"0%"!==e}function sf(e,t,s){return s+t*(e-s)}function rf(e,t,s,r,a){return void 0!==a&&(e=sf(e,a,r)),sf(e,s,r)+t}function af(e,t=0,s=1,r,a){e.min=rf(e.min,t,s,r,a),e.max=rf(e.max,t,s,r,a)}function nf(e,{x:t,y:s}){af(e.x,t.translate,t.scale,t.originPoint),af(e.y,s.translate,s.scale,s.originPoint)}const of=.999999999999,lf=1.0000000000001;function cf(e,t){e.min=e.min+t,e.max=e.max+t}function df(e,t,s,r,a=.5){af(e,t,s,yu(e.min,e.max,a),r)}function uf(e,t){df(e.x,t.x,t.scaleX,t.scale,t.originX),df(e.y,t.y,t.scaleY,t.scale,t.originY)}function mf(e,t){return Yp(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),t))}const hf=()=>({x:{min:0,max:0},y:{min:0,max:0}}),pf={current:null},ff={current:!1};function gf(){if(ff.current=!0,Zc)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>pf.current=e.matches;e.addEventListener("change",t),t()}else pf.current=!1}const xf=new WeakMap;const vf=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class bf{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:a,visualState:n},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Mm,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Md.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Ad.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=n;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=i,this.blockInitialAnimation=Boolean(a),this.isControllingVariants=lp(t),this.isVariantNode=cp(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const u in d){const e=d[u];void 0!==o[u]&&zh(e)&&e.set(o[u])}}mount(e){this.current=e,xf.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),ff.current||gf(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||pf.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Pd(this.notifyUpdate),Pd(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=Sm.has(e);s&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Ad.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Xh){const t=Xh[e];if(!t)continue;const{isEnabled:s,Feature:r}=t;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<vf.length;s++){const t=vf[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,t,s){for(const r in t){const a=t[r],n=s[r];if(zh(a))e.addValue(r,a);else if(zh(n))e.addValue(r,kh(a,{owner:e}));else if(n!==a)if(e.hasValue(r)){const t=e.getValue(r);!0===t.liveStyle?t.jump(a):t.hasAnimated||t.set(a)}else{const t=e.getStaticValue(r);e.addValue(r,kh(void 0!==t?t:a,{owner:e}))}}for(const r in s)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=kh(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=s&&("string"==typeof s&&(ed(s)||sd(s))?s=parseFloat(s):(r=s,!Uh.find(ih(r))&&xu.test(t)&&(s=vh(e,t))),this.setBaseTarget(e,zh(s)?s.get():s)),zh(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if("string"==typeof t||"object"==typeof t){const r=Ap(this.props,t,this.presenceContext?.custom);r&&(s=r[e])}if(t&&void 0!==s)return s;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||zh(r)?void 0!==this.initialValues[e]&&void 0===s?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new ld),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){_h.render(this.render)}}class yf extends bf{constructor(){super(...arguments),this.KeyframeResolver=yh}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;zh(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function wf(e,{style:t,vars:s},r,a){const n=e.style;let i;for(i in t)n[i]=t[i];for(i in a?.applyProjectionStyles(n,r),s)n.setProperty(i,s[i])}class jf extends yf{constructor(){super(...arguments),this.type="html",this.renderInstance=wf}readValueFromInstance(e,t){if(Sm.has(t))return this.projection?.isProjecting?jm(t):((e,t)=>{const{transform:s="none"}=getComputedStyle(e);return Nm(s,t)})(e,t);{const r=(s=e,window.getComputedStyle(s)),a=(zd(t)?r.getPropertyValue(t):r[t])||0;return"string"==typeof a?a.trim():a}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return mf(e,t)}build(e,t,s){gp(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Lp(e,t,s)}}const Nf=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class kf extends yf{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=hf}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Sm.has(t)){const e=xh(t);return e&&e.default||0}return t=Nf.has(t)?t:Fp(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return Mp(e,t,s)}build(e,t,s){Np(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,r){!function(e,t,s,r){wf(e,t,void 0,r);for(const a in t.attrs)e.setAttribute(Nf.has(a)?a:Fp(a),t.attrs[a])}(e,t,0,r)}mount(e){this.isSVGTag=_p(e.tagName),super.mount(e)}}const _f=(e,t)=>Cp(e)?new kf(t):new jf(t,{allowProjection:e!==o.Fragment});function Sf(e,t,s){const r=e.getProps();return Ap(r,t,void 0!==s?s:r.custom,e)}const Ef=e=>Array.isArray(e);function Cf(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,kh(s))}function Rf(e){return Ef(e)?e[e.length-1]||0:e}function Tf(e,t){const s=e.getValue("willChange");if(r=s,Boolean(zh(r)&&r.add))return s.add(t);if(!s&&Jc.WillChange){const s=new Jc.WillChange("auto");e.addValue("willChange",s),s.add(t)}var r}function Af(e){return e.props[qp]}const Pf=e=>null!==e;const If={type:"spring",stiffness:500,damping:25,restSpeed:10},Df={type:"keyframes",duration:.8},Lf={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Of=(e,{keyframes:t})=>t.length>2?Df:Sm.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:If:Lf;const Mf=(e,t,s,r={},a,n)=>i=>{const o=ah(r,e)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c-=cd(l);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{i(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:n?void 0:a};(function({when:e,delay:t,delayChildren:s,staggerChildren:r,staggerDirection:a,repeat:n,repeatType:i,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||Object.assign(d,Of(e,d)),d.duration&&(d.duration=cd(d.duration)),d.repeatDelay&&(d.repeatDelay=cd(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let u=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(Xm(d),0===d.delay&&(u=!0)),(Jc.instantAnimations||Jc.skipAnimations)&&(u=!0,Xm(d),d.delay=0),d.allowFlatten=!o.type&&!o.ease,u&&!n&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:s="loop"}){const r=e.filter(Pf);return r[t&&"loop"!==s&&t%2==1?0:r.length-1]}(d.keyframes,o);if(void 0!==e)return void Ad.update(()=>{d.onUpdate(e),d.onComplete()})}return o.isSync?new pm(d):new th(d)};function Vf({protectedKeys:e,needsAnimating:t},s){const r=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,r}function zf(e,t,{delay:s=0,transitionOverride:r,type:a}={}){let{transition:n=e.getDefaultTransition(),transitionEnd:i,...o}=t;r&&(n=r);const l=[],c=a&&e.animationState&&e.animationState.getState()[a];for(const d in o){const t=e.getValue(d,e.latestValues[d]??null),r=o[d];if(void 0===r||c&&Vf(c,d))continue;const a={delay:s,...ah(n||{},d)},i=t.get();if(void 0!==i&&!t.isAnimating&&!Array.isArray(r)&&r===i&&!a.velocity)continue;let u=!1;if(window.MotionHandoffAnimation){const t=Af(e);if(t){const e=window.MotionHandoffAnimation(t,d,Ad);null!==e&&(a.startTime=e,u=!0)}}Tf(e,d),t.start(Mf(d,t,r,e.shouldReduceMotion&&nh.has(d)?{type:!1}:a,e,u));const m=t.animation;m&&l.push(m)}return i&&Promise.all(l).then(()=>{Ad.update(()=>{i&&function(e,t){const s=Sf(e,t);let{transitionEnd:r={},transition:a={},...n}=s||{};n={...n,...r};for(const i in n)Cf(e,i,Rf(n[i]))}(e,i)})}),l}function Uf(e,t,s,r=0,a=1){const n=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),i=e.size,o=(i-1)*r;return"function"==typeof s?s(n,i):1===a?n*r:o-n*r}function Bf(e,t,s={}){const r=Sf(e,t,"exit"===s.type?e.presenceContext?.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(a=s.transitionOverride);const n=r?()=>Promise.all(zf(e,r,s)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(r=0)=>{const{delayChildren:n=0,staggerChildren:i,staggerDirection:o}=a;return function(e,t,s=0,r=0,a=0,n=1,i){const o=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),o.push(Bf(l,t,{...i,delay:s+("function"==typeof r?0:r)+Uf(e.variantChildren,l,r,a,n)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(o)}(e,t,r,n,i,o,s)}:()=>Promise.resolve(),{when:o}=a;if(o){const[e,t]="beforeChildren"===o?[n,i]:[i,n];return e().then(()=>t())}return Promise.all([n(),i(s.delay)])}function Ff(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let r=0;r<s;r++)if(t[r]!==e[r])return!1;return!0}const qf=op.length;function $f(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&$f(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<qf;s++){const r=op[s],a=e.props[r];(np(a)||!1===a)&&(t[r]=a)}return t}const Wf=[...ip].reverse(),Hf=ip.length;function Zf(e){return t=>Promise.all(t.map(({animation:t,options:s})=>function(e,t,s={}){let r;if(e.notify("AnimationStart",t),Array.isArray(t)){const a=t.map(t=>Bf(e,t,s));r=Promise.all(a)}else if("string"==typeof t)r=Bf(e,t,s);else{const a="function"==typeof t?Sf(e,t,s.custom):t;r=Promise.all(zf(e,a,s))}return r.then(()=>{e.notify("AnimationComplete",t)})}(e,t,s)))}function Gf(e){let t=Zf(e),s=Qf(),r=!0;const a=t=>(s,r)=>{const a=Sf(e,r,"exit"===t?e.presenceContext?.custom:void 0);if(a){const{transition:e,transitionEnd:t,...r}=a;s={...s,...r,...t}}return s};function n(n){const{props:i}=e,o=$f(e.parent)||{},l=[],c=new Set;let d={},u=1/0;for(let t=0;t<Hf;t++){const m=Wf[t],h=s[m],p=void 0!==i[m]?i[m]:o[m],f=np(p),g=m===n?h.isActive:null;!1===g&&(u=t);let x=p===o[m]&&p!==i[m]&&f;if(x&&r&&e.manuallyAnimateOnMount&&(x=!1),h.protectedKeys={...d},!h.isActive&&null===g||!p&&!h.prevProp||ap(p)||"boolean"==typeof p)continue;const v=Kf(h.prevProp,p);let b=v||m===n&&h.isActive&&!x&&f||t>u&&f,y=!1;const w=Array.isArray(p)?p:[p];let j=w.reduce(a(m),{});!1===g&&(j={});const{prevResolvedValues:N={}}=h,k={...N,...j},_=t=>{b=!0,c.has(t)&&(y=!0,c.delete(t)),h.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in k){const t=j[e],s=N[e];if(d.hasOwnProperty(e))continue;let r=!1;r=Ef(t)&&Ef(s)?!Ff(t,s):t!==s,r?null!=t?_(e):c.add(e):void 0!==t&&c.has(e)?_(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=j,h.isActive&&(d={...d,...j}),r&&e.blockInitialAnimation&&(b=!1);const S=x&&v;b&&(!S||y)&&l.push(...w.map(t=>{const s={type:m};if("string"==typeof t&&r&&!S&&e.manuallyAnimateOnMount&&e.parent){const{parent:r}=e,a=Sf(r,t);if(r.enteringChildren&&a){const{delayChildren:t}=a.transition||{};s.delay=Uf(r.enteringChildren,e,t)}}return{animation:t,options:s}}))}if(c.size){const t={};if("boolean"!=typeof i.initial){const s=Sf(e,Array.isArray(i.initial)?i.initial[0]:i.initial);s&&s.transition&&(t.transition=s.transition)}c.forEach(s=>{const r=e.getBaseTarget(s),a=e.getValue(s);a&&(a.liveStyle=!0),t[s]=r??null}),l.push({animation:t})}let m=Boolean(l.length);return!r||!1!==i.initial&&i.initial!==i.animate||e.manuallyAnimateOnMount||(m=!1),r=!1,m?t(l):Promise.resolve()}return{animateChanges:n,setActive:function(t,r){if(s[t].isActive===r)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,r)),s[t].isActive=r;const a=n(t);for(const e in s)s[e].protectedKeys={};return a},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=Qf(),r=!0}}}function Kf(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!Ff(t,e)}function Yf(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Qf(){return{animate:Yf(!0),whileInView:Yf(),whileHover:Yf(),whileTap:Yf(),whileDrag:Yf(),whileFocus:Yf(),exit:Yf()}}class Xf{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Jf=0;const eg={animation:{Feature:class extends Xf{constructor(e){super(e),e.animationState||(e.animationState=Gf(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ap(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends Xf{constructor(){super(...arguments),this.id=Jf++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function tg(e,t,s,r={passive:!0}){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s)}function sg(e){return{point:{x:e.pageX,y:e.pageY}}}function rg(e,t,s,r){return tg(e,t,(e=>t=>Ah(t)&&e(t,sg(t)))(s),r)}function ag(e){return e.max-e.min}function ng(e,t,s,r=.5){e.origin=r,e.originPoint=yu(t.min,t.max,e.origin),e.scale=ag(s)/ag(t),e.translate=yu(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function ig(e,t,s,r){ng(e.x,t.x,s.x,r?r.originX:void 0),ng(e.y,t.y,s.y,r?r.originY:void 0)}function og(e,t,s){e.min=s.min+t.min,e.max=e.min+ag(t)}function lg(e,t,s){e.min=t.min-s.min,e.max=e.min+ag(t)}function cg(e,t,s){lg(e.x,t.x,s.x),lg(e.y,t.y,s.y)}function dg(e){return[e("x"),e("y")]}const ug=({current:e})=>e?e.ownerDocument.defaultView:null,mg=(e,t)=>Math.abs(e-t);class hg{constructor(e,t,{transformPagePoint:s,contextWindow:r=window,dragSnapToOrigin:a=!1,distanceThreshold:n=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=gg(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=mg(e.x,t.x),r=mg(e.y,t.y);return Math.sqrt(s**2+r**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!s)return;const{point:r}=e,{timestamp:a}=Id;this.history.push({...r,timestamp:a});const{onStart:n,onMove:i}=this.handlers;t||(n&&n(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=pg(t,this.transformPagePoint),Ad.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:r,resumeAnimation:a}=this.handlers;if(this.dragSnapToOrigin&&a&&a(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const n=gg("pointercancel"===e.type?this.lastMoveEventInfo:pg(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,n),r&&r(e,n)},!Ah(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=n,this.contextWindow=r||window;const i=pg(sg(e),this.transformPagePoint),{point:o}=i,{timestamp:l}=Id;this.history=[{...o,timestamp:l}];const{onSessionStart:c}=t;c&&c(e,gg(i,this.history)),this.removeListeners=id(rg(this.contextWindow,"pointermove",this.handlePointerMove),rg(this.contextWindow,"pointerup",this.handlePointerUp),rg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Pd(this.updatePoint)}}function pg(e,t){return t?{point:t(e.point)}:e}function fg(e,t){return{x:e.x-t.x,y:e.y-t.y}}function gg({point:e},t){return{point:e,delta:fg(e,vg(t)),offset:fg(e,xg(t)),velocity:bg(t,.1)}}function xg(e){return e[0]}function vg(e){return e[e.length-1]}function bg(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,r=null;const a=vg(e);for(;s>=0&&(r=e[s],!(a.timestamp-r.timestamp>cd(t)));)s--;if(!r)return{x:0,y:0};const n=dd(a.timestamp-r.timestamp);if(0===n)return{x:0,y:0};const i={x:(a.x-r.x)/n,y:(a.y-r.y)/n};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function yg(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function wg(e,t){let s=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,r]=[r,s]),{min:s,max:r}}const jg=.35;function Ng(e,t,s){return{min:kg(e,t),max:kg(e,s)}}function kg(e,t){return"number"==typeof e?e:e[t]||0}const _g=new WeakMap;class Sg{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:r}=this.visualElement;if(r&&!1===r.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new hg(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(sg(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:r,onDragStart:a}=this.getProps();if(s&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(n=s)||"y"===n?Sh[n]?null:(Sh[n]=!0,()=>{Sh[n]=!1}):Sh.x||Sh.y?null:(Sh.x=Sh.y=!0,()=>{Sh.x=Sh.y=!1}),!this.openDragLock))return;var n;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),dg(e=>{let t=this.getAxisMotionValue(e).get()||0;if(su.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const r=s.layout.layoutBox[e];if(r){t=ag(r)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),a&&Ad.postRender(()=>a(e,t)),Tf(this.visualElement,"transform");const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:s,dragDirectionLock:r,onDirectionLock:a,onDrag:n}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:i}=t;if(r&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(i),void(null!==this.currentDirection&&a&&a(this.currentDirection));this.updateAxis("x",t.point,i),this.updateAxis("y",t.point,i),this.visualElement.render(),n&&n(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>dg(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play())},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,distanceThreshold:s,contextWindow:ug(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,r=t||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!r||!s)return;const{velocity:n}=r;this.startAnimation(n);const{onDragEnd:i}=this.getProps();i&&Ad.postRender(()=>i(s,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:r}=this.getProps();if(!s||!Eg(e,r,this.currentDirection))return;const a=this.getAxisMotionValue(e);let n=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(n=function(e,{min:t,max:s},r){return void 0!==t&&e<t?e=r?yu(t,e,r.min):Math.max(e,t):void 0!==s&&e>s&&(e=r?yu(s,e,r.max):Math.min(e,s)),e}(n,this.constraints[e],this.elastic[e])),a.set(n)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&Up(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!s)&&function(e,{top:t,left:s,bottom:r,right:a}){return{x:yg(e.x,s,a),y:yg(e.y,t,r)}}(s.layoutBox,e),this.elastic=function(e=jg){return!1===e?e=0:!0===e&&(e=jg),{x:Ng(e,"left","right"),y:Ng(e,"top","bottom")}}(t),r!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&dg(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(s.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Up(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const a=function(e,t,s){const r=mf(e,s),{scroll:a}=t;return a&&(cf(r.x,a.offset.x),cf(r.y,a.offset.y)),r}(s,r.root,this.visualElement.getTransformPagePoint());let n=function(e,t){return{x:wg(e.x,t.x),y:wg(e.y,t.y)}}(r.layout.layoutBox,a);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(n));this.hasMutatedConstraints=!!e,e&&(n=Yp(e))}return n}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:r,dragTransition:a,dragSnapToOrigin:n,onDragTransitionEnd:i}=this.getProps(),o=this.constraints||{},l=dg(i=>{if(!Eg(i,t,this.currentDirection))return;let l=o&&o[i]||{};n&&(l={min:0,max:0});const c=r?200:1e6,d=r?40:1e7,u={type:"inertia",velocity:s?e[i]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...a,...l};return this.startAxisValueAnimation(i,u)});return Promise.all(l).then(i)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Tf(this.visualElement,e),s.start(Mf(e,s,0,t,this.visualElement,!1))}stopAnimation(){dg(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){dg(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[t];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){dg(t=>{const{drag:s}=this.getProps();if(!Eg(t,s,this.currentDirection))return;const{projection:r}=this.visualElement,a=this.getAxisMotionValue(t);if(r&&r.layout){const{min:s,max:n}=r.layout.layoutBox[t];a.set(e[t]-yu(s,n,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Up(t)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};dg(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();r[e]=function(e,t){let s=.5;const r=ag(e),a=ag(t);return a>r?s=od(t.min,t.max-r,e.min):r>a&&(s=od(e.min,e.max-a,t.min)),Xc(0,1,s)}({min:s,max:s},this.constraints[e])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),dg(t=>{if(!Eg(t,e,null))return;const s=this.getAxisMotionValue(t),{min:a,max:n}=this.constraints[t];s.set(yu(a,n,r[t]))})}addListeners(){if(!this.visualElement.current)return;_g.set(this.visualElement,this);const e=rg(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();Up(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,r=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Ad.read(t);const a=tg(window,"resize",()=>this.scalePositionWithinConstraints()),n=s.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(dg(t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))}),this.visualElement.render())});return()=>{a(),e(),r(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:a=!1,dragElastic:n=jg,dragMomentum:i=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:r,dragConstraints:a,dragElastic:n,dragMomentum:i}}}function Eg(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const Cg=e=>(t,s)=>{e&&Ad.postRender(()=>e(t,s))};const Rg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Tg(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ag={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!ru.test(e))return e;e=parseFloat(e)}return`${Tg(e,t.target.x)}% ${Tg(e,t.target.y)}%`}},Pg={correct:(e,{treeScale:t,projectionDelta:s})=>{const r=e,a=xu.parse(e);if(a.length>5)return r;const n=xu.createTransformer(e),i="number"!=typeof a[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;a[0+i]/=o,a[1+i]/=l;const c=yu(o,l,.5);return"number"==typeof a[2+i]&&(a[2+i]/=c),"number"==typeof a[3+i]&&(a[3+i]/=c),n(a)}};let Ig=!1;class Dg extends o.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:r}=this.props,{projection:a}=e;!function(e){for(const t in e)mp[t]=e[t],zd(t)&&(mp[t].isCSSVariable=!0)}(Og),a&&(t.group&&t.group.add(a),s&&s.register&&r&&s.register(a),Ig&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions({...a.options,onExitComplete:()=>this.safeToRemove()})),Rg.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:r,isPresent:a}=this.props,{projection:n}=s;return n?(n.isPresent=a,Ig=!0,r||e.layoutDependency!==t||void 0===t||e.isPresent!==a?n.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?n.promote():n.relegate()||Ad.postRender(()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),_h.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:r}=e;Ig=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Lg(e){const[t,s]=Hh(),r=o.useContext(Wc);return l.jsx(Dg,{...e,layoutGroup:r,switchLayoutGroup:o.useContext($p),isPresent:t,safeToRemove:s})}const Og={borderRadius:{...Ag,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ag,borderTopRightRadius:Ag,borderBottomLeftRadius:Ag,borderBottomRightRadius:Ag,boxShadow:Pg};const Mg=(e,t)=>e.depth-t.depth;class Vg{constructor(){this.children=[],this.isDirty=!1}add(e){Yc(this.children,e),this.isDirty=!0}remove(e){Qc(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Mg),this.isDirty=!1,this.children.forEach(e)}}const zg=["TopLeft","TopRight","BottomLeft","BottomRight"],Ug=zg.length,Bg=e=>"string"==typeof e?parseFloat(e):e,Fg=e=>"number"==typeof e||ru.test(e);function qg(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const $g=Hg(0,.5,wd),Wg=Hg(.5,.95,ad);function Hg(e,t,s){return r=>r<e?0:r>t?1:s(od(e,t,r))}function Zg(e,t){e.min=t.min,e.max=t.max}function Gg(e,t){Zg(e.x,t.x),Zg(e.y,t.y)}function Kg(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Yg(e,t,s,r,a){return e=sf(e-=t,1/s,r),void 0!==a&&(e=sf(e,1/a,r)),e}function Qg(e,t,[s,r,a],n,i){!function(e,t=0,s=1,r=.5,a,n=e,i=e){su.test(t)&&(t=parseFloat(t),t=yu(i.min,i.max,t/100)-i.min);if("number"!=typeof t)return;let o=yu(n.min,n.max,r);e===n&&(o-=t),e.min=Yg(e.min,t,s,o,a),e.max=Yg(e.max,t,s,o,a)}(e,t[s],t[r],t[a],t.scale,n,i)}const Xg=["x","scaleX","originX"],Jg=["y","scaleY","originY"];function ex(e,t,s,r){Qg(e.x,t,Xg,s?s.x:void 0,r?r.x:void 0),Qg(e.y,t,Jg,s?s.y:void 0,r?r.y:void 0)}function tx(e){return 0===e.translate&&1===e.scale}function sx(e){return tx(e.x)&&tx(e.y)}function rx(e,t){return e.min===t.min&&e.max===t.max}function ax(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function nx(e,t){return ax(e.x,t.x)&&ax(e.y,t.y)}function ix(e){return ag(e.x)/ag(e.y)}function ox(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class lx{constructor(){this.members=[]}add(e){Yc(this.members,e),e.scheduleRender()}remove(e){if(Qc(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let s;for(let r=t;r>=0;r--){const e=this.members[r];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const cx=["","X","Y","Z"];let dx=0;function ux(e,t,s,r){const{latestValues:a}=t;a[e]&&(s[e]=a[e],t.setStaticValue(e,0),r&&(r[e]=0))}function mx(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=Af(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Ad,!(t||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&mx(r)}function hx({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:r,resetTransform:a}){return class{constructor(e={},s=t?.()){this.id=dx++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(gx),this.nodes.forEach(Nx),this.nodes.forEach(kx),this.nodes.forEach(xx)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Vg)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new ld),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var s;this.isSVG=Vh(t)&&!(Vh(s=t)&&"svg"===s.tagName),this.instance=t;const{layoutId:r,layout:a,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(a||r)&&(this.isLayoutDirty=!0),e){let s,r=0;const a=()=>this.root.updateBlockedByResize=!1;Ad.read(()=>{r=window.innerWidth}),e(t,()=>{const e=window.innerWidth;e!==r&&(r=e,this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Md.now(),r=({timestamp:a})=>{const n=a-s;n>=t&&(Pd(r),e(n-t))};return Ad.setup(r,!0),()=>Pd(r)}(a,250),Rg.hasAnimatedSinceResize&&(Rg.hasAnimatedSinceResize=!1,this.nodes.forEach(jx)))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&n&&(r||a)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:s,layout:r})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||n.getDefaultTransition()||Tx,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!nx(this.targetLayout,r),c=!t&&s;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...ah(a,"layout"),onPlay:i,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||jx(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Pd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(_x),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&mx(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){const e=this.path[a];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(bx);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(yx);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(wx),this.nodes.forEach(px),this.nodes.forEach(fx)):this.nodes.forEach(yx),this.clearAllSnapshots();const e=Md.now();Id.delta=Xc(0,1e3/60,e-Id.timestamp),Id.timestamp=e,Id.isProcessing=!0,Dd.update.process(Id),Dd.preRender.process(Id),Dd.render.process(Id),Id.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,_h.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(vx),this.sharedNodes.forEach(Sx)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ad.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ad.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||ag(this.snapshot.measuredBox.x)||ag(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!a)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!sx(this.projectionDelta),s=this.getTransformTemplate(),r=s?s(this.latestValues,""):void 0,n=r!==this.prevTransformTemplateValue;e&&this.instance&&(t||Jp(this.latestValues)||n)&&(a(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var r;return e&&(s=this.removeTransform(s)),Ix((r=s).x),Ix(r.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Lx))){const{scroll:e}=this.root;e&&(cf(t.x,e.offset.x),cf(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(Gg(t,e),this.scroll?.wasRoot)return t;for(let s=0;s<this.path.length;s++){const r=this.path[s],{scroll:a,options:n}=r;r!==this.root&&a&&n.layoutScroll&&(a.wasRoot&&Gg(t,e),cf(t.x,a.offset.x),cf(t.y,a.offset.y))}return t}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};Gg(s,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&uf(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Jp(e.latestValues)&&uf(s,e.latestValues)}return Jp(this.latestValues)&&uf(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Gg(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!Jp(e.latestValues))continue;Xp(e.latestValues)&&e.updateSnapshot();const r=hf();Gg(r,e.measurePageBox()),ex(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,r)}return Jp(this.latestValues)&&ex(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Id.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const s=Boolean(this.resumingFrom)||this!==t;if(!(e||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=Id.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},cg(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Gg(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var n,i,o;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,i=this.relativeTarget,o=this.relativeParent.target,og(n.x,i.x,o.x),og(n.y,i.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Gg(this.target,this.layout.layoutBox),nf(this.target,this.targetDelta)):Gg(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},cg(this.relativeTargetOrigin,this.target,e.target),Gg(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!Xp(this.parent.latestValues)&&!ef(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===Id.timestamp&&(s=!1),s)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;Gg(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,i=this.treeScale.y;!function(e,t,s,r=!1){const a=s.length;if(!a)return;let n,i;t.x=t.y=1;for(let o=0;o<a;o++){n=s[o],i=n.projectionDelta;const{visualElement:a}=n.options;a&&a.props.style&&"contents"===a.props.style.display||(r&&n.options.layoutScroll&&n.scroll&&n!==n.root&&uf(e,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,nf(e,i)),r&&Jp(n.latestValues)&&uf(e,n.latestValues))}t.x<lf&&t.x>of&&(t.x=1),t.y<lf&&t.y>of&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(Kg(this.prevProjectionDelta.x,this.projectionDelta.x),Kg(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ig(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===n&&this.treeScale.y===i&&ox(this.projectionDelta.x,this.prevProjectionDelta.x)&&ox(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,r=s?s.latestValues:{},a={...this.latestValues},n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const i={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Rx));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var l,m,h,p,f,g;Ex(n.x,e.x,s),Ex(n.y,e.y,s),this.setTargetDelta(n),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(cg(i,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h=this.relativeTarget,p=this.relativeTargetOrigin,f=i,g=s,Cx(h.x,p.x,f.x,g),Cx(h.y,p.y,f.y,g),u&&(l=this.relativeTarget,m=u,rx(l.x,m.x)&&rx(l.y,m.y))&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),Gg(u,this.relativeTarget)),o&&(this.animationValues=a,function(e,t,s,r,a,n){a?(e.opacity=yu(0,s.opacity??1,$g(r)),e.opacityExit=yu(t.opacity??1,0,Wg(r))):n&&(e.opacity=yu(t.opacity??1,s.opacity??1,r));for(let i=0;i<Ug;i++){const a=`border${zg[i]}Radius`;let n=qg(t,a),o=qg(s,a);void 0===n&&void 0===o||(n||(n=0),o||(o=0),0===n||0===o||Fg(n)===Fg(o)?(e[a]=Math.max(yu(Bg(n),Bg(o),r),0),(su.test(o)||su.test(n))&&(e[a]+="%")):e[a]=o)}(t.rotate||s.rotate)&&(e.rotate=yu(t.rotate||0,s.rotate||0,r))}(a,r,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Pd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ad.update(()=>{Rg.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=kh(0)),this.currentAnimation=function(e,t,s){const r=zh(e)?e:kh(e);return r.start(Mf("",r,t,s)),r.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:r,latestValues:a}=e;if(t&&s&&r){if(this!==e&&this.layout&&r&&Dx(this.options.animationType,this.layout.layoutBox,r.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=ag(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const r=ag(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+r}Gg(t,s),uf(t,a),ig(this.projectionDeltaWithTransform,this.layoutCorrected,t,a)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new lx);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const r=this.getStack();r&&r.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const r={};s.z&&ux("z",e,r,this.animationValues);for(let a=0;a<cx.length;a++)ux(`rotate${cx[a]}`,e,r,this.animationValues),ux(`skew${cx[a]}`,e,r,this.animationValues);e.render();for(const a in r)e.setStaticValue(a,r[a]),this.animationValues&&(this.animationValues[a]=r[a]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=Pp(t?.pointerEvents)||"",void(e.transform=s?s(this.latestValues,""):"none");const r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=Pp(t?.pointerEvents)||""),void(this.hasProjected&&!Jp(this.latestValues)&&(e.transform=s?s({},""):"none",this.hasProjected=!1));e.visibility="";const a=r.animationValues||r.latestValues;this.applyTransformsToTarget();let n=function(e,t,s){let r="";const a=e.x.translate/t.x,n=e.y.translate/t.y,i=s?.z||0;if((a||n||i)&&(r=`translate3d(${a}px, ${n}px, ${i}px) `),1===t.x&&1===t.y||(r+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:a,rotateY:n,skewX:i,skewY:o}=s;e&&(r=`perspective(${e}px) ${r}`),t&&(r+=`rotate(${t}deg) `),a&&(r+=`rotateX(${a}deg) `),n&&(r+=`rotateY(${n}deg) `),i&&(r+=`skewX(${i}deg) `),o&&(r+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(r+=`scale(${o}, ${l})`),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,a);s&&(n=s(a,n)),e.transform=n;const{x:i,y:o}=this.projectionDelta;e.transformOrigin=`${100*i.origin}% ${100*o.origin}% 0`,r.animationValues?e.opacity=r===this?a.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:e.opacity=r===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const l in mp){if(void 0===a[l])continue;const{correct:t,applyTo:s,isCSSVariable:i}=mp[l],o="none"===n?a[l]:t(a[l],r);if(s){const t=s.length;for(let r=0;r<t;r++)e[s[r]]=o}else i?this.options.visualElement.renderState.vars[l]=o:e[l]=o}this.options.layoutId&&(e.pointerEvents=r===this?Pp(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(bx),this.root.sharedNodes.clear()}}}function px(e){e.updateLayout()}function fx(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=e.layout,{animationType:a}=e.options,n=t.source!==e.layout.source;"size"===a?dg(e=>{const r=n?t.measuredBox[e]:t.layoutBox[e],a=ag(r);r.min=s[e].min,r.max=r.min+a}):Dx(a,t.layoutBox,s)&&dg(r=>{const a=n?t.measuredBox[r]:t.layoutBox[r],i=ag(s[r]);a.max=a.min+i,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+i)});const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};ig(i,s,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};n?ig(o,e.applyTransform(r,!0),t.measuredBox):ig(o,s,t.layoutBox);const l=!sx(i);let c=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:a,layout:n}=r;if(a&&n){const i={x:{min:0,max:0},y:{min:0,max:0}};cg(i,t.layoutBox,a.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};cg(o,s,n.layoutBox),nx(i,o)||(c=!0),r.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=i,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:o,layoutDelta:i,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function gx(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function xx(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function vx(e){e.clearSnapshot()}function bx(e){e.clearMeasurements()}function yx(e){e.isLayoutDirty=!1}function wx(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function jx(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Nx(e){e.resolveTargetDelta()}function kx(e){e.calcProjection()}function _x(e){e.resetSkewAndRotation()}function Sx(e){e.removeLeadSnapshot()}function Ex(e,t,s){e.translate=yu(t.translate,0,s),e.scale=yu(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Cx(e,t,s,r){e.min=yu(t.min,s.min,r),e.max=yu(t.max,s.max,r)}function Rx(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Tx={duration:.45,ease:[.4,0,.1,1]},Ax=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Px=Ax("applewebkit/")&&!Ax("chrome/")?Math.round:ad;function Ix(e){e.min=Px(e.min),e.max=Px(e.max)}function Dx(e,t,s){return"position"===e||"preserve-aspect"===e&&(r=ix(t),a=ix(s),n=.2,!(Math.abs(r-a)<=n));var r,a,n}function Lx(e){return e!==e.root&&e.scroll?.wasRoot}const Ox=hx({attachResizeListener:(e,t)=>tg(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Mx={current:void 0},Vx=hx({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Mx.current){const e=new Ox({});e.mount(window),e.setOptions({layoutScroll:!0}),Mx.current=e}return Mx.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),zx={pan:{Feature:class extends Xf{constructor(){super(...arguments),this.removePointerDownListener=ad}onPointerDown(e){this.session=new hg(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ug(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:Cg(e),onStart:Cg(t),onMove:s,onEnd:(e,t)=>{delete this.session,r&&Ad.postRender(()=>r(e,t))}}}mount(){this.removePointerDownListener=rg(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Xf{constructor(e){super(e),this.removeGroupControls=ad,this.removeListeners=ad,this.controls=new Sg(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ad}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Vx,MeasureLayout:Lg}};function Ux(e,t,s){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===s);const a=r["onHover"+s];a&&Ad.postRender(()=>a(t,sg(t)))}function Bx(e,t,s){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===s);const a=r["onTap"+("End"===s?"":s)];a&&Ad.postRender(()=>a(t,sg(t)))}const Fx=new WeakMap,qx=new WeakMap,$x=e=>{const t=Fx.get(e.target);t&&t(e)},Wx=e=>{e.forEach($x)};function Hx(e,t,s){const r=function({root:e,...t}){const s=e||document;qx.has(s)||qx.set(s,{});const r=qx.get(s),a=JSON.stringify(t);return r[a]||(r[a]=new IntersectionObserver(Wx,{root:e,...t})),r[a]}(t);return Fx.set(e,s),r.observe(e),()=>{Fx.delete(e),r.unobserve(e)}}const Zx={some:0,all:1};const Gx=Kp({...eg,...{inView:{Feature:class extends Xf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:r="some",once:a}=e,n={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof r?r:Zx[r]};return Hx(this.node.current,n,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,a&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:r}=this.node.getProps(),n=t?s:r;n&&n(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Xf{mount(){const{current:e}=this.node;e&&(this.unmount=Mh(e,(e,t)=>(Bx(this.node,t,"Start"),(e,{success:t})=>Bx(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Xf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(yN){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=id(tg(this.node.current,"focus",()=>this.onFocus()),tg(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Xf{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[r,a,n]=Ch(e,s),i=e=>{if(!Rh(e))return;const{target:s}=e,r=t(s,e);if("function"!=typeof r||!s)return;const n=e=>{Rh(e)&&(r(e),s.removeEventListener("pointerleave",n))};s.addEventListener("pointerleave",n,a)};return r.forEach(e=>{e.addEventListener("pointerenter",i,a)}),n}(e,(e,t)=>(Ux(this.node,t,"Start"),e=>Ux(this.node,e,"End"))))}unmount(){}}}},...zx,...{layout:{ProjectionNode:Vx,MeasureLayout:Lg}}},_f);const Kx=o.forwardRef(({className:e,...t},s)=>l.jsx("textarea",{className:Pr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));function Yx({bookTitle:e,chapterNumber:t,question:s,answer:r,attempts:a,maxAttempts:n,setAnswer:i}){return l.jsxs("div",{className:"py-4",children:[l.jsxs("p",{className:"text-body-sm text-foreground/80 mb-4 text-center",children:["Pour valider votre lecture du chapitre ",t,' de "',e,'", veuillez rpondre  la question suivante:']}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"font-medium text-foreground",id:"quiz-question",children:s}),l.jsxs("div",{className:"mt-2",children:[l.jsx(Tl,{htmlFor:"answer",className:"text-body-sm font-medium text-foreground",children:"Votre rponse"}),l.jsx(Kx,{id:"answer",placeholder:"Votre rponse...",rows:3,value:r,onChange:e=>i(e.target.value),className:"w-full border-coffee-medium resize-none mt-1 text-foreground bg-background","aria-describedby":"quiz-question attempts-counter","aria-required":"true"}),l.jsxs("p",{id:"attempts-counter",className:"text-caption text-foreground/70 mt-1","aria-live":"polite",children:["Tentatives: ",a,"/",n]})]})]})]})}function Qx({correctAnswer:e,segment:t,revealedAt:s,onContinue:r}){return l.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 shadow-sm",role:"status","aria-live":"polite","data-testid":"correct-answer-reveal",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"p-2 rounded-full bg-amber-200",children:l.jsx(Nt,{className:"h-5 w-5 text-amber-600"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-amber-800",children:"Bonne rponse rvle"}),l.jsxs("p",{className:"text-sm text-amber-700",children:["Segment ",t," valid avec un Joker"]})]})]}),l.jsxs("div",{className:"mb-4 p-4 bg-white rounded-lg border",children:[l.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"La bonne rponse tait :"}),l.jsx("p",{className:"text-lg font-semibold text-foreground","data-testid":"revealed-answer-text",children:e||"Rponse introuvable (vrifier answer en base et questionId/slug/segment)."})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("p",{className:"text-xs text-amber-600",children:["Rvl le ",new Date(s).toLocaleString("fr-FR")]}),l.jsxs(ya,{onClick:r,className:"bg-amber-600 hover:bg-amber-700 text-white","data-testid":"continue-after-reveal",children:[l.jsx(xe,{className:"h-4 w-4 mr-2"}),"Continuer la lecture"]})]})]})}async function Xx(e,t){try{const{data:s,error:r}=await Vr.from("reading_questions_public").select("id, book_slug, segment, question, book_id").eq("book_slug",e).eq("segment",t).maybeSingle();return r?null:s}catch(s){return null}}Kx.displayName="Textarea";Number(3);function Jx(e=0){return!!Number.isFinite(e)}function ev(e=0){return Math.floor((e||0)/10)+1}async function tv(e){if(!Jx(e.expectedSegments??0))throw new Error("Joker indisponible: ncessite au moins 3 segments.");const t=await async function(e){const{bookId:t,questionId:s,userId:r,consume:a=!0}=e;if(!t||!s||!r)throw new Error("joker-reveal: missing bookId/questionId/userId");const{data:n}=await Vr.auth.getSession(),i=n?.session?.access_token,o=i?{Authorization:`Bearer ${i}`}:void 0,{data:l,error:c}=await Vr.functions.invoke("joker-reveal",{body:{bookId:t,questionId:s,userId:r,consume:a},headers:o});if(c)throw new Error(c.message||"joker-reveal failed");if(!l?.answer)throw new Error("joker-reveal: no answer returned");return l.answer}({bookId:e.bookId,questionId:e.questionId,userId:e.userId,consume:!0});return{answer:t}}async function sv(e,t){try{let s,r;const a=await Vr.from("books_public").select("expected_segments").eq("id",e).maybeSingle();if(!a.error&&a.data)s=a.data,r=null;else{const t=await Vr.from("books").select("expected_segments, id").eq("slug",e).eq("is_published",!0).maybeSingle();!t.error&&t.data?(s=t.data,r=null,e=t.data.id):r=t.error||new Error("Book not found")}if(r||!s)return 0;const{data:n,error:i}=await Vr.from("reading_progress").select("id").eq("user_id",t).eq("book_id",e).single();if(i||!n)return 0;const o=ev(s.expected_segments),{data:l,error:c}=await Vr.from("reading_validations").select("id").eq("progress_id",n.id).eq("used_joker",!0);if(c)return 0;const d=l?.length||0;return Math.max(0,o-d)}catch(s){return 0}}function rv({bookId:e,userId:t,expectedSegments:s=0}){const[r,a]=o.useState(0),[n,i]=o.useState(0),[l,c]=o.useState(0),[d,u]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!e||!t)return a(0),i(0),void c(0);u(!0);try{const r=await sv(e,t),n=ev(s),o=Math.max(0,n-r);a(r),i(n),c(o)}catch(r){a(0),i(0),c(0)}finally{u(!1)}})()},[e,t,s]);return{jokersRemaining:r,jokersAllowed:n,jokersUsed:l,isLoading:d,updateJokersInfo:async()=>{if(e&&t)try{const r=await sv(e,t),n=ev(s),i=Math.max(0,n-r);a(r),c(i)}catch(r){}}}}function av({bookTitle:e,chapterNumber:t,onComplete:s,onClose:r,question:a,expectedSegments:n=0,progressId:i,jokersRemaining:c=0,isUsingJoker:d=!1}){const[u,m]=o.useState(""),[h,p]=o.useState(0),[f,g]=o.useState(!1),[x,v]=o.useState(!1),[b,y]=o.useState(null),[w,j]=o.useState(null),[N,k]=o.useState(null),[_,S]=o.useState(!1),[E,C]=o.useState(!1),R=o.useRef(!1),T=o.useRef(!1),A=o.useRef(null),{user:P}=ha(),I=function(){!ff.current&&gf();const[e]=o.useState(pf.current);return e}();o.useEffect(()=>(T.current=!1,()=>{T.current=!1,A.current?.abort()}),[a?.id]);const{jokersAllowed:D,jokersUsed:L,jokersRemaining:O,updateJokersInfo:M}=rv({bookId:a.book_slug||i||null,userId:P?.id||null,expectedSegments:n}),V=c??O,z=()=>{A.current?.abort(),r()};return l.jsxs(l.Fragment,{children:[l.jsx(Ic,{open:!f&&!x,onOpenChange:z,children:l.jsxs(Mc,{className:"sm:max-w-md border-coffee-medium",children:[l.jsxs(Vc,{children:[l.jsxs(Uc,{id:"quiz-modal-title",className:"text-center text-coffee-darker font-serif",children:["Vrification de lecture: Chapitre ",t]}),l.jsx(Bc,{id:"quiz-modal-description",className:"text-center text-body-sm text-foreground/80",children:"Rpondez par un mot pour valider votre comprhension."})]}),l.jsx(Kh,{mode:"wait",children:l.jsxs(Gx.div,{initial:{opacity:0,y:I?0:8},animate:{opacity:1,y:0},exit:{opacity:0,y:I?0:-8},transition:{duration:.18},children:[l.jsx(Yx,{bookTitle:e,chapterNumber:t,question:a.question,answer:u,attempts:h,maxAttempts:3,setAnswer:m,"data-testid":"quiz-answer-input"}),void 0,l.jsxs(zc,{className:"sm:justify-center gap-2",children:[l.jsx(ya,{variant:"outline",onClick:z,className:"border-coffee-medium text-foreground hover:bg-muted","aria-label":"Annuler le quiz de lecture",children:"Annuler"}),l.jsx(ya,{onClick:async()=>{if(u.trim()){if(!(R.current||E||_||x)){R.current=!0,C(!0);try{if(!P?.id)return void Yr.error("Vous devez tre connect pour valider");const{data:e,error:t}=await Vr.from("books").select("id").eq("slug",a.book_slug).maybeSingle();if(t||!e?.id)return void Yr.error("Erreur lors de la recherche du livre.");A.current?.abort(),A.current=new AbortController;const r=await async function(e){if(e.questionId?.includes("fallback-"))return{ok:!1,blocked:!0,reason:"fallback_id"};if(!e.userId||!e.bookId||!e.questionId)throw new Error("Missing required parameters");let t=e.bookId;t.startsWith("fallback-")&&(t=t.replace("fallback-",""));let s=e.questionId;if(s?.startsWith("fallback-"))return{ok:!1,blocked:!0};try{const{data:r,error:a}=await Vr.rpc("force_validate_segment_beta",{p_book_id:t,p_question_id:s,p_answer:e.answer||"",p_user_id:e.userId,p_used_joker:Boolean(e.usedJoker),p_correct:e.correct??null});if(a)throw new Error(`RPC error: ${a.message}`);return r}catch(r){throw r}}({bookId:e.id,questionId:a.id,answer:u.trim(),userId:P.id,usedJoker:!1,correct:null,signal:A.current.signal});if(r?.ok)Yr.success("Rponse correcte ! Segment valid !"),T.current||(T.current=!0,s({correct:!0,useJoker:!1}));else{const e=h+1;p(e),Yr.error("Rponse incorrecte. Essayez encore !");const t=Jx(n);e>=1&&V>0&&t&&!d?(k(Date.now()),g(!0)):t?e>=3&&(Yr.error("Nombre maximum de tentatives atteint. Ressayez plus tard."),T.current||(T.current=!0,s({correct:!1,useJoker:!1}))):(Yr.error("Les jokers ne sont pas disponibles pour ce livre (moins de 3 segments)."),e>=3&&!T.current&&(T.current=!0,s({correct:!1,useJoker:!1})))}}catch(e){if("AbortError"===e?.name)return;const t=h+1;p(t);const r=Jx(n);r&&V>0&&!d&&t>=1?(k(Date.now()),g(!0)):r?t>=3?(Yr.error("Nombre maximum de tentatives atteint. Ressayez plus tard."),T.current||(T.current=!0,s({correct:!1,useJoker:!1}))):Yr.error(`Rponse incorrecte. Il vous reste ${3-t} tentative(s).`):(Yr.error("Les jokers ne sont pas disponibles pour ce livre (moins de 3 segments)."),t>=3?T.current||(T.current=!0,s({correct:!1,useJoker:!1})):Yr.error(`Rponse incorrecte. Il vous reste ${3-t} tentative(s).`))}finally{R.current=!1,C(!1)}}}else Yr.error("Veuillez entrer une rponse")},disabled:!u.trim()||x||_||E,className:"bg-coffee-dark hover:bg-coffee-darker text-white","aria-label":"Valider ma rponse au quiz","aria-describedby":u.trim()?void 0:"answer-requirement","data-testid":"submit-answer-button",children:E?"Validation...":"Valider ma rponse"}),!u.trim()&&l.jsx("div",{id:"answer-requirement",className:"sr-only","aria-live":"polite",children:"Vous devez saisir une rponse avant de valider"})]})]},"quiz-content")})]})}),l.jsx(Ic,{open:x,onOpenChange:()=>v(!1),children:l.jsxs(Mc,{className:"sm:max-w-md",children:[l.jsx(Vc,{children:l.jsxs(Uc,{className:"text-center font-serif",children:["Segment ",t," valid"]})}),b&&l.jsx(Qx,{correctAnswer:b,segment:t,revealedAt:w??(new Date).toISOString(),onContinue:()=>{v(!1),T.current||(T.current=!0,s({correct:!0,useJoker:!0}))}})]})}),l.jsx(Ic,{open:f,onOpenChange:()=>g(!1),children:l.jsxs(Mc,{className:"sm:max-w-md border-coffee-medium",children:[l.jsxs(Vc,{children:[l.jsx(Uc,{className:"text-center font-serif text-coffee-darker",children:"Utiliser un joker"}),l.jsx(Bc,{className:"text-center text-body-sm text-foreground/80",children:"Rvle la bonne rponse pour ce segment en dpensant un joker."})]}),l.jsx(Kh,{mode:"wait",children:l.jsxs(Gx.div,{initial:{opacity:0,scale:I?1:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:I?1:.98},transition:{duration:.18},children:[l.jsxs("div",{className:"py-4 text-center space-y-4",children:[l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:l.jsx("p",{className:"text-amber-800 text-body-sm",children:"Utiliser un joker rvlera immdiatement la bonne rponse et validera ce segment."})}),l.jsxs("div",{className:"text-body-sm text-muted-foreground",children:[l.jsxs("p",{children:["Jokers restants :"," ",l.jsx("span",{className:"font-semibold text-coffee-dark",children:V})]}),l.jsxs("p",{children:["Segment : ",t]})]})]}),l.jsxs(zc,{className:"sm:justify-center gap-2",children:[l.jsx(ya,{variant:"outline",onClick:()=>{g(!1),k(null),T.current||(T.current=!0,s({correct:!1,useJoker:!1}))},disabled:_,className:"border-coffee-medium text-foreground hover:bg-muted",children:"Annuler"}),l.jsx(ya,{onClick:async()=>{if(g(!1),!_){S(!0);try{if(a?.book_id){a.book_id}const r=await tv({bookId:a.book_id,questionId:a.id,userId:P.id,expectedSegments:n}),i=("string"==typeof r?r:r?.answer??"").trim();if(!i)return void Yr.error("Impossible d'afficher la bonne rponse (donnes manquantes).");if(y(i),j((new Date).toISOString()),v(!0),N)try{await(e={bookId:a.book_slug||"",segment:t,attemptsBefore:h,timeToJokerMs:Date.now()-N},void("undefined"!=typeof window&&window.gtag&&window.gtag("event","joker_used",{book_id:e.bookId,segment:e.segment,attempts_before:e.attemptsBefore,time_to_joker_ms:e.timeToJokerMs,event_category:"reading_validation",custom_parameters:{joker_usage:!0}}))),await function(e){"undefined"!=typeof window&&window.gtag&&window.gtag("event","answer_revealed",{book_id:e.bookId,segment:e.segment,answer_length:e.correctAnswerLength,event_category:"reading_validation",custom_parameters:{answer_revealed:!0,was_correct_before:!1}})}({bookId:a.book_slug||"",segment:t,correctAnswerLength:i.length})}catch(s){}await M(),Yr.success("Joker utilis ! La bonne rponse est rvle.")}catch(r){403===r?.status||/trop court|moins de 3 segments/i.test(r?.message||"")?Yr.error("Jokers indisponibles sur ce livre (moins de 3 segments)."):Yr.error("Erreur lors de l'utilisation du joker. Veuillez ressayer.")}finally{S(!1)}var e}},disabled:_,className:"bg-amber-600 hover:bg-amber-700 text-white",children:_?"Rvlation...":"Utiliser le joker"})]})]},"joker-content")})]})})]})}const nv=o.createContext({showConfetti:()=>{}}),iv=({children:e})=>{const t=o.useRef(null),s=o.useRef(null);o.useEffect(()=>{"undefined"!=typeof window&&t.current&&(s.current=Na.create(t.current,{resize:!0,useWorker:!0}))},[]);const r=o.useCallback(e=>{const t=s.current,r=e?.burst??"big";if(!t)return Na({particleCount:"big"===r?200:100,spread:60,origin:{y:.6},colors:["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"]}),setTimeout(()=>{Na({particleCount:"big"===r?120:60,angle:60,spread:55,origin:{x:0,y:.6}})},150),void setTimeout(()=>{Na({particleCount:"big"===r?120:60,angle:120,spread:55,origin:{x:1,y:.6}})},300);t({particleCount:"big"===r?120:60,angle:60,spread:55,origin:{x:0,y:.6}}),t({particleCount:"big"===r?120:60,angle:120,spread:55,origin:{x:1,y:.6}}),t({particleCount:"big"===r?80:40,spread:70,startVelocity:35,origin:{y:.6}})},[]);return l.jsxs(nv.Provider,{value:{showConfetti:r},children:[l.jsx("div",{className:"pointer-events-none fixed inset-0 z-[9999]",children:l.jsx("canvas",{ref:t,className:"block h-full w-full"})}),e]})};function ov({isOpen:e,onClose:t,segment:s}){const{showConfetti:r}=o.useContext(nv);o.useEffect(()=>{e&&requestAnimationFrame(()=>r({burst:"big"}))},[e,r]);const a=s+1;return l.jsx(Ic,{open:e,onOpenChange:()=>t&&t(),children:l.jsxs(Mc,{className:"sm:max-w-md border-coffee-medium",children:[l.jsx(Vc,{className:"pb-2",children:l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx(xe,{className:"w-16 h-16 text-green-500 mb-2 animate-scale-in"}),l.jsx(Uc,{className:"text-h4 text-center font-serif text-coffee-darker",children:"Parfait !"}),l.jsx(Bc,{className:"sr-only",children:"Votre lecture a t valide avec succs"})]})}),l.jsxs("div",{className:"py-4 text-center",children:[l.jsx("p",{className:"text-coffee-dark mb-2",children:"Votre lecture a t valide avec succs."}),l.jsx("p",{className:"text-muted-foreground",children:"Rendez-vous dans 30 pages pour valider la suite de votre lecture."}),l.jsxs("p",{className:"text-body-sm mt-2 font-medium",children:["Prochain segment  valider : ",a]})]}),l.jsx("div",{className:"flex justify-center mt-4",children:l.jsx(ya,{onClick:()=>t&&t(),className:"bg-coffee-dark hover:bg-coffee-darker",children:"Continuer ma lecture"})})]})})}const lv=o.memo(({book:e,showValidationModal:t,showQuizModal:s,showSuccessMessage:r=!1,validationSegment:a,currentQuestion:n,isValidating:i,isLocked:o=!1,remainingLockTime:c=null,jokersUsed:d=0,jokersAllowed:u=0,jokersRemaining:m=0,isUsingJoker:h=!1,onValidationClose:p,onValidationConfirm:f,onQuizClose:g,onQuizComplete:x,onSuccessClose:v,onLockExpire:b})=>{const y=Number(e?.expectedSegments??e?.expected_segments??e?.totalSegments??e?.total_chapters??0);return t||s||r?l.jsxs(l.Fragment,{children:[t&&a&&l.jsx(l.Fragment,{children:o&&c&&c>0?l.jsx($c,{bookTitle:e.title,segment:a,isOpen:t,isValidating:i,isLocked:!0,remainingLockTime:c,jokersUsed:d,jokersAllowed:u,onClose:p,onValidate:f,onLockExpire:b}):l.jsx($c,{bookTitle:e.title,segment:a,isOpen:t,isValidating:i,jokersUsed:d,jokersAllowed:u,onClose:p,onValidate:f})}),s&&n&&l.jsx(av,{bookTitle:e.title,chapterNumber:n.segment||0,onComplete:x,onClose:g,question:n,expectedSegments:y,progressId:e.id,jokersRemaining:m,isUsingJoker:h}),r&&l.jsx(ov,{isOpen:r,onClose:v,segment:n?.segment||0})]}):null});lv.displayName="BookValidationModals";const cv={legendary:"border-4 border-yellow-400 shadow-lg shadow-yellow-300/30 bg-gradient-to-br from-yellow-100 to-white",epic:"border-2 border-purple-400 shadow-md shadow-purple-300/30 bg-gradient-to-br from-purple-100 to-white",rare:"border border-blue-300 shadow-sm shadow-blue-200/30 bg-gradient-to-br from-blue-50 to-white",common:"border border-gray-200 bg-white"};function dv({badge:e,isLocked:t=!1,className:s,isFavorite:r=!1,onFavoriteToggle:a,showFavoriteToggle:n=!1,isReadOnly:i=!1}){const{name:o,icon:c,description:d,rarity:u="common",dateEarned:m}=e,h=cv[u]||cv.common;return l.jsx(Ir,{children:l.jsxs(Dr,{children:[l.jsx(Lr,{asChild:!0,children:l.jsxs("div",{className:Pr("flex flex-col items-center text-center space-y-3 transition-all duration-200 relative",t?"opacity-70":"hover:scale-105",s),children:[l.jsxs("div",{className:Pr("w-20 h-20 rounded-full flex items-center justify-center relative",h,t?"shadow-sm grayscale":"shadow-md"),children:[l.jsx("span",{className:"text-h2",children:c}),t&&l.jsx("div",{className:"absolute inset-0 rounded-full bg-coffee-dark/20 flex items-center justify-center",children:l.jsx("span",{className:"text-h4",children:""})}),!t&&l.jsx("div",{className:"absolute -bottom-2 text-[10px] font-semibold px-2 py-0.5 rounded-full bg-white shadow text-coffee-dark border border-coffee-light",children:u})]}),!t&&n&&l.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),a?.()},className:"absolute -top-2 -right-2 z-10","aria-label":r?"Retirer des favoris":"Ajouter aux favoris",children:l.jsx(St,{size:20,className:Pr("transition-colors duration-300",r?"fill-yellow-400 text-yellow-500":"text-gray-400 hover:text-yellow-500")})}),l.jsxs("div",{className:"space-y-1 px-1",children:[l.jsx("h3",{className:Pr("font-medium text-body-sm",t?"text-coffee-medium":"text-coffee-darker"),children:o}),l.jsx("p",{className:"text-caption text-muted-foreground line-clamp-2",children:d}),!t&&m&&l.jsxs("p",{className:"text-[10px] font-medium text-coffee-medium mt-1",children:["Obtenu le ",m]})]})]})}),l.jsx(Or,{className:"max-w-[200px] text-body-sm",children:l.jsxs("div",{className:"space-y-1",children:[l.jsx("p",{className:"font-medium",children:o}),l.jsx("p",{className:"text-caption",children:d})]})})]})})}function uv({open:e,badges:t,setOpen:s}){return l.jsx(Ic,{open:e,onOpenChange:s,children:l.jsxs(Mc,{className:"sm:max-w-md border-coffee-medium animate-enter",children:[l.jsxs(Vc,{children:[l.jsx(Uc,{className:"text-center text-h4 font-serif text-coffee-darker",children:" Nouveau badge dbloqu !"}),l.jsx(Bc,{className:"text-center",children:"Flicitations pour cette nouvelle tape dans votre parcours de lecture !"})]}),l.jsxs("div",{className:"py-6 flex flex-col items-center space-y-6",children:[t.map(e=>l.jsx("div",{className:"flex flex-col items-center space-y-3",children:l.jsx(dv,{badge:e,className:"scale-125 animate-scale-in"})},e.id)),l.jsx(ya,{onClick:()=>s(!1),className:"mt-4 bg-coffee-dark hover:bg-coffee-darker",children:"Super !"}),l.jsx(ya,{variant:"outline",className:"border-coffee-light",onClick:()=>{s(!1),window.location.href="/achievements"},children:"Voir tous mes badges"})]})]})})}function mv({open:e,quests:t,setOpen:s}){return l.jsx(Ic,{open:e,onOpenChange:s,children:l.jsxs(Mc,{className:"sm:max-w-md border-amber-500 border-2 animate-enter bg-gradient-to-br from-amber-50 to-yellow-50",children:[l.jsxs(Vc,{children:[l.jsxs(Uc,{className:"text-center text-h3 font-serif text-amber-900 flex items-center justify-center gap-2",children:[l.jsx(T,{className:"h-8 w-8 text-amber-600 animate-pulse"}),"Challenge Complt !",l.jsx(Nt,{className:"h-8 w-8 text-amber-600 animate-pulse"})]}),l.jsx(Bc,{className:"text-center text-amber-800 font-medium",children:" Vous avez accompli un exploit rare et prestigieux !"})]}),l.jsxs("div",{className:"py-6 flex flex-col items-center space-y-6",children:[t.map(e=>l.jsx("div",{className:"w-full bg-white/80 backdrop-blur-sm border-2 border-amber-400 rounded-2xl p-6 shadow-2xl animate-scale-in",children:l.jsxs("div",{className:"flex flex-col items-center space-y-3 text-center",children:[l.jsx("div",{className:"text-5xl mb-2",children:"zap"===e.quest?.icon?l.jsx(Et,{className:"h-12 w-12 text-amber-600"}):""}),l.jsx("h3",{className:"font-serif text-h4 text-amber-900",children:e.quest?.title||e.quest_slug}),l.jsx("p",{className:"text-body text-amber-800",children:e.quest?.description||"Qute accomplie !"}),e.quest?.xp_reward&&l.jsx("div",{className:"mt-2 px-4 py-2 bg-gradient-to-r from-amber-400 to-yellow-400 rounded-full",children:l.jsxs("span",{className:"font-bold text-amber-900 flex items-center gap-1",children:[l.jsx(Et,{className:"h-4 w-4"}),"+",e.quest.xp_reward," XP"]})}),e.quest?.category&&l.jsx("div",{className:"text-caption text-amber-700 uppercase tracking-wider font-semibold",children:e.quest.category})]})},e.id)),l.jsx(ya,{onClick:()=>s(!1),className:"mt-4 bg-gradient-to-r from-amber-600 to-yellow-600 hover:from-amber-700 hover:to-yellow-700 text-white font-bold px-8 py-6 text-lg shadow-lg",children:" Fantastique !"}),l.jsx(ya,{variant:"outline",className:"border-2 border-amber-400 text-amber-900 hover:bg-amber-50",onClick:()=>{s(!1),window.location.href="/achievements"},children:"Voir toutes mes qutes"})]})]})})}var hv=Object.prototype.hasOwnProperty;const pv=new WeakMap,fv=()=>{},gv=fv(),xv=Object,vv=e=>e===gv,bv=e=>"function"==typeof e,yv=(e,t)=>({...e,...t}),wv={},jv={},Nv="undefined",kv=typeof window!=Nv,_v=typeof document!=Nv,Sv=kv&&"Deno"in window;let Ev=!0;const[Cv,Rv]=kv&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[fv,fv],Tv={isOnline:()=>Ev,isVisible:()=>{const e=_v&&document.visibilityState;return vv(e)||"hidden"!==e}},Av={initFocus:e=>(_v&&document.addEventListener("visibilitychange",e),Cv("focus",e),()=>{_v&&document.removeEventListener("visibilitychange",e),Rv("focus",e)}),initReconnect:e=>{const t=()=>{Ev=!0,e()},s=()=>{Ev=!1};return Cv("online",t),Cv("offline",s),()=>{Rv("online",t),Rv("offline",s)}}};h.useId;const Pv=!kv||Sv,Iv="undefined"!=typeof navigator&&navigator.connection,Dv=!Pv&&Iv&&(["slow-2g","2g"].includes(Iv.effectiveType)||Iv.saveData),Lv=new WeakMap,Ov=(e,t)=>e===`[object ${t}]`;let Mv=0;const Vv=e=>{const t=typeof e,s=(r=e,xv.prototype.toString.call(r));var r;const a=Ov(s,"Date"),n=Ov(s,"RegExp"),i=Ov(s,"Object");let o,l;if(xv(e)!==e||a||n)o=a?e.toJSON():"symbol"==t?e.toString():"string"==t?JSON.stringify(e):""+e;else{if(o=Lv.get(e),o)return o;if(o=++Mv+"~",Lv.set(e,o),Array.isArray(e)){for(o="@",l=0;l<e.length;l++)o+=Vv(e[l])+",";Lv.set(e,o)}if(i){o="#";const t=xv.keys(e).sort();for(;!vv(l=t.pop());)vv(e[l])||(o+=l+":"+Vv(e[l])+",");Lv.set(e,o)}}return o};let zv=0;const Uv=()=>++zv;async function Bv(...e){const[t,s,r,a]=e,n=yv({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{});let i=n.populateCache;const o=n.rollbackOnError;let l=n.optimisticData;const c=n.throwOnError;if(bv(s)){const e=s,r=[],a=t.keys();for(const s of a)!/^\$(inf|sub)\$/.test(s)&&e(t.get(s)._k)&&r.push(s);return Promise.all(r.map(d))}return d(s);async function d(s){const[a]=(e=>{if(bv(e))try{e=e()}catch(s){e=""}const t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?Vv(e):"",t]})(s);if(!a)return;const[d,u]=((e,t)=>{const s=pv.get(e);return[()=>!vv(t)&&e.get(t)||wv,r=>{if(!vv(t)){const a=e.get(t);t in jv||(jv[t]=a),s[5](t,yv(a,r),a||wv)}},s[6],()=>!vv(t)&&t in jv?jv[t]:!vv(t)&&e.get(t)||wv]})(t,a),[m,h,p,f]=pv.get(t),g=()=>{const e=m[a];return(bv(n.revalidate)?n.revalidate(d().data,s):!1!==n.revalidate)&&(delete p[a],delete f[a],e&&e[0])?e[0](2).then(()=>d().data):d().data};if(e.length<3)return g();let x,v=r,b=!1;const y=Uv();h[a]=[y,0];const w=!vv(l),j=d(),N=j.data,k=j._c,_=vv(k)?N:k;if(w&&(l=bv(l)?l(_,N):l,u({data:l,_c:_})),bv(v))try{v=v(_)}catch(S){x=S,b=!0}if(v&&bv(v.then)){if(v=await v.catch(e=>{x=e,b=!0}),y!==h[a][0]){if(b)throw x;return v}b&&w&&(e=>"function"==typeof o?o(e):!1!==o)(x)&&(i=!0,u({data:_,_c:gv}))}if(i&&!b)if(bv(i)){const e=i(v,_);u({data:e,error:gv,_c:gv})}else u({data:v,error:gv,_c:gv});if(h[a][1]=Uv(),Promise.resolve(g()).then(()=>{u({_c:gv})}),!b)return v;if(c)throw x}}const Fv=(e,t)=>{for(const s in e)e[s][0]&&e[s][0](t)},qv=function e(t,s){var r,a;if(t===s)return!0;if(t&&s&&(r=t.constructor)===s.constructor){if(r===Date)return t.getTime()===s.getTime();if(r===RegExp)return t.toString()===s.toString();if(r===Array){if((a=t.length)===s.length)for(;a--&&e(t[a],s[a]););return-1===a}if(!r||"object"==typeof t){for(r in a=0,t){if(hv.call(t,r)&&++a&&!hv.call(s,r))return!1;if(!(r in s)||!e(t[r],s[r]))return!1}return Object.keys(s).length===a}}return t!=t&&s!=s},[$v,Wv]=((e,t)=>{if(!pv.has(e)){const s=yv(Av,t),r=Object.create(null),a=Bv.bind(gv,e);let n=fv;const i=Object.create(null),o=(e,t)=>{const s=i[e]||[];return i[e]=s,s.push(t),()=>s.splice(s.indexOf(t),1)},l=(t,s,r)=>{e.set(t,s);const a=i[t];if(a)for(const e of a)e(s,r)},c=()=>{if(!pv.has(e)&&(pv.set(e,[r,Object.create(null),Object.create(null),Object.create(null),a,l,o]),!Pv)){const t=s.initFocus(setTimeout.bind(gv,Fv.bind(gv,r,0))),a=s.initReconnect(setTimeout.bind(gv,Fv.bind(gv,r,1)));n=()=>{t&&t(),a&&a(),pv.delete(e)}}};return c(),[e,a,c,n]}return[e,pv.get(e)[4]]})(new Map);yv({onLoadingSlow:fv,onSuccess:fv,onError:fv,onErrorRetry:(e,t,s,r,a)=>{const n=s.errorRetryCount,i=a.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*s.errorRetryInterval;!vv(n)&&i>n||setTimeout(r,o,a)},onDiscarded:fv,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Dv?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:Dv?5e3:3e3,compare:qv,isPaused:()=>!1,cache:$v,mutate:Wv,fallback:{}},Tv),o.createContext({});const Hv=(e,t,s,r=!1,a)=>{const[n,i]=o.useState(!1),[l,c]=o.useState(0),[d,u]=o.useState(null),[m,h]=o.useState(!1),[p,f]=o.useState(!1),[g,x]=o.useState(null),[v,b]=o.useState(!1),[y,w]=o.useState(0);return{showQuiz:n,setShowQuiz:i,quizChapter:l,currentQuestion:d,showSuccessMessage:m,setShowSuccessMessage:h,isValidating:r,prepareAndShowQuestion:async s=>{if(!t||!e||!e.id)throw new Error("User or book information missing");try{a&&a(!0);const r=await(async(e,t,s)=>{try{const r=`lock_${e}_${t}_${s}`,a=sessionStorage.getItem(r);if(a){const e=JSON.parse(a),t=new Date,s=new Date(e.lockedUntil);if(s>t)return{isLocked:!0,remainingTime:Math.floor((s.getTime()-t.getTime())/1e3)};sessionStorage.removeItem(r)}const{data:n,error:i}=await Vr.from("validation_locks").select("locked_until").eq("user_id",e).eq("book_id",t).eq("segment",s).maybeSingle();if(i)return{isLocked:!1,remainingTime:null};if(!n)return{isLocked:!1,remainingTime:null};const o=new Date,l=new Date(n.locked_until),c=l>o,d=c?Math.floor((l.getTime()-o.getTime())/1e3):null;return c&&sessionStorage.setItem(r,JSON.stringify({lockedUntil:n.locked_until})),{isLocked:c,remainingTime:d}}catch(r){return{isLocked:!1,remainingTime:null}}})(t,e.id,s);if(r.isLocked&&null!==r.remainingTime)return f(!0),void x(r.remainingTime);const n=await async function(e,t,s){try{const{data:r,error:a}=await Vr.from("reading_validations").select("id").eq("user_id",e).eq("book_id",t).eq("segment",s).maybeSingle();return!a&&!!r}catch(r){return!1}}(t,e.id,s);if(n)return void Yr.info("Ce segment a dj t valid");const o=await sv(e.id,t);w(o);const l=await Xx(e.slug||e.id,s);if(!l)return void Yr.error("Aucune question trouve pour ce segment");u(l),c(s),i(!0)}catch(r){throw Yr.error("Erreur lors de la prparation du quiz"),r}finally{a&&a(!1)}},handleQuizComplete:async(r,n=!1)=>{if(t&&e&&e.id)try{return a&&a(!0),r?(i(!1),h(!0),Wv(["jokers-info",e.id]),Wv(["book-progress",e.id]),Wv(e=>"string"==typeof e&&e.includes("reading-progress"),void 0,{revalidate:!0}),s&&s(e.id),{success:!0,newBadges:[]}):(i(!1),{canUseJoker:y>0})}catch(o){return{canUseJoker:y>0}}finally{a&&a(!1),b(!1)}else Yr.error("Information utilisateur ou livre manquante")},isLocked:p,remainingLockTime:g,handleLockExpire:()=>{f(!1),x(null)},isUsingJoker:v,jokersRemaining:y}};async function Zv(e){try{if(!e)return null;const{data:t,error:s}=await Vr.from("user_levels").select("*").eq("user_id",e).maybeSingle();return s?null:t||async function(e){try{const t={user_id:e,xp:0,level:1},{data:s,error:r}=await Vr.from("user_levels").insert(t).select().single();return r?null:s}catch(s){return null}}(e)}catch(t){return null}}async function Gv(e,t){try{if(!e)return!1;if(t<=0)return!1;const r=await Zv(e);if(!r)return!1;const a=r.xp+t,n=r.level,i=(s=a)>=1e3?5:s>=500?4:s>=250?3:s>=100?2:1,{error:o}=await Vr.from("user_levels").update({xp:a,level:i,last_updated:(new Date).toISOString()}).eq("user_id",e);return!o&&(i>n&&Yr.success(`Niveau suprieur ! Vous tes maintenant niveau ${i}`,{duration:5e3}),!0)}catch(r){return!1}var s}const Kv=(e,t)=>e?!!t||(Yr.error("Information du livre manquante : Impossible de valider sans les informations du livre",{duration:3e3}),!1):(Yr.error("Vous devez tre connect pour valider votre lecture : Connectez-vous pour enregistrer votre progression.",{duration:5e3}),!1);async function Yv(e){if(!e)return null;try{const t=new Date,s=t.getFullYear(),r=t.getMonth()+1,a=`${s}-${r.toString().padStart(2,"0")}`,n=await async function(e,t){if(!e)return!1;const{data:s,error:r}=await Vr.from("user_monthly_rewards").select("id").eq("user_id",e).eq("month",t).maybeSingle();return!r&&!!s}(e,a);if(n)return null;const i=await async function(e,t,s){if(!e)return[];const r=new Date(t,s-1,1).toISOString(),a=new Date(t,s,0).toISOString(),{data:n,error:i}=await Vr.from("reading_validations").select("*").eq("user_id",e).gte("validated_at",r).lte("validated_at",a);return i?[]:n||[]}(e,s,r);if(i.length>=10){const t=function(e,t){const s=new Date(e,t-1,1).toLocaleString("fr-FR",{month:"long"}),r=t.toString().padStart(2,"0");return{id:`gift-${e}-${r}`,label:`Cadeau du mois : ${s} ${e}`,slug:`gift-${e}-${r}`,name:`Cadeau du mois : ${s} ${e}`,description:`Rcompense pour avoir valid plus de 10 segments en ${s} ${e}`,icon:"",color:"amber-100",rarity:"epic"}}(s,r),n=await async function(e,t,s){try{const{error:r}=await Vr.from("user_monthly_rewards").insert({user_id:e,badge_id:t,month:s});return!r}catch(r){return!1}}(e,t.id,a);if(n)return await Fl(e,t.id),t}return null}catch(t){return null}}function Qv({badge:e,isOpen:t,onClose:s}){const r=o.useRef(null);return o.useEffect(()=>{if(t&&e){const e=5e3,t=Date.now()+e,s=(e,t)=>Math.random()*(t-e)+e,r=setInterval(()=>{if(t-Date.now()<=0)return clearInterval(r);Na({particleCount:3,angle:s(60,120),spread:s(50,70),origin:{y:.6},colors:["#FFD700","#FFA500","#FF4500"]}),Na({particleCount:2,angle:s(60,120),spread:s(50,70),origin:{y:.6},shapes:["star"],colors:["#FFD700","#FFA500"]})},250);return()=>clearInterval(r)}},[t,e]),e?l.jsx(Ic,{open:t,onOpenChange:s,children:l.jsxs(Mc,{className:"sm:max-w-md border-amber-300 animate-enter bg-gradient-to-b from-amber-50 to-white",children:[l.jsx("div",{ref:r,className:"absolute inset-0 pointer-events-none"}),l.jsxs(Vc,{children:[l.jsx(Uc,{className:"text-center text-h3 font-serif text-amber-800",children:" Cadeau Mystre du Mois "}),l.jsx(Bc,{className:"text-center text-amber-700",children:"Bravo ! Tu as valid plus de 10 segments ce mois-ci !"})]}),l.jsxs("div",{className:"py-8 flex flex-col items-center space-y-8",children:[l.jsxs("div",{className:"relative animate-bounce duration-1000",children:[l.jsx("div",{className:"absolute inset-0 bg-amber-300 rounded-full opacity-20 animate-ping"}),l.jsx(dv,{badge:e,className:"scale-150 animate-scale-in relative z-10"})]}),l.jsx("p",{className:"text-center text-h4 text-amber-700 font-medium",children:e.label}),l.jsx("p",{className:"text-center text-body-sm text-amber-600",children:e.description}),l.jsx(ya,{onClick:s,className:"mt-4 bg-amber-500 hover:bg-amber-600 text-white px-8 py-6 text-h4",children:"Gnial, merci !"})]})]})}):null}function Xv({monthlyReward:e,showMonthlyReward:t,onClose:s}){return l.jsx(Qv,{badge:e,isOpen:t,onClose:s})}const Jv=({book:e,userId:t,onProgressUpdate:s,currentBook:r,setCurrentBook:a,refreshProgressData:n,refreshReadingProgress:i,user:l,onChapterComplete:c})=>{const d=o.useRef(null),[u,m]=o.useState(!1),[h,p]=o.useState([]),[f,g]=o.useState(!1),[x,v]=o.useState([]),[b,y]=o.useState(null),w=o.useRef([]),{isValidating:j,setIsValidating:N,validationSegment:k,setValidationSegment:_,validationError:S,setValidationError:E}=(()=>{const[e,t]=o.useState(!1),[s,r]=o.useState(null),[a,n]=o.useState(null);return{isValidating:e,setIsValidating:t,validationSegment:s,setValidationSegment:r,validationError:a,setValidationError:n,resetValidationState:()=>{n(null),r(null),t(!1)}}})();o.useEffect(()=>()=>{w.current.forEach(clearTimeout),w.current=[]},[]);const C=()=>{try{w.current.forEach(clearTimeout),w.current=[],Na({particleCount:200,spread:70,origin:{y:.6}});const e=setTimeout(()=>{Na({particleCount:100,angle:60,spread:55,origin:{x:0}}),Na({particleCount:100,angle:120,spread:55,origin:{x:1}})},250);w.current.push(e)}catch(e){}},{forceRefresh:R}=El(),{monthlyReward:T,showMonthlyReward:A,setShowMonthlyReward:P}=function(e){const[t,s]=o.useState(null),[r,a]=o.useState(!1);return o.useEffect(()=>{e&&Yv(e).then(e=>{e&&(s(e),a(!0))})},[e]),{monthlyReward:t,showMonthlyReward:r,setShowMonthlyReward:a}}(t),{showQuiz:I,setShowQuiz:D,quizChapter:L,currentQuestion:O,showSuccessMessage:M,setShowSuccessMessage:V,prepareAndShowQuestion:z,handleQuizComplete:U,isLocked:B,remainingLockTime:F,handleLockExpire:q,isUsingJoker:$,jokersRemaining:W}=Hv(e,t,s,j,N),{newBadges:H,newQuests:Z,handleQuizComplete:G}=(({book:e,userId:t,originalHandleQuizComplete:s,onProgressUpdate:r})=>{const[a,n]=o.useState([]),[i,l]=o.useState([]),{forceRefresh:c}=El();return{newBadges:a,setNewBadges:n,newQuests:i,setNewQuests:l,handleQuizComplete:async(a,i)=>{try{const o=await s(a,i);if(a&&t&&e?.id){c(),r&&r(e.id);const s=[0,100,300];for(const r of s)setTimeout(async()=>{try{await kl(t,e.id)}catch(s){}},r)}return o?.newBadges&&o.newBadges.length>0?(n(o.newBadges),t&&o.newBadges.some(e=>e.id&&e.id.includes("streak"))&&await Gv(t,30)):n([]),o?.newQuests&&o.newQuests.length>0?(l(o.newQuests),o.newQuests.forEach(e=>{const t=e.quest?.title||e.quest_slug,s=e.quest?.xp_reward||100;Yr.success(` Challenge Complt : ${t}`,{description:`+${s} XP  Exploit rare dbloqu !`,duration:8e3,className:"quest-toast-special bg-gradient-to-r from-amber-100 to-yellow-100 border-2 border-amber-400"})})):l([]),o}catch(o){try{c()}catch(d){}throw o}}}})({book:e,userId:t,originalHandleQuizComplete:U,onProgressUpdate:s}),K=b||k,Y=o.useCallback(s=>{if(!t)return void Yr.error("Vous devez tre connect pour commencer ou valider votre lecture");const a=(s?.chaptersRead||(r||e)?.chaptersRead||0)+1;y(a),_(a),d.current||(d.current=new Date)},[t,r,e,_]),Q=Bo(qo(async s=>{if(s.preventDefault(),s.stopPropagation(),E(null),Kv(t,e)&&(!e||!(e=>e.chaptersRead>=e.totalChapters&&(Yr.success("Vous avez dj termin ce livre ! : Votre progression a t entirement enregistre.",{duration:3e3}),!0))(e)))try{N(!0);const t=(e.chaptersRead||0)+1;y(t),_(t)}catch(r){const e=r instanceof Error?r.message:String(r);E(e),((e,t)=>{const s=e instanceof Error?e.message:String(e);Yr.error(`Erreur lors ${t} : ${s.substring(0,100)}`,{duration:5e3})})(r,"de la prparation de la validation")}finally{N(!1)}},"useBookValidation.handleValidateReading")),X=Bo(qo(async()=>{if(!Kv(t,e))return;let s=K;if(!s&&e&&(s=(e.chaptersRead||0)+1,y(s),_(s)),s)try{N(!0),await z(s),R()}catch(r){Yr.error("Erreur de validation",{description:r.message||"Impossible de prparer la validation",duration:5e3}),R()}finally{N(!1)}else Yr.error("Impossible de dterminer le segment  valider",{duration:3e3})},"useBookValidation.handleValidationConfirm")),J=o.useCallback(async(s,a)=>{if(a&&s)return C(),{success:!0,newBadges:[]};s&&C();const i=await G(s,!1);if(s&&i){if(t){if(i?.newBadges&&i.newBadges.length>0&&(p(i.newBadges),m(!0)),i?.newQuests&&i.newQuests.length>0&&(v(i.newQuests),g(!0)),(r||e)?.isCompleted){const s=localStorage.getItem(`completed_books_${t}`)?JSON.parse(localStorage.getItem(`completed_books_${t}`)||"[]"):[];s.some(t=>t.id===(r||e).id)||(s.push(r||e),localStorage.setItem(`completed_books_${t}`,JSON.stringify(s)))}if(d.current){const e=new Date;(async(e,t,s)=>{try{if(Math.round((s.getTime()-t.getTime())/6e4)<1)return}catch(r){}})(0,d.current,e),d.current=null}try{await Yv(t)&&setTimeout(()=>{P(!0)},1500)}catch(o){}}Yr.success("Segment valid avec succs !")}return n&&await n(),R(),i},[G,C,n,R,t,a,r,e,m,p,P]),ee=o.useCallback(e=>J(e.correct,e.useJoker),[J]);return o.useMemo(()=>({isValidating:j,showQuiz:I,setShowQuiz:D,quizChapter:L,validationSegment:K,setValidationSegment:y,currentQuestion:O,showSuccessMessage:M,setShowSuccessMessage:V,handleValidateReading:Q,prepareAndShowQuestion:z,handleQuizComplete:ee,handleValidationConfirm:X,showConfetti:C,validationError:S,isLocked:B,remainingLockTime:F,handleLockExpire:q,newBadges:H,forceRefresh:R,showBadgeDialog:u,setShowBadgeDialog:m,unlockedBadges:h,showQuestDialog:f,setShowQuestDialog:g,unlockedQuests:x,newQuests:Z,monthlyReward:T,showMonthlyReward:A,setShowMonthlyReward:P,handleMainButtonClick:Y,sessionStartTimeRef:d,isUsingJoker:$,jokersRemaining:W}),[j,I,D,L,K,y,O,M,V,Q,z,ee,X,C,S,B,F,q,H,R,u,h,f,x,Z,T,A,Y,$,W])},eb=class e{constructor(){a(this,"metrics",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}trackRender(e){}trackApiCall(e){}trackError(e,t){const s=this.metrics.get(e)||{renderCount:0,lastRenderTime:Date.now(),apiCallCount:0,errorCount:0};s.errorCount++,this.metrics.set(e,s)}getReport(){let e=" RAPPORT DE PERFORMANCE\n\n";return this.metrics.forEach((t,s)=>{e+=`${s}:\n`,e+=`  - Rendus: ${t.renderCount}\n`,e+=`  - API Calls: ${t.apiCallCount}\n`,e+=`  - Erreurs: ${t.errorCount}\n\n`}),e}logReport(){}};a(eb,"instance");let tb=eb;const sb=o.memo(({children:e})=>l.jsx(l.Fragment,{children:e}),(e,t)=>e.deps&&t.deps?e.deps.every((e,s)=>e===t.deps[s]):e.children===t.children);function rb({validations:e}){return e?.length?l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-h4 font-medium text-coffee-darker flex items-center",children:[l.jsx(Ct,{className:"mr-2 h-5 w-5"}),"Historique de mes validations"]})}),l.jsx(al,{children:l.jsx("div",{className:"space-y-3",children:e.slice().reverse().map((e,t)=>l.jsxs("div",{className:"flex gap-3 pb-3 border-b border-coffee-lightest last:border-b-0",children:[l.jsx("div",{className:"flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-coffee-lightest text-coffee-dark",children:e.used_joker?l.jsx(Nt,{className:"h-4 w-4"}):l.jsx(gt,{className:"h-4 w-4"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("p",{className:"font-medium text-body-sm text-coffee-darker",children:["Validation du segment ",e.segment," (pages ",30*(e.segment-1)+1,"-",30*e.segment,")"]}),e.used_joker&&l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-caption bg-amber-100 text-amber-700 rounded-full",children:[l.jsx(Nt,{className:"h-3 w-3"}),"Joker utilis"]})]}),l.jsx("p",{className:"text-caption text-muted-foreground",children:new Date(e.validated_at||e.date_validated).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]},t))})})]}):null}function ab(e){return o.useMemo(()=>Number(e?.expectedSegments??e?.expected_segments??e?.totalSegments??e?.total_chapters??0),[e])}sb.displayName="MemoizedComponent";const nb=({book:e,onChapterComplete:t})=>{const{trackRender:s,trackError:r}=(e=>{const t=tb.getInstance();return{trackRender:()=>t.trackRender(e),trackApiCall:()=>t.trackApiCall(e),trackError:s=>t.trackError(e,s)}})("BookDetail"),{currentBook:a,setCurrentBook:n,progressPercent:i,readingProgress:c,progressRef:d,refreshReadingProgress:u,refreshProgressData:m,user:h}=function(e){const[t,s]=o.useState(e),[r,a]=o.useState(0),[n,i]=o.useState(null),l=o.useRef(null),{user:c}=ha(),{refetch:d}=El(),u=o.useRef(null),m=t?.id||t?.slug||"",h=o.useCallback(async()=>{if(c?.id&&m)try{u.current&&clearTimeout(u.current);const e=await kl(c.id,m);if(e){i(e);const t=e.chaptersRead||0;s(s=>({...s,chaptersRead:t,progressPercent:e.progressPercent,currentSegment:e.currentSegment})),a(e.progressPercent||0),setTimeout(()=>{l.current&&(l.current.style.transform="translateZ(0)")},0)}}catch(e){Yr.error("Erreur lors du chargement de la progression du livre")}},[c?.id,m]);return o.useEffect(()=>{(async()=>{c?.id&&m&&await h()})()},[c?.id,m,h]),o.useEffect(()=>{n&&a(n.progressPercent||0)},[n]),{currentBook:t,setCurrentBook:s,progressPercent:r,setProgressPercent:a,readingProgress:n,setReadingProgress:i,progressRef:l,refreshReadingProgress:d,refreshProgressData:h,user:c}}(e),{isValidating:p,showQuiz:f,setShowQuiz:g,validationSegment:x,setValidationSegment:v,currentQuestion:b,showSuccessMessage:y,setShowSuccessMessage:w,prepareAndShowQuestion:j,handleQuizComplete:N,handleValidationConfirm:k,showConfetti:_,isLocked:S,remainingLockTime:E,handleLockExpire:C,forceRefresh:R,showBadgeDialog:T,setShowBadgeDialog:A,unlockedBadges:P,showQuestDialog:I,setShowQuestDialog:D,unlockedQuests:L,monthlyReward:O,showMonthlyReward:M,setShowMonthlyReward:V,handleMainButtonClick:z,sessionStartTimeRef:U,isUsingJoker:B,jokersRemaining:F}=Jv({book:a,userId:h?.id||null,currentBook:a,setCurrentBook:n,refreshProgressData:m,refreshReadingProgress:u,user:h,onChapterComplete:t}),[q,$]=o.useState(!1),[W,H]=o.useState([]),Z=ab(a),G=function(e){const t=Number(e??0);return!Number.isFinite(t)||t<3?0:Math.floor(t/10)+1}(Z),{jokersUsed:K}=rv({bookId:a?.id||null,userId:h?.id||null,expectedSegments:Z}),Y=G,Q=o.useMemo(()=>{const e=c?.chaptersRead||a.chaptersRead||0,t=c?.totalSegments||a.totalChapters||a.expectedSegments||a.total_chapters||1,s=e>=t;return{chaptersRead:e,totalChapters:t,isBookCompleted:s,showValidationButton:!s}},[c?.chaptersRead,c?.totalSegments,a.chaptersRead,a.totalChapters,a.expectedSegments,a.total_chapters]);o.useEffect(()=>{(async()=>{if(h?.id&&a?.id)try{const e=await async function(e,t){try{const{data:s,error:r}=await Vr.from("reading_validations").select("*").eq("user_id",e).eq("book_id",t).order("segment",{ascending:!0});return r?[]:s||[]}catch(s){return[]}}(h.id,a.id);H(e)}catch(e){H([])}})()},[a?.id,h?.id]);const X=Bo(qo(()=>{const e=(c?.chaptersRead||a?.chaptersRead||0)+1;if(e<=0)return r(new Error("Invalid segment calculated")),void Yr.error("Impossible de dterminer le segment  valider");v(e),$(!0),U.current||(U.current=new Date)},"BookDetail.handleOpenValidationModal")),J=Bo(qo(()=>{if(!x){const e=(c?.chaptersRead||a?.chaptersRead||0)+1;if(!e||e<=0)return r(new Error("Unable to calculate valid segment")),void Yr.error("Impossible de dterminer le segment  valider");v(e)}$(!1),k()},"BookDetail.handleModalValidationConfirm"));return o.useEffect(()=>{if(q&&x){c&&x<=(c.chaptersRead||0)&&($(!1),Promise.all([m(),R()]).catch(e=>{r(e)}))}},[q,x,c?.chaptersRead,m,R,r]),s(),l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(Rc,{title:a.title}),l.jsxs(al,{className:"space-y-4",children:[l.jsxs(sb,{deps:[a.id,a.title],children:[l.jsx(Tc,{book:a}),l.jsx(Ac,{description:a.description})]}),Q.isBookCompleted?l.jsx(sb,{deps:[Q.isBookCompleted],children:l.jsx("div",{className:"bg-green-50 p-4 rounded-md border border-green-200 text-center",children:l.jsx("p",{className:"text-green-800 font-medium",children:"Flicitations ! Vous avez termin ce livre."})})}):Q.showValidationButton&&l.jsx(sb,{deps:[Q.chaptersRead,p],children:l.jsx(l.Fragment,{children:l.jsx(ya,{variant:"bookCta",disabled:p,onClick:X,className:"w-full py-3 text-h4 font-serif my-4",children:l.jsx("span",{className:"!text-white",children:Q.chaptersRead>0?"Valider ma lecture":"Commencer ma lecture"})})})}),l.jsx(sb,{deps:[Q.chaptersRead,Q.totalChapters,i,K,Y],children:l.jsxs(l.Fragment,{children:[l.jsxs("p",{className:"text-muted-foreground text-center",children:["Progression : ",Q.chaptersRead," / ",Q.totalChapters," segments valids."]}),l.jsx(Pc,{progressPercent:i,jokersUsed:K,jokersAllowed:Y,ref:d})]})}),(q||f||y)&&l.jsx(lv,{book:a,showValidationModal:q,showQuizModal:f,showSuccessMessage:y,validationSegment:x,currentQuestion:b,isValidating:p,isLocked:S,remainingLockTime:E,jokersUsed:K,jokersAllowed:Y,jokersRemaining:F,isUsingJoker:B,onValidationClose:()=>$(!1),onValidationConfirm:J,onQuizClose:()=>g(!1),onQuizComplete:N,onSuccessClose:()=>w(!1),onLockExpire:C}),T&&l.jsx(uv,{open:T,badges:P,setOpen:A}),I&&l.jsx(mv,{open:I,quests:L,setOpen:D}),M&&l.jsx(Xv,{monthlyReward:O,showMonthlyReward:M,onClose:()=>V(!1)}),W.length>0&&l.jsx(sb,{deps:[W.length],children:l.jsx(rb,{validations:W})})]})]})};const ib=async e=>{const t=await(async e=>{if(!e)return[];const{data:t,error:s}=await Vr.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!0});return s?[]:t})(e);if(!t||t.length<3)return{has3DayStreak:!1,has5DayStreak:!1,has7DayStreak:!1};const s=new Set;t.forEach(e=>{const t=e.validated_at||e.date_validated||"";if(t){const e=new Date(t).toISOString().split("T")[0];s.add(e)}});const r=Array.from(s).sort();let a=1,n=1,i=r[0];for(let o=1;o<r.length;o++){const e=new Date(r[o]),t=new Date(r[o-1]),s=(e.getTime()-t.getTime())/864e5;1===s?(n++,i=r[o]):s>1&&(n>a&&(a=n),n=1,i=r[o])}return n>a&&(a=n),{has3DayStreak:a>=3,has5DayStreak:a>=5,has7DayStreak:a>=7,endDate:i,streakLength:a}};let ob=null;const lb=async()=>{if(ob)return ob;try{const{data:e,error:t}=await Vr.from("quests").select("slug, title, description, icon, category, xp_reward").order("created_at",{ascending:!0});return t?[]:(ob=e||[],ob)}catch(e){return[]}},cb=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(e).toLocaleString("en-US",{timeZone:s,hour12:!1});return new Date(r).getHours()},db=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(e).toLocaleString("en-US",{timeZone:s,weekday:"long",year:"numeric",month:"numeric",day:"numeric"});return new Date(r).getDay()},ub=(e,t)=>{const s=Intl.DateTimeFormat().resolvedOptions().timeZone;return new Date(e).toLocaleDateString("en-CA",{timeZone:s})};lb().then(e=>{});const mb=async(e,t)=>{try{if(!e||!t)return null;const{data:s,error:r}=await Vr.from("user_quests").select("*").eq("user_id",e).eq("quest_slug",t).maybeSingle();if(r&&"PGRST116"!==r.code)return null;if(s)return null;const{data:a,error:n}=await Vr.from("user_quests").insert({user_id:e,quest_slug:t,unlocked_at:(new Date).toISOString()}).select().single();if(n)return null;const i=(await lb()).find(e=>e.slug===t),o=i?.xp_reward||100;await Gv(e,o);return{...a,quest:i}}catch(s){s instanceof Error&&s.message;return null}},hb=async(e,t)=>{try{if(!e||!t)return null;const s=await jl(e),{data:r}=await Vr.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!1});if(!r)return null;const a=s.filter(e=>"completed"===e.status),{data:n}=await Vr.rpc("get_user_streaks",{user_id:e}),i=n?.current||0;switch(t){case"marathon_reader":{const e=ub((new Date).toISOString()),t=r.filter(t=>ub(t.validated_at)===e).length;return{current:Math.min(t,10),target:10}}case"night_marathon":{const e=r.filter(e=>{const t=cb(e.validated_at);return t>=22||t<6}).length;return{current:Math.min(e,5),target:5}}case"binge_reading":{if(a.length<3)return{current:a.length,target:3};const e=[...a].sort((e,t)=>new Date(e.updated_at).getTime()-new Date(t.updated_at).getTime());let t=0;for(let s=0;s<=e.length-3;s++){const r=new Date(e[s].updated_at),a=new Date(e[s+2].updated_at);if(Math.floor((a.getTime()-r.getTime())/864e5)<=7){t=3;break}}return{current:t||a.length,target:3}}case"unstoppable":case"perfect_month":return{current:Math.min(i,30),target:30};default:return null}}catch(s){return null}};async function pb(e,t,s,r,a,n,i){await xl(n),Wv(e=>"string"==typeof e&&e.includes(`reading-progress-${n}`),void 0,{revalidate:!0}),Wv(e=>"string"==typeof e&&e.includes(`book-progress-${a}`),void 0,{revalidate:!0}),Wv(e=>"string"==typeof e&&e.includes(`jokers-info-${a}`),void 0,{revalidate:!0}),Wv(()=>kl(n,a),void 0,{revalidate:!0}),await Gv(n,10);const o=await(async(e,t=!1)=>{if(!e)return[];try{const s=[],r=await ib(e);if(r.has7DayStreak&&r.endDate){const r="serie-7-jours";if(!(await Bl(e,r))&&(await Fl(e,r),t)){const e=Ul.find(e=>e.id===r);e&&s.push({...e,dateEarned:(new Date).toLocaleDateString("fr-FR")})}}else r.has5DayStreak&&r.endDate||r.has3DayStreak&&r.endDate;return s}catch(s){return[]}})(n,!0);let l=[];try{l=await(async e=>{const t=[];try{if(!e)return[];const s=await lb(),r=await jl(e),{data:a,error:n}=await Vr.from("reading_validations").select("*").eq("user_id",e).order("validated_at",{ascending:!1});if(n)return;const i=r.filter(e=>"completed"===e.status),{data:o}=await Vr.rpc("get_user_streaks",{user_id:e}),l=o?.current||0,c=o?.best||0;for(const d of s){let s=!1;switch(d.slug){case"marathon_reader":if(a&&a.length>=10){const e={};a.forEach(t=>{const s=ub(t.validated_at);e[s]=(e[s]||0)+1}),s=Object.values(e).some(e=>e>=10)}break;case"binge_reading":if(i.length>=3){const e=[...i].sort((e,t)=>new Date(e.updated_at).getTime()-new Date(t.updated_at).getTime());for(let t=0;t<=e.length-3;t++){const r=new Date(e[t].updated_at),a=new Date(e[t+2].updated_at);if(Math.floor((a.getTime()-r.getTime())/864e5)<=7){s=!0;break}}}break;case"night_marathon":a&&a.length>=5&&(s=a.filter(e=>{const t=cb(e.validated_at);return t>=22||t<6}).length>=5);break;case"lightning_reader":s=i.some(e=>{if(!e.started_at||!e.total_pages||e.total_pages<300)return!1;const t=new Date(e.started_at),s=new Date(e.updated_at);return Math.floor((s.getTime()-t.getTime())/864e5)<3});break;case"speed_demon":s=i.some(e=>{if(!e.started_at)return!1;const t=new Date(e.started_at);return(new Date(e.updated_at).getTime()-t.getTime())/36e5<24});break;case"sprinter":s=r.some(e=>e.current_page&&e.current_page>=50);break;case"explorer":if(i.length>=3){const e=new Date((new Date).getTime()-2592e6);s=i.filter(t=>new Date(t.updated_at)>=e).length>=3}break;case"completionist":s=i.length>=3;break;case"unstoppable":case"perfect_month":s=l>=30||c>=30;break;case"punctual":if(a&&a.length>=7){const e=a.slice(0,7).map(e=>cb(e.validated_at)),t=Math.min(...e);s=Math.max(...e)-t<=2}break;case"early_bird":a&&a.length>0&&(s=a.some(e=>cb(e.validated_at)<7));break;case"night_owl":a&&a.length>0&&(s=a.some(e=>cb(e.validated_at)>=23));break;case"weekend_warrior":a&&a.length>=2&&(s=a.some(e=>{if(6!==db(e.validated_at))return!1;const t=ub(e.validated_at),s=new Date(new Date(t+"T00:00:00"));s.setDate(s.getDate()+1);const r=s.toISOString().split("T")[0];return a.some(e=>ub(e.validated_at)===r&&0===db(e.validated_at))}))}if(s){const s=await mb(e,d.slug);s&&t.push(s)}}}catch(s){}return t})(n)}catch(c){}return setTimeout(async()=>{try{await Yv(n)}catch(e){}},0),{newBadges:o&&o.length>0?o:void 0,newQuests:l&&l.length>0?l:void 0}}const fb=async e=>{try{await async function(){const{data:e,error:t}=await Vr.auth.getSession();if(t)throw t;if(!e?.session)throw new Error(" Utilisateur non authentifi lors de la validation");return!0}(e.user_id);const{data:t,error:s}=await Vr.from("books_public").select("slug, total_pages").eq("id",e.book_id).maybeSingle();if(s||!t)throw new Error(" Impossible de rcuprer les informations du livre");const r=await Xx(t.slug||e.book_id,e.segment);if(!r?.id)throw new Error(" Question introuvable pour ce segment");const{data:a,error:n}=await Vr.rpc("force_validate_segment_beta",{p_book_id:e.book_id,p_question_id:r.id,p_answer:e.answer??"",p_user_id:e.user_id,p_used_joker:!!e.used_joker,p_correct:void 0===e.correct||!!e.correct});if(n)throw new Error(n.message||"chec validation (RPC)");const i=Array.isArray(a)?a[0]:a??{},o=i.progress_id??i.progressId??i.progress??i.data?.progress_id??void 0,l=i.action??i.data?.action??void 0;let c=0;if(o){const{data:e,error:t}=await Vr.from("reading_progress").select("current_page, status").eq("id",o).maybeSingle();!t&&e&&(c=e.current_page??0)}else{const{data:t,error:s}=await Vr.from("reading_progress").select("current_page, status").eq("user_id",e.user_id).eq("book_id",e.book_id).order("updated_at",{ascending:!1}).limit(1).maybeSingle();!s&&t&&(c=t.current_page??0)}let d="updated"===l;if(!d){const{data:t,error:s}=await Vr.from("reading_validations").select("id").eq("user_id",e.user_id).eq("book_id",e.book_id).eq("segment",e.segment).limit(1);s||(d=(t?.length??0)>0)}e.segment;const u=await pb(0,0,0,0,e.book_id,e.user_id).catch(e=>({newBadges:void 0,newQuests:void 0}));return{message:d?"Segment dj valid (idempotent)":"Segment valid avec succs",current_page:c,already_validated:d,next_segment_question:null,...u?.newBadges?{newBadges:u.newBadges}:{},...u?.newQuests?{newQuests:u.newQuests}:{}}}catch(t){const e=t instanceof Error?t.message:"Erreur inconnue";throw Yr.error(`chec de la validation: ${e}`),new Error(e)}},gb=async(e,t)=>{try{const s=await kl(e,t),r=await bl(t);return r?s?{...r,chaptersRead:s.chaptersRead,progressPercent:s.progressPercent,nextSegmentPage:s.nextSegmentPage,isCompleted:s.progressPercent>=100}:(await(async(e,t)=>{if(!e||"string"!=typeof e)return null;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return null;const s={user_id:e,book_id:t.id,total_pages:t.pages,current_page:0,status:"to_read",started_at:(new Date).toISOString(),streak_current:0,streak_best:0};try{const{data:e,error:t}=await Vr.from("reading_progress").insert(s).select().single();return t?null:{...e,validations:[]}}catch(r){return null}})(e,r),{...r,chaptersRead:0,progressPercent:0,nextSegmentPage:30,isCompleted:!1}):null}catch(s){return null}};function xb(){const{id:e}=xt(),[t,s]=o.useState(null),[r,a]=o.useState(!0),[n,i]=o.useState(null),c=L(),d=Rt(),{user:u}=ha(),m=o.useRef(!0),h=ab(t),p=function(e){const t=Number(e??0);return Number.isFinite(t)&&t>=3}(h);o.useEffect(()=>{},[t?.title,h,p]);const[f,g]=o.useState(null);o.useEffect(()=>{d.state?.accessDenied&&d.state?.message&&(g(d.state.message),window.history.replaceState({},document.title))},[d.state]),o.useEffect(()=>{m.current=!0;return(async()=>{if(!e)return i("Aucun identifiant de livre fourni"),void a(!1);try{a(!0),i(null);const r=await bl(e);if(!m.current)return;if(!r)return i(`Le livre avec l'identifiant "${e}" n'existe pas`),void a(!1);const n={...r,categories:r.categories||r.tags||[],tags:r.tags||r.categories||[]},o={...n,progressPercent:0,currentSegment:1,totalSegments:n.totalChapters||n.expectedSegments||n.total_chapters||1,nextSegmentPage:1,chaptersRead:0,expectedSegments:n.expectedSegments||n.total_chapters||1,book_id:n.id,current_page:0,started_at:(new Date).toISOString(),status:"to_read",streak_best:0,streak_current:0,total_pages:n.total_pages||n.pages||0,updated_at:(new Date).toISOString(),user_id:u?.id||""};if(s(o),u?.id)try{const t=await kl(u.id,e);if(!m.current)return;if(t){const e={...t,categories:t.categories||t.tags||[],tags:t.tags||t.categories||[]};s(e)}else{const t=await gb(u.id,e);if(!m.current)return;if(t){const e={...t,categories:t.categories||t.tags||[],tags:t.tags||t.categories||[],isCompleted:t.progressPercent>=100};s(e)}}}catch(t){}}catch(r){m.current&&(i("Erreur lors du chargement du livre"),Yr.error("Erreur lors du chargement du livre"))}finally{m.current&&a(!1)}})(),()=>{m.current=!1}},[e,c,u?.id]);return l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("main",{className:"mx-auto w-full px-4 max-w-none py-6",children:r?l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Chargement du livre..."})]})}):n?l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center max-w-none",children:[l.jsx("h2",{className:"text-xl font-medium text-coffee-darker mb-2",children:"Erreur"}),l.jsx("p",{className:"text-muted-foreground mb-4",children:n}),l.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker underline",onClick:()=>c(-1),children:"Retourner  la page prcdente"})]})}):t?l.jsxs("div",{className:"space-y-6",children:[f&&l.jsx("div",{className:"max-w-4xl mx-auto",children:l.jsx("div",{className:"bg-coffee-lightest border border-coffee-light rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-orange-500",children:""}),l.jsx("p",{className:"text-coffee-dark font-medium",children:f})]})})}),l.jsx(nb,{book:t,onChapterComplete:async e=>{if(t&&u?.id)try{await fb({user_id:u.id,book_id:e,segment:t.currentSegment??0});const r=await kl(u.id,e);if(!m.current)return;if(r)s(r);else{const t=await gb(u.id,e);if(!m.current)return;t?s(t):Yr.error("Impossible de mettre  jour le livre")}}catch(r){Yr.error("Erreur lors de la validation : "+r.message)}else Yr.error("Vous devez tre connect pour valider un chapitre")}}),t.progressPercent>=100&&l.jsx("div",{className:"max-w-4xl mx-auto",children:l.jsxs("div",{className:"bg-coffee-lightest/50 border border-coffee-light rounded-lg p-6 text-center",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsx("h3",{className:"text-xl font-semibold text-coffee-darker",children:"Flicitations ! Vous avez termin ce livre"})]}),l.jsxs("p",{className:"text-muted-foreground mb-4",children:["Rejoignez la discussion avec d'autres lecteurs qui ont galement termin \"",t.title,'"']}),l.jsxs(v,{to:`/finished-chat/${t.slug||e}`,className:"inline-flex items-center gap-2 bg-coffee-dark hover:bg-coffee-darker text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[l.jsx("span",{children:""}),"Accder au salon de discussion"]})]})})]}):l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center max-w-none",children:[l.jsx("h2",{className:"text-xl font-medium text-coffee-darker mb-2",children:"Livre non disponible"}),l.jsx("p",{className:"text-muted-foreground mb-4",children:"Le livre demand n'est pas disponible pour le moment."}),l.jsx("button",{className:"text-coffee-dark hover:text-coffee-darker underline",onClick:()=>c("/explore"),children:"Dcouvrir d'autres livres"})]})})})]})})}function vb(e){let t=document.querySelector('link[rel="canonical"]');t||(t=document.createElement("link"),t.setAttribute("rel","canonical"),document.head.appendChild(t)),t.setAttribute("href",e)}function bb(e){if(e.startsWith("http"))return e;const{data:t}=Vr.storage.from("blog-images").getPublicUrl(e);return t.publicUrl}const yb={async getPublishedPosts(e=50){const t=(new Date).toISOString(),{data:s,error:r}=await Vr.from("blog_posts").select("id,title,slug,content,excerpt,author,tags,published,created_at,updated_at,image_url,image_alt,published_at").eq("published",!0).or(`published_at.is.null,published_at.lte.${t}`).order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).order("id",{ascending:!1}).limit(e);if(r)throw r;return(s||[]).map(e=>({...e,imageUrl:e.image_url?bb(e.image_url):void 0,imageHero:e.image_url?bb(e.image_url):void 0,imageAlt:e.image_alt}))},async getPublishedPostsPage(e,t){const s=(e-1)*t,r=s+t-1,a=(new Date).toISOString(),{data:n,count:i,error:o}=await Vr.from("blog_posts").select("id,title,slug,excerpt,image_url,image_alt,published_at,author,tags",{count:"exact"}).eq("published",!0).or(`published_at.is.null,published_at.lte.${a}`).order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).order("id",{ascending:!1}).range(s,r);if(o)throw o;return{data:(n||[]).map(e=>({...e,imageUrl:e.image_url?bb(e.image_url):void 0,imageHero:e.image_url?bb(e.image_url):void 0,imageAlt:e.image_alt,content:"",created_at:e.published_at||"",updated_at:e.published_at||"",published:!0})),count:i??0}},async getAllPosts(){const{data:e,error:t}=await Vr.from("blog_posts").select("*").order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(e=>({...e,imageUrl:e.image_url?bb(e.image_url):void 0,imageHero:e.image_url?bb(e.image_url):void 0,imageAlt:e.image_alt}))},async getPostBySlug(e){const{data:t,error:s}=await Vr.from("blog_posts").select("*").eq("slug",e).eq("published",!0).maybeSingle();if(s)throw s;return t?{...t,imageUrl:t.image_url?bb(t.image_url):void 0,imageHero:t.image_url?bb(t.image_url):void 0,imageAlt:t.image_alt,reading_time:t.reading_time}:null},async createPost(e){const{imageUrl:t,imageAlt:s,published_at:r,...a}=e,{data:n,error:i}=await Vr.from("blog_posts").insert([{...a,image_url:t,image_alt:s,published_at:r,published:e.published??!0}]).select().single();if(i)throw i;return{...n,imageUrl:n.image_url,imageAlt:n.image_alt}},async updatePost(e){const{id:t,imageUrl:s,imageAlt:r,published_at:a,...n}=e,{data:i,error:o}=await Vr.from("blog_posts").update({...n,image_url:s,image_alt:r,published_at:a}).eq("id",t).select().single();if(o)throw o;return{...i,imageUrl:i.image_url,imageAlt:i.image_alt}},async deletePost(e){const{error:t}=await Vr.from("blog_posts").delete().eq("id",e);if(t)throw t},async uploadImage(e){const t=e.name.split(".").pop(),s=`${`${Date.now()}-${Math.random().toString(36).substring(2)}.${t}`}`,{error:r}=await Vr.storage.from("blog-images").upload(s,e);if(r)throw r;const{data:a}=Vr.storage.from("blog-images").getPublicUrl(s);return a.publicUrl},async deleteImage(e){if(!e)return;const t=e.split("/"),s=t[t.length-1],{error:r}=await Vr.storage.from("blog-images").remove([s]);if(r)throw r}};function wb({posts:e}){return 0===e.length?l.jsx(el,{className:"border-coffee-light",children:l.jsx(al,{className:"text-center py-12",children:l.jsx("p",{className:"text-coffee-dark",children:"Aucun article publi pour le moment."})})}):l.jsx("div",{className:"space-y-6",children:e.map(e=>l.jsxs(el,{className:"border-coffee-light hover:shadow-lg transition-shadow",children:[e.imageUrl&&l.jsx("div",{className:"relative h-48 w-full overflow-hidden rounded-t-lg",children:l.jsx("img",{src:e.imageUrl,alt:e.imageAlt||e.title,className:"object-cover w-full h-full",loading:"lazy",width:640,height:360})}),l.jsxs(tl,{children:[l.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:l.jsxs("div",{className:"flex-1",children:[l.jsx(sl,{className:"text-xl font-serif text-coffee-darker mb-2",children:l.jsx(v,{to:`/blog/${e.slug}`,className:"hover:text-coffee-dark transition-colors",children:e.title})}),e.excerpt&&l.jsx(rl,{className:"text-base text-coffee-dark",children:e.excerpt})]})}),l.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-coffee-dark mt-3",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Ct,{className:"h-4 w-4"}),l.jsx("time",{dateTime:e.published_at,children:new Date(e.published_at||"").toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),e.author&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(te,{className:"h-4 w-4"}),l.jsx("span",{children:e.author})]})]}),e.tags&&e.tags.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:e.tags.map(e=>l.jsx(Nn,{variant:"secondary",className:"bg-coffee-light text-coffee-darker",children:e},e))})]})]},e.id))})}function jb({currentPage:e,totalPages:t}){if(t<=1)return null;const s=e=>1===e?"/blog":`/blog/page/${e}`;return l.jsxs("nav",{className:"flex items-center justify-center space-x-2 mt-8","aria-label":"Pagination du blog",children:[e>1&&l.jsx(v,{to:s(e-1),children:l.jsxs(ya,{variant:"outline",size:"sm",className:"flex items-center gap-2","aria-label":"Page prcdente",children:[l.jsx(Tt,{className:"h-4 w-4"}),"Prcdente"]})}),l.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const r=[];let a=Math.max(1,e-Math.floor(2.5)),n=Math.min(t,a+5-1);n-a<4&&(a=Math.max(1,n-5+1)),a>1&&(r.push(l.jsx(v,{to:s(1),children:l.jsx(ya,{variant:1===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":1===e?"page":void 0,children:"1"})},1)),a>2&&r.push(l.jsx("span",{className:"px-2 text-coffee-dark",children:"..."},"ellipsis-start")));for(let t=a;t<=n;t++)r.push(l.jsx(v,{to:s(t),children:l.jsx(ya,{variant:t===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":t===e?"page":void 0,children:t})},t));return n<t&&(n<t-1&&r.push(l.jsx("span",{className:"px-2 text-coffee-dark",children:"..."},"ellipsis-end")),r.push(l.jsx(v,{to:s(t),children:l.jsx(ya,{variant:t===e?"default":"outline",size:"sm",className:"min-w-[40px]","aria-current":t===e?"page":void 0,children:t})},t))),r})()}),e<t&&l.jsx(v,{to:s(e+1),children:l.jsxs(ya,{variant:"outline",size:"sm",className:"flex items-center gap-2","aria-label":"Page suivante",children:["Suivante",l.jsx(B,{className:"h-4 w-4"})]})})]})}function Nb(){const e=xt(),t=Math.max(1,Number(e.page??1)||1),{posts:s,totalPages:r,total:a,isLoading:n,error:i}=((e,t=20)=>{const[s,r]=o.useState([]),[a,n]=o.useState(0),[i,l]=o.useState(!0),[c,d]=o.useState(null),u=Math.max(1,Math.ceil(a/t));return o.useEffect(()=>{(async()=>{try{l(!0),d(null);const{data:s,count:a}=await yb.getPublishedPostsPage(e,t);r(s),n(a)}catch(s){d("Erreur lors du chargement des articles")}finally{l(!1)}})()},[e,t]),{posts:s,total:a,totalPages:u,isLoading:i,error:c}})(t,12);return o.useEffect(()=>{vb(1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`)},[t]),t>r&&a>0?l.jsx(At,{to:`/blog/page/${r}`,replace:!0}):n?l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:l.jsx("div",{className:"text-center text-white",children:"Chargement des articles..."})})}):i?l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:l.jsx("div",{className:"text-center text-white",children:i})})}):l.jsxs(l.Fragment,{children:[l.jsxs(x,{children:[l.jsx("title",{children:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),l.jsx("meta",{name:"description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),l.jsx("link",{rel:"canonical",href:1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`}),l.jsx("meta",{property:"og:type",content:"website"}),l.jsx("meta",{property:"og:title",content:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),l.jsx("meta",{property:"og:description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),l.jsx("meta",{property:"og:url",content:1===t?"https://www.vread.fr/blog":`https://www.vread.fr/blog/page/${t}`}),l.jsx("meta",{name:"twitter:card",content:"summary"}),l.jsx("meta",{name:"twitter:title",content:1===t?"Blog VREAD | Conseils et mthodes pour mieux lire":`Blog VREAD  Page ${t}`}),l.jsx("meta",{name:"twitter:description",content:1===t?"Dcouvrez des conseils scientifiques et des mthodes concrtes pour amliorer votre lecture, crer une routine et retenir ce que vous lisez.":`Page ${t} - Dcouvrez nos articles pour amliorer votre lecture`}),t>1&&l.jsx("link",{rel:"prev",href:t-1==1?"https://www.vread.fr/blog":"https://www.vread.fr/blog/page/"+(t-1)}),t<r&&l.jsx("link",{rel:"next",href:`https://www.vread.fr/blog/page/${t+1}`}),l.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"ItemList",name:"Blog VREAD",description:"Tous nos articles VREAD: mthodes, lecture, SEO, nouveauts",url:"https://www.vread.fr/blog",publisher:{"@type":"Organization",name:"VREAD",url:"https://www.vread.fr"},itemListElement:s.map((e,t)=>({"@type":"ListItem",position:t+1,url:`https://www.vread.fr/blog/${e.slug}`}))})})]}),l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsxs("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:[l.jsx("div",{className:"mb-6",children:l.jsx(v,{to:"/",children:l.jsxs(ya,{variant:"ghost",className:"text-white hover:text-logo-accent",children:[l.jsx(C,{className:"h-4 w-4 mr-2"}),"Retour  l'accueil"]})})}),l.jsxs("header",{className:"text-center mb-12",children:[l.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-4",children:"Blog VREAD"}),l.jsx("p",{className:"text-lg text-white/90 max-w-none mx-auto",children:"Dcouvrez nos articles sur la lecture, les livres et la culture littraire"})]}),l.jsxs("div",{className:"max-w-none mx-auto",children:[l.jsx(wb,{posts:s}),l.jsx(jb,{currentPage:t,totalPages:r})]})]})})]})}
/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:kb,setPrototypeOf:_b,isFrozen:Sb,getPrototypeOf:Eb,getOwnPropertyDescriptor:Cb}=Object;let{freeze:Rb,seal:Tb,create:Ab}=Object,{apply:Pb,construct:Ib}="undefined"!=typeof Reflect&&Reflect;Rb||(Rb=function(e){return e}),Tb||(Tb=function(e){return e}),Pb||(Pb=function(e,t,s){return e.apply(t,s)}),Ib||(Ib=function(e,t){return new e(...t)});const Db=Kb(Array.prototype.forEach),Lb=Kb(Array.prototype.lastIndexOf),Ob=Kb(Array.prototype.pop),Mb=Kb(Array.prototype.push),Vb=Kb(Array.prototype.splice),zb=Kb(String.prototype.toLowerCase),Ub=Kb(String.prototype.toString),Bb=Kb(String.prototype.match),Fb=Kb(String.prototype.replace),qb=Kb(String.prototype.indexOf),$b=Kb(String.prototype.trim),Wb=Kb(Object.prototype.hasOwnProperty),Hb=Kb(RegExp.prototype.test),Zb=(Gb=TypeError,function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Ib(Gb,t)});var Gb;function Kb(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return Pb(e,t,r)}}function Yb(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:zb;_b&&_b(e,null);let r=t.length;for(;r--;){let a=t[r];if("string"==typeof a){const e=s(a);e!==a&&(Sb(t)||(t[r]=e),a=e)}e[a]=!0}return e}function Qb(e){for(let t=0;t<e.length;t++){Wb(e,t)||(e[t]=null)}return e}function Xb(e){const t=Ab(null);for(const[s,r]of kb(e)){Wb(e,s)&&(Array.isArray(r)?t[s]=Qb(r):r&&"object"==typeof r&&r.constructor===Object?t[s]=Xb(r):t[s]=r)}return t}function Jb(e,t){for(;null!==e;){const s=Cb(e,t);if(s){if(s.get)return Kb(s.get);if("function"==typeof s.value)return Kb(s.value)}e=Eb(e)}return function(){return null}}const ey=Rb(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ty=Rb(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),sy=Rb(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ry=Rb(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ay=Rb(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ny=Rb(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),iy=Rb(["#text"]),oy=Rb(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ly=Rb(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),cy=Rb(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),dy=Rb(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),uy=Tb(/\{\{[\w\W]*|[\w\W]*\}\}/gm),my=Tb(/<%[\w\W]*|[\w\W]*%>/gm),hy=Tb(/\$\{[\w\W]*/gm),py=Tb(/^data-[\-\w.\u00B7-\uFFFF]+$/),fy=Tb(/^aria-[\-\w]+$/),gy=Tb(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),xy=Tb(/^(?:\w+script|data):/i),vy=Tb(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),by=Tb(/^html$/i),yy=Tb(/^[a-z][.\w]*(-[.\w]+)+$/i);var wy=Object.freeze({__proto__:null,ARIA_ATTR:fy,ATTR_WHITESPACE:vy,CUSTOM_ELEMENT:yy,DATA_ATTR:py,DOCTYPE_NAME:by,ERB_EXPR:my,IS_ALLOWED_URI:gy,IS_SCRIPT_OR_DATA:xy,MUSTACHE_EXPR:uy,TMPLIT_EXPR:hy});const jy=1,Ny=3,ky=7,_y=8,Sy=9;var Ey=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const s=t=>e(t);if(s.version="3.2.6",s.removed=[],!t||!t.document||t.document.nodeType!==Sy||!t.Element)return s.isSupported=!1,s;let{document:r}=t;const a=r,n=a.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:m,DOMParser:h,trustedTypes:p}=t,f=c.prototype,g=Jb(f,"cloneNode"),x=Jb(f,"remove"),v=Jb(f,"nextSibling"),b=Jb(f,"childNodes"),y=Jb(f,"parentNode");if("function"==typeof o){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let w,j="";const{implementation:N,createNodeIterator:k,createDocumentFragment:_,getElementsByTagName:S}=r,{importNode:E}=a;let C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};s.isSupported="function"==typeof kb&&"function"==typeof y&&N&&void 0!==N.createHTMLDocument;const{MUSTACHE_EXPR:R,ERB_EXPR:T,TMPLIT_EXPR:A,DATA_ATTR:P,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:D,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:O}=wy;let{IS_ALLOWED_URI:M}=wy,V=null;const z=Yb({},[...ey,...ty,...sy,...ay,...iy]);let U=null;const B=Yb({},[...oy,...ly,...cy,...dy]);let F=Object.seal(Ab(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),q=null,$=null,W=!0,H=!0,Z=!1,G=!0,K=!1,Y=!0,Q=!1,X=!1,J=!1,ee=!1,te=!1,se=!1,re=!0,ae=!1,ne=!0,ie=!1,oe={},le=null;const ce=Yb({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let de=null;const ue=Yb({},["audio","video","img","source","image","track"]);let me=null;const he=Yb({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pe="http://www.w3.org/1998/Math/MathML",fe="http://www.w3.org/2000/svg",ge="http://www.w3.org/1999/xhtml";let xe=ge,ve=!1,be=null;const ye=Yb({},[pe,fe,ge],Ub);let we=Yb({},["mi","mo","mn","ms","mtext"]),je=Yb({},["annotation-xml"]);const Ne=Yb({},["title","style","font","a","script"]);let ke=null;const _e=["application/xhtml+xml","text/html"];let Se=null,Ee=null;const Ce=r.createElement("form"),Re=function(e){return e instanceof RegExp||e instanceof Function},Te=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ee||Ee!==e){if(e&&"object"==typeof e||(e={}),e=Xb(e),ke=-1===_e.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Se="application/xhtml+xml"===ke?Ub:zb,V=Wb(e,"ALLOWED_TAGS")?Yb({},e.ALLOWED_TAGS,Se):z,U=Wb(e,"ALLOWED_ATTR")?Yb({},e.ALLOWED_ATTR,Se):B,be=Wb(e,"ALLOWED_NAMESPACES")?Yb({},e.ALLOWED_NAMESPACES,Ub):ye,me=Wb(e,"ADD_URI_SAFE_ATTR")?Yb(Xb(he),e.ADD_URI_SAFE_ATTR,Se):he,de=Wb(e,"ADD_DATA_URI_TAGS")?Yb(Xb(ue),e.ADD_DATA_URI_TAGS,Se):ue,le=Wb(e,"FORBID_CONTENTS")?Yb({},e.FORBID_CONTENTS,Se):ce,q=Wb(e,"FORBID_TAGS")?Yb({},e.FORBID_TAGS,Se):Xb({}),$=Wb(e,"FORBID_ATTR")?Yb({},e.FORBID_ATTR,Se):Xb({}),oe=!!Wb(e,"USE_PROFILES")&&e.USE_PROFILES,W=!1!==e.ALLOW_ARIA_ATTR,H=!1!==e.ALLOW_DATA_ATTR,Z=e.ALLOW_UNKNOWN_PROTOCOLS||!1,G=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,K=e.SAFE_FOR_TEMPLATES||!1,Y=!1!==e.SAFE_FOR_XML,Q=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,se=e.RETURN_TRUSTED_TYPE||!1,J=e.FORCE_BODY||!1,re=!1!==e.SANITIZE_DOM,ae=e.SANITIZE_NAMED_PROPS||!1,ne=!1!==e.KEEP_CONTENT,ie=e.IN_PLACE||!1,M=e.ALLOWED_URI_REGEXP||gy,xe=e.NAMESPACE||ge,we=e.MATHML_TEXT_INTEGRATION_POINTS||we,je=e.HTML_INTEGRATION_POINTS||je,F=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Re(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(F.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Re(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(F.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(F.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(H=!1),te&&(ee=!0),oe&&(V=Yb({},iy),U=[],!0===oe.html&&(Yb(V,ey),Yb(U,oy)),!0===oe.svg&&(Yb(V,ty),Yb(U,ly),Yb(U,dy)),!0===oe.svgFilters&&(Yb(V,sy),Yb(U,ly),Yb(U,dy)),!0===oe.mathMl&&(Yb(V,ay),Yb(U,cy),Yb(U,dy))),e.ADD_TAGS&&(V===z&&(V=Xb(V)),Yb(V,e.ADD_TAGS,Se)),e.ADD_ATTR&&(U===B&&(U=Xb(U)),Yb(U,e.ADD_ATTR,Se)),e.ADD_URI_SAFE_ATTR&&Yb(me,e.ADD_URI_SAFE_ATTR,Se),e.FORBID_CONTENTS&&(le===ce&&(le=Xb(le)),Yb(le,e.FORBID_CONTENTS,Se)),ne&&(V["#text"]=!0),Q&&Yb(V,["html","head","body"]),V.table&&(Yb(V,["tbody"]),delete q.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Zb('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Zb('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=e.TRUSTED_TYPES_POLICY,j=w.createHTML("")}else void 0===w&&(w=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let s=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(s=t.getAttribute(r));const a="dompurify"+(s?"#"+s:"");try{return e.createPolicy(a,{createHTML:e=>e,createScriptURL:e=>e})}catch(n){return null}}(p,n)),null!==w&&"string"==typeof j&&(j=w.createHTML(""));Rb&&Rb(e),Ee=e}},Ae=Yb({},[...ty,...sy,...ry]),Pe=Yb({},[...ay,...ny]),Ie=function(e){Mb(s.removed,{element:e});try{y(e).removeChild(e)}catch(t){x(e)}},De=function(e,t){try{Mb(s.removed,{attribute:t.getAttributeNode(e),from:t})}catch(r){Mb(s.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{Ie(t)}catch(r){}else try{t.setAttribute(e,"")}catch(r){}},Le=function(e){let t=null,s=null;if(J)e="<remove></remove>"+e;else{const t=Bb(e,/^[\r\n\t ]+/);s=t&&t[0]}"application/xhtml+xml"===ke&&xe===ge&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const a=w?w.createHTML(e):e;if(xe===ge)try{t=(new h).parseFromString(a,ke)}catch(i){}if(!t||!t.documentElement){t=N.createDocument(xe,"template",null);try{t.documentElement.innerHTML=ve?j:a}catch(i){}}const n=t.body||t.documentElement;return e&&s&&n.insertBefore(r.createTextNode(s),n.childNodes[0]||null),xe===ge?S.call(t,Q?"html":"body")[0]:Q?t.documentElement:n},Oe=function(e){return k.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Me=function(e){return e instanceof m&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Ve=function(e){return"function"==typeof l&&e instanceof l};function ze(e,t,r){Db(e,e=>{e.call(s,t,r,Ee)})}const Ue=function(e){let t=null;if(ze(C.beforeSanitizeElements,e,null),Me(e))return Ie(e),!0;const r=Se(e.nodeName);if(ze(C.uponSanitizeElement,e,{tagName:r,allowedTags:V}),Y&&e.hasChildNodes()&&!Ve(e.firstElementChild)&&Hb(/<[/\w!]/g,e.innerHTML)&&Hb(/<[/\w!]/g,e.textContent))return Ie(e),!0;if(e.nodeType===ky)return Ie(e),!0;if(Y&&e.nodeType===_y&&Hb(/<[/\w]/g,e.data))return Ie(e),!0;if(!V[r]||q[r]){if(!q[r]&&Fe(r)){if(F.tagNameCheck instanceof RegExp&&Hb(F.tagNameCheck,r))return!1;if(F.tagNameCheck instanceof Function&&F.tagNameCheck(r))return!1}if(ne&&!le[r]){const t=y(e)||e.parentNode,s=b(e)||e.childNodes;if(s&&t){for(let r=s.length-1;r>=0;--r){const a=g(s[r],!0);a.__removalCount=(e.__removalCount||0)+1,t.insertBefore(a,v(e))}}}return Ie(e),!0}return e instanceof c&&!function(e){let t=y(e);t&&t.tagName||(t={namespaceURI:xe,tagName:"template"});const s=zb(e.tagName),r=zb(t.tagName);return!!be[e.namespaceURI]&&(e.namespaceURI===fe?t.namespaceURI===ge?"svg"===s:t.namespaceURI===pe?"svg"===s&&("annotation-xml"===r||we[r]):Boolean(Ae[s]):e.namespaceURI===pe?t.namespaceURI===ge?"math"===s:t.namespaceURI===fe?"math"===s&&je[r]:Boolean(Pe[s]):e.namespaceURI===ge?!(t.namespaceURI===fe&&!je[r])&&!(t.namespaceURI===pe&&!we[r])&&!Pe[s]&&(Ne[s]||!Ae[s]):!("application/xhtml+xml"!==ke||!be[e.namespaceURI]))}(e)?(Ie(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!Hb(/<\/no(script|embed|frames)/i,e.innerHTML)?(K&&e.nodeType===Ny&&(t=e.textContent,Db([R,T,A],e=>{t=Fb(t,e," ")}),e.textContent!==t&&(Mb(s.removed,{element:e.cloneNode()}),e.textContent=t)),ze(C.afterSanitizeElements,e,null),!1):(Ie(e),!0)},Be=function(e,t,s){if(re&&("id"===t||"name"===t)&&(s in r||s in Ce))return!1;if(H&&!$[t]&&Hb(P,t));else if(W&&Hb(I,t));else if(!U[t]||$[t]){if(!(Fe(e)&&(F.tagNameCheck instanceof RegExp&&Hb(F.tagNameCheck,e)||F.tagNameCheck instanceof Function&&F.tagNameCheck(e))&&(F.attributeNameCheck instanceof RegExp&&Hb(F.attributeNameCheck,t)||F.attributeNameCheck instanceof Function&&F.attributeNameCheck(t))||"is"===t&&F.allowCustomizedBuiltInElements&&(F.tagNameCheck instanceof RegExp&&Hb(F.tagNameCheck,s)||F.tagNameCheck instanceof Function&&F.tagNameCheck(s))))return!1}else if(me[t]);else if(Hb(M,Fb(s,L,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==qb(s,"data:")||!de[e]){if(Z&&!Hb(D,Fb(s,L,"")));else if(s)return!1}else;return!0},Fe=function(e){return"annotation-xml"!==e&&Bb(e,O)},qe=function(e){ze(C.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Me(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let a=t.length;for(;a--;){const i=t[a],{name:o,namespaceURI:l,value:c}=i,d=Se(o),u=c;let m="value"===o?u:$b(u);if(r.attrName=d,r.attrValue=m,r.keepAttr=!0,r.forceKeepAttr=void 0,ze(C.uponSanitizeAttribute,e,r),m=r.attrValue,!ae||"id"!==d&&"name"!==d||(De(o,e),m="user-content-"+m),Y&&Hb(/((--!?|])>)|<\/(style|title)/i,m)){De(o,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){De(o,e);continue}if(!G&&Hb(/\/>/i,m)){De(o,e);continue}K&&Db([R,T,A],e=>{m=Fb(m,e," ")});const h=Se(e.nodeName);if(Be(h,d,m)){if(w&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(l);else switch(p.getAttributeType(h,d)){case"TrustedHTML":m=w.createHTML(m);break;case"TrustedScriptURL":m=w.createScriptURL(m)}if(m!==u)try{l?e.setAttributeNS(l,o,m):e.setAttribute(o,m),Me(e)?Ie(e):Ob(s.removed)}catch(n){De(o,e)}}else De(o,e)}ze(C.afterSanitizeAttributes,e,null)},$e=function e(t){let s=null;const r=Oe(t);for(ze(C.beforeSanitizeShadowDOM,t,null);s=r.nextNode();)ze(C.uponSanitizeShadowNode,s,null),Ue(s),qe(s),s.content instanceof i&&e(s.content);ze(C.afterSanitizeShadowDOM,t,null)};return s.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,n=null,o=null,c=null;if(ve=!e,ve&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Ve(e)){if("function"!=typeof e.toString)throw Zb("toString is not a function");if("string"!=typeof(e=e.toString()))throw Zb("dirty is not a string, aborting")}if(!s.isSupported)return e;if(X||Te(t),s.removed=[],"string"==typeof e&&(ie=!1),ie){if(e.nodeName){const t=Se(e.nodeName);if(!V[t]||q[t])throw Zb("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)r=Le("\x3c!----\x3e"),n=r.ownerDocument.importNode(e,!0),n.nodeType===jy&&"BODY"===n.nodeName||"HTML"===n.nodeName?r=n:r.appendChild(n);else{if(!ee&&!K&&!Q&&-1===e.indexOf("<"))return w&&se?w.createHTML(e):e;if(r=Le(e),!r)return ee?null:se?j:""}r&&J&&Ie(r.firstChild);const d=Oe(ie?e:r);for(;o=d.nextNode();)Ue(o),qe(o),o.content instanceof i&&$e(o.content);if(ie)return e;if(ee){if(te)for(c=_.call(r.ownerDocument);r.firstChild;)c.appendChild(r.firstChild);else c=r;return(U.shadowroot||U.shadowrootmode)&&(c=E.call(a,c,!0)),c}let u=Q?r.outerHTML:r.innerHTML;return Q&&V["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&Hb(by,r.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+u),K&&Db([R,T,A],e=>{u=Fb(u,e," ")}),w&&se?w.createHTML(u):u},s.setConfig=function(){Te(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),X=!0},s.clearConfig=function(){Ee=null,X=!1},s.isValidAttribute=function(e,t,s){Ee||Te({});const r=Se(e),a=Se(t);return Be(r,a,s)},s.addHook=function(e,t){"function"==typeof t&&Mb(C[e],t)},s.removeHook=function(e,t){if(void 0!==t){const s=Lb(C[e],t);return-1===s?void 0:Vb(C[e],s,1)[0]}return Ob(C[e])},s.removeHooks=function(e){C[e]=[]},s.removeAllHooks=function(){C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},s}();const Cy=(...e)=>{"undefined"!=typeof window&&window.gtag&&window.gtag(...e)},Ry=(e,t)=>{Cy("event","share",{content_type:"article",item_id:e,method:t})};function Ty(){const{slug:e}=xt(),[t,s]=o.useState(null),[r,a]=o.useState([]),[n,i]=o.useState(!0),[c,d]=o.useState(null);if(o.useEffect(()=>{vb(window.location.href.replace("http://","https://"));(async()=>{if(!e)return d("Article non trouv"),void i(!1);try{const t=await yb.getPostBySlug(e);t?(s(t),d(null)):d("Article non trouv")}catch(t){d("Erreur lors du chargement de l'article")}finally{i(!1)}})()},[e]),o.useEffect(()=>{(async()=>{if(t?.tags&&0!==t.tags.length)try{const{data:e}=await Vr.from("blog_posts").select("id, title, slug, excerpt, image_url, image_alt, tags, published_at").contains("tags",t.tags).neq("id",t.id).eq("published",!0).limit(3);e&&a(e.map(e=>({...e,content:"",created_at:e.published_at||"",updated_at:e.published_at||"",published:!0,imageHero:e.image_url,imageAlt:e.image_alt})))}catch(e){}})()},[t]),o.useEffect(()=>{var e,s;t&&(e=t.title,s=`/blog/${t.slug}`,Cy("event","page_view",{page_title:e,page_location:window.location.href,page_path:s}))},[t]),o.useEffect(()=>{if(!t)return;const e=Date.now();return()=>{const s=Math.round((Date.now()-e)/1e3);var r;s>5&&(r=t.title,Cy("event","reading_time",{article_title:r,time_seconds:s}))}},[t]),n)return l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:l.jsx("div",{className:"text-center text-white",children:"Chargement de l'article..."})})});if(c||!t)return l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsx("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:l.jsx("div",{className:"text-center text-white",children:c||"Article non trouv"})})});const u=new Date(t.created_at);new Date(t.updated_at);return l.jsxs(l.Fragment,{children:[l.jsxs(x,{children:[l.jsxs("title",{children:[t.title," | VREAD Blog"]}),l.jsx("meta",{name:"description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),t.tags&&t.tags.length>0&&l.jsx("meta",{name:"keywords",content:t.tags.join(", ")}),l.jsx("link",{rel:"canonical",href:`https://www.vread.fr/blog/${t.slug}`}),l.jsx("meta",{property:"og:type",content:"article"}),l.jsx("meta",{property:"og:title",content:t.title}),l.jsx("meta",{property:"og:description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),l.jsx("meta",{property:"og:url",content:`https://www.vread.fr/blog/${t.slug}`}),l.jsx("meta",{property:"og:image",content:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"}),l.jsx("meta",{property:"article:published_time",content:t.created_at}),t.author&&l.jsx("meta",{property:"article:author",content:t.author}),t.tags&&t.tags.length>0&&l.jsx("meta",{property:"article:tag",content:t.tags.join(", ")}),l.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),l.jsx("meta",{name:"twitter:title",content:t.title}),l.jsx("meta",{name:"twitter:description",content:t.excerpt||`Dcouvrez l'article "${t.title}" sur le blog VREAD`}),l.jsx("meta",{name:"twitter:image",content:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"}),l.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:t.title,description:t.excerpt||"",author:{"@type":"Organization",name:t.author||"VREAD"},publisher:{"@type":"Organization",name:"VREAD",url:"https://www.vread.fr",logo:{"@type":"ImageObject",url:"https://www.vread.fr/branding/vread-logo-512.png"}},datePublished:t.created_at,dateModified:t.updated_at,url:`https://www.vread.fr/blog/${t.slug}`,mainEntityOfPage:{"@type":"WebPage","@id":`https://www.vread.fr/blog/${t.slug}`},keywords:t.tags?.join(", ")||"",articleSection:"Littrature",image:t.imageHero||"https://www.vread.fr/branding/vread-logo-512.png"})})]}),l.jsx("div",{className:"min-h-screen bg-logo-background",children:l.jsxs("div",{className:"mx-auto w-full px-4 max-w-none py-8",children:[l.jsx("div",{className:"mb-6",children:l.jsx(v,{to:"/blog",children:l.jsxs(ya,{variant:"ghost",className:"text-white hover:text-logo-accent",children:[l.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Retour au blog"]})})}),l.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-6",children:l.jsxs("ol",{className:"flex items-center gap-2 text-sm text-white/80",children:[l.jsx("li",{children:l.jsx(v,{to:"/",className:"hover:text-white transition-colors",children:"Accueil"})}),l.jsx("li",{children:l.jsx(B,{className:"h-4 w-4"})}),l.jsx("li",{children:l.jsx(v,{to:"/blog",className:"hover:text-white transition-colors",children:"Blog"})}),l.jsx("li",{children:l.jsx(B,{className:"h-4 w-4"})}),l.jsx("li",{className:"text-white/60 truncate max-w-md",children:t.title})]})}),l.jsxs("article",{className:"max-w-none mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[t.imageHero&&l.jsx("div",{className:"relative h-64 md:h-80 w-full overflow-hidden",children:l.jsx("img",{src:t.imageHero,alt:t.imageAlt||t.title,className:"object-cover w-full h-full",loading:"lazy",decoding:"async",width:1200,height:630})}),l.jsxs("header",{className:"p-8 pb-6",children:[l.jsx("h1",{className:"text-3xl md:text-4xl font-serif font-bold text-coffee-darker mb-4",children:t.title}),t.excerpt&&l.jsx("p",{className:"text-lg text-coffee-dark mb-6 leading-relaxed",children:t.excerpt}),l.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-coffee-dark mb-4",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Ct,{className:"h-4 w-4"}),l.jsx("time",{dateTime:t.created_at,children:u.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})})]}),t.author&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(te,{className:"h-4 w-4"}),l.jsx("span",{children:t.author})]}),t.reading_time&&l.jsxs(l.Fragment,{children:[l.jsx("span",{children:""}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(yt,{className:"h-4 w-4"}),l.jsxs("span",{children:[t.reading_time," min de lecture"]})]})]}),l.jsxs(ya,{onClick:async()=>{if(navigator.share)try{await navigator.share({title:t.title,text:t.excerpt||t.title,url:window.location.href}),Ry(t.title,"web_share"),Yr.success("Article partag avec succs")}catch(e){"AbortError"!==e.name&&Yr.error("Erreur lors du partage")}else try{await navigator.clipboard.writeText(window.location.href),Ry(t.title,"clipboard"),Yr.success("Lien copi dans le presse-papier")}catch(e){Yr.error("Impossible de copier le lien")}},variant:"ghost",size:"sm",className:"ml-auto text-coffee-dark hover:text-logo-accent",children:[l.jsx(It,{className:"h-4 w-4 mr-2"}),"Partager"]})]}),t.tags&&t.tags.length>0&&l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx(Dt,{className:"h-4 w-4 text-coffee-dark mt-1"}),t.tags.map(e=>l.jsx(Nn,{variant:"secondary",className:"bg-coffee-light text-coffee-darker",children:e},e))]})]}),l.jsx("div",{className:"px-8 pb-8 prose prose-lg max-w-none prose-headings:text-coffee-darker prose-p:text-coffee-dark prose-strong:text-coffee-darker prose-a:text-logo-accent prose-a:no-underline hover:prose-a:underline",dangerouslySetInnerHTML:{__html:Ey.sanitize(t.content,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","a","img","code","pre"],ALLOWED_ATTR:["href","target","rel","src","alt","title","class"],ALLOW_DATA_ATTR:!1})}}),r.length>0&&l.jsxs("section",{className:"px-8 pb-8 mt-8 border-t border-coffee-light pt-8",children:[l.jsx("h2",{className:"text-2xl font-serif font-bold text-coffee-darker mb-6",children:"Articles lis"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:r.map(e=>l.jsx(v,{to:`/blog/${e.slug}`,className:"group block",children:l.jsxs("article",{className:"bg-coffee-lightest rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[e.imageHero&&l.jsx("div",{className:"relative h-40 w-full overflow-hidden",children:l.jsx("img",{src:e.imageHero,alt:e.imageAlt||e.title,className:"object-cover w-full h-full group-hover:scale-105 transition-transform duration-300",loading:"lazy",width:400,height:200})}),l.jsxs("div",{className:"p-4",children:[l.jsx("h3",{className:"font-semibold text-coffee-darker mb-2 group-hover:text-logo-accent transition-colors line-clamp-2",children:e.title}),e.excerpt&&l.jsx("p",{className:"text-sm text-coffee-dark line-clamp-3",children:e.excerpt})]})]})},e.id))})]})]})]})})]})}const Ay=()=>{const[e,t]=o.useState(null),s=Ce();return{handleRemove:async(r,a)=>{if(!e){t(r);try{const e=await(async e=>{try{const{data:{user:t}}=await Vr.auth.getUser();if(!t)throw new Error("Utilisateur non authentifi");const{data:s,error:r}=await Vr.from("reading_progress").select("*").eq("user_id",t.id).eq("book_id",e).eq("status","to_read").maybeSingle();if(r)throw new Error("Impossible de vrifier le statut du livre");if(!s)throw new Error("Livre non trouv dans   lire ");const{error:a}=await Vr.from("reading_progress").delete().eq("id",s.id);if(a)throw new Error("Impossible de retirer le livre");return s}catch(t){throw t}})(r);if(!e)throw new Error("Suppression choue");s.invalidateQueries({queryKey:["reading-list"]}),s.invalidateQueries({queryKey:["reading-progress"]}),Yr.success(`"${a}" retir de   lire `,{action:{label:"Annuler",onClick:async()=>{try{await(async e=>{try{const{error:t}=await Vr.from("reading_progress").insert([{id:e.id,user_id:e.user_id,book_id:e.book_id,current_page:e.current_page,total_pages:e.total_pages,status:e.status,started_at:e.started_at,updated_at:e.updated_at}]);if(t)throw new Error("Impossible de restaurer le livre")}catch(t){throw t}})(e),s.invalidateQueries({queryKey:["reading-list"]}),s.invalidateQueries({queryKey:["reading-progress"]}),Yr.success(`"${a}" restaur`)}catch(t){Yr.error("Impossible de restaurer le livre")}}},duration:5e3})}catch(n){Yr.error(n.message||"Impossible de retirer le livre")}finally{t(null)}}},removingBookId:e}};function Py({title:e,description:t,books:s,actionLabel:r,onAction:a,showProgress:n=!1,showDate:i=!1,hideUnavailableBooks:c=!1,enablePagination:d=!1,initialPageSize:u=8,showRemoveButton:m=!1}){const{handleRemove:p,removingBookId:f}=Ay(),g=o.useMemo(()=>{const e=Array.isArray(s)?s:[];return e.length,c?e.filter(e=>!e.isUnavailable):e},[s,c,e]),{paginatedBooks:x,hasMore:v,loadMore:b,showingItems:y,totalItems:w}=Qo(g,{initialPageSize:u,pageSize:6}),j=d?x:g;return h.useEffect(()=>{},[e,j.length]),0===j.length?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-serif font-medium text-coffee-darker",children:e}),t&&l.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:t})]}),l.jsx("div",{className:"text-center p-6 border border-dashed rounded-lg",children:l.jsx("p",{className:"text-muted-foreground",children:"Aucun livre dans cette catgorie"})})]}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-serif font-medium text-coffee-darker",children:e}),t&&l.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:t})]}),l.jsx("div",{className:"space-y-4 sm:space-y-6",children:j.map(e=>{const t=e.chaptersRead||0,s=e.totalChapters||e.expectedSegments||1,o=e.progressPercent||Math.round(t/s*100),c=e.id||e.slug||"";return l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 p-4 bg-background rounded-lg border border-border relative group",children:[m&&l.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),p(c,e.title||"Ce livre")},disabled:f===c,className:"absolute top-2 right-2 z-10 p-1.5 rounded-full bg-background/80 hover:bg-destructive/10 border border-border hover:border-destructive/50 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-200 disabled:opacity-50","aria-label":`Retirer "${e.title}" de   lire `,children:l.jsx(N,{className:"h-4 w-4 text-muted-foreground hover:text-destructive transition-colors"})}),l.jsxs("div",{className:"book-cover w-20 h-28 sm:w-20 sm:h-28 mx-auto sm:mx-0 overflow-hidden flex-shrink-0 relative",children:[(()=>{const t=e?.coverImage||e?.cover_url||e?.book_cover;return t?l.jsx("img",{src:t,alt:e.title||"Couverture",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="/placeholder.svg"}}):l.jsx("div",{className:"w-full h-full flex items-center justify-center "+(e.isUnavailable?"bg-gray-300":"bg-chocolate-medium"),children:l.jsx("span",{className:"font-serif text-xl italic "+(e.isUnavailable?"text-gray-500":"text-white"),children:(e.title||"?").substring(0,1)})})})(),e.isUnavailable&&l.jsx("div",{className:"absolute top-0 right-0 bg-amber-500 p-0.5 rounded-bl",children:l.jsx(Lt,{className:"h-3 w-3 text-white"})})]}),l.jsxs("div",{className:"flex-1 text-center sm:text-left space-y-2",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[l.jsx("h3",{className:"font-semibold text-base sm:text-lg "+(e.isUnavailable?"text-gray-500":"text-coffee-darker"),children:e.title||"Livre sans titre"}),e.isUnavailable&&l.jsx(Nn,{variant:"outline",className:"text-xs border-amber-500 text-amber-600 mx-auto sm:mx-0 w-fit",children:"Indisponible"})]}),l.jsx("p",{className:"text-sm text-muted-foreground",children:e.author||"Auteur inconnu"}),n&&l.jsxs("div",{className:"mt-3 mb-2 space-y-1",children:[l.jsx("div",{className:"h-2 w-full bg-muted rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full rounded-full "+(e.isUnavailable?"bg-gray-400":"bg-coffee-dark"),style:{width:`${Math.min(o,100)}%`}})}),l.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[l.jsxs("span",{children:[o,"% termin"]}),l.jsxs("span",{children:[t,"/",s," segment",s>1?"s":""]})]})]}),i&&e.completed_at&&l.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Termin le: ",new Date(e.completed_at).toLocaleDateString("fr-FR")]}),r&&a&&l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>a(c),className:"mt-3 w-full sm:w-auto min-h-[44px]",disabled:e.isUnavailable,children:r})]})]},c)})}),d&&l.jsx(Xo,{onLoadMore:b,hasMore:v,showingCount:y,totalCount:w,className:"mt-6"})]})}function Iy(){return l.jsxs("div",{className:"space-y-8",children:[l.jsxs(el,{className:"border-coffee-light",children:[l.jsxs(tl,{children:[l.jsx(nl,{className:"h-7 w-52"}),l.jsx(nl,{className:"h-4 w-40"})]}),l.jsx(al,{className:"space-y-4",children:l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>l.jsx(nl,{className:"h-64 w-full rounded-md"},e))})})]}),l.jsxs(el,{className:"border-coffee-light",children:[l.jsxs(tl,{children:[l.jsx(nl,{className:"h-7 w-40"}),l.jsx(nl,{className:"h-4 w-36"})]}),l.jsx(al,{className:"space-y-4",children:l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[1,2].map(e=>l.jsx(nl,{className:"h-64 w-full rounded-md"},e))})})]})]})}function Dy({hasError:e,title:t="Aucune lecture trouve",description:s}){const r=L();return l.jsxs(el,{className:"border-coffee-light",children:[l.jsxs(tl,{children:[l.jsx(sl,{className:"text-xl font-serif text-coffee-darker",children:t}),l.jsx(rl,{children:e?"Une erreur est survenue lors du chargement de vos livres.":s||"Vous n'avez pas encore de livres dans votre liste de lecture."})]}),l.jsx(al,{className:"flex justify-center py-8",children:l.jsxs(ya,{className:"bg-coffee-dark hover:bg-coffee-darker",onClick:()=>r("/explore"),children:[l.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Dcouvrir des livres"]})})]})}function Ly({isFetching:e}){return e?l.jsx("div",{className:"py-2 px-4 bg-coffee-light/20 rounded-md text-center text-sm text-muted-foreground",children:"Mise  jour de votre liste de lecture..."}):null}function Oy(){const e=cl("ReadingList"),{user:t,session:s}=ha(),r=L();o.useEffect(()=>{t&&s?e.info("ReadingList component mounted for user:",t.id):r("/auth")},[t,s,r,e]);const{books:a,loading:n,navigateToBook:i}=(()=>{const e=L(),{user:t,session:s}=ha(),[r,a]=o.useState({toReadCount:0,inProgressCount:0,completedCount:0,isLoading:!0,isLoadingReadingList:!1,hasInitialFetch:!1,isDataReady:!1,toRead:[],inProgress:[],completed:[]}),n=o.useCallback(t=>{e(`/books/${t}`)},[e]);return o.useEffect(()=>{if(!t?.id)return void a(e=>({...e,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}));let e=!1;return(async()=>{try{a(e=>({...e,isLoading:!0,isLoadingReadingList:!0}));const s=await Lo(t.id);if(e)return;const r=await Oo(s,"to_read",t.id),n=await Oo(s,"in_progress",t.id),i=await Oo(s,"completed",t.id);a(e=>({...e,toReadCount:s.toReadCount,inProgressCount:s.inProgressCount,completedCount:s.completedCount,toRead:r,inProgress:n,completed:i,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}))}catch(yN){if(e)return;a(e=>({...e,isLoading:!1,isLoadingReadingList:!1,hasInitialFetch:!0,isDataReady:!0}))}})(),()=>{e=!0}},[t?.id]),{books:{toRead:r.toRead,inProgress:r.inProgress,completed:r.completed},loading:{isLoading:r.isLoading,isLoadingReadingList:r.isLoadingReadingList,isDataReady:r.isDataReady,isFetching:!1},navigateToBook:n}})();e.debug("Reading list state",{toReadCount:a.toRead?.length||0,inProgressCount:a.inProgress?.length||0,completedCount:a.completed?.length||0,isLoading:n.isLoading,isLoadingReadingList:n.isLoadingReadingList,isDataReady:n.isDataReady});return l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none px-4 sm:px-6 lg:px-8 py-6 space-y-8",children:[l.jsx(Ly,{isFetching:n.isFetching}),n.isLoading||n.isLoadingReadingList||!n.isDataReady?(e.debug("Showing loading state",{isLoading:n.isLoading,isLoadingReadingList:n.isLoadingReadingList,isDataReady:n.isDataReady}),l.jsx(Iy,{})):a.toRead?.length||a.inProgress?.length||a.completed?.length?(e.debug("Rendering book sections",{inProgress:a.inProgress?.length||0,toRead:a.toRead?.length||0,completed:a.completed?.length||0}),l.jsxs("div",{className:"space-y-8",children:[a.inProgress?.length>0&&l.jsx(Py,{title:"En cours de lecture",description:"Reprenez o vous vous tes arrt",books:a.inProgress,showProgress:!0,actionLabel:"Continuer la lecture",onAction:i}),a.toRead?.length>0&&l.jsx(Py,{title:" lire",description:"Votre liste de lecture  venir",books:a.toRead,actionLabel:"Commencer la lecture",onAction:i,enablePagination:a.toRead.length>8,initialPageSize:8,showRemoveButton:!0}),a.completed?.length>0&&l.jsx(Py,{title:"Livres termins",description:"Vos lectures compltes",books:a.completed,showDate:!0,actionLabel:"Relire",onAction:i,enablePagination:a.completed.length>10,initialPageSize:10})]})):(e.info("All lists are empty, showing empty state"),l.jsx(Dy,{hasError:!1,title:"Aucune lecture trouve",description:"Vous n'avez pas encore de livres dans votre liste de lecture."}))]})]})})}const My=e=>Re({queryKey:["discover",e],queryFn:()=>async function(e){const{data:t,error:s}=await Vr.rpc("discover_feed",{uid:e,lim:20}).single();if(s)throw s;if(!t)throw new Error("No data returned from discover_feed");const r=t;return{feed:Array.isArray(r.feed)?r.feed:[],readers:Array.isArray(r.readers)?r.readers:[],stats:r.stats||{readers:0,followers:0,following:0}}}(e),enabled:!!e,staleTime:6e4,refetchOnWindowFocus:!1});function Vy({show:e}){return l.jsx(Kh,{children:e&&l.jsx(Gx.div,{className:"pointer-events-none absolute inset-0 flex items-center justify-center",initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.35,ease:"easeOut"},children:l.jsxs("div",{className:"relative",children:[l.jsx(Gx.div,{className:"absolute inset-0 rounded-full",style:{filter:"blur(24px)",background:"#AE6841"},initial:{opacity:.15,scale:.7},animate:{opacity:.18,scale:1.15},exit:{opacity:0}}),l.jsx(Ot,{className:"h-28 w-28",color:"#DFC5A6",strokeWidth:1.5,fill:"#DFC5A6"})]})})})}function zy({activities:e,loading:t}){return t?l.jsxs(el,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[l.jsx(tl,{className:"bg-gradient-to-r from-coffee-light/20 to-coffee-medium/10 border-b border-coffee-light/30",children:l.jsxs(sl,{className:"font-serif text-coffee-darker flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-coffee-medium/20 to-coffee-light/20 rounded-xl",children:l.jsx(Nt,{className:"h-5 w-5 text-coffee-dark"})}),l.jsx("span",{children:"Fil d'actualit"})]})}),l.jsx(al,{className:"p-6",children:l.jsx("div",{className:"space-y-4",children:[...Array(4)].map((e,t)=>l.jsx("div",{className:"h-20 bg-coffee-light/20 rounded-lg animate-pulse"},t))})})]}):l.jsxs(el,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[l.jsxs(tl,{className:"bg-gradient-to-r from-coffee-light/20 to-coffee-medium/10 border-b border-coffee-light/30",children:[l.jsxs(sl,{className:"font-serif text-coffee-darker flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-coffee-medium/20 to-coffee-light/20 rounded-xl",children:l.jsx(Nt,{className:"h-5 w-5 text-coffee-dark"})}),l.jsx("span",{children:"Fil d'actualit"})]}),l.jsx("p",{className:"text-coffee-dark font-light text-body-sm",children:"Dcouvrez les dernires activits de la communaut"})]}),l.jsx(al,{className:"p-6",children:l.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:0===e.length?l.jsxs("div",{className:"text-center py-8 text-coffee-dark",children:[l.jsx(Nt,{className:"h-12 w-12 mx-auto mb-4 text-coffee-light"}),l.jsx("p",{children:"Aucune activit rcente  afficher"}),l.jsx("p",{className:"text-body-sm text-coffee-dark/70 mt-2",children:"Les activits de la communaut apparatront ici"})]}):e.map((e,t)=>l.jsx(Uy,{activity:e},`${e.actor_id}-${e.ts}-${t}`))})})]})}function Uy({activity:e}){const t=ge(new Date(e.ts),{addSuffix:!0,locale:ye});return"finished"===e.kind?l.jsx(By,{activity:e,timeAgo:t}):l.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gradient-to-r from-coffee-light/5 to-coffee-medium/5 hover:from-coffee-light/10 hover:to-coffee-medium/10 transition-colors",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx(mn,{src:e.avatar_url??void 0,alt:e.actor_name,fallbackText:e.actor_name,size:"sm",className:"border border-coffee-light/20"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("div",{className:"flex items-center gap-2 mb-1",children:l.jsx("span",{className:"font-medium text-coffee-darker text-body-sm",children:e.actor_name})}),l.jsx("p",{className:"text-coffee-dark text-body-sm",children:"badge"===e.kind&&l.jsxs(l.Fragment,{children:["a dbloqu le badge ",l.jsx(Nn,{variant:"secondary",className:"inline-flex items-center text-caption bg-coffee-light/20 text-coffee-darker border-coffee-light/30",children:e.payload_title})]})}),l.jsx("p",{className:"text-coffee-dark/60 text-caption mt-1",children:t})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx(jt,{className:"h-4 w-4 text-yellow-500"})})]})}function By({activity:e,timeAgo:t}){const[s,r]=o.useState(!!e.liked_by_me),[a,n]=o.useState(e.likes_count??0),[i,c]=o.useState(!1),d=o.useCallback(async()=>{if(!e.activity_id)return;c(!0),setTimeout(()=>c(!1),600),n(e=>s?e-1:e+1);const t=s;r(!s);try{t?await async function(e){const{data:t}=await Vr.auth.getSession(),s=t?.session?.user?.id;if(!s)throw new Error("Not authenticated");const{error:r}=await Vr.from("activity_likes").delete().eq("progress_id",e).eq("liker_id",s);if(r)throw r}(e.activity_id):await async function(e){const{data:t}=await Vr.auth.getSession(),s=t?.session?.user?.id;if(!s)throw new Error("Not authenticated");const{error:r}=await Vr.from("activity_likes").insert({progress_id:e,liker_id:s});if(r&&"23505"!==r.code)throw r}(e.activity_id)}catch(yN){r(t),n(e.likes_count??0),c(!1)}},[s,a,e.activity_id]),u=function(e,t=300){const s=o.useRef(0);return{onPointerDown:()=>{const r=Date.now();r-s.current<t&&e(),s.current=r}}}(d);return l.jsxs("div",{className:"relative rounded-lg bg-gradient-to-r from-coffee-light/5 to-coffee-medium/5 hover:from-coffee-light/10 hover:to-coffee-medium/10 transition-colors overflow-hidden",...u,children:[l.jsx(Vy,{show:i}),l.jsxs("div",{className:"flex items-start gap-3 p-3",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx(mn,{src:e.avatar_url??void 0,alt:e.actor_name,fallbackText:e.actor_name,size:"sm",className:"border border-coffee-light/20"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("div",{className:"flex items-center gap-2 mb-1",children:l.jsx("span",{className:"font-medium text-coffee-darker text-body-sm",children:e.actor_name})}),l.jsxs("p",{className:"text-coffee-dark text-body-sm mb-2",children:["a termin la lecture de ",l.jsx("span",{className:"font-medium",children:e.payload_title})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("p",{className:"text-coffee-dark/60 text-caption",children:t}),l.jsxs("button",{"aria-label":s?"Retirer le Booky":"Donner un Booky",className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border bg-card hover:bg-accent transition-colors",onClick:e=>{e.stopPropagation(),d()},children:[l.jsx(Ot,{className:"h-4 w-4 "+(s?"fill-current":""),style:{color:"#AE6841"}}),l.jsxs("span",{children:[a," Booky",a>1?"s":""]})]})]})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx(be,{className:"h-4 w-4 text-green-600"})})]})]})}function Fy({stats:e,loading:t}){if(t)return l.jsxs(el,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[l.jsx(tl,{className:"pb-3",children:l.jsx(sl,{className:"font-serif text-coffee-darker text-h4",children:"Statistiques de la communaut"})}),l.jsx(al,{className:"space-y-4",children:[...Array(3)].map((e,t)=>l.jsx("div",{className:"h-16 bg-coffee-light/10 rounded-lg animate-pulse"},t))})]});const s=[{icon:I,label:"Lecteurs",value:e.readers.toString(),color:"text-coffee-dark",bgColor:"bg-coffee-light/20"},{icon:Mt,label:"Abonnes",value:e.followers.toString(),color:"text-coffee-darker",bgColor:"bg-coffee-medium/20"},{icon:Fe,label:"Abonnements",value:e.following.toString(),color:"text-coffee-dark",bgColor:"bg-coffee-light/30"}];return l.jsxs(el,{className:"border-coffee-light bg-white/70 backdrop-blur-md",children:[l.jsx(tl,{className:"pb-3",children:l.jsx(sl,{className:"font-serif text-coffee-darker text-h4",children:"Statistiques de la communaut"})}),l.jsx(al,{className:"space-y-4",children:s.map((e,t)=>l.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-coffee-light/10 to-coffee-medium/5",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("div",{className:`p-2 rounded-lg ${e.bgColor}`,children:l.jsx(e.icon,{className:`h-4 w-4 ${e.color}`})}),l.jsx("span",{className:"text-coffee-dark font-medium text-body-sm",children:e.label})]}),l.jsx("span",{className:"font-bold text-coffee-darker text-h4",children:e.value})]},t))})]})}const qy=Ft,$y=o.forwardRef(({className:e,...t},s)=>l.jsx(Vt,{ref:s,className:Pr("border-b",e),...t}));$y.displayName="AccordionItem";const Wy=o.forwardRef(({className:e,children:t,...s},r)=>l.jsx(zt,{className:"flex",children:l.jsxs(Ut,{ref:r,className:Pr("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...s,children:[t,l.jsx(et,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Wy.displayName=Ut.displayName;const Hy=o.forwardRef(({className:e,children:t,...s},r)=>l.jsx(Bt,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:l.jsx("div",{className:Pr("pb-4 pt-0",e),children:t})}));function Zy({readers:e,loading:t}){return t?l.jsxs(el,{className:"border-coffee-light/40 bg-white/80 backdrop-blur-md shadow-sm",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-h4 font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(I,{className:"h-5 w-5 text-coffee-dark"}),"Lecteurs  dcouvrir"]})}),l.jsx(al,{children:l.jsx("div",{className:"space-y-3",children:[...Array(3)].map((e,t)=>l.jsx("div",{className:"h-16 bg-coffee-light/10 rounded-lg animate-pulse"},t))})})]}):l.jsxs(el,{className:"border-coffee-light/40 bg-white/80 backdrop-blur-md shadow-sm",children:[l.jsx(tl,{children:l.jsxs(sl,{className:"text-h4 font-serif text-coffee-darker flex items-center gap-2",children:[l.jsx(I,{className:"h-5 w-5 text-coffee-dark"}),"Lecteurs  dcouvrir"]})}),l.jsx(al,{children:l.jsx(qy,{type:"single",collapsible:!0,defaultValue:"readers-list",children:l.jsxs($y,{value:"readers-list",className:"border-coffee-light/20",children:[l.jsxs(Wy,{className:"text-coffee-dark hover:text-coffee-darker font-medium",children:["Voir les lecteurs (",e.length,")"]}),l.jsx(Hy,{children:l.jsx("div",{className:"space-y-3 mt-4",children:0===e.length?l.jsxs("div",{className:"text-center py-6 text-coffee-dark",children:[l.jsx(I,{className:"h-12 w-12 mx-auto mb-4 text-coffee-light"}),l.jsx("p",{children:"Aucun lecteur  dcouvrir pour le moment"})]}):e.map(e=>l.jsx(Gy,{reader:e},e.id))})})]})})})]})}function Gy({reader:e}){return l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 rounded-xl bg-gradient-to-r from-coffee-light/5 to-white/50 border border-coffee-light/20 hover:from-coffee-light/10 hover:to-white/70 transition-all p-4",children:[l.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[l.jsx(mn,{src:e.avatar_url??void 0,alt:e.username,fallbackText:e.username,size:"sm",className:"border border-coffee-light/20"}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("h4",{className:"font-medium text-coffee-darker truncate",children:e.username}),l.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-body-sm text-coffee-dark",children:[l.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[l.jsx(be,{className:"h-3 w-3"}),e.in_progress," en cours"]}),l.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[l.jsx(jt,{className:"h-3 w-3"}),e.badges," badges"]}),l.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[l.jsx(pe,{className:"h-3 w-3"}),e.streak," j"]})]})]})]}),l.jsx("div",{className:"flex justify-end sm:justify-start shrink-0",children:l.jsx(Kl,{targetUserId:e.id,onFollowChange:()=>{}})})]})}function Ky(){const{user:e}=ha(),{data:t,isLoading:s,error:r}=My(e?.id);return l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-coffee-lightest via-white to-coffee-light/30",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6",children:[l.jsxs("div",{className:"mb-8",children:[l.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker mb-2",children:"Dcouvrir des lecteurs"}),l.jsx("p",{className:"text-coffee-dark font-light",children:"Explorez la communaut et suivez l'activit des autres lecteurs"})]}),r&&l.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:"Une erreur est survenue lors du chargement des donnes."}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsx(zy,{activities:t?.feed||[],loading:s}),l.jsx(Zy,{readers:t?.readers||[],loading:s})]}),l.jsx("div",{className:"space-y-6",children:l.jsx(Fy,{stats:t?.stats||{readers:0,followers:0,following:0},loading:s})})]})]})]})})}function Yy(){const[e]=ze(),t=L(),s=e.get("cat"),r=["litterature","religion","essai","bio"].includes(s)?s:"litterature",a=(e.get("q")??"").trim(),[n,i]=o.useState(r),[c,d]=o.useState(a),[u,m]=o.useState([]),[h,p]=o.useState(!1),[f,g]=o.useState(null),[x,v]=o.useState(1);o.useEffect(()=>{const s=new URLSearchParams(e);s.set("cat",n),c?s.set("q",c):s.delete("q"),t({search:s.toString()},{replace:!0})},[n,c]),o.useEffect(()=>{!async function(){p(!0),g(null);const e=24*(x-1),t=e+24-1;try{let s=Vr.from("books_explore").select("*").eq("category",n).order("created_at",{ascending:!1}).range(e,t);c&&c.length>=2&&(s=s.or(`title.ilike.%${c}%,author.ilike.%${c}%`));const{data:r,error:a}=await s;if(a)throw a;m(r||[])}catch(yN){g(yN.message??"Erreur inconnue"),m([])}finally{p(!1)}}()},[n,x,c]);const b=({value:e,label:t})=>{const s=n===e;return l.jsx("button",{onClick:()=>{i(e),v(1)},className:"px-4 py-2 text-sm rounded-lg transition-colors "+(s?"bg-neutral text-neutral-foreground font-medium":"text-muted-foreground hover:bg-muted hover:text-foreground"),"aria-pressed":s,children:t})};return l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6 space-y-6",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:"Explorer"}),l.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[l.jsxs("div",{className:"inline-flex items-center gap-1 rounded-xl border border-border p-1 order-2 sm:order-1",children:[l.jsx(b,{value:"litterature",label:"Littrature"}),l.jsx(b,{value:"religion",label:"Religion"}),l.jsx(b,{value:"essai",label:"Essai"}),l.jsx(b,{value:"bio",label:"Bio"})]}),l.jsx("div",{className:"order-1 sm:order-2 w-full sm:max-w-md",role:"search","aria-label":"Recherche de livres",children:l.jsx(Mn,{onSearch:e=>{d(e.trim()),v(1)},placeholder:"Titre ou auteur",isSearching:h})})]})]}),h&&l.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement des livres"}),f&&l.jsx("p",{className:"text-sm text-destructive",children:f}),!h&&!f&&0===u.length&&l.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun livre dans cette catgorie."}),l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:u.map(e=>l.jsx(Yo,{book:e},e.id))}),l.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[l.jsx("button",{className:"px-3 py-2 rounded-lg border border-border disabled:opacity-40 hover:bg-muted transition-colors",disabled:1===x,onClick:()=>v(e=>Math.max(1,e-1)),children:"Prcdent"}),l.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",x]}),l.jsx("button",{className:"px-3 py-2 rounded-lg border border-border hover:bg-muted transition-colors",onClick:()=>v(e=>e+1),children:"Suivant"})]})]})]})}function Qy({earnedBadges:e,allBadges:t,className:s}){return l.jsx("div",{className:Pr("space-y-3",s),children:[{name:"legendary",label:"Lgendaires",color:"text-amber-600",bgColor:"bg-amber-50",progressColor:"bg-amber-400"},{name:"epic",label:"piques",color:"text-purple-600",bgColor:"bg-purple-50",progressColor:"bg-purple-400"},{name:"rare",label:"Rares",color:"text-blue-600",bgColor:"bg-blue-50",progressColor:"bg-blue-400"},{name:"common",label:"Communs",color:"text-gray-600",bgColor:"bg-gray-50",progressColor:"bg-gray-400"}].map(s=>{const r=(s=>{const r=t.filter(e=>e.rarity===s).length,a=e.filter(e=>e.rarity===s).length;return{earned:a,total:r,percentage:r>0?Math.round(a/r*100):0}})(s.name);return 0===r.total?null:l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:Pr("text-body-sm font-medium",s.color),children:s.label}),l.jsxs("span",{className:"text-caption text-coffee-medium",children:[r.earned," / ",r.total]})]}),l.jsx(Ho,{value:r.percentage,className:Pr("h-2 bg-coffee-lightest",s.bgColor),indicatorClassName:s.progressColor})]},s.name)})})}Hy.displayName=Bt.displayName;function Xy(){const{user:e}=ha(),{data:t=[],isLoading:s}=Re({queryKey:["user-badges",r=e?.id||""],queryFn:()=>ql(r),enabled:!!r,staleTime:3e4});var r;const{data:a=[],isLoading:n}=Re({queryKey:["all-badges"],queryFn:zl,staleTime:3e5});return s||n?l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),l.jsxs(el,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[l.jsx(tl,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:l.jsxs(sl,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-secondary to-reed-light rounded-xl flex-shrink-0",children:l.jsx(jt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),l.jsx("span",{className:"flex-1 min-w-0",children:"Badges Dbloqus"}),l.jsx(Nt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]})}),l.jsx(al,{className:"p-6 sm:p-8 flex items-center justify-center min-h-[200px]",children:l.jsx(Se,{className:"h-8 w-8 animate-spin text-reed-primary"})})]})]}):l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),l.jsxs(el,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[l.jsxs(tl,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:[l.jsxs(sl,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-secondary to-reed-light rounded-xl flex-shrink-0",children:l.jsx(jt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),l.jsx("span",{className:"flex-1 min-w-0",children:"Badges Dbloqus"}),l.jsx(Nt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]}),l.jsx(rl,{className:"text-reed-dark",children:"Vos accomplissements par ordre de raret"})]}),l.jsx(al,{className:"p-6 sm:p-8",children:l.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[l.jsx(Qy,{earnedBadges:t,allBadges:a,className:"mb-6"}),t.length>0?l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 sm:gap-6",children:t.map(e=>l.jsxs("div",{className:"group relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-2xl blur-xl transform group-hover:scale-105 transition-transform duration-500"}),l.jsxs("div",{className:"relative bg-white/80 backdrop-blur-sm border border-white/50 rounded-2xl p-4 sm:p-6 hover:shadow-2xl transition-all duration-500 group-hover:-translate-y-1 text-center",children:[l.jsx("div",{className:"text-h2 mb-3",children:e.icon}),l.jsx("h3",{className:"font-serif font-semibold text-reed-darker text-body-sm sm:text-body mb-2 break-words",children:e.label}),l.jsx("p",{className:"text-caption sm:text-body-sm text-reed-dark leading-relaxed break-words",children:e.description}),e.dateEarned&&l.jsxs("p",{className:"text-caption text-reed-medium mt-2",children:["Obtenu le ",e.dateEarned]}),l.jsx("div",{className:"absolute -top-2 -right-2",children:l.jsx("div",{className:"px-2 py-1 rounded-full text-caption font-medium "+("legendary"===e.rarity?"bg-amber-100 text-amber-800":"epic"===e.rarity?"bg-purple-100 text-purple-800":"rare"===e.rarity?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:"legendary"===e.rarity?"Lg.":"epic"===e.rarity?"pic.":"rare"===e.rarity?"Rare":"Com."})})]})]},e.id))}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"text-hero mb-4 opacity-30",children:""}),l.jsx("h3",{className:"font-serif text-reed-darker text-h4 mb-2",children:"Aucun badge dbloqu"}),l.jsx("p",{className:"text-reed-dark",children:"Continuez  lire pour dbloquer vos premiers badges !"})]})]})})]})]})}function Jy({quest:e,questInfo:t,isLocked:s=!1,progress:r}){return s?l.jsx(el,{className:"border-gray-300 bg-gray-50/50 opacity-75",children:l.jsx(al,{className:"p-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:"rounded-full bg-gray-200 p-2 mt-1",children:l.jsx(ft,{className:"h-5 w-5 text-gray-500"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"font-medium text-gray-700",children:t.title}),t.category&&l.jsx("span",{className:"text-caption text-gray-500 uppercase tracking-wider px-2 py-0.5 bg-gray-200 rounded",children:t.category})]}),l.jsx("p",{className:"text-body-sm text-gray-600 italic mt-1",children:"Accomplissez l'exploit pour dcouvrir les dtails..."}),r&&l.jsxs("div",{className:"mt-2",children:[l.jsx("div",{className:"flex items-center gap-2 mb-1",children:l.jsxs("span",{className:"text-caption text-gray-600 font-medium",children:["Progression : ",r.current," / ",r.target]})}),l.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"bg-amber-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(r.current/r.target*100,100)}%`}})})]}),t.xp_reward&&l.jsxs("p",{className:"text-caption text-gray-500 mt-2 flex items-center gap-1",children:[l.jsx(Et,{className:"h-3 w-3"}),t.xp_reward," XP"]})]})]})})}):l.jsx(el,{className:"border-amber-400 bg-gradient-to-br from-amber-50 to-yellow-50 hover:shadow-lg transition-shadow",children:l.jsx(al,{className:"p-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:"rounded-full bg-amber-100 p-2 mt-1 text-amber-600",children:(()=>{const s=e?.quest?.icon||t?.icon;if(!s)return l.jsx(jt,{className:"h-5 w-5"});switch(s){case"sun":return l.jsx($t,{className:"h-5 w-5"});case"zap":return l.jsx(Et,{className:"h-5 w-5"});case"books":return l.jsx(be,{className:"h-5 w-5"});case"refresh":return l.jsx(Pe,{className:"h-5 w-5"});default:return l.jsx(jt,{className:"h-5 w-5"})}})()}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"font-medium text-amber-900",children:e?.quest?.title||t.title}),t.category&&l.jsx("span",{className:"text-caption text-amber-700 uppercase tracking-wider px-2 py-0.5 bg-amber-200 rounded",children:t.category})]}),l.jsx("p",{className:"text-body-sm text-amber-800 mt-1",children:e?.quest?.description||t.description}),e?.unlocked_at&&l.jsxs("p",{className:"text-caption text-amber-700 mt-2",children:[" Dbloque le ",qt(new Date(e.unlocked_at),"d MMMM yyyy",{locale:ye})]}),t.xp_reward&&l.jsxs("p",{className:"text-caption text-amber-700 mt-1 flex items-center gap-1 font-semibold",children:[l.jsx(Et,{className:"h-3 w-3"}),"+",t.xp_reward," XP"]})]})]})})})}function ew(){const[e,t]=o.useState([]),[s,r]=o.useState([]),[a,n]=o.useState({}),[i,c]=o.useState(!0),[d,u]=o.useState(null),m={marathons:s.filter(e=>"marathons"===e.category),vitesse:s.filter(e=>"vitesse"===e.category),variete:s.filter(e=>"variete"===e.category),regularite:s.filter(e=>"regularite"===e.category),horaires:s.filter(e=>"horaires"===e.category)},h={marathons:{icon:"",label:"Marathons",desc:"Dfis intenses"},vitesse:{icon:"",label:"Vitesse & Performance",desc:"Dfis de rapidit"},variete:{icon:"",label:"Varit & Exploration",desc:"Dfis de diversit"},regularite:{icon:"",label:"Rgularit Extrme",desc:"Dfis de constance"},horaires:{icon:"",label:"Horaires Spciaux",desc:"Dfis temporels"}};return o.useEffect(()=>{(async()=>{try{c(!0);const{data:e}=await Vr.auth.getUser();if(e?.user){u(e.user.id);const s=await lb();r(s);const a=await(async e=>{try{if(!e)return[];const{data:t,error:s}=await Vr.from("user_quests").select("*").eq("user_id",e).order("unlocked_at",{ascending:!1});if(s)return[];const r=await lb();return t.map(e=>{const t=r.find(t=>t.slug===e.quest_slug);return{...e,quest:t}})}catch(t){return[]}})(e.user.id);t(a);const i={};for(const t of s){if(!a.some(e=>e.quest_slug===t.slug)){const s=await hb(e.user.id,t.slug);s&&(i[t.slug]=s)}}n(i)}}catch(e){}finally{c(!1)}})()},[]),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/10 to-reed-secondary/10 rounded-3xl blur-2xl"}),l.jsxs(el,{className:"relative border-0 bg-white/70 backdrop-blur-md shadow-2xl rounded-3xl overflow-hidden",children:[l.jsxs(tl,{className:"bg-gradient-to-r from-reed-secondary/40 to-reed-light/40 border-b border-white/20",children:[l.jsxs(sl,{className:"font-serif text-reed-darker flex items-center gap-3 text-h4",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-reed-light to-white rounded-xl flex-shrink-0",children:l.jsx(Wt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-reed-primary"})}),l.jsx("span",{className:"flex-1 min-w-0",children:"Qutes Accomplies"}),l.jsx(St,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse flex-shrink-0"})]}),l.jsx(rl,{className:"text-reed-dark",children:"Exploits spciaux dverrouills par vos actions"})]}),l.jsx(al,{className:"p-6 sm:p-8",children:i?l.jsx("div",{className:"space-y-6",children:[...Array(3)].map((e,t)=>l.jsx("div",{className:"h-20 sm:h-24 bg-gradient-to-r from-reed-secondary/30 to-reed-light/30 animate-pulse rounded-2xl"},t))}):l.jsxs("div",{className:"space-y-8",children:[Object.entries(m).map(([t,s])=>{if(0===s.length)return null;const r=h[t];return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b-2 border-reed-primary/20",children:[l.jsx("span",{className:"text-2xl",children:r.icon}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-serif text-h5 text-reed-darker",children:r.label}),l.jsxs("p",{className:"text-caption text-reed-medium",children:[r.desc,"  ",s.length," qute",s.length>1?"s":""]})]})]}),l.jsx("div",{className:"space-y-4 pl-2",children:s.map(t=>{const s=e.find(e=>e.quest_slug===t.slug),r=a[t.slug];return l.jsx(Jy,{quest:s,questInfo:t,isLocked:!s,progress:r},t.slug)})})]},t)}),0===s.length&&l.jsxs("div",{className:"text-center py-12 sm:py-16",children:[l.jsx("div",{className:"flex justify-center mb-6",children:l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-3xl blur-xl"}),l.jsx("div",{className:"relative p-6 bg-gradient-to-br from-reed-secondary/30 to-reed-light/30 rounded-3xl border border-white/30",children:l.jsx(Nt,{className:"h-10 w-10 sm:h-12 sm:w-12 text-reed-primary"})})]})}),l.jsx("h3",{className:"font-serif text-h4 text-reed-darker mb-3",children:"Aucune qute disponible"}),l.jsx("p",{className:"text-reed-dark leading-relaxed px-4",children:"Les qutes seront bientt disponibles"})]})]})})]})]})}function tw({xp:e,level:t}){const s=(e??0)%1e3/10;return l.jsxs("div",{className:"group relative",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary/20 to-reed-secondary/20 rounded-3xl blur-xl transform group-hover:scale-105 transition-transform duration-500"}),l.jsx("div",{className:"relative bg-white/70 backdrop-blur-md border border-white/40 rounded-3xl p-6 sm:p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 group-hover:-translate-y-1",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6",children:[l.jsxs("div",{className:"relative flex-shrink-0",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-reed-primary to-reed-dark rounded-2xl blur-sm opacity-30 scale-110"}),l.jsx("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-reed-secondary to-reed-light rounded-2xl border border-reed-primary/30",children:l.jsx(St,{className:"h-6 w-6 sm:h-8 sm:w-8 text-reed-primary"})}),l.jsx("div",{className:"absolute -top-2 -right-2",children:l.jsx("div",{className:"px-2 py-1 bg-gradient-to-br from-reed-primary to-reed-dark rounded-full text-caption font-bold text-white",children:t??1})})]}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("h3",{className:"text-caption sm:text-body-sm font-serif font-medium text-reed-dark uppercase mb-2",children:["Niveau ",t??1]}),l.jsxs("p",{className:"text-h4 sm:text-h4 font-serif font-semibold text-reed-darker mb-3 break-words",children:[(e??0).toLocaleString()," XP"]}),l.jsx("div",{className:"w-full bg-reed-light/50 rounded-full h-2 overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-reed-primary to-reed-secondary transition-all duration-1000 ease-out",style:{width:`${s}%`}})}),l.jsxs("p",{className:"text-caption text-reed-dark mt-1",children:[1e3-(e??0)%1e3," XP jusqu'au niveau ",(t??1)+1]})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx(Nt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-reed-primary animate-pulse"})})]})})]})}function sw(){const{user:e}=ha(),{data:t,isLoading:s}=Re({queryKey:["user-stats",r=e?.id||""],queryFn:()=>$l(r),enabled:!!r,staleTime:6e4});var r;const a=t||{booksRead:0,pagesRead:0,badgesCount:0,streakCurrent:0,streakBest:0,xp:0,lvl:1};return s?l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-light/30 to-white",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"container max-w-6xl mx-auto px-4 py-8 sm:py-12",children:[l.jsxs("div",{className:"text-center mb-8 px-4",children:[l.jsx("h1",{className:"text-h1 font-serif text-reed-darker mb-2",style:{hyphens:"none",wordBreak:"normal",whiteSpace:"nowrap"},children:"Vos Accomplissements"}),l.jsx("p",{className:"text-body text-reed-dark",children:"Clbrez votre parcours littraire"})]}),l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsx(Se,{className:"h-8 w-8 animate-spin text-reed-primary"})})]})]})}):l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-reed-light/30 to-white",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"container max-w-6xl mx-auto px-4 py-8 sm:py-12",children:[l.jsxs("div",{className:"text-center mb-10 sm:mb-12 px-4",children:[l.jsx("h1",{className:"text-h1 sm:text-hero font-serif text-reed-darker mb-2",style:{hyphens:"none",wordBreak:"normal",whiteSpace:"nowrap"},children:"Vos Accomplissements"}),l.jsx("p",{className:"text-body sm:text-lg text-reed-dark",children:"Clbrez votre parcours littraire"})]}),l.jsxs("div",{className:"space-y-8",children:[l.jsx(tw,{xp:a.xp,level:a.lvl}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[l.jsx("div",{className:"text-h2 mb-1",children:""}),l.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:a.booksRead}),l.jsx("div",{className:"text-caption text-reed-dark",children:"Livres lus"})]}),l.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[l.jsx("div",{className:"text-h2 mb-1",children:""}),l.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:a.pagesRead}),l.jsx("div",{className:"text-caption text-reed-dark",children:"Pages lues"})]}),l.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[l.jsx("div",{className:"text-h2 mb-1",children:""}),l.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:a.streakCurrent}),l.jsxs("div",{className:"text-caption text-reed-dark",children:["Srie actuelle",a.streakBest>0&&l.jsxs("span",{className:"block text-caption text-reed-medium mt-1",children:["Record: ",a.streakBest]})]})]}),l.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-reed-primary/20 rounded-2xl p-4 text-center shadow-sm hover:shadow-md transition-shadow",children:[l.jsx("div",{className:"text-h2 mb-1",children:""}),l.jsx("div",{className:"text-h3 font-serif text-reed-darker",children:a.badgesCount}),l.jsx("div",{className:"text-caption text-reed-dark",children:"Badges"})]})]}),l.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[l.jsx(Xy,{}),l.jsx(ew,{})]})]})]})]})})}function rw({user:e,compact:t=!1,hideUnfollow:s=!1}){const{user:r}=ha(),[a,n]=o.useState(e.name||"Lecteur"),[i,c]=o.useState(!1),[d,u]=o.useState(!0);return o.useEffect(()=>{c(!!r&&r.id!==e.id);(async()=>{try{u(!0);const t=await la(e.id);if(t){const s=ca(t.username||e.username,t.email||e.email,e.id);n(s)}}catch(t){}finally{u(!1)}})()},[r,e]),l.jsxs("div",{className:"flex items-center justify-between "+(t?"gap-2":"gap-4"),children:[l.jsxs(v,{to:`/profile/${e.id}`,className:"flex items-center gap-3 hover:underline","aria-label":`Voir le profil de ${a}`,children:[l.jsx(mn,{src:e.avatar_url||void 0,alt:a,fallbackText:a}),l.jsx("span",{className:"font-medium text-coffee-darker "+(t?"text-body-sm":"text-body"),children:d?"Chargement...":a})]}),i&&l.jsx("div",{children:l.jsx(Kl,{targetUserId:e.id,hideUnfollow:s})})]})}function aw(){const{type:e,userId:t}=xt(),s=L(),{user:r}=ha(),[a,n]=o.useState([]),[i,c]=o.useState(!0),[d,u]=o.useState(null),m=t||r?.id,h=r?.id===m;o.useEffect(()=>{if(!m)return;(async()=>{c(!0),u(null);try{let t=[];"followers"===e?t=await async function(e){try{const{data:t,error:s}=await Vr.from("followers").select("follower_id").eq("following_id",e);if(s)throw s;if(!t.length)return[];const{data:r,error:a}=await Vr.rpc("get_public_profiles_for_ids",{ids:t.map(e=>e.follower_id)});if(a)throw a;return r||[]}catch(d){return[]}}(m):"following"===e&&(t=await async function(e){try{const{data:t,error:s}=await Vr.from("followers").select("following_id").eq("follower_id",e);if(s)throw s;if(!t.length)return[];const{data:r,error:a}=await Vr.rpc("get_public_profiles_for_ids",{ids:t.map(e=>e.following_id)});if(a)throw a;return r||[]}catch(d){return[]}}(m)),n(t)}catch(t){u("Impossible de charger les "+("followers"===e?"abonns":"abonnements"))}finally{c(!1)}})()},[m,e]);return l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[l.jsxs(ya,{variant:"ghost",size:"sm",className:"text-coffee-dark",onClick:()=>{s(t?`/profile/${t}`:"/profile")},children:[l.jsx(Tt,{className:"h-4 w-4 mr-1"}),"Retour au profil"]}),l.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:"followers"===e?h?"Mes abonns":"Abonns":h?"Mes abonnements":"Abonnements"})]}),l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{children:l.jsx(sl,{className:"text-lg font-serif text-coffee-darker",children:"followers"===e?"Personnes qui vous suivent":"Personnes que vous suivez"})}),l.jsx(al,{className:"space-y-4",children:i?l.jsx("div",{className:"flex justify-center p-6",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-coffee-dark"})}):d?l.jsx("div",{className:"text-center p-4 text-muted-foreground",children:d}):a.length>0?a.map(t=>l.jsx(rw,{user:t,hideUnfollow:"followers"===e},t.id)):l.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"followers"===e?h?"Vous n'avez pas encore d'abonns":"Cet utilisateur n'a pas encore d'abonns":h?"Vous n'tes abonn  aucun utilisateur":"Cet utilisateur n'est abonn  personne"})})]})]})]})})}function nw({children:e}){const{user:t,isLoading:s,isInitialized:r}=ha(),a=L(),[n,i]=o.useState(!1),[c,d]=o.useState(null),[u,m]=o.useState(!0);return o.useEffect(()=>{r&&!s&&(async()=>{if(!t?.id)return d(!1),void m(!1);if(!0===t?.user_metadata?.is_admin||!0===t?.app_metadata?.is_admin)return d(!0),void m(!1);try{const{data:e,error:s}=await Vr.from("profiles").select("is_admin").eq("id",t.id).single();d(!s&&(e?.is_admin||!1))}catch(e){d(!1)}finally{m(!1)}})()},[t?.id,r,s]),o.useEffect(()=>{if(r&&!s&&!u&&!1===c&&!n){i(!0);const e=setTimeout(()=>{a("/home")},100);return()=>clearTimeout(e)}},[c,u,s,r,a,n]),s||!r||u?l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Vrification des droits d'administration..."})]})}):c?l.jsx(l.Fragment,{children:e}):l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Ht,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),l.jsx("h2",{className:"text-h4 font-medium mb-2",children:"Accs refus"}),l.jsx("p",{className:"text-muted-foreground mb-6",children:"Vous n'avez pas les droits d'administration ncessaires pour accder  cette page."}),l.jsx("button",{onClick:()=>a("/home"),className:"px-4 py-2 bg-coffee-dark hover:bg-coffee-darker text-white rounded-md",children:"Retour  l'accueil"})]})})}function iw(){const{user:e,isAdmin:t}=ha();return e?l.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.email,"  ",t?"Admin ":"Admin "]}):null}function ow({children:e}){return l.jsxs("div",{children:[l.jsxs("header",{className:"flex items-center justify-between p-3 border-b border-border bg-card",children:[l.jsxs("nav",{className:"flex gap-3 text-sm",children:[l.jsx(Zt,{to:"/admin",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Dashboard"}),l.jsx(Zt,{to:"/admin/auto-covers",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Auto-covers"}),l.jsx(Zt,{to:"/admin/audit",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Audit"}),l.jsx(Zt,{to:"/admin/book-requests",className:({isActive:e})=>"hover:underline "+(e?"text-primary font-medium":"text-foreground"),children:"Demandes"})]}),l.jsx(iw,{})]}),l.jsx("main",{children:e})]})}const lw=o.forwardRef(({className:e,...t},s)=>l.jsx("div",{className:"relative w-full overflow-auto",children:l.jsx("table",{ref:s,className:Pr("w-full caption-bottom text-sm",e),...t})}));lw.displayName="Table";const cw=o.forwardRef(({className:e,...t},s)=>l.jsx("thead",{ref:s,className:Pr("[&_tr]:border-b",e),...t}));cw.displayName="TableHeader";const dw=o.forwardRef(({className:e,...t},s)=>l.jsx("tbody",{ref:s,className:Pr("[&_tr:last-child]:border-0",e),...t}));dw.displayName="TableBody";o.forwardRef(({className:e,...t},s)=>l.jsx("tfoot",{ref:s,className:Pr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const uw=o.forwardRef(({className:e,...t},s)=>l.jsx("tr",{ref:s,className:Pr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));uw.displayName="TableRow";const mw=o.forwardRef(({className:e,...t},s)=>l.jsx("th",{ref:s,className:Pr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));mw.displayName="TableHead";const hw=o.forwardRef(({className:e,...t},s)=>l.jsx("td",{ref:s,className:Pr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));hw.displayName="TableCell";o.forwardRef(({className:e,...t},s)=>l.jsx("caption",{ref:s,className:Pr("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const pw=o.forwardRef(({className:e,orientation:t="horizontal",decorative:s=!0,...r},a)=>l.jsx(Gt,{ref:a,decorative:s,orientation:t,className:Pr("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...r}));function fw({book:e,onUpdate:t}){const[s,r]=o.useState(!1),[a,n]=o.useState(!1),[i,c]=o.useState(e.total_pages||0),[d,u]=o.useState(e.expected_segments),[m,h]=o.useState(""),[p,f]=o.useState(!0),[g,x]=o.useState(e.slug),[v,b]=o.useState(null),[y,w]=o.useState(""),[j,N]=o.useState(""),[k,_]=o.useState(!1);return l.jsxs(Ic,{open:s,onOpenChange:t=>{r(t),t&&(async()=>{try{const{data:t,error:s}=await Vr.from("books").select("id, title, author, description, cover_url, slug, is_published, total_pages").eq("slug",e.slug).single();if(s||!t)return;t&&(t.description&&h(t.description),f(!1!==t.is_published),t.total_pages&&c(t.total_pages),t.slug&&x(t.slug))}catch(t){}})()},children:[l.jsx(Dc,{asChild:!0,children:l.jsxs(ya,{variant:"outline",size:"sm",children:[l.jsx(Kt,{className:"h-4 w-4 mr-2"}),"Modifier"]})}),l.jsxs(Mc,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[l.jsx(Vc,{children:l.jsxs(Uc,{className:"text-h4",children:['Modifier "',e.title,'"']})}),l.jsxs("div",{className:"space-y-6 py-4",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-h4 font-medium",children:"Mtadonnes"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"totalPages",children:"Nombre total de pages"}),l.jsx(On,{id:"totalPages",type:"number",value:i,onChange:e=>c(parseInt(e.target.value)||0),min:0})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"expectedSegments",children:"Nombre de segments attendus"}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx(On,{id:"expectedSegments",type:"number",value:d,onChange:e=>u(parseInt(e.target.value)||0),min:0}),l.jsx(ya,{onClick:()=>{const e=Math.ceil(Number(i)/30);u(e)},type:"button",variant:"secondary",children:"Recalculer"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"description",children:"Description (optionnelle)"}),l.jsx(Kx,{id:"description",value:m,onChange:e=>h(e.target.value),rows:4,placeholder:"Description du livre..."})]}),l.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[l.jsx(Fc,{id:"isPublished",checked:p,onCheckedChange:e=>f(!0===e)}),l.jsx(Tl,{htmlFor:"isPublished",className:"font-medium cursor-pointer",children:"Publier ce livre"})]}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx(ya,{onClick:async()=>{n(!0);try{const s=parseInt(String(i),10);if(isNaN(s))throw new Error("Le nombre de pages doit tre un nombre valide");if(!g)throw new Error("Le slug du livre est manquant");const a={total_pages:s,description:m||null,is_published:p},{data:n,error:o}=await Vr.from("books").update(a).eq("slug",g).select();if(o)throw o;oa({title:`Modifications enregistres : Les informations du livre "${e.title}" ont t mises  jour.`}),r(!1),t()}catch(s){oa({title:`Erreur : Impossible de mettre  jour le livre: ${s.message}`,variant:"destructive"})}finally{n(!1)}},disabled:a,className:"w-full sm:w-auto",children:a?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Yt,{className:"mr-2 h-4 w-4"}),"Sauvegarder les modifications"]})}),l.jsx(ya,{onClick:async()=>{if(0!==e.missingSegments.length){n(!0);try{const{data:s,error:a}=await Vr.from("books").select("id, slug").eq("id",e.id).single();if(a)throw a;const n=e.missingSegments.map(e=>({book_id:s.id,book_slug:s.slug,segment:e,question:"",answer:""})),{error:i}=await Vr.from("reading_questions").upsert(n,{onConflict:"book_slug,segment"});if(i)throw i;oa({title:`Segments gnrs : ${e.missingSegments.length} segments vides ont t gnrs avec succs.`}),r(!1),t()}catch(s){oa({title:`Erreur : Impossible de gnrer les segments: ${s.message}`,variant:"destructive"})}finally{n(!1)}}else oa({title:"Information : Tous les segments ont dj t crs pour ce livre."})},disabled:a||0===e.missingSegments?.length,variant:"outline",className:"w-full sm:w-auto",children:a?l.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}):"Gnrer les segments manquants"})]})]}),l.jsx(pw,{}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-h4 font-medium",children:"Ajouter une question de validation"}),e.missingSegments&&e.missingSegments.length>0?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"segment",children:"Segment manquant"}),l.jsxs("select",{id:"segment",className:"w-full rounded-md border border-input bg-background px-3 py-2",value:v||"",onChange:e=>b(parseInt(e.target.value)),children:[l.jsx("option",{value:"",children:"Slectionnez un segment"}),e.missingSegments.map(e=>l.jsxs("option",{value:e,children:["Segment ",e]},e))]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"question",children:"Question"}),l.jsx(On,{id:"question",value:y,onChange:e=>w(e.target.value),placeholder:"Exemple: Quel est le nom du personnage principal ?"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{htmlFor:"answer",children:"Rponse (un seul mot)"}),l.jsx(On,{id:"answer",value:j,onChange:e=>N(e.target.value),placeholder:"Exemple: Jean"}),l.jsx("p",{className:"text-caption text-muted-foreground",children:"La rponse doit contenir un seul mot, sans espace."})]}),l.jsx(ya,{onClick:async()=>{if(v||0===v)if(y.trim())if(j.trim())if(j.trim().split(/\s+/).length>1)oa({title:"Rponse invalide : La rponse doit contenir un seul mot",variant:"destructive"});else{_(!0);try{const{data:s,error:a}=await Vr.from("books").select("id, slug").eq("id",e.id).single();if(a)throw a;const{error:n}=await Vr.from("reading_questions").insert({book_id:s.id,book_slug:s.slug,segment:v,question:y.trim(),answer:j.trim().toLowerCase()});if(n)throw n;oa({title:`Question ajoute : La question pour le segment ${v} a t ajoute avec succs.`}),w(""),N(""),r(!1),t()}catch(s){oa({title:`Erreur : Impossible d'ajouter la question: ${s.message}`,variant:"destructive"})}finally{_(!1)}}else oa({title:"Rponse invalide : La rponse ne peut pas tre vide",variant:"destructive"});else oa({title:"Question invalide : La question ne peut pas tre vide",variant:"destructive"});else oa({title:"Segment non slectionn : Veuillez slectionner un segment",variant:"destructive"})},disabled:k,variant:"secondary",className:"w-full sm:w-auto",children:k?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}),"Ajout en cours..."]}):l.jsx(l.Fragment,{children:"Ajouter la question"})})]}):l.jsx("p",{className:"text-muted-foreground",children:"Tous les segments de ce livre ont dj des questions."})]})]})]})]})}pw.displayName=Gt.displayName;const gw=Ro({title:Eo().min(1,"Le titre est requis"),author:Eo().min(1,"L'auteur est requis"),total_pages:To().min(1,"Le nombre de pages est requis"),description:Eo().optional(),cover_url:Eo().optional(),is_published:Co().default(!0)});function xw({onBookAdded:e}){const[t,s]=o.useState(!1),[r,a]=o.useState(!1),[n,i]=o.useState(null),[c,d]=o.useState(null),u=Ke({resolver:dc(gw),defaultValues:{title:"",author:"",total_pages:void 0,description:"",cover_url:"",is_published:!0}});return l.jsxs(Ic,{open:t,onOpenChange:s,children:[l.jsx(Dc,{asChild:!0,children:l.jsxs(ya,{size:"sm",className:"gap-2",children:[l.jsx(Oe,{className:"h-4 w-4"}),"Ajouter un livre"]})}),l.jsxs(Mc,{className:"sm:max-w-[550px]",children:[l.jsx(Vc,{children:l.jsx(Uc,{children:"Ajouter un nouveau livre"})}),l.jsx(Yl,{...u,children:l.jsxs("form",{onSubmit:u.handleSubmit(async t=>{a(!0);try{const r=(t.title+"-"+t.author).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");let a=t.cover_url;n&&(a=await(async(e,t)=>{const s=`books/${t}.${e.name.split(".").pop()}`,{error:r}=await Vr.storage.from("covers").upload(s,e,{cacheControl:"3600",upsert:!0});if(r)throw new Error(`Erreur lors de l'upload de la couverture: ${r.message}`);const{data:a}=Vr.storage.from("covers").getPublicUrl(s);return a.publicUrl})(n,r));const o={id:crypto.randomUUID(),title:t.title,author:t.author,total_pages:t.total_pages,description:t.description||null,cover_url:a||null,slug:r,tags:[],is_published:t.is_published},{error:l}=await Vr.from("books").insert(o);if(l)throw l;await(async(e,t)=>{const s=Math.ceil(t/30);if(!(s<=0))try{const t=[];for(let a=0;a<s;a++)t.push({book_slug:e,segment:a,question:"",answer:""});const{error:r}=await Vr.from("reading_questions").upsert(t,{onConflict:"book_slug,segment"});if(r)throw r}catch(l){oa({title:"Attention : Le livre a t cr, mais la gnration automatique des segments a chou.",variant:"default"})}})(r,t.total_pages),oa({title:`Livre ajout avec succs : "${t.title}" a t ajout  la base de donnes.`}),u.reset(),i(null),d(null),s(!1),e()}catch(r){oa({title:`Erreur : Impossible d'ajouter le livre: ${r.message}`,variant:"destructive"})}finally{a(!1)}}),className:"space-y-4",children:[l.jsx(Xl,{control:u.control,name:"title",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{children:"Titre"}),l.jsx(rc,{children:l.jsx(On,{placeholder:"Titre du livre",...e})}),l.jsx(ac,{})]})}),l.jsx(Xl,{control:u.control,name:"author",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{children:"Auteur"}),l.jsx(rc,{children:l.jsx(On,{placeholder:"Nom de l'auteur",...e})}),l.jsx(ac,{})]})}),l.jsx(Xl,{control:u.control,name:"total_pages",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{children:"Nombre de pages"}),l.jsx(rc,{children:l.jsx(On,{type:"number",min:"1",placeholder:"Nombre de pages",...e})}),l.jsx(ac,{})]})}),l.jsx(Xl,{control:u.control,name:"description",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{children:"Rsum (optionnel)"}),l.jsx(rc,{children:l.jsx(Kx,{placeholder:"Description du livre",...e})}),l.jsx(ac,{})]})}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(sc,{children:"Couverture"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(Xl,{control:u.control,name:"cover_url",render:({field:e})=>l.jsxs(tc,{children:[l.jsx(sc,{className:"text-body-sm text-muted-foreground",children:"URL de l'image"}),l.jsx(rc,{children:l.jsx(On,{placeholder:"https://example.com/cover.jpg",...e,onChange:t=>{e.onChange(t),(e=>{const t=e.target.value;t?(i(null),d(t)):d(null)})(t)},disabled:!!n})}),l.jsx(ac,{})]})}),l.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-md p-4",children:l.jsxs("label",{htmlFor:"cover-upload",className:"flex flex-col items-center justify-center cursor-pointer",children:[l.jsx(Qt,{className:"h-6 w-6 text-gray-400 mb-2"}),l.jsx("span",{className:"text-body-sm text-muted-foreground",children:"Uploader une image"}),l.jsx("input",{id:"cover-upload",type:"file",className:"hidden",accept:"image/*",onChange:e=>{const t=e.target.files?.[0]||null;if(t){i(t);const e=URL.createObjectURL(t);d(e),u.setValue("cover_url","")}},disabled:r})]})})]}),l.jsx("div",{className:"flex items-center justify-center",children:c?l.jsx("div",{className:"relative w-40 h-56 overflow-hidden rounded-md border border-gray-200",children:l.jsx("img",{src:c,alt:"Aperu",className:"w-full h-full object-cover",onError:()=>d(null)})}):l.jsx("div",{className:"w-40 h-56 bg-gray-100 flex items-center justify-center rounded-md border border-gray-200",children:l.jsx("span",{className:"text-gray-400",children:"Aperu"})})})]})]}),l.jsx(Xl,{control:u.control,name:"is_published",render:({field:e})=>l.jsxs(tc,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[l.jsxs("div",{className:"space-y-0.5",children:[l.jsx(sc,{children:"Publier ce livre"}),l.jsx(ac,{})]}),l.jsx(rc,{children:l.jsx(Fc,{checked:e.value,onCheckedChange:e.onChange})})]})}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l.jsx(ya,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:r,children:"Annuler"}),l.jsx(ya,{type:"submit",disabled:r,children:r?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"h-4 w-4 mr-2 animate-spin"}),"Cration..."]}):"Crer le livre"})]})]})})]})]})}const vw=ns,bw=Jt,yw=o.forwardRef(({className:e,...t},s)=>l.jsx(Xt,{className:Pr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));yw.displayName=Xt.displayName;const ww=o.forwardRef(({className:e,...t},s)=>l.jsxs(bw,{children:[l.jsx(yw,{}),l.jsx(es,{ref:s,className:Pr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));ww.displayName=es.displayName;const jw=({className:e,...t})=>l.jsx("div",{className:Pr("flex flex-col space-y-2 text-center sm:text-left",e),...t});jw.displayName="AlertDialogHeader";const Nw=({className:e,...t})=>l.jsx("div",{className:Pr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Nw.displayName="AlertDialogFooter";const kw=o.forwardRef(({className:e,...t},s)=>l.jsx(ts,{ref:s,className:Pr("text-lg font-semibold",e),...t}));kw.displayName=ts.displayName;const _w=o.forwardRef(({className:e,...t},s)=>l.jsx(ss,{ref:s,className:Pr("text-sm text-muted-foreground",e),...t}));_w.displayName=ss.displayName;const Sw=o.forwardRef(({className:e,...t},s)=>l.jsx(rs,{ref:s,className:Pr(ba(),e),...t}));Sw.displayName=rs.displayName;const Ew=o.forwardRef(({className:e,...t},s)=>l.jsx(as,{ref:s,className:Pr(ba({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Ew.displayName=as.displayName;function Cw({open:e,onOpenChange:t,bookId:s,bookTitle:r,onDeleted:a}){const[n,i]=o.useState(!1),[c,d]=o.useState(!1),[u,m]=o.useState(0);o.useEffect(()=>{e&&h()},[e,s]);const h=async()=>{try{const{data:e,error:t,count:r}=await Vr.from("reading_questions").select("id",{count:"exact"}).eq("book_slug",s);if(t)throw t;d(!!r&&r>0),m(r||0)}catch(e){}},p=async()=>{i(!0);try{const e=await(async e=>{try{if(!e)return oa({title:"Erreur de suppression : Identifiant du livre non fourni",variant:"destructive"}),!1;const{error:t}=await Vr.from("reading_questions").delete().eq("book_slug",e);if(t)throw t;const{error:s}=await Vr.from("reading_validations").delete().eq("book_id",e);if(s)throw s;const{error:r}=await Vr.from("books").delete().eq("id",e);if(r)throw r;return oa({title:"Livre supprim avec succs",variant:"default"}),!0}catch(t){const e=t instanceof Error?t.message:"Impossible de supprimer ce livre";return oa({title:`Erreur de suppression : ${e}`,variant:"destructive"}),!1}})(s);e&&(oa({title:`Livre supprim : "${r}" et ses donnes associes ont t supprims avec succs.`}),a(),t(!1))}catch(e){oa({title:`Erreur de suppression : ${e.message||"Impossible de supprimer ce livre"}`,variant:"destructive"})}finally{i(!1)}};return l.jsx(vw,{open:e,onOpenChange:t,children:l.jsxs(ww,{children:[l.jsxs(jw,{children:[l.jsxs(kw,{className:"flex items-center gap-2",children:[l.jsx(is,{className:"h-5 w-5 text-destructive"}),'Supprimer "',r,'"']}),l.jsxs(_w,{children:["Cette action est irrversible. Le livre sera supprim dfinitivement de la base de donnes.",c&&l.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded flex items-start gap-2",children:[l.jsx(Lt,{className:"h-4 w-4 text-amber-500 mt-0.5"}),l.jsxs("span",{className:"text-amber-800",children:["Ce livre contient ",u," question",u>1?"s":""," de validation qui ",u>1?"seront galement supprimes":"sera galement supprime","."]})]})]})]}),l.jsxs(Nw,{children:[l.jsx(Ew,{disabled:n,children:"Annuler"}),l.jsx(Sw,{onClick:e=>{e.preventDefault(),p()},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:n,children:n?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"h-4 w-4 mr-2 animate-spin"}),"Suppression..."]}):c?"Supprimer tout":"Supprimer dfinitivement"})]})]})})}function Rw(e){const t=(e?.tags||[]).map(e=>(e||"").toLowerCase()),s=(e?.author||"").toLowerCase();return t.includes("ancien testament")||s.includes("bible - ancien testament")?"ot":t.includes("nouveau testament")||s.includes("bible - nouveau testament")?"nt":t.includes("talmud")||t.includes("bavli")||t.includes("yerushalmi")||s.includes("talmud")?"talmud":"other"}const Tw={ot:{bg:"#FCF7ED",title:"#5A3921",icon:""},nt:{bg:"#F6FAFF",title:"#2E4159",icon:""},talmud:{bg:"#F7F6F1",title:"#4B4436",icon:""},other:{bg:"#F5F5F5",title:"#222222",icon:null}};function Aw(e,t,s,r){e.font=r;const a=(t||"Sans titre").split(/\s+/),n=[];let i="";for(const o of a){const t=i?`${i} ${o}`:o;e.measureText(t).width>s&&i?(n.push(i),i=o):i=t}return i&&n.push(i),n}async function Pw(e){const t=512,s=768,r=document.createElement("canvas");r.width=t,r.height=s;const a=r.getContext("2d"),n=Rw(e),i=Tw[n],o="other"===n?function(e){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)>>>0;return`hsl(${t%360} 70% 95%)`}(e.title||e.slug||e.id):i.bg;a.fillStyle=o,a.fillRect(0,0,t,s);let l=30,c=`600 ${l}px system-ui, -apple-system, Segoe UI, Roboto, serif`,d=Aw(a,e.title,440,c);for(;d.length>3&&l>18;)l-=2,c=`600 ${l}px system-ui, -apple-system, Segoe UI, Roboto, serif`,d=Aw(a,e.title,440,c);a.fillStyle=i.title,a.textAlign="center",a.textBaseline="middle",a.font=c;const u=l+8,m=384-d.length*u/2;d.forEach((e,t)=>a.fillText(e,256,m+t*u)),i.icon&&(a.font="20px system-ui, -apple-system, Segoe UI, Roboto, serif",a.fillText(i.icon,256,740));const h=await new Promise((e,t)=>r.toBlob(s=>s?e(s):t(new Error("toBlob null")),"image/jpeg",.9));const p=`auto/${(e.slug||e.title||e.id||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}.jpg`,{error:f}=await Vr.storage.from("covers").upload(p,h,{upsert:!0,contentType:"image/jpeg"});if(f)throw f;const{data:g}=Vr.storage.from("covers").getPublicUrl(p),x=g?.publicUrl,{error:v}=await Vr.from("books").update({cover_url:x}).eq("id",e.id);if(v)throw v;return x}function Iw(){const[e,t]=o.useState([]),[s,r]=o.useState(!0),[a,n]=o.useState(null),[i,c]=o.useState(null),[d,u]=o.useState(!1),[m,h]=o.useState(0),[p,f]=o.useState(!1),[g,x]=o.useState(new Set),v=o.useCallback(async()=>{r(!0),n(null);try{const{data:e,error:s}=await Vr.from("books").select("id, title, slug, total_pages, cover_url, expected_segments");if(s)throw s;const{data:r}=await Vr.from("book_segment_status").select("*"),a=new Map(r?.map(e=>[e.slug,e])??[]),n=e.map(e=>{const t=e.total_pages||0,s=e.expected_segments??0,r=a.get(e.slug),n=r?.available_questions??0,i=r?.missing_segments??[],o="complete"===r?.status?"complete":"incomplete"===r?.status?"incomplete":"missing";return{id:e.id,title:e.title,slug:e.slug,total_pages:t,expectedSegments:s,availableQuestions:n,segments:[],missingSegments:i,status:o,cover_url:e.cover_url,author:"",description:"",totalChapters:s,chaptersRead:n,isCompleted:"complete"===o,language:"fr",categories:[],pages:t,publicationYear:(new Date).getFullYear()}});n.sort((e,t)=>{const s={incomplete:0,missing:1,complete:2};return s[e.status]-s[t.status]}),t(n)}catch(e){n(e.message||"Erreur lors de la rcupration des donnes")}finally{r(!1),f(!1)}},[]);o.useEffect(()=>{v()},[m,v]),o.useEffect(()=>{v()},[v]);const b=o.useCallback(()=>{h(e=>e+1)},[]),y=e=>{switch(e){case"complete":return l.jsxs("div",{className:"flex items-center text-green-600",children:[l.jsx(xe,{className:"w-5 h-5 mr-1"}),l.jsx("span",{children:"Complet"})]});case"incomplete":return l.jsxs("div",{className:"flex items-center text-amber-600",children:[l.jsx(Lt,{className:"w-5 h-5 mr-1"}),l.jsx("span",{children:"Incomplet"})]});case"missing":return l.jsxs("div",{className:"flex items-center text-destructive",children:[l.jsx(Lt,{className:"w-5 h-5 mr-1"}),l.jsx("span",{children:"Aucune question"})]})}},w=({book:e})=>l.jsxs(Ic,{children:[l.jsx(Dc,{asChild:!0,children:l.jsx(ya,{variant:"outline",size:"sm",className:"ml-2",disabled:0===e.missingSegments.length,children:"Voir segments manquants"})}),l.jsxs(Mc,{children:[l.jsx(Vc,{children:l.jsxs(Uc,{className:"flex items-center gap-2",children:[l.jsx(be,{className:"h-5 w-5"}),'Segments manquants pour "',e.title,'"']})}),l.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-4",children:0===e.missingSegments.length?l.jsxs("p",{className:"text-green-600 flex items-center",children:[l.jsx(xe,{className:"w-5 h-5 mr-2"}),"Tous les segments ont des questions"]}):l.jsxs("div",{children:[l.jsxs("p",{className:"mb-3",children:[e.missingSegments.length," segment",e.missingSegments.length>1?"s":""," sur ",e.expectedSegments," manquant",e.missingSegments.length>1?"s":""," :"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:e.missingSegments.map(e=>l.jsxs(Nn,{variant:"secondary",className:"px-3 py-1",children:["Segment ",e]},e))}),l.jsx("div",{className:"mt-4 p-3 bg-muted rounded-md",children:l.jsxs("p",{className:"text-body-sm flex items-start gap-2",children:[l.jsx(cs,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),l.jsx("span",{children:"Rappel : le segment 1 correspond aux pages 1  30, le segment 2 aux pages 31  60, etc."})]})})]})})]})]});return s&&!p?l.jsx("div",{className:"flex justify-center items-center h-64",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"animate-spin h-8 w-8 mx-auto mb-4 text-coffee-dark"}),l.jsx("p",{className:"text-coffee-dark",children:"Chargement des donnes..."})]})}):a?l.jsx("div",{className:"flex justify-center items-center h-64",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Lt,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),l.jsx("h3",{className:"text-h4 font-medium mb-2 text-destructive",children:"Erreur"}),l.jsx("p",{className:"text-muted-foreground",children:a}),l.jsx(ya,{onClick:v,className:"mt-4",children:"Ressayer"})]})}):l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("h2",{className:"text-h4 font-serif font-medium text-coffee-darker",children:["tat des questions de validation (",e.length," livres)"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(ya,{onClick:()=>{f(!0),v()},variant:"outline",size:"sm",className:"gap-2",disabled:p,children:[p?l.jsx(Se,{className:"h-4 w-4 animate-spin"}):l.jsx(os,{className:"h-4 w-4"}),"Recharger manuellement"]}),l.jsxs(ya,{onClick:async()=>{u(!0);try{const{data:e,error:t}=await Vr.from("reading_questions").select("id, book_slug, segment").eq("segment",0);if(t)throw t;if(!e||0===e.length)return oa({title:"Information : Aucun segment avec index 0 n'a t trouv."}),void u(!1);const s={success:0,skipped:0,failed:0};for(const r of e){const{data:e,error:t}=await Vr.from("reading_questions").select("id").eq("book_slug",r.book_slug).eq("segment",1).maybeSingle();if(t)s.failed++;else if(e){const{error:e}=await Vr.from("reading_questions").delete().eq("id",r.id);e?s.failed++:s.skipped++}else{const{error:e}=await Vr.from("reading_questions").update({segment:1}).eq("id",r.id);e?s.failed++:s.success++}}oa({title:`Correction des segments termine : ${s.success} segments mis  jour, ${s.skipped} segments supprims car redondants, ${s.failed} erreurs.`}),v()}catch(e){oa({title:`Erreur : Impossible de corriger les segments: ${e.message}`,variant:"destructive"})}finally{u(!1)}},variant:"outline",size:"sm",className:"gap-2",disabled:d,children:[d?l.jsx(Se,{className:"h-4 w-4 animate-spin"}):l.jsx(ls,{className:"h-4 w-4"}),d?"Correction...":"Corriger les segments  zro"]}),l.jsx(xw,{onBookAdded:b}),l.jsxs(ya,{onClick:v,size:"sm",variant:"outline",className:"gap-2",children:[l.jsx(Se,{className:"h-4 w-4"}),"Actualiser"]})]})]}),l.jsx("div",{className:"rounded-md border",children:l.jsxs(lw,{children:[l.jsx(cw,{children:l.jsxs(uw,{children:[l.jsx(mw,{className:"w-1/3",children:"Titre"}),l.jsx(mw,{className:"text-right",children:"Pages"}),l.jsx(mw,{className:"text-right",children:"Segments attendus"}),l.jsx(mw,{className:"text-right",children:"Questions disponibles"}),l.jsx(mw,{className:"text-right",children:"Couverture"}),l.jsx(mw,{className:"text-center",children:"Cover"}),l.jsx(mw,{className:"text-right",children:"tat"}),l.jsx(mw,{className:"text-right",children:"Actions"})]})}),l.jsxs(dw,{children:[e.map(e=>l.jsxs(uw,{children:[l.jsx(hw,{className:"font-medium",children:e.title}),l.jsx(hw,{className:"text-right",children:e.total_pages}),l.jsx(hw,{className:"text-right",children:e.expectedSegments}),l.jsx(hw,{className:"text-right",children:e.availableQuestions}),l.jsxs(hw,{className:"text-right",children:[Math.round(e.availableQuestions/e.expectedSegments*100),"%"]}),l.jsx(hw,{className:"text-center",children:e.cover_url?l.jsx("div",{className:"flex items-center justify-center text-green-600",children:l.jsx(xe,{className:"w-4 h-4"})}):l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>(async e=>{x(t=>new Set(t).add(e.id));try{const t=await Pw(e);oa({title:`Couverture gnre pour "${e.title}"`,description:`URL: ${t}`}),b()}catch(t){oa({title:"Erreur lors de la gnration de la couverture",description:t.message,variant:"destructive"})}finally{x(t=>{const s=new Set(t);return s.delete(e.id),s})}})(e),disabled:g.has(e.id),className:"text-xs px-2 py-1 h-6",children:g.has(e.id)?l.jsx(Se,{className:"w-3 h-3 animate-spin"}):" Gnrer"})}),l.jsx(hw,{className:"text-right",children:y(e.status)}),l.jsx(hw,{className:"text-right",children:l.jsxs("div",{className:"flex justify-end items-center gap-2",children:[l.jsx(fw,{book:e,onUpdate:b}),l.jsx(w,{book:e}),l.jsxs(ya,{variant:"outline",size:"sm",className:"border-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>(e=>{c(e)})({id:e.id,title:e.title}),children:[l.jsx(is,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Supprimer"})]})]})})]},e.id)),0===e.length&&l.jsx(uw,{children:l.jsx(hw,{colSpan:8,className:"h-24 text-center",children:"Aucun livre trouv"})})]})]})}),i&&l.jsx(Cw,{open:!!i,onOpenChange:e=>!e&&c(null),bookId:i.id,bookTitle:i.title,onDeleted:b})]})}function Dw(){const{user:e}=ha(),[t,s]=o.useState(!1),[r,a]=o.useState(!0);return o.useEffect(()=>{!async function(){if(!e)return s(!1),void a(!1);try{const{data:t,error:r}=await Vr.from("profiles").select("is_admin").eq("id",e.id).single();s(!r&&(t?.is_admin||!1))}catch(t){s(!1)}finally{a(!1)}}()},[e]),r?l.jsxs(el,{className:"p-4 mb-6 bg-amber-50 border-amber-300",children:[l.jsx("h3",{className:"text-h4 font-medium mb-2 text-amber-800",children:"Panneau de dbogage administrateur"}),l.jsx("p",{className:"text-body-sm",children:"Vrification des permissions..."})]}):l.jsxs(el,{className:"p-4 mb-6 bg-amber-50 border-amber-300",children:[l.jsx("h3",{className:"text-h4 font-medium mb-2 text-amber-800",children:"Panneau de dbogage administrateur"}),l.jsxs("div",{className:"space-y-1 text-body-sm",children:[l.jsxs("p",{children:[l.jsx("span",{className:"font-semibold",children:"Email utilisateur :"})," ",e?.email||"Non connect"]}),l.jsxs("p",{children:[l.jsx("span",{className:"font-semibold",children:"Accs administrateur autoris :"})," ",t?"Oui":"Non"]}),l.jsxs("p",{children:[l.jsx("span",{className:"font-semibold",children:"ID utilisateur :"})," ",e?.id||"N/A"]}),l.jsx("p",{className:"text-caption text-amber-600 mt-2",children:"Statut bas sur la base de donnes"})]})]})}function Lw({className:e,classNames:t,showOutsideDays:s=!0,...r}){return l.jsx(ds,{showOutsideDays:s,className:Pr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Pr(ba({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Pr(ba({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>l.jsx(Tt,{className:"h-4 w-4"}),IconRight:({...e})=>l.jsx(B,{className:"h-4 w-4"})},...r})}function Ow({currentImageUrl:e,currentImageAlt:t,onImageChange:s,onImageRemove:r}){const[a,n]=o.useState(!1),[i,c]=o.useState(t||""),d=o.useRef(null);return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(Tl,{children:"Image principale"}),l.jsxs("div",{className:"mt-2",children:[e?l.jsx("div",{className:"space-y-3",children:l.jsxs("div",{className:"relative inline-block",children:[l.jsx(Zo,{src:e,alt:i||"Image de l'article",className:"w-32 h-20 object-cover rounded border",sizes:"128px"}),l.jsx(ya,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full p-0",onClick:async()=>{if(e)try{await yb.deleteImage(e),r(),c(""),Yr.success("Image supprime")}catch(t){Yr.error("Erreur lors de la suppression")}},children:l.jsx(N,{className:"h-3 w-3"})})]})}):l.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[l.jsx(us,{className:"mx-auto h-12 w-12 text-gray-400"}),l.jsx("div",{className:"mt-2",children:l.jsxs(ya,{type:"button",variant:"outline",onClick:()=>d.current?.click(),disabled:a,className:"flex items-center gap-2",children:[l.jsx(Qt,{className:"h-4 w-4"}),a?"Upload en cours...":"Choisir une image"]})}),l.jsx("p",{className:"text-body-sm text-gray-500 mt-2",children:"PNG, JPG, GIF jusqu' 5MB"})]}),l.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)Yr.error("L'image doit faire moins de 5MB");else{n(!0);try{const e=await yb.uploadImage(t);s(e,i),Yr.success("Image uploade avec succs")}catch(r){Yr.error("Erreur lors de l'upload de l'image")}finally{n(!1)}}else Yr.error("Veuillez slectionner un fichier image")},className:"hidden"})]})]}),e&&l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"image-alt",children:"Texte alternatif de l'image"}),l.jsx(On,{id:"image-alt",value:i,onChange:t=>{return r=t.target.value,c(r),void(e&&s(e,r));var r},placeholder:"Description de l'image pour l'accessibilit"}),l.jsx("p",{className:"text-body-sm text-muted-foreground mt-1",children:"Dcrivez l'image pour l'accessibilit et le SEO"})]})]})}function Mw(){const[e,t]=o.useState([]),[s,r]=o.useState(!1),[a,n]=o.useState(null),[i,c]=o.useState({title:"",slug:"",content:"",excerpt:"",author:"VREAD",tags:[],published:!0,published_at:void 0,imageUrl:"",imageAlt:""}),[d,u]=o.useState(!1);o.useEffect(()=>{m()},[]);const m=async()=>{try{const e=await yb.getAllPosts();t(e)}catch(e){Yr.error("Erreur lors du chargement des articles")}},h=e=>e.toLowerCase().replace(/[]/g,"a").replace(/[]/g,"e").replace(/[]/g,"i").replace(/[]/g,"o").replace(/[]/g,"u").replace(/[]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),p=(e,t)=>{c(s=>({...s,imageUrl:e,imageAlt:t}))},f=()=>{c(e=>({...e,imageUrl:"",imageAlt:""}))},g=async()=>{if(i.title&&i.slug&&i.content){u(!0);try{a?(await yb.updatePost({id:a.id,...i}),Yr.success("Article mis  jour avec succs")):(await yb.createPost(i),Yr.success("Article cr avec succs")),await m(),r(!1),n(null)}catch(e){Yr.error("Erreur lors de la sauvegarde")}finally{u(!1)}}else Yr.error("Veuillez remplir tous les champs obligatoires")};return s?l.jsxs(el,{children:[l.jsx(tl,{children:l.jsxs(sl,{className:"flex items-center gap-2",children:[l.jsx(Kt,{className:"h-5 w-5"}),a?"Modifier l'article":"Nouvel article"]})}),l.jsxs(al,{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"title",children:"Titre *"}),l.jsx(On,{id:"title",value:i.title,onChange:e=>{return t=e.target.value,void c(e=>({...e,title:t,slug:e.slug||h(t)}));var t},placeholder:"Titre de l'article"})]}),l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"slug",children:"Slug *"}),l.jsx(On,{id:"slug",value:i.slug,onChange:e=>c(t=>({...t,slug:e.target.value})),placeholder:"slug-de-l-article"})]})]}),l.jsx(Ow,{currentImageUrl:i.imageUrl,currentImageAlt:i.imageAlt,onImageChange:p,onImageRemove:f}),l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"excerpt",children:"Extrait"}),l.jsx(Kx,{id:"excerpt",value:i.excerpt,onChange:e=>c(t=>({...t,excerpt:e.target.value})),placeholder:"Rsum de l'article...",rows:3})]}),l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"content",children:"Contenu *"}),l.jsx(Kx,{id:"content",value:i.content,onChange:e=>c(t=>({...t,content:e.target.value})),placeholder:"Contenu de l'article (HTML ou Markdown)...",className:"min-h-[300px] font-mono text-body-sm"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(Fc,{id:"published",checked:i.published,onCheckedChange:e=>c(t=>({...t,published:!!e}))}),l.jsx(Tl,{htmlFor:"published",children:"Publi"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{children:"Date de publication programme (optionnel)"}),l.jsxs(An,{children:[l.jsx(Pn,{asChild:!0,children:l.jsxs(ya,{variant:"outline",className:Pr("w-full justify-start text-left font-normal",!i.published_at&&"text-muted-foreground"),children:[l.jsx(Ct,{className:"mr-2 h-4 w-4"}),i.published_at?qt(new Date(i.published_at),"PPP '' HH:mm",{locale:ye}):l.jsx("span",{children:"Slectionner une date et heure"})]})}),l.jsxs(In,{className:"w-auto p-0",align:"start",children:[l.jsx(Lw,{mode:"single",selected:i.published_at?new Date(i.published_at):void 0,onSelect:e=>{if(e){const t=i.published_at?new Date(i.published_at):new Date;e.setHours(t.getHours(),t.getMinutes()),c(t=>({...t,published_at:e.toISOString()}))}else c(e=>({...e,published_at:void 0}))},disabled:e=>e<new Date,initialFocus:!0,className:"p-3 pointer-events-auto"}),i.published_at&&l.jsxs("div",{className:"p-3 border-t",children:[l.jsx(Tl,{className:"text-caption",children:"Heure"}),l.jsxs("div",{className:"flex gap-2 mt-1",children:[l.jsx(On,{type:"time",value:i.published_at?qt(new Date(i.published_at),"HH:mm"):"12:00",onChange:e=>{if(i.published_at){const t=new Date(i.published_at),[s,r]=e.target.value.split(":");t.setHours(parseInt(s),parseInt(r)),c(e=>({...e,published_at:t.toISOString()}))}},className:"flex-1"}),l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>c(e=>({...e,published_at:void 0})),children:"Supprimer"})]})]})]})]}),i.published_at&&l.jsxs("p",{className:"text-caption text-muted-foreground flex items-center gap-1",children:[l.jsx(yt,{className:"h-3 w-3"}),"L'article sera publi automatiquement"]})]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(ya,{onClick:g,disabled:d,className:"flex items-center gap-2",children:[l.jsx(Yt,{className:"h-4 w-4"}),d?"Sauvegarde...":"Sauvegarder"]}),l.jsx(ya,{variant:"outline",onClick:()=>r(!1),disabled:d,children:"Annuler"})]})]})]}):l.jsxs(el,{children:[l.jsx(tl,{children:l.jsxs(sl,{className:"flex items-center justify-between",children:[l.jsx("span",{children:"Articles de blog"}),l.jsxs(ya,{onClick:()=>{n(null),c({title:"",slug:"",content:"",excerpt:"",author:"VREAD",tags:[],published:!0,published_at:void 0,imageUrl:"",imageAlt:""}),r(!0)},className:"flex items-center gap-2",children:[l.jsx(Oe,{className:"h-4 w-4"}),"Nouvel article"]})]})}),l.jsx(al,{children:0===e.length?l.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucun article trouv"}):l.jsxs(lw,{children:[l.jsx(cw,{children:l.jsxs(uw,{children:[l.jsx(mw,{children:"Titre"}),l.jsx(mw,{children:"Slug"}),l.jsx(mw,{children:"Statut"}),l.jsx(mw,{children:"Date"}),l.jsx(mw,{children:"Actions"})]})}),l.jsx(dw,{children:e.map(e=>l.jsxs(uw,{children:[l.jsx(hw,{className:"font-medium",children:e.title}),l.jsx(hw,{className:"text-muted-foreground",children:e.slug}),l.jsx(hw,{children:e.published_at&&new Date(e.published_at)>new Date?l.jsxs("span",{className:"px-2 py-1 rounded text-caption bg-blue-100 text-blue-800 flex items-center gap-1",children:[l.jsx(yt,{className:"h-3 w-3"}),"Programm"]}):l.jsx("span",{className:"px-2 py-1 rounded text-caption "+(e.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.published?"Publi":"Brouillon"})}),l.jsx(hw,{children:l.jsxs("div",{children:[l.jsx("div",{children:new Date(e.created_at).toLocaleDateString("fr-FR")}),e.published_at&&new Date(e.published_at)>new Date&&l.jsxs("div",{className:"text-caption text-muted-foreground",children:["Prog: ",qt(new Date(e.published_at),"dd/MM '' HH:mm",{locale:ye})]})]})}),l.jsx(hw,{children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>window.open(`/blog/${e.slug}`,"_blank"),children:l.jsx(ms,{className:"h-4 w-4"})}),l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>(e=>{n(e),c({title:e.title,slug:e.slug,content:e.content,excerpt:e.excerpt||"",author:e.author||"VREAD",tags:e.tags||[],published:e.published,published_at:e.published_at,imageUrl:e.imageUrl||"",imageAlt:e.imageAlt||""}),r(!0)})(e),children:l.jsx(Kt,{className:"h-4 w-4"})}),l.jsx(ya,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("tes-vous sr de vouloir supprimer cet article ?"))try{await yb.deletePost(e),Yr.success("Article supprim avec succs"),await m()}catch(t){Yr.error("Erreur lors de la suppression")}})(e.id),children:l.jsx(De,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})}Lw.displayName="Calendar";function Vw(){return l.jsxs(ya,{onClick:async function(){const{data:{user:e}}=await Vr.auth.getUser();if(!e)return void Yr.error("Vous devez tre connect pour exporter les donnes");const{data:t}=await Vr.from("profiles").select("is_admin").eq("id",e.id).single();if(!t?.is_admin)return void Yr.error("Accs refus: Droits administrateur requis");const s=["books","reading_progress","reading_questions","reading_validations"];let r="-- Export SQL pour VREAD\n\n";for(const o of s){const{data:e,error:t}=await Vr.from(o).select("*");if(!t&&e){r+=`-- Table: ${o}\n`;for(const t of e){const e=Object.keys(t),s=e.map(e=>{const s=t[e];return null===s?"NULL":"string"==typeof s?`'${s.replace(/'/g,"''")}'`:"boolean"==typeof s?s?"TRUE":"FALSE":Array.isArray(s)?`'${JSON.stringify(s)}'`:s});r+=`INSERT INTO ${o} (${e.join(", ")}) VALUES (${s.join(", ")});\n`}r+="\n"}}const a=new Blob([r],{type:"text/sql;charset=utf-8"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download="read_export.sql",document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(n)},variant:"outline",className:"gap-2",children:[l.jsx(hs,{className:"h-4 w-4"}),"Exporter la base VREAD (SQL)"]})}function zw(){const[e,t]=o.useState(localStorage.getItem("vercel-webhook-url")||""),[s,r]=o.useState(!1);return l.jsxs(el,{children:[l.jsx(tl,{children:l.jsxs(sl,{className:"flex items-center gap-2",children:[l.jsx(Et,{className:"h-5 w-5"}),"Configuration Vercel"]})}),l.jsxs(al,{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"webhook-url",children:"URL du webhook de dploiement Vercel"}),l.jsx(On,{id:"webhook-url",value:e,onChange:e=>t(e.target.value),placeholder:"https://api.vercel.com/v1/integrations/deploy/..."}),l.jsx("p",{className:"text-body-sm text-muted-foreground mt-1",children:"Crez un webhook dans votre projet Vercel pour dclencher les redploiements automatiques"})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ya,{onClick:()=>{localStorage.setItem("vercel-webhook-url",e),Yr.success("URL du webhook Vercel sauvegarde")},variant:"outline",children:"Sauvegarder"}),l.jsxs(ya,{onClick:async()=>{if(e){r(!0);try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trigger:"blog-update"})})).ok)throw new Error("Erreur lors du dclenchement");Yr.success("Redploiement Vercel dclench avec succs")}catch(t){Yr.error("Erreur lors du dclenchement du redploiement")}finally{r(!1)}}else Yr.error("Veuillez d'abord configurer l'URL du webhook Vercel")},disabled:s||!e,className:"flex items-center gap-2",children:[l.jsx(Et,{className:"h-4 w-4"}),s?"Dclenchement...":"Dclencher le redploiement"]})]})]})]})}async function Uw(e=100,t="all"){const{data:s,error:r}=await Vr.from("books").select("id,title,slug,author,tags,cover_url").limit(e);if(r)throw r;return(s||[]).filter(e=>{if(!(function(e){if(!e)return!0;try{const t=new URL(e).hostname;return/(^|\.)vread\.fr$/i.test(t)}catch{return!0}}(e.cover_url)||!e.cover_url))return!1;const s=function(e){const t=(e?.tags||[]).map(e=>(e||"").toLowerCase()),s=(e?.author||"").toLowerCase();return t.includes("ancien testament")||s.includes("bible - ancien testament")?"ot":t.includes("nouveau testament")||s.includes("bible - nouveau testament")?"nt":t.includes("talmud")||t.includes("bavli")||t.includes("yerushalmi")||s.includes("talmud")?"talmud":"other"}(e);return"all"===t||s===t})}const Bw="autoCoverBatchLock",Fw="autoCoverBatchLastBeat";function qw(){return Date.now()}function $w(){try{localStorage.setItem(Bw,String(qw())),localStorage.setItem(Fw,String(qw()))}catch{}}function Ww(){try{localStorage.removeItem(Bw),localStorage.removeItem(Fw)}catch{}}function Hw({enabled:e=!0,batchSize:t=20,delayBetweenBatchesMs:s=2500,concurrency:r=3,variant:a="all"}){const{isAdmin:n}=ha(),[i,l]=o.useState(!1),[c,d]=o.useState({done:0,total:0}),u=o.useRef(null);return o.useEffect(()=>{if(!e||!n)return;let i=!1;return async function(){const{data:{user:e}}=await Vr.auth.getUser();if(e&&n&&function(){try{const e=localStorage.getItem(Bw),t=e?parseInt(e,10):0;return(!t||qw()-t>9e4)&&(localStorage.setItem(Bw,String(qw())),!0)}catch{return!0}}()){l(!0),u.current=window.setInterval($w,2e4);try{for(;!i;){const e=await Uw(t,a);if(0===e.length)break;d({done:0,total:e.length});let n=0,i=0;const o=async()=>{if(n>=e.length)return;const t=e[n++];try{await Pw(t)}catch(yN){}finally{i++,d({done:i,total:e.length}),$w(),await o()}};await Promise.all(Array.from({length:Math.min(r,e.length)},o)),await new Promise(e=>setTimeout(e,s))}}finally{l(!1),u.current&&window.clearInterval(u.current),Ww()}}}(),()=>{i=!0,u.current&&window.clearInterval(u.current),Ww()}},[e,t,s,r,a,n]),i&&c.total,null}function Zw(){const[e,t]=o.useState("books"),s=Sa(),r=async()=>{try{await(async()=>{try{const{data:e,error:t}=await Vr.from("books").select("id, title, slug, total_pages");if(t)throw t;const{data:s,error:r}=await Vr.from("reading_questions").select("book_slug, segment");if(r)throw r;const a=[];if(e.forEach(e=>{const t=e.total_pages||0,r=Math.ceil(t/30),n=s.filter(t=>t.book_slug===e.slug).map(e=>e.segment),i=[...new Set(n)],o=[];for(let s=0;s<r;s++)i.includes(s)||o.push(s);o.length>0&&a.push({id:e.id,title:e.title,missingSegments:o,expectedSegments:r,availableQuestions:i.length})}),0===a.length)throw new Error("Aucun livre avec des segments manquants n'a t trouv.");let n="book_id,titre,segment_manquant,questions_existantes,segments_attendus\n";a.forEach(e=>{e.missingSegments.forEach(t=>{n+=`"${e.id}","${e.title.replace(/"/g,'""')}",${t},${e.availableQuestions},${e.expectedSegments}\n`})});const i=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),l=document.createElement("a"),c=(new Date).toISOString().split("T")[0];return l.setAttribute("href",o),l.setAttribute("download",`segments-manquants-${c}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),!0}catch(e){throw e}})(),oa({title:"Export russi : le fichier CSV des segments manquants a t tlcharg"})}catch(e){oa({title:"Erreur d'export : impossible de gnrer le fichier CSV",variant:"destructive"})}},a=async()=>{try{const e=["books","reading_progress","reading_questions","reading_validations"];let t="-- Export SQL pour VREAD\n\n";for(const n of e){const{data:e,error:s}=await Vr.from(n).select("*");if(!s&&e){t+=`-- Table: ${n}\n`;for(const s of e){const e=Object.keys(s),r=e.map(e=>{const t=s[e];return null===t?"NULL":"string"==typeof t?`'${t.replace(/'/g,"''")}'`:"boolean"==typeof t?t?"TRUE":"FALSE":Array.isArray(t)?`'${JSON.stringify(t)}'`:t});t+=`INSERT INTO ${n} (${e.join(", ")}) VALUES (${r.join(", ")});\n`}t+="\n"}}const s=new Blob([t],{type:"text/sql;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="read_export.sql",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(r),oa({title:"Export complet russi : le fichier SQL a t tlcharg"})}catch(e){oa({title:"Erreur d'export : impossible de gnrer le fichier SQL complet",variant:"destructive"})}};return l.jsx(Vn,{children:l.jsx(nw,{children:l.jsx(ow,{children:l.jsxs("div",{className:"min-h-screen bg-logo-background text-logo-text",children:[l.jsxs("main",{className:"mx-auto w-full px-4 max-w-none py-6 space-y-6",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[l.jsx("h1",{className:"text-3xl font-serif font-medium text-coffee-darker",children:Ua}),!s&&l.jsxs("div",{className:"flex gap-3",children:[l.jsxs(ya,{onClick:r,variant:"outline",className:"gap-2",children:[l.jsx(gt,{className:"h-4 w-4"}),"Exporter les segments manquants"]}),l.jsxs(ya,{onClick:a,variant:"outline",className:"gap-2",children:[l.jsx(hs,{className:"h-4 w-4"}),rn]}),l.jsx(Vw,{})]}),s&&l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ya,{onClick:r,variant:"outline",size:"sm",children:"CSV"}),l.jsx(ya,{onClick:a,variant:"outline",size:"sm",children:"SQL"})]})]}),!s&&l.jsx(Dw,{}),l.jsx(zw,{}),l.jsxs(el,{className:"border-coffee-light",children:[l.jsxs(tl,{className:"pb-3",children:[l.jsx(sl,{children:en}),l.jsx(rl,{children:"Grer les livres, articles de blog et vrifier le statut des questions de validation"})]}),l.jsx(al,{children:l.jsxs(kn,{defaultValue:e,onValueChange:t,className:"w-full",children:[l.jsxs(_n,{className:"mb-6",children:[l.jsxs(Sn,{value:"books",className:"flex items-center",children:[l.jsx("span",{className:"w-4 h-4 mr-2",children:""}),Xa]}),l.jsxs(Sn,{value:"blog",className:"flex items-center",children:[l.jsx("span",{className:"w-4 h-4 mr-2",children:""}),"Blog"]}),l.jsxs(Sn,{value:"settings",className:"flex items-center",children:[l.jsx("span",{className:"w-4 h-4 mr-2",children:""}),Fa]})]}),l.jsx(En,{value:"books",children:l.jsx(Iw,{})}),l.jsx(En,{value:"blog",children:l.jsx(Mw,{})}),l.jsx(En,{value:"settings",children:l.jsxs("div",{className:"p-8 text-center border border-dashed rounded-lg",children:[l.jsx(Lt,{className:"w-12 h-12 mx-auto text-amber-500 mb-4"}),l.jsx("h3",{className:"text-lg font-medium text-coffee-darker mb-2",children:tn}),l.jsx("p",{className:"text-muted-foreground",children:sn})]})})]})})]})]}),l.jsx(Hw,{enabled:!0,batchSize:20,concurrency:3,delayBetweenBatchesMs:2e3,variant:"all"})]})})})})}function Gw(){const{user:e}=ha(),[t,s]=o.useState("all"),[r,a]=o.useState([]),[n,i]=o.useState(!1),[c,d]=o.useState(0),[u,m]=o.useState([]),[h,p]=o.useState(500);async function f(){try{const e=await async function(e=500,t="all"){const{data:s,error:r}=await Vr.from("books").select("id,title,slug,author,tags,cover_url").limit(e);if(r)throw r;return(s||[]).filter(e=>{const s=Rw(e);var r;return(!e.cover_url||!!(r=e.cover_url)&&/(^https?:\/\/(www\.)?vread\.fr\/)/i.test(r))&&("all"===t||s===t)})}(h,"all"===t?"all":t);a(e),d(0),m([])}catch(yN){oa({title:"Erreur de chargement",description:yN.message,variant:"destructive"})}}o.useEffect(()=>{f()},[t,h]);const g=o.useMemo(()=>r.length?Math.round(100*c/r.length):0,[c,r.length]);return l.jsx(Vn,{children:l.jsx(nw,{children:l.jsx(ow,{children:l.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-h1 font-medium mb-2",children:"Auto-covers (JPEG)"}),l.jsx("p",{className:"text-body-sm text-muted-foreground",children:"Gnre de vraies couvertures pour les livres sans image (ou fausse URL)."})]}),l.jsxs(el,{children:[l.jsx(tl,{children:l.jsx(sl,{children:"Configuration"})}),l.jsxs(al,{children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{children:"Groupe"}),l.jsxs(pc,{value:t,onValueChange:e=>s(e),children:[l.jsx(gc,{children:l.jsx(fc,{})}),l.jsxs(bc,{children:[l.jsx(yc,{value:"all",children:"Tous"}),l.jsx(yc,{value:"ot",children:"Ancien Testament"}),l.jsx(yc,{value:"nt",children:"Nouveau Testament"}),l.jsx(yc,{value:"talmud",children:"Talmud"}),l.jsx(yc,{value:"other",children:"Autres"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{children:"Limite"}),l.jsx(On,{type:"number",min:1,max:2e3,value:h,onChange:e=>p(parseInt(e.target.value||"500",10))})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Tl,{children:""}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(ya,{onClick:f,variant:"outline",className:"flex-1",children:[l.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Rafrachir"]}),l.jsxs(ya,{onClick:async function(){if(!r.length)return void oa({title:"Rien  faire"});i(!0),d(0),m([]);let e=0;const t=async()=>{if(e>=r.length)return;const s=r[e++];try{await Pw(s)}catch(yN){m(t=>[...t,{id:s.id,title:s.title,error:yN.message||"err"}])}finally{d(e=>e+1),await t()}};await Promise.all(Array.from({length:Math.min(4,r.length)},t)),i(!1),oa({title:"Batch termin",description:`${r.length-u.length} OK, ${u.length} erreurs`})},disabled:!r.length||n,className:"flex-1",children:[l.jsx(ps,{className:"h-4 w-4 mr-2"}),n?"En cours":`Gnrer ${r.length}`]})]})]})]}),l.jsxs("div",{className:"text-body-sm text-muted-foreground",children:[r.length," livres  traiter  ",c,"/",r.length," effectus (",g,"%)"]}),n&&l.jsx("div",{className:"mt-4",children:l.jsx(Ho,{value:g,className:"w-full"})})]})]}),!!u.length&&l.jsx(Dl,{variant:"destructive",children:l.jsxs(Ll,{children:[l.jsxs("div",{className:"font-medium mb-2",children:["checs (",u.length,")"]}),l.jsx("ul",{className:"list-disc ml-5 space-y-1",children:u.slice(0,10).map(e=>l.jsxs("li",{className:"text-sm",children:[e.title,"  ",e.error]},e.id))})]})}),r.length>0&&l.jsxs(el,{children:[l.jsxs(tl,{children:[l.jsx(sl,{children:"Aperu des livres"}),l.jsxs(rl,{children:["Premiers ",Math.min(10,r.length)," livres de la liste"]})]}),l.jsx(al,{children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.slice(0,10).map(e=>l.jsxs("div",{className:"border rounded-lg p-3",children:[l.jsx("div",{className:"text-body font-medium",children:e.title}),l.jsx("div",{className:"text-caption text-muted-foreground",children:e.slug}),l.jsxs("div",{className:"text-caption text-muted-foreground",children:[e.author," ",e.tags?.length?` ${e.tags.join(", ")}`:""]})]},e.id))})})]})]})})})})}function Kw(){const[e,t]=o.useState([]),[s,r]=o.useState("idle");function a(e){t(t=>[...t,e])}async function n(e){const t=512,s=768,r=document.createElement("canvas");r.width=t,r.height=s;const a=r.getContext("2d");if(!a)throw new Error("Canvas 2D non dispo");a.fillStyle="#F6FAFF",a.fillRect(0,0,t,s),a.fillStyle="#2E4159",a.textAlign="center",a.textBaseline="middle",a.font="600 28px system-ui, -apple-system, Segoe UI, Roboto, serif";const n=[],i=e.split(/\s+/);let o="";for(const c of i){const e=o?`${o} ${c}`:c;a.measureText(e).width>440&&o?(n.push(o),o=c):o=e}o&&n.push(o);const l=384-36*n.length/2;n.forEach((e,t)=>a.fillText(e,256,l+36*t)),a.font="20px system-ui, -apple-system, Segoe UI, Roboto, serif",a.fillText("",256,740);return await new Promise((e,t)=>r.toBlob(s=>s?e(s):t(new Error("toBlob null")),"image/jpeg",.9))}return l.jsx(Vn,{children:l.jsx(nw,{children:l.jsx(ow,{children:l.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[l.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Audit Supabase (Admin)"}),l.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Vrifie RLS (lecture), gnration JPEG, Storage (upload/remove) et update DB (avec rollback)."}),l.jsx("div",{className:"flex items-center gap-2 mb-4",children:l.jsx("button",{className:"border rounded px-3 py-2 text-sm",onClick:async function(){t([]),r("running");const e=[{key:"auth",label:"Vrification session admin",run:async()=>{const{data:{user:e},error:t}=await Vr.auth.getUser();if(t)throw t;if(!e)throw new Error("Pas de session");const{data:s,error:r}=await Vr.rpc("get_current_user_admin_status");if(r)throw r;if(!s)throw new Error("Utilisateur non admin (is_admin=false)");a(`OK admin: ${e.email||e.id}`)}},{key:"select_books",label:"Lecture books (RLS SELECT)",run:async()=>{const{data:e,error:t}=await Vr.from("books").select("id,title,cover_url").limit(1);if(t)throw t;e&&e.length?a(`OK lecture books: ${e[0].title}`):a("Aucun livre trouv (ce n'est pas une erreur si la base est vide)")}},{key:"gen_jpeg",label:"Gnration JPEG (Canvas)",run:async()=>{const e=await n("Audit Cover");if(!e||e.size<1e3)throw new Error("JPEG trop petit ou vide");a(`OK JPEG: ${(e.size/1024).toFixed(1)} kB`)}},{key:"upload_storage",label:"Upload Storage (covers/auto)",run:async()=>{const e=await n("Audit Cover"),t=`auto/audit-${Date.now()}.jpg`,s=await Vr.storage.from("covers").upload(t,e,{upsert:!0,contentType:"image/jpeg"});if(s.error)throw s.error;a(`OK upload: ${t}`),window.__audit_path=t}},{key:"update_book",label:"Update DB cover_url (rollback)",run:async()=>{const{data:e,error:t}=await Vr.from("books").select("id,cover_url,title").limit(1);if(t)throw t;if(!e||!e.length)return void a("Pas de livre  mettre  jour  on saute cette tape");const s=e[0],r=s.cover_url,{data:n}=Vr.storage.from("covers").getPublicUrl(window.__audit_path),i=n?.publicUrl;if(!i)throw new Error("URL publique introuvable");const o=await Vr.from("books").update({cover_url:i}).eq("id",s.id);if(o.error)throw o.error;a(`OK update cover_url sur: ${s.title}`);const l=await Vr.from("books").update({cover_url:r}).eq("id",s.id);if(l.error)throw l.error;a("OK rollback cover_url")}},{key:"cleanup",label:"Nettoyage (delete fichier test)",run:async()=>{const e=window.__audit_path;if(!e)return void a("Skip nettoyage (pas de path enregistr)");const t=await Vr.storage.from("covers").remove([e]);if(t.error)throw t.error;a("OK suppression fichier test")}}];try{for(const t of e)a(` ${t.label}`),await t.run();r("ok"),a(" Audit termin : TOUT OK")}catch(yN){r("fail"),a(` chec: ${yN.message||yN.toString()}`)}},disabled:"running"===s,children:"running"===s?"Audit en cours...":"Lancer l'audit"})}),l.jsx("div",{className:"text-sm p-3 rounded border bg-muted/50 whitespace-pre-wrap",children:e.length?e.join("\n"):""}),"ok"===s&&l.jsx("div",{className:"mt-3 text-green-700 text-sm",children:"Tout est oprationnel "}),"fail"===s&&l.jsx("div",{className:"mt-3 text-red-700 text-sm",children:"Audit en chec. Regarde les logs ci-dessus."})]})})})})}function Yw(){const[e,t]=o.useState("all"),s=Ce(),{data:r,isLoading:a}=Re({queryKey:["admin-book-requests",e],queryFn:async()=>{let t=Vr.from("book_requests").select("*").order("created_at",{ascending:!1});"all"!==e&&(t=t.eq("status",e));const{data:s,error:r}=await t;if(r)throw r;const a=[...new Set(s?.map(e=>e.user_id))],{data:n}=await Vr.from("profiles").select("id, username, email").in("id",a),i=new Map(n?.map(e=>[e.id,e]));return s?.map(e=>({...e,profile:i.get(e.user_id)}))}}),n=fs({mutationFn:async({id:e,status:t})=>{const{error:s}=await Vr.from("book_requests").update({status:t}).eq("id",e);if(s)throw s},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-book-requests"]}),Yr.success("Statut mis  jour")},onError:()=>{Yr.error("Erreur lors de la mise  jour")}});return l.jsx(ow,{children:l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h1",{className:"text-h3 font-medium",children:"Demandes de livres"}),l.jsxs(pc,{value:e,onValueChange:t,children:[l.jsx(gc,{className:"w-[180px]",children:l.jsx(fc,{placeholder:"Filtrer par statut"})}),l.jsxs(bc,{children:[l.jsx(yc,{value:"all",children:"Tous"}),l.jsx(yc,{value:"pending",children:"En attente"}),l.jsx(yc,{value:"processing",children:"En traitement"}),l.jsx(yc,{value:"completed",children:"Complt"})]})]})]}),a?l.jsx("div",{className:"flex justify-center py-12",children:l.jsx(Se,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):l.jsx("div",{className:"border rounded-lg",children:l.jsxs(lw,{children:[l.jsx(cw,{children:l.jsxs(uw,{children:[l.jsx(mw,{children:"Date"}),l.jsx(mw,{children:"Utilisateur"}),l.jsx(mw,{children:"Titre"}),l.jsx(mw,{children:"Auteur"}),l.jsx(mw,{children:"Notes"}),l.jsx(mw,{children:"Statut"}),l.jsx(mw,{children:"Actions"})]})}),l.jsxs(dw,{children:[r?.map(e=>l.jsxs(uw,{children:[l.jsx(hw,{className:"text-sm",children:qt(new Date(e.created_at),"dd/MM/yyyy")}),l.jsx(hw,{className:"text-sm",children:e.profile?.username||e.profile?.email||""}),l.jsx(hw,{className:"font-medium",children:e.book_title}),l.jsx(hw,{className:"text-sm",children:e.book_author||""}),l.jsx(hw,{className:"text-sm max-w-xs truncate",children:e.reason||""}),l.jsx(hw,{children:l.jsxs("span",{className:"inline-flex px-2 py-1 text-xs rounded-full "+("completed"===e.status?"bg-green-100 text-green-800":"processing"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:["pending"===e.status&&"En attente","processing"===e.status&&"En traitement","completed"===e.status&&"Complt"]})}),l.jsx(hw,{children:l.jsxs(pc,{value:e.status,onValueChange:t=>n.mutate({id:e.id,status:t}),children:[l.jsx(gc,{className:"w-[140px]",children:l.jsx(fc,{})}),l.jsxs(bc,{children:[l.jsx(yc,{value:"pending",children:"En attente"}),l.jsx(yc,{value:"processing",children:"En traitement"}),l.jsx(yc,{value:"completed",children:"Complt"})]})]})})]},e.id)),!r?.length&&l.jsx(uw,{children:l.jsx(hw,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Aucune demande trouve"})})]})]})})]})})}function Qw(){const{slug:e}=xt(),t=L(),{user:s}=ha(),[r,a]=o.useState(null),[n,i]=o.useState(!1),[c,d]=o.useState(!0),[u,m]=o.useState([]),[h,p]=o.useState(""),[f,g]=o.useState(!1),x=o.useRef(null);o.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[u]),o.useEffect(()=>{if(!e||!s?.id)return;(async()=>{try{d(!0);const r=await bl(e);if(!r)return void t("/explore");a(r);const n=await kl(s.id,e);if(!(n?.progressPercent>=100||"completed"===n?.status)&&null!==n)return void t(`/${e}`,{state:{accessDenied:!0,message:"Vous devez terminer ce livre pour accder au salon de discussion"}});i(!0),await b()}catch(r){t("/explore")}finally{d(!1)}})()},[e,s?.id,t]);const b=async()=>{if(e)try{const{data:t,error:s}=await Vr.from("book_chats").select("\n          id,\n          book_slug,\n          user_id,\n          content,\n          created_at,\n          profiles!inner (\n            username,\n            avatar_url\n          )\n        ").eq("book_slug",e).order("created_at",{ascending:!0}).limit(100);if(s)throw s;m(t||[])}catch(t){Yr.error("Erreur lors du chargement des messages")}},y=async()=>{if(h.trim()&&s?.id&&e&&!f)try{g(!0);const{error:t}=await Vr.from("book_chats").insert({book_slug:e,user_id:s.id,content:h.trim()});if(t)throw t;p(""),Yr.success("Message envoy !"),await b()}catch(t){Yr.error("Erreur lors de l'envoi du message")}finally{g(!1)}};return o.useEffect(()=>{if(!e)return;const t=Vr.channel("book-chat-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"book_chats",filter:`book_slug=eq.${e}`},()=>{b()}).subscribe();return()=>{Vr.removeChannel(t)}},[e]),c?l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("main",{className:"container mx-auto px-4 py-6",children:l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Vrification de l'accs..."})]})})})]})}):n||c?l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsxs("main",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[l.jsxs("div",{className:"mb-6",children:[l.jsxs(v,{to:`/${e}`,className:"inline-flex items-center text-coffee-dark hover:text-coffee-darker mb-4",children:[l.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Retour au livre"]}),l.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[l.jsx(gs,{className:"h-6 w-6 text-coffee-dark"}),l.jsxs("h1",{className:"text-2xl font-bold text-coffee-darker",children:["Salon  ",r?.title||"Livre"]})]}),l.jsx("p",{className:"text-muted-foreground",children:"Discutez avec d'autres lecteurs qui ont termin ce livre"})]}),l.jsxs(el,{className:"border-coffee-light",children:[l.jsx(tl,{className:"pb-4",children:l.jsxs(sl,{className:"text-lg text-coffee-dark",children:["Messages de la communaut ",r?.title?` ${r.title}`:""]})}),l.jsxs(al,{className:"space-y-4",children:[l.jsxs("div",{className:"h-96 overflow-y-auto space-y-4 p-4 bg-coffee-lightest/30 rounded-lg",children:[0===u.length?l.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[l.jsx(gs,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),l.jsx("p",{children:"Aucun message pour le moment."}),l.jsx("p",{className:"text-sm",children:"Soyez le premier  partager vos impressions !"})]}):u.map(e=>l.jsxs("div",{className:"flex gap-3",children:[l.jsxs(cn,{className:"h-8 w-8 flex-shrink-0",children:[l.jsx(dn,{src:e.profiles?.avatar_url||void 0}),l.jsx(un,{className:"bg-coffee-light text-coffee-darker text-sm",children:e.profiles?.username?.charAt(0)?.toUpperCase()||"?"})]}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[l.jsx("span",{className:"font-medium text-coffee-darker text-sm",children:e.profiles?.username||"Utilisateur"}),l.jsx("span",{className:"text-xs text-muted-foreground",children:ge(new Date(e.created_at),{addSuffix:!0,locale:ye})})]}),l.jsx("p",{className:"text-foreground text-sm leading-relaxed",children:e.content})]})]},e.id)),l.jsx("div",{ref:x})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(On,{value:h,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},placeholder:"Partagez vos impressions sur ce livre...",className:"flex-1",maxLength:500,disabled:f}),l.jsx(ya,{onClick:y,disabled:!h.trim()||f,className:"bg-coffee-dark hover:bg-coffee-darker text-white",children:f?l.jsx(Se,{className:"h-4 w-4 animate-spin"}):"Envoyer"})]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Appuyez sur Entre pour envoyer  Maximum 500 caractres"})]})]})]})]})}):l.jsx(Vn,{children:l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("main",{className:"container mx-auto px-4 py-6",children:l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Se,{className:"h-8 w-8 animate-spin text-coffee-dark mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Redirection en cours..."})]})})})]})})}function Xw({title:e,description:t,canonical:s,noindex:r=!1,ogImage:a,ogType:n="website",publishedTime:i,modifiedTime:o,author:c,tags:d=[],section:u}){const m=s||("undefined"!=typeof window?window.location.href:"");return l.jsxs(x,{children:[l.jsx("title",{children:e}),l.jsx("meta",{name:"description",content:t}),l.jsx("meta",{name:"robots",content:r?"noindex, nofollow":"index, follow"}),l.jsx("link",{rel:"canonical",href:m}),l.jsx("meta",{property:"og:title",content:e}),l.jsx("meta",{property:"og:description",content:t}),l.jsx("meta",{property:"og:type",content:n}),l.jsx("meta",{property:"og:url",content:m}),a&&l.jsx("meta",{property:"og:image",content:a}),"article"===n&&i&&l.jsx("meta",{property:"article:published_time",content:i}),"article"===n&&o&&l.jsx("meta",{property:"article:modified_time",content:o}),"article"===n&&c&&l.jsx("meta",{property:"article:author",content:c}),"article"===n&&u&&l.jsx("meta",{property:"article:section",content:u}),"article"===n&&d.map(e=>l.jsx("meta",{property:"article:tag",content:e},e)),l.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),l.jsx("meta",{name:"twitter:title",content:e}),l.jsx("meta",{name:"twitter:description",content:t}),a&&l.jsx("meta",{name:"twitter:image",content:a}),l.jsx("meta",{name:"author",content:c||"VREAD"}),d.length>0&&l.jsx("meta",{name:"keywords",content:d.join(", ")})]})}function Jw(){return l.jsxs(l.Fragment,{children:[l.jsx(Xw,{title:"VREAD   propos  L'application qui transforme votre lecture",description:"Dcouvrez VREAD, l'application rvolutionnaire qui gamifie votre lecture grce  des questions IA, un systme de progression motivant et une communaut de lecteurs passionns. Transformez chaque page en succs !",canonical:"https://www.vread.fr/a-propos",tags:["lecture","application","motivation","communaut","livres","gamification"]}),l.jsx("main",{className:"container mx-auto px-4 py-10 max-w-4xl",children:l.jsxs("div",{className:"prose prose-neutral max-w-none",children:[l.jsx("h1",{className:"text-4xl font-bold mb-6",children:"VREAD : Rvolutionnez votre faon de lire"}),l.jsx("p",{className:"text-xl leading-relaxed mb-8 text-logo-accent font-medium",children:"VREAD accompagne votre lecture, page aprs page. Notre plateforme rvolutionnaire mle passion du livre, motivation personnelle et communaut bienveillante pour transformer chaque progression en victoire."}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Qu'est-ce que VREAD ?"}),l.jsxs("p",{className:"mb-6",children:["VREAD est l'application qui ",l.jsx("strong",{children:"gamifie intelligemment votre exprience de lecture"}),". Finies les lectures abandonnes  mi-parcours ! Grce  notre systme unique de validation par questions IA, chaque segment de lecture devient un dfi stimulant et chaque page tourne, un succs tangible."]}),l.jsxs("div",{className:"bg-gradient-to-r from-logo-accent/10 to-logo-background/10 p-6 rounded-lg mb-8",children:[l.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Comment a marche ?"}),l.jsxs("ul",{className:"space-y-3",children:[l.jsxs("li",{children:[l.jsx("strong",{children:"1. Choisissez votre livre"})," parmi notre vaste bibliothque"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"2. Lisez par segments"})," d'environ 30 pages"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"3. Validez votre comprhension"})," avec une question IA personnalise"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"4. Progressez et dbloquez"})," des badges et rcompenses"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"5. Partagez vos succs"})," avec la communaut VREAD"]})]})]}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Notre mission"}),l.jsxs("p",{className:"mb-6",children:[l.jsx("strong",{children:"Dmocratiser la lecture rgulire"})," en la rendant accessible, motivante et sociale. Nous croyons que chaque personne peut dvelopper une habitude de lecture durable avec les bons outils et la bonne communaut. VREAD transforme la lecture solitaire en aventure collective."]}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Nos valeurs fondamentales"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[l.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[l.jsx("h3",{className:"font-semibold mb-2",children:" Accessibilit"}),l.jsx("p",{children:"La lecture pour tous, sans discrimination de niveau ou de rythme. Chacun avance  sa vitesse."})]}),l.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[l.jsx("h3",{className:"font-semibold mb-2",children:" Communaut"}),l.jsx("p",{children:"Avancer ensemble, s'entraider et clbrer les victoires de chacun dans un esprit bienveillant."})]}),l.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[l.jsx("h3",{className:"font-semibold mb-2",children:" Progression"}),l.jsx("p",{children:"Suivre ses objectifs, visualiser ses progrs et maintenir la motivation sur le long terme."})]}),l.jsxs("div",{className:"p-4 border-l-4 border-logo-accent",children:[l.jsx("h3",{className:"font-semibold mb-2",children:" Dcouverte"}),l.jsx("p",{children:"Ouvrir de nouveaux horizons littraires et encourager l'exploration de genres varis."})]})]}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Pourquoi choisir VREAD ?"}),l.jsxs("ul",{className:"space-y-4 mb-8",children:[l.jsxs("li",{children:[l.jsx("strong",{children:" Interface intuitive"})," : Design moderne et ergonomique pour une exprience fluide"]}),l.jsxs("li",{children:[l.jsx("strong",{children:" IA personnalise"})," : Questions adaptes  votre niveau et style de lecture"]}),l.jsxs("li",{children:[l.jsx("strong",{children:" Gamification motivante"})," : Badges, classements et dfis pour maintenir l'engagement"]}),l.jsxs("li",{children:[l.jsx("strong",{children:" Suivi dtaill"})," : Statistiques compltes de vos habitudes de lecture"]}),l.jsxs("li",{children:[l.jsx("strong",{children:" Communaut active"})," : changez avec des milliers de lecteurs passionns"]}),l.jsxs("li",{children:[l.jsx("strong",{children:" Bibliothque riche"})," : Des milliers de livres dans tous les genres"]})]}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" L'quipe VREAD"}),l.jsx("p",{className:"mb-6",children:"VREAD est n de la passion d'une quipe de dveloppeurs et de passionns de littrature. Nous sommes convaincus que la technologie peut servir la culture et rendre la lecture plus accessible  l're numrique. Chaque fonctionnalit est pense avec soin pour respecter l'exprience de lecture tout en l'enrichissant."}),l.jsx("h2",{className:"text-2xl font-semibold mt-12 mb-6",children:" Contact et support"}),l.jsx("p",{className:"mb-4",children:"Des questions ? Des suggestions ? Notre quipe est  votre coute pour amliorer continuellement votre exprience VREAD. Rejoignez notre communaut Discord ou crivez-nous directement !"}),l.jsxs("p",{className:"mb-6",children:[l.jsx("strong",{children:"Pour nous contacter :"})," ",l.jsx("a",{href:"mailto:tanguy@vread.fr",className:"text-logo-accent hover:underline font-medium",children:"tanguy@vread.fr"})]}),l.jsxs("div",{className:"bg-logo-background text-white p-8 rounded-lg text-center mt-12",children:[l.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Prt  transformer votre lecture ?"}),l.jsx("p",{className:"mb-6 text-lg",children:"Rejoignez des milliers de lecteurs qui ont dj rvolutionn leurs habitudes de lecture avec VREAD."}),l.jsx(v,{to:"/auth",className:"inline-block bg-white text-logo-background hover:bg-gray-100 px-8 py-4 rounded-lg font-bold text-lg transition-colors shadow-lg",children:"Crer mon compte gratuitement"})]})]})})]})}function ej(){return l.jsxs(l.Fragment,{children:[l.jsxs(x,{children:[l.jsx("title",{children:"Presse | VREAD"}),l.jsx("meta",{name:"description",content:"Espace presse VREAD : kit mdia, logos, visuels, contacts et communiqus."}),l.jsx("link",{rel:"canonical",href:"https://www.vread.fr/presse"}),l.jsx("meta",{property:"og:title",content:"Presse | VREAD"}),l.jsx("meta",{property:"og:description",content:"Kit mdia, logos, visuels et contact presse VREAD."}),l.jsx("meta",{property:"og:type",content:"website"}),l.jsx("meta",{property:"og:url",content:"https://www.vread.fr/presse"}),l.jsx("style",{children:'script[type="application/ld+json"]{display:block !important;min-height:1px;width:1px;margin:0;padding:0;border:0}'})]}),l.jsx("main",{className:"container mx-auto px-4 py-10 max-w-4xl",children:l.jsxs("div",{className:"prose prose-neutral max-w-none",children:[l.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Presse"}),l.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify({"@context":"https://schema.org","@type":"Organization",name:"VREAD",url:"https://www.vread.fr/"})}}),l.jsx("p",{className:"text-base leading-relaxed mb-8",children:"VREAD accompagne les lecteurs page aprs page et transforme la lecture en exprience sociale et motivante. Retrouvez ici notre kit mdia."}),l.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Kit mdia"}),l.jsxs("div",{className:"bg-muted p-6 rounded-lg mb-8",children:[l.jsx("strong",{className:"block mb-4",children:"Logos & visuels officiels"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("a",{href:"/branding/vread-logo.svg",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (SVG)"}),l.jsx("a",{href:"/branding/vread-logo-192.png",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (PNG 192px)"}),l.jsx("a",{href:"/branding/vread-logo-512.png",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (PNG 512px)"}),l.jsx("a",{href:"/branding/vread-logo-1024-q80.webp",className:"block text-logo-accent hover:underline",download:!0,children:"Logo VREAD (WebP 1024px)"})]})]}),l.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Contact presse"}),l.jsx("p",{className:"mb-2",children:"Pour toute demande mdia, contactez-nous :"}),l.jsxs("p",{className:"mb-8",children:[l.jsx("strong",{children:"Email :"})," contact@vread.fr"]}),l.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4",children:"Communiqus & actus"}),l.jsxs("p",{className:"mb-8",children:["Consultez notre ",l.jsx(v,{to:"/blog",className:"text-logo-accent hover:underline",children:"blog"})," pour les dernires annonces."]}),l.jsx(v,{to:"/auth",className:"inline-block bg-logo-accent hover:bg-logo-accent-dark text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Dcouvrir VREAD"})]})})]})}function tj(){return l.jsxs("main",{className:"container mx-auto max-w-3xl px-4 py-16 text-center",children:[l.jsxs(x,{children:[l.jsx("title",{children:"404  Page introuvable | VREAD"}),l.jsx("meta",{name:"robots",content:"noindex"})]}),l.jsxs("div",{"data-testid":"not-found",children:[l.jsx("div",{className:"text-6xl font-extrabold mb-4",children:"404"}),l.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Page introuvable"}),l.jsx("p",{className:"text-base",children:"La page que tu cherches n'existe pas."})]})]})}const sj=()=>{const[e]=ze(),t=e.get("q")||"";return l.jsxs(l.Fragment,{children:[l.jsxs(x,{prioritizeSeoTags:!0,children:[l.jsx("title",{children:t?`Recherche: ${t} | VREAD`:"Recherche | VREAD"}),l.jsx("meta",{name:"description",content:"Recherchez vos livres et contenus prfrs sur VREAD"}),l.jsx("meta",{name:"robots",content:"noindex,follow"}),l.jsx("meta",{name:"googlebot",content:"noindex,follow"}),l.jsx("meta",{name:"application-name",content:"VREAD"}),l.jsx("meta",{property:"og:site_name",content:"VREAD"}),l.jsx("link",{rel:"canonical",href:"https://www.vread.fr/search"+(t?`?q=${encodeURIComponent(t)}`:"")})]}),l.jsx("div",{className:"container mx-auto px-4 py-8",children:l.jsxs("div",{className:"max-w-2xl mx-auto",children:[l.jsx("h1",{className:"text-h1 font-bold mb-8 text-center",children:"Recherche VREAD"}),l.jsxs("div",{className:"relative mb-8",children:[l.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),l.jsx(On,{type:"search",placeholder:"Rechercher...",value:t,className:"pl-10",readOnly:!0})]}),t?l.jsxs("div",{className:"text-center",children:[l.jsxs("p",{className:"text-body mb-4",children:["Rsultats pour  ",l.jsx("span",{className:"font-semibold",children:t}),"  (bientt)"]}),l.jsx("p",{className:"text-body-sm text-muted-foreground",children:"La fonctionnalit de recherche sera bientt disponible."})]}):l.jsx("div",{className:"text-center text-muted-foreground",children:l.jsx("p",{className:"text-body",children:"Entrez votre recherche dans l'URL ou utilisez le formulaire ci-dessus."})})]})})]})};function rj(){const e=L();return l.jsx("div",{className:"min-h-screen bg-background p-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsxs(ya,{variant:"ghost",size:"sm",onClick:()=>e(-1),className:"flex items-center gap-2",children:[l.jsx(Pt,{className:"h-4 w-4"}),"Retour"]})}),l.jsxs(el,{children:[l.jsx(tl,{children:l.jsx(sl,{className:"text-2xl font-serif text-coffee-darker",children:"Politique de Confidentialit"})}),l.jsxs(al,{className:"prose prose-coffee max-w-none space-y-6",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"1. Collecte des donnes"}),l.jsx("p",{className:"text-coffee-darker/80",children:"VREAD collecte uniquement les donnes ncessaires au fonctionnement de l'application : email, progression de lecture, prfrences utilisateur."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"2. Utilisation des donnes"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Vos donnes sont utilises pour personnaliser votre exprience de lecture et suivre votre progression. Aucune donne n'est vendue  des tiers."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"3. Hbergement"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Vos donnes sont hberges par Supabase (tats-Unis) avec chiffrement en transit et au repos."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"4. Vos droits"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Vous pouvez accder, modifier ou supprimer vos donnes  tout moment depuis les rglages de l'application. La suppression de compte est dfinitive et irrversible."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"5. Contact"}),l.jsxs("p",{className:"text-coffee-darker/80",children:["Pour toute question : ",l.jsx("a",{href:"mailto:privacy@vread.fr",className:"text-coffee-dark underline",children:"privacy@vread.fr"})]})]}),l.jsxs("p",{className:"text-sm text-coffee-darker/60 border-t pt-4",children:["Dernire mise  jour : ",(new Date).toLocaleDateString("fr-FR")]})]})]})]})})}function aj(){const e=L();return l.jsx("div",{className:"min-h-screen bg-background p-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsxs(ya,{variant:"ghost",size:"sm",onClick:()=>e(-1),className:"flex items-center gap-2",children:[l.jsx(Pt,{className:"h-4 w-4"}),"Retour"]})}),l.jsxs(el,{children:[l.jsx(tl,{children:l.jsx(sl,{className:"text-2xl font-serif text-coffee-darker",children:"Conditions d'Utilisation"})}),l.jsxs(al,{className:"prose prose-coffee max-w-none space-y-6",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"1. Service"}),l.jsx("p",{className:"text-coffee-darker/80",children:"VREAD est une application de suivi de lecture qui vous accompagne dans votre progression littraire page aprs page."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"2. Utilisation acceptable"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Vous vous engagez  utiliser VREAD de manire responsable, sans perturber le service ou porter atteinte aux autres utilisateurs."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"3. Proprit intellectuelle"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Le contenu et la technologie de VREAD sont protgs par les droits d'auteur. Les livres rfrencs appartiennent  leurs auteurs respectifs."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"4. Limitation de responsabilit"}),l.jsx("p",{className:"text-coffee-darker/80",children:"VREAD est fourni \"en l'tat\". Nous nous efforons d'assurer la disponibilit du service mais ne garantissons pas son fonctionnement ininterrompu."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"5. Modification des conditions"}),l.jsx("p",{className:"text-coffee-darker/80",children:"Ces conditions peuvent tre modifies. Les utilisateurs seront notifis des changements importants."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-xl font-semibold text-coffee-dark",children:"6. Contact"}),l.jsxs("p",{className:"text-coffee-darker/80",children:["Pour toute question : ",l.jsx("a",{href:"mailto:contact@vread.fr",className:"text-coffee-dark underline",children:"contact@vread.fr"})]})]}),l.jsxs("p",{className:"text-sm text-coffee-darker/60 border-t pt-4",children:["Dernire mise  jour : ",(new Date).toLocaleDateString("fr-FR")]})]})]})]})})}function nj(){const e=L(),[t,s]=o.useState(!1),[r,a]=o.useState(!1),n=o.useCallback(async()=>{try{s(!0),await async function(){const{data:{session:e},error:t}=await Vr.auth.getSession();if(t||!e?.access_token)throw new Error("No valid session found");const{data:s,error:r}=await Vr.functions.invoke("delete-account",{headers:{Authorization:`Bearer ${e.access_token}`}});if(r)throw new Error("Deletion failed: "+r.message);return s}();try{await Vr.auth.signOut({scope:"local"})}catch{}try{localStorage.clear(),sessionStorage.clear()}catch{}Yr.success("Compte supprim avec succs"),e("/",{replace:!0})}catch(yN){const t="string"==typeof yN?.message&&yN.message.toLowerCase().includes("unauthorized")?"Session expire. Reconnecte-toi pour confirmer la suppression.":"Erreur lors de la suppression du compte";Yr.error(t)}finally{s(!1),a(!1)}},[e]);return l.jsxs("div",{className:"mx-auto w-full max-w-xl p-4 md:p-6",children:[l.jsxs("button",{onClick:()=>e(-1),className:"mb-4 inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground",children:[l.jsx(Pt,{className:"h-4 w-4"}),"Retour"]}),l.jsx("h1",{className:"mb-2 text-2xl font-semibold",children:"Supprimer mon compte"}),l.jsxs("p",{className:"mb-6 text-sm text-muted-foreground",children:["Cette action est ",l.jsx("span",{className:"font-semibold text-red-600",children:"dfinitive"})," et"," ",l.jsx("span",{className:"font-semibold",children:"irrversible"}),"."]}),l.jsxs("div",{className:"rounded-2xl border p-4 md:p-6",children:[l.jsxs("div",{className:"mb-4 flex items-start gap-3",children:[l.jsx(Lt,{className:"mt-0.5 h-5 w-5 text-red-600"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:"Consquences de la suppression"}),l.jsxs("ul",{className:"mt-2 list-disc pl-5 text-sm text-muted-foreground",children:[l.jsx("li",{children:"Suppression de votre profil et de vos donnes de lecture"}),l.jsx("li",{children:"Perte de votre progression, historique et badges"}),l.jsx("li",{children:"Aucune rcupration possible"})]})]})]}),l.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[l.jsx("button",{onClick:()=>a(!0),disabled:t,className:"inline-flex h-10 items-center justify-center rounded-lg bg-red-600 px-4 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-60",children:t?"Suppression...":"Supprimer dfinitivement mon compte"}),l.jsx("button",{onClick:()=>e(-1),className:"inline-flex h-10 items-center justify-center rounded-lg border px-4 text-sm font-medium hover:bg-accent",children:"Annuler"})]})]}),r&&l.jsx("div",{className:"fixed inset-0 z-[100] grid place-items-center bg-black/40 p-4",children:l.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-background p-5 shadow-xl",children:[l.jsx("p",{className:"text-lg font-semibold",children:"Confirmer la suppression"}),l.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"tes-vous absolument certain de vouloir supprimer votre compte VREAD ? Cette action est dfinitive."}),l.jsxs("div",{className:"mt-5 flex items-center justify-end gap-3",children:[l.jsx("button",{onClick:()=>a(!1),className:"inline-flex h-9 items-center justify-center rounded-lg border px-4 text-sm font-medium hover:bg-accent",children:"Annuler"}),l.jsx("button",{onClick:n,disabled:t,className:"inline-flex h-9 items-center justify-center rounded-lg bg-red-600 px-4 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-60",children:t?"Suppression...":"Oui, supprimer mon compte"})]})]})})]})}var ij,oj,lj,cj,dj,uj,mj,hj,pj,fj,gj,xj,vj,bj,yj,wj,jj,Nj,kj,_j,Sj,Ej,Cj,Rj,Tj,Aj,Pj,Ij,Dj,Lj,Oj,Mj,Vj,zj,Uj,Bj,Fj,qj,$j,Wj,Hj=function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function r(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}();(oj=ij||(ij={})).UNKNOWN_ERROR="0",oj.PURCHASE_CANCELLED_ERROR="1",oj.STORE_PROBLEM_ERROR="2",oj.PURCHASE_NOT_ALLOWED_ERROR="3",oj.PURCHASE_INVALID_ERROR="4",oj.PRODUCT_NOT_AVAILABLE_FOR_PURCHASE_ERROR="5",oj.PRODUCT_ALREADY_PURCHASED_ERROR="6",oj.RECEIPT_ALREADY_IN_USE_ERROR="7",oj.INVALID_RECEIPT_ERROR="8",oj.MISSING_RECEIPT_FILE_ERROR="9",oj.NETWORK_ERROR="10",oj.INVALID_CREDENTIALS_ERROR="11",oj.UNEXPECTED_BACKEND_RESPONSE_ERROR="12",oj.RECEIPT_IN_USE_BY_OTHER_SUBSCRIBER_ERROR="13",oj.INVALID_APP_USER_ID_ERROR="14",oj.OPERATION_ALREADY_IN_PROGRESS_ERROR="15",oj.UNKNOWN_BACKEND_ERROR="16",oj.INVALID_APPLE_SUBSCRIPTION_KEY_ERROR="17",oj.INELIGIBLE_ERROR="18",oj.INSUFFICIENT_PERMISSIONS_ERROR="19",oj.PAYMENT_PENDING_ERROR="20",oj.INVALID_SUBSCRIBER_ATTRIBUTES_ERROR="21",oj.LOG_OUT_ANONYMOUS_USER_ERROR="22",oj.CONFIGURATION_ERROR="23",oj.UNSUPPORTED_ERROR="24",oj.EMPTY_SUBSCRIBER_ATTRIBUTES_ERROR="25",oj.PRODUCT_DISCOUNT_MISSING_IDENTIFIER_ERROR="26",oj.PRODUCT_DISCOUNT_MISSING_SUBSCRIPTION_GROUP_IDENTIFIER_ERROR="28",oj.CUSTOMER_INFO_ERROR="29",oj.SYSTEM_INFO_ERROR="30",oj.BEGIN_REFUND_REQUEST_ERROR="31",oj.PRODUCT_REQUEST_TIMED_OUT_ERROR="32",oj.API_ENDPOINT_BLOCKED="33",oj.INVALID_PROMOTIONAL_OFFER_ERROR="34",oj.OFFLINE_CONNECTION_ERROR="35",oj.TEST_STORE_SIMULATED_PURCHASE_ERROR="42",function(e){function t(){var s=e.call(this,"There is no singleton instance. Make sure you configure Purchases before trying to get the default instance. More info here: https://errors.rev.cat/configuring-sdk")||this;return Object.setPrototypeOf(s,t.prototype),s}Hj(t,e)}(Error),function(e){function t(){var s=e.call(this,"This method is not available in the current platform.")||this;return Object.setPrototypeOf(s,t.prototype),s}Hj(t,e)}(Error),(cj=lj||(lj={})).UNKNOWN="UNKNOWN",cj.CUSTOM="CUSTOM",cj.LIFETIME="LIFETIME",cj.ANNUAL="ANNUAL",cj.SIX_MONTH="SIX_MONTH",cj.THREE_MONTH="THREE_MONTH",cj.TWO_MONTH="TWO_MONTH",cj.MONTHLY="MONTHLY",cj.WEEKLY="WEEKLY",(uj=dj||(dj={}))[uj.INTRO_ELIGIBILITY_STATUS_UNKNOWN=0]="INTRO_ELIGIBILITY_STATUS_UNKNOWN",uj[uj.INTRO_ELIGIBILITY_STATUS_INELIGIBLE=1]="INTRO_ELIGIBILITY_STATUS_INELIGIBLE",uj[uj.INTRO_ELIGIBILITY_STATUS_ELIGIBLE=2]="INTRO_ELIGIBILITY_STATUS_ELIGIBLE",uj[uj.INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS=3]="INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS",(hj=mj||(mj={})).NON_SUBSCRIPTION="NON_SUBSCRIPTION",hj.SUBSCRIPTION="SUBSCRIPTION",hj.UNKNOWN="UNKNOWN",(fj=pj||(pj={})).CONSUMABLE="CONSUMABLE",fj.NON_CONSUMABLE="NON_CONSUMABLE",fj.NON_RENEWABLE_SUBSCRIPTION="NON_RENEWABLE_SUBSCRIPTION",fj.AUTO_RENEWABLE_SUBSCRIPTION="AUTO_RENEWABLE_SUBSCRIPTION",fj.PREPAID_SUBSCRIPTION="PREPAID_SUBSCRIPTION",fj.UNKNOWN="UNKNOWN",(xj=gj||(gj={}))[xj.UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY=0]="UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY",xj[xj.IMMEDIATE_WITH_TIME_PRORATION=1]="IMMEDIATE_WITH_TIME_PRORATION",xj[xj.IMMEDIATE_AND_CHARGE_PRORATED_PRICE=2]="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",xj[xj.IMMEDIATE_WITHOUT_PRORATION=3]="IMMEDIATE_WITHOUT_PRORATION",xj[xj.DEFERRED=6]="DEFERRED",xj[xj.IMMEDIATE_AND_CHARGE_FULL_PRICE=5]="IMMEDIATE_AND_CHARGE_FULL_PRICE",(bj=vj||(vj={}))[bj.INFINITE_RECURRING=1]="INFINITE_RECURRING",bj[bj.FINITE_RECURRING=2]="FINITE_RECURRING",bj[bj.NON_RECURRING=3]="NON_RECURRING",(wj=yj||(yj={})).FREE_TRIAL="FREE_TRIAL",wj.SINGLE_PAYMENT="SINGLE_PAYMENT",wj.DISCOUNTED_RECURRING_PAYMENT="DISCOUNTED_RECURRING_PAYMENT",(Nj=jj||(jj={})).DAY="DAY",Nj.WEEK="WEEK",Nj.MONTH="MONTH",Nj.YEAR="YEAR",Nj.UNKNOWN="UNKNOWN",(_j=kj||(kj={})).INAPP="inapp",_j.SUBS="subs",(Ej=Sj||(Sj={}))[Ej.SUBSCRIPTIONS=0]="SUBSCRIPTIONS",Ej[Ej.SUBSCRIPTIONS_UPDATE=1]="SUBSCRIPTIONS_UPDATE",Ej[Ej.IN_APP_ITEMS_ON_VR=2]="IN_APP_ITEMS_ON_VR",Ej[Ej.SUBSCRIPTIONS_ON_VR=3]="SUBSCRIPTIONS_ON_VR",Ej[Ej.PRICE_CHANGE_CONFIRMATION=4]="PRICE_CHANGE_CONFIRMATION",(Rj=Cj||(Cj={}))[Rj.SUCCESS=0]="SUCCESS",Rj[Rj.USER_CANCELLED=1]="USER_CANCELLED",Rj[Rj.ERROR=2]="ERROR",(Aj=Tj||(Tj={})).VERBOSE="VERBOSE",Aj.DEBUG="DEBUG",Aj.INFO="INFO",Aj.WARN="WARN",Aj.ERROR="ERROR",(Ij=Pj||(Pj={}))[Ij.BILLING_ISSUE=0]="BILLING_ISSUE",Ij[Ij.PRICE_INCREASE_CONSENT=1]="PRICE_INCREASE_CONSENT",Ij[Ij.GENERIC=2]="GENERIC",Ij[Ij.WIN_BACK_OFFER=3]="WIN_BACK_OFFER",(Lj=Dj||(Dj={})).DISABLED="DISABLED",Lj.INFORMATIONAL="INFORMATIONAL",(Mj=Oj||(Oj={})).NOT_REQUESTED="NOT_REQUESTED",Mj.VERIFIED="VERIFIED",Mj.FAILED="FAILED",Mj.VERIFIED_ON_DEVICE="VERIFIED_ON_DEVICE",(zj=Vj||(Vj={})).NOT_PRESENTED="NOT_PRESENTED",zj.ERROR="ERROR",zj.CANCELLED="CANCELLED",zj.PURCHASED="PURCHASED",zj.RESTORED="RESTORED",(Bj=Uj||(Uj={})).STOREKIT_1="STOREKIT_1",Bj.STOREKIT_2="STOREKIT_2",Bj.DEFAULT="DEFAULT",(qj=Fj||(Fj={})).MY_APP="MY_APP",qj.REVENUECAT="REVENUECAT",(Wj=$j||($j={})).SUCCESS="SUCCESS",Wj.ERROR="ERROR",Wj.PURCHASE_BELONGS_TO_OTHER_USER="PURCHASE_BELONGS_TO_OTHER_USER",Wj.INVALID_TOKEN="INVALID_TOKEN",Wj.EXPIRED="EXPIRED";const Zj=Ss("Purchases",{web:()=>i(()=>import("./web-8fJlM3e4.js"),__vite__mapDeps([4,1,2,3])).then(e=>new e.PurchasesWeb)}),Gj=n("https://xjumsrjuyzvsixvfwoiz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqdW1zcmp1eXp2c2l4dmZ3b2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxNTU1NjYsImV4cCI6MjA2MDczMTU2Nn0.GXAF1p5iTeI3mLwwYi4rnXLsWHSUwglmdQJ7SoC3rH8");const Kj=new class{constructor(){a(this,"productId","com.vread.app.lifetime"),a(this,"isInitialized",!1),a(this,"apiKey","appl_LqGBafbkvvzjeVyWijyguTTO0yB")}async initialize(){if(this.isIOS())try{await Zj.setLogLevel({level:Tj.DEBUG}),await Zj.configure({apiKey:this.apiKey}),this.isInitialized=!0}catch(e){throw e}}async getProducts(){if(!this.isIOS())return[];this.isInitialized||await this.initialize();try{const e=await Zj.getOfferings();if(!e.current)return[];const t=e.current.availablePackages.find(e=>"lifetime"===e.identifier||e.product.identifier===this.productId);return t?[t.product]:[]}catch(e){return[]}}async purchaseLifetime(){if(!this.isIOS())return oa({title:"Erreur",description:"Les achats in-app ne sont disponibles que sur iOS",variant:"destructive"}),!1;this.isInitialized||await this.initialize();try{const e=await Zj.getOfferings();if(!e.current)throw new Error("No current offering available");const t=e.current.availablePackages.find(e=>"lifetime"===e.identifier||e.product.identifier===this.productId);if(!t)throw new Error("Lifetime package not found");await Zj.purchasePackage({aPackage:t});return await this.activatePremium("apple"),oa({title:"Achat russi ! ",description:"Tu as maintenant accs  Premium  vie"}),!0}catch(e){return"1"===e.code||e.message?.includes("cancelled")?oa({title:"Achat annul",description:"Tu as annul l'achat"}):oa({title:"Erreur d'achat",description:"Impossible de finaliser l'achat. Ressaye plus tard.",variant:"destructive"}),!1}}async restorePurchases(){if(!this.isIOS())return oa({title:"Erreur",description:"Les achats in-app ne sont disponibles que sur iOS",variant:"destructive"}),!1;try{const e=await Zj.restorePurchases();return void 0!==e.customerInfo.entitlements.active.premium?(oa({title:"Achat restaur !",description:"Ton accs Premium a t restaur"}),await this.activatePremium("apple"),!0):(oa({title:"Aucun achat trouv",description:"Aucun achat Premium n'a t trouv sur ce compte Apple"}),!1)}catch(e){return oa({title:"Erreur de restauration",description:"Impossible de restaurer les achats. Ressaye plus tard.",variant:"destructive"}),!1}}async activatePremium(e){try{const{data:{user:t}}=await Gj.auth.getUser();if(!t)return;const{error:s}=await Gj.from("profiles").update({is_premium:!0,premium_since:(new Date).toISOString(),premium_type:e}).eq("id",t.id)}catch(t){}}isIOS(){return"ios"===_s.getPlatform()}};function Yj(){const[e,t]=o.useState(!0),[s,r]=o.useState(!1),[a,n]=o.useState(!1),[i,c]=o.useState(null);o.useEffect(()=>{d()},[]);const d=async()=>{try{t(!0),await Kj.initialize();const e=await Kj.getProducts();e&&e.length>0?c(e[0]):oa({title:"Erreur de chargement",description:"Impossible de rcuprer les informations du produit",variant:"destructive"})}catch(e){oa({title:"Erreur",description:"Impossible d'initialiser le store Apple",variant:"destructive"})}finally{t(!1)}};if(e)return l.jsx(el,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50",children:l.jsx("div",{className:"text-center py-8",children:l.jsx("p",{className:"text-muted-foreground",children:"Chargement du store Apple..."})})});const u=i?.priceString||"29,99 ";return l.jsxs(el,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50 md:scale-105 md:z-10",children:[l.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center gap-1 whitespace-nowrap",children:" Offre de lancement - Limite"}),l.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2",children:[l.jsx("h3",{className:"text-2xl font-bold",children:"Premium  Vie"}),l.jsx(bn,{size:"md",variant:"compact"})]}),l.jsxs("div",{className:"mb-2",children:[l.jsx("span",{className:"text-sm text-muted-foreground line-through",children:"99"}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-5xl font-bold text-orange-600",children:u}),l.jsx(Nt,{className:"h-6 w-6 text-orange-500 animate-pulse"})]}),l.jsx("span",{className:"text-lg font-semibold text-orange-700",children:"Accs  vie"})]}),l.jsx("p",{className:"text-sm font-semibold text-orange-600 mb-6",children:" Achat via App Store"}),l.jsxs("ul",{className:"space-y-4 mb-8",children:[l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{className:"font-semibold",children:"Demander l'ajout de n'importe quel livre"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Traitement sous 48-72h"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Statistiques de lecture avances"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Badges exclusifs Premium"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Support prioritaire"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Accs anticip aux nouvelles fonctionnalits"})]})]}),l.jsx(ya,{onClick:async()=>{r(!0);try{await Kj.purchaseLifetime()}catch(e){}finally{r(!1)}},disabled:s||!i,className:"w-full bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold mb-3",size:"lg",children:s?"Achat en cours...":`Acheter - ${u}`}),l.jsx(ya,{onClick:async()=>{n(!0);try{await Kj.restorePurchases()}catch(e){}finally{n(!1)}},disabled:a,variant:"outline",className:"w-full",size:"sm",children:a?"Restauration...":"Restaurer mes achats"}),l.jsx("p",{className:"text-xs text-muted-foreground text-center mt-4",children:"Paiement trait par l'App Store. Pas d'abonnement, paiement unique."})]})}function Qj(){const{user:e}=ha(),[t,s]=o.useState(!1),r="ios"===_s.getPlatform();return l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("div",{className:"container mx-auto px-4 py-12",children:l.jsxs("div",{className:"max-w-5xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-12",children:[l.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[l.jsx(P,{className:"h-10 w-10 text-yellow-500"}),l.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:"Passe en Premium"})]}),l.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Dbloquer toutes les fonctionnalits de VREAD et demander l'ajout de n'importe quel livre"})]}),r?l.jsxs("div",{className:"max-w-md mx-auto mb-12",children:[l.jsx(Yj,{}),l.jsx("p",{className:"text-center text-sm text-muted-foreground mt-6",children:" Sur iOS, les achats sont grs par l'App Store"})]}):l.jsxs("div",{className:"grid md:grid-cols-3 gap-8 mb-12",children:[l.jsxs(el,{className:"p-8",children:[l.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Gratuit"}),l.jsxs("div",{className:"mb-6",children:[l.jsx("span",{className:"text-4xl font-bold",children:"0"}),l.jsx("span",{className:"text-muted-foreground ml-2 block text-sm mt-1",children:"pour toujours"})]}),l.jsxs("ul",{className:"space-y-4 mb-6",children:[l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Accs au catalogue de livres classiques"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Validation par checkpoints toutes les ~30 pages"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Suivi de progression et statistiques"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Badges et systme de rcompenses"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Communaut de lecteurs"})]})]})]}),l.jsxs(el,{className:"p-8 border-2 border-orange-500 relative shadow-2xl bg-gradient-to-br from-orange-50/50 to-yellow-50/50 md:scale-105 md:z-10",children:[l.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-1 rounded-full text-sm font-semibold flex items-center gap-1 whitespace-nowrap",children:" Offre de lancement - Limite"}),l.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2",children:[l.jsx("h3",{className:"text-2xl font-bold",children:"Lifetime - Early Bird"}),l.jsx(P,{className:"h-6 w-6 text-orange-500"})]}),l.jsxs("div",{className:"mb-2",children:[l.jsx("span",{className:"text-sm text-muted-foreground line-through",children:"99"}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-5xl font-bold text-orange-600",children:"29"}),l.jsx(Nt,{className:"h-6 w-6 text-orange-500 animate-pulse"})]}),l.jsx("span",{className:"text-lg font-semibold text-orange-700",children:"Accs  vie"})]}),l.jsx("p",{className:"text-sm font-semibold text-orange-600 mb-6",children:"Valable jusqu'au 15 octobre"}),l.jsxs("ul",{className:"space-y-4 mb-8",children:[l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{className:"font-semibold",children:"Demander l'ajout de n'importe quel livre"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Traitement sous 48-72h"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Statistiques de lecture avances"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Badges exclusifs Premium"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Support prioritaire"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Accs anticip aux nouvelles fonctionnalits"})]})]}),l.jsx(ya,{onClick:()=>{if(!e)return void(window.location.href="/auth");s(!0);const t=`https://buy.stripe.com/cNi28q73k0oE7u3bBuejK00?prefilled_email=${encodeURIComponent(e.email||"")}&client_reference_id=${e.id}`;window.location.href=t},disabled:t,className:"w-full bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold",size:"lg",children:t?"Redirection vers Stripe...":"Profiter de l'offre - 29 Lifetime"})]}),l.jsxs(el,{className:"p-8 border relative shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx("h3",{className:"text-2xl font-bold",children:"Premium Annuel"}),l.jsx(P,{className:"h-6 w-6 text-yellow-500"})]}),l.jsxs("div",{className:"mb-2",children:[l.jsx("span",{className:"text-4xl font-bold",children:"50"}),l.jsx("span",{className:"text-xl text-muted-foreground",children:"/an"})]}),l.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Soit 4,17/mois"}),l.jsxs("ul",{className:"space-y-4 mb-8",children:[l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{className:"font-semibold",children:"Demander l'ajout de n'importe quel livre"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Traitement sous 48-72h"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Statistiques de lecture avances"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Badges exclusifs Premium"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Support prioritaire"})]}),l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Accs anticip aux nouvelles fonctionnalits"})]})]}),l.jsx(ya,{onClick:()=>{if(!e)return void(window.location.href="/auth");s(!0);const t=`https://buy.stripe.com/7sYbJ0fzQ5IY5lV0WQejK01?prefilled_email=${encodeURIComponent(e.email||"")}&client_reference_id=${e.id}`;window.location.href=t},disabled:t,className:"w-full",size:"lg",children:t?"Redirection vers Stripe...":"Passer Premium - 50/an"})]})]}),!r&&l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx("p",{className:"text-sm text-muted-foreground",children:" Paiement 100% scuris par Stripe"}),l.jsx("p",{className:"text-sm text-muted-foreground",children:" Annulation possible  tout moment"}),l.jsx("p",{className:"text-sm text-muted-foreground",children:" Accs immdiat aprs paiement"})]}),l.jsxs("div",{className:"mt-16 max-w-3xl mx-auto",children:[l.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Questions frquentes"}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold mb-2",children:"Comment fonctionne la demande de livre ?"}),l.jsx("p",{className:"text-muted-foreground",children:"Une fois Premium, tu peux demander n'importe quel livre via le formulaire ddi. Nous crons les questions de comprhension et ajoutons le livre ASAP."})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold mb-2",children:"Combien de livres puis-je demander ?"}),l.jsx("p",{className:"text-muted-foreground",children:"Deux livres par deux livres ! Tu dois valider un des deux livres demands pour en obtenir un autre."})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold mb-2",children:"Puis-je annuler mon abonnement ?"}),l.jsx("p",{className:"text-muted-foreground",children:"Oui, tu peux annuler  tout moment. Tu garderas l'accs Premium jusqu' la fin de ta priode paye."})]})]})]})]})})]})}function Xj(){const{user:e,isPremium:t}=ha(),s=L(),[r,a]=o.useState(!1),[n,i]=o.useState({title:"",author:"",isbn:"",reason:""});if(!t){const e="ios"===_s.getPlatform();return l.jsx("div",{className:"max-w-2xl mx-auto p-6",children:l.jsxs(el,{className:"p-8 text-center",children:[l.jsx(P,{className:"mx-auto h-16 w-16 text-yellow-500 mb-4"}),l.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Fonctionnalit Premium"}),l.jsx("p",{className:"text-muted-foreground mb-6",children:"Passe Premium pour demander l'ajout de n'importe quel livre dans VREAD. Nous crons les questions de comprhension et ajoutons le livre sous 48-72h."}),l.jsx(ya,{onClick:()=>s("/premium"),size:"lg",children:e?"Dcouvrir Premium (In-App Purchase)":"Dcouvrir Premium - 50/an"})]})})}return l.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[l.jsx(A,{className:"h-6 w-6 text-primary"}),l.jsx("h2",{className:"text-2xl font-bold",children:"Demander un livre"})]}),l.jsx(el,{className:"p-6",children:l.jsxs("form",{onSubmit:async r=>{if(r.preventDefault(),!e)return oa({title:"Connexion requise",description:"Connecte-toi pour continuer",variant:"destructive"}),void s("/auth");if(!t)return oa({title:"Premium requis",description:"Cette fonctionnalit est rserve aux membres Premium",variant:"destructive"}),void s("/premium");if(n.title.trim()){a(!0);try{const{error:t}=await Vr.from("book_requests").insert({user_id:e.id,book_title:n.title.trim(),book_author:n.author.trim()||null,isbn:n.isbn.trim()||null,reason:n.reason.trim()||null});if(t)throw t;oa({title:"Demande envoye !",description:"Nous traiterons ta demande sous 48-72h. Tu seras notifi par email."}),i({title:"",author:"",isbn:"",reason:""})}catch(o){oa({title:"Erreur",description:"Impossible d'envoyer la demande. Ressaye plus tard.",variant:"destructive"})}finally{a(!1)}}else oa({title:"Titre requis",description:"Le titre du livre est obligatoire",variant:"destructive"})},className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"title",className:"block text-sm font-medium mb-2",children:"Titre du livre *"}),l.jsx(On,{id:"title",value:n.title,onChange:e=>i({...n,title:e.target.value}),placeholder:"Ex: L'tranger",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"author",className:"block text-sm font-medium mb-2",children:"Auteur"}),l.jsx(On,{id:"author",value:n.author,onChange:e=>i({...n,author:e.target.value}),placeholder:"Ex: Albert Camus"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"isbn",className:"block text-sm font-medium mb-2",children:"ISBN (optionnel)"}),l.jsx(On,{id:"isbn",value:n.isbn,onChange:e=>i({...n,isbn:e.target.value}),placeholder:"Ex: 978-2070360024"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium mb-2",children:"Pourquoi ce livre ? (optionnel)"}),l.jsx(Kx,{id:"reason",value:n.reason,onChange:e=>i({...n,reason:e.target.value}),placeholder:"Ex: Classique de la littrature franaise que je veux lire pour mes tudes",rows:4})]}),l.jsx(ya,{type:"submit",disabled:r,className:"w-full",size:"lg",children:r?"Envoi en cours...":"Envoyer la demande"}),l.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:[" Nous traitons les demandes sous 48-72h.",l.jsx("br",{}),"Tu seras notifi par email quand le livre sera disponible."]})]})})]})}function Jj(){return l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsx("main",{className:"container mx-auto py-8",children:l.jsx(Xj,{})})]})}function eN(){return o.useEffect(()=>{(async()=>{const e=await async function(){const{data:e}=await Vr.from("blog_posts").select("slug, updated_at, published_at").eq("published",!0).order("published_at",{ascending:!1}),t="https://www.vread.fr";return`<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n  <url>\n    <loc>${t}</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>daily</changefreq>\n    <priority>1.0</priority>\n  </url>\n  <url>\n    <loc>${t}/blog</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>daily</changefreq>\n    <priority>0.9</priority>\n  </url>\n  <url>\n    <loc>${t}/premium</loc>\n    <lastmod>${(new Date).toISOString()}</lastmod>\n    <changefreq>weekly</changefreq>\n    <priority>0.9</priority>\n  </url>\n  ${e?.map(e=>`\n  <url>\n    <loc>${t}/blog/${e.slug}</loc>\n    <lastmod>${e.updated_at}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.8</priority>\n  </url>`).join("")}\n</urlset>`}(),t=new Blob([e],{type:"application/xml"});URL.createObjectURL(t),document.open(),document.write(e),document.close()})()},[]),null}async function tN(e){const{data:{user:t}}=await Vr.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await Vr.from("feedback_votes").insert({feedback_id:e,user_id:t.id});if(s){if("23505"===s.code)return void(await async function(e){const{data:{user:t}}=await Vr.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await Vr.from("feedback_votes").delete().match({feedback_id:e,user_id:t.id});if(s)throw s}(e));throw s}}const sN=[{rating:5,emoji:"",label:"Gnial"},{rating:4,emoji:"",label:"Bien"},{rating:3,emoji:"",label:"Correct"},{rating:2,emoji:"",label:"Bof"},{rating:1,emoji:"",label:"Frustrant"}];function rN(){const{user:e}=ha(),{toast:t}=ia(),[s,r]=o.useState(null),[a,n]=o.useState([0,0,0,0,0]),[i,c]=o.useState(!1);async function d(){try{const e=await async function(){const{data:e,error:t}=await Vr.from("feedback_quick_ratings").select("rating");if(t)throw t;const s=[0,0,0,0,0];return e?.forEach(e=>{e.rating>=1&&e.rating<=5&&s[e.rating-1]++}),s}();n(e)}catch(e){}}async function u(s){if(e){c(!0);try{await async function(e){const{data:{user:t}}=await Vr.auth.getUser();if(!t)throw new Error("User not authenticated");const{error:s}=await Vr.from("feedback_quick_ratings").insert({user_id:t.id,rating:e});if(s)throw s}(s),r(s);const e=document.createElement("div");e.textContent="+5 pts ",e.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-4xl font-bold text-green-600 animate-bounce z-50",document.body.appendChild(e),setTimeout(()=>e.remove(),1500),t({title:"Merci ! ",description:"Tu viens de gagner 5 points"}),await d()}catch(a){t({title:"Erreur",description:a.message||"Impossible d'envoyer ton avis",variant:"destructive"})}finally{c(!1)}}else t({title:"Connexion requise",description:"Connecte-toi pour donner ton avis !",variant:"destructive"})}return o.useEffect(()=>{d()},[]),l.jsxs(el,{className:"p-6",children:[l.jsx("h2",{className:"text-xl font-semibold mb-2",children:" Feedback Express"}),l.jsx("p",{className:"text-muted-foreground mb-6",children:"Comment tait ton exprience aujourd'hui ?"}),l.jsx("div",{className:"flex justify-between gap-2 mb-4",children:sN.map(({rating:e,emoji:t,label:r})=>l.jsxs(ya,{variant:"outline",className:"flex-1 flex flex-col gap-2 h-auto py-4 transition-all "+(s===e?"border-primary border-2 scale-105":""),onClick:()=>u(e),disabled:i||null!==s,children:[l.jsx("span",{className:"text-4xl",children:t}),l.jsx("span",{className:"text-xs",children:r}),a[e-1]>0&&l.jsx("span",{className:"text-xs text-muted-foreground",children:a[e-1]})]},e))}),s&&l.jsx("p",{className:"text-center text-sm text-green-600 font-medium animate-in fade-in",children:" +5 pts  Ton vote compte !"})]})}const aN=[{type:"bug",emoji:"",label:"Bug",points:10,color:"bg-red-100 hover:bg-red-200 border-red-300"},{type:"feature",emoji:"",label:"Feature",points:15,color:"bg-blue-100 hover:bg-blue-200 border-blue-300"},{type:"idea",emoji:"",label:"Ide",points:20,color:"bg-yellow-100 hover:bg-yellow-200 border-yellow-300"},{type:"love",emoji:"",label:"J'adore!",points:10,color:"bg-pink-100 hover:bg-pink-200 border-pink-300"},{type:"suggestion",emoji:"",label:"Suggestion",points:15,color:"bg-purple-100 hover:bg-purple-200 border-purple-300"},{type:"question",emoji:"",label:"Question",points:5,color:"bg-gray-100 hover:bg-gray-200 border-gray-300"}],nN=[{value:"reading",label:"Lecture"},{value:"interface",label:"Interface"},{value:"performance",label:"Performance"},{value:"other",label:"Autre"}];function iN({onSuccess:e,onCancel:t}){const{user:s}=ha(),{toast:r}=ia(),[a,n]=o.useState(1),[i,c]=o.useState(!1),[d,u]=o.useState({is_anonymous:!1});if(1===a)return l.jsxs(el,{className:"p-6",children:[l.jsx("h2",{className:"text-2xl font-bold mb-2",children:" De quoi veux-tu parler ?"}),l.jsx("p",{className:"text-muted-foreground mb-6",children:"Choisis le type de feedback que tu veux partager"}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:aN.map(({type:e,emoji:t,label:s,points:r,color:a})=>l.jsxs(ya,{variant:"outline",className:`h-auto py-6 flex flex-col gap-2 ${a} ${d.type===e?"border-2":""}`,onClick:()=>{u({...d,type:e}),n(2)},children:[l.jsx("span",{className:"text-4xl",children:t}),l.jsx("span",{className:"font-semibold",children:s}),l.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",r," pts"]})]},e))})]});if(2===a){const t=aN.find(e=>e.type===d.type);return l.jsxs(el,{className:"p-6",children:[l.jsxs("h2",{className:"text-2xl font-bold mb-2",children:[t?.emoji," ",t?.label]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"title",children:"Titre *"}),l.jsx(On,{id:"title",placeholder:"bug"===d.type?"Ex: Bug lors du clic sur X":"feature"===d.type?"Ex: Pouvoir faire X":"Ex: Mon ide gniale...",value:d.title||"",onChange:e=>u({...d,title:e.target.value})})]}),l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"description",children:"Description *"}),l.jsx(Kx,{id:"description",placeholder:"bug"===d.type?"Quand je fais X, il se passe Y au lieu de Z":"feature"===d.type?"J'aimerais pouvoir X parce que Y":"Raconte-nous en dtail...",value:d.description||"",onChange:e=>u({...d,description:e.target.value}),rows:6,maxLength:500}),l.jsxs("p",{className:"text-xs text-muted-foreground text-right mt-1",children:[d.description?.length||0,"/500"]})]}),l.jsxs("div",{children:[l.jsx(Tl,{htmlFor:"category",children:"Catgorie"}),l.jsxs("select",{id:"category",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",value:d.category||"",onChange:e=>u({...d,category:e.target.value}),children:[l.jsx("option",{value:"",children:"Slectionne une catgorie"}),nN.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",id:"anonymous",checked:d.is_anonymous,onChange:e=>u({...d,is_anonymous:e.target.checked}),className:"h-4 w-4"}),l.jsx(Tl,{htmlFor:"anonymous",className:"cursor-pointer",children:"Rester anonyme (ton nom ne sera pas affich)"})]}),l.jsxs("div",{className:"flex gap-2 pt-4",children:[l.jsx(ya,{variant:"outline",onClick:()=>n(1),className:"flex-1",children:" Retour"}),l.jsx(ya,{onClick:async function(){if(s)if(d.type&&d.title&&d.description){c(!0);try{const t=await async function(e){const{data:{user:t}}=await Vr.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:s,error:r}=await Vr.from("feedback_submissions").insert({type:e.type,title:e.title,description:e.description,category:e.category,is_anonymous:e.is_anonymous||!1,image_url:e.image_url,user_id:t.id}).select("\n      *,\n      profiles!inner(username, avatar_url)\n    ").single();if(r)throw r;return s}(d);n(3),r({title:" Merci champion !",description:`Tu viens de gagner +${t.points_awarded} points !`}),setTimeout(()=>{e?.()},3e3)}catch(t){r({title:"Erreur",description:t.message||"Impossible d'envoyer ton feedback",variant:"destructive"})}finally{c(!1)}}else r({title:"Champs manquants",description:"Remplis tous les champs obligatoires",variant:"destructive"});else r({title:"Connexion requise",description:"Connecte-toi pour donner ton feedback !",variant:"destructive"})},disabled:i||!d.title||!d.description,className:"flex-1",children:i?l.jsxs(l.Fragment,{children:[l.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):"Envoyer "})]})]})]})}const m=aN.find(e=>e.type===d.type);return l.jsxs(el,{className:"p-6 text-center",children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Merci champion ! "}),l.jsxs("p",{className:"text-xl text-green-600 font-semibold",children:["Tu viens de gagner +",m?.points," points !"]})]}),l.jsxs("div",{className:"bg-muted p-6 rounded-lg mb-6",children:[l.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:" Ton feedback fait grandir VREAD"}),l.jsx("p",{className:"text-lg font-semibold",children:"Continue comme a ! "})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ya,{variant:"outline",onClick:t,className:"flex-1",children:" Retour"}),l.jsx(ya,{onClick:()=>{u({is_anonymous:!1}),n(1)},className:"flex-1",children:" Donner un autre feedback"})]})]})}const oN={bug:{emoji:"",label:"Bug",color:"bg-red-100 text-red-800"},feature:{emoji:"",label:"Feature",color:"bg-blue-100 text-blue-800"},idea:{emoji:"",label:"Ide",color:"bg-yellow-100 text-yellow-800"},love:{emoji:"",label:"J'adore",color:"bg-pink-100 text-pink-800"},suggestion:{emoji:"",label:"Suggestion",color:"bg-purple-100 text-purple-800"},question:{emoji:"",label:"Question",color:"bg-gray-100 text-gray-800"}},lN={pending:{label:"En attente",color:"bg-gray-100 text-gray-800"},in_progress:{label:"En cours",color:"bg-blue-100 text-blue-800"},done:{label:"Ralis",color:"bg-green-100 text-green-800"},rejected:{label:"Rejet",color:"bg-red-100 text-red-800"}};function cN({feedback:e,onVoteChange:t}){const{toast:s}=ia(),[r,a]=o.useState(!1),[n,i]=o.useState(e.has_voted),[c,d]=o.useState(e.votes_count),u=oN[e.type],m=lN[e.status];return l.jsx(el,{className:"p-4 hover:shadow-md transition-shadow",children:l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsxs(ya,{variant:n?"default":"outline",size:"sm",className:"flex-col h-auto py-2 px-3",onClick:async function(){a(!0);try{await tN(e.id),i(!n),d(n?c-1:c+1),n||s({title:"Vote enregistr ! ",description:"+2 points gagns"}),t?.()}catch(r){s({title:"Erreur",description:r.message||"Impossible de voter",variant:"destructive"})}finally{a(!1)}},disabled:r,children:[l.jsx(fe,{className:"h-4 w-4 "+(n?"fill-current":"")}),l.jsx("span",{className:"text-xs font-semibold",children:c})]}),l.jsxs("div",{className:"flex-1 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsxs(Nn,{className:u.color,children:[u.emoji," ",u.label]}),e.category&&l.jsx(Nn,{variant:"outline",className:"text-xs",children:e.category}),l.jsx(Nn,{className:m.color,children:m.label})]}),l.jsx("h3",{className:"font-semibold text-lg",children:e.title}),l.jsx("p",{className:"text-muted-foreground text-sm",children:e.description}),l.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[!e.is_anonymous&&e.profiles&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(cn,{className:"h-5 w-5",children:[l.jsx(dn,{src:e.profiles.avatar_url}),l.jsx(un,{children:e.profiles.username?.[0]?.toUpperCase()||"?"})]}),l.jsxs("span",{children:["@",e.profiles.username]})]}),e.is_anonymous&&l.jsx("span",{className:"italic",children:"Anonyme"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(yt,{className:"h-3 w-3"}),ge(new Date(e.created_at),{addSuffix:!0,locale:ye})]}),e.comments_count>0&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(D,{className:"h-3 w-3"}),e.comments_count]})]})]})]})})}function dN(){const[e,t]=o.useState([]),[s,r]=o.useState(!0),[a,n]=o.useState({sortBy:"votes"});async function i(){r(!0);try{const e=await async function(e={}){let t=Vr.from("feedback_submissions").select("\n      *,\n      profiles(username, avatar_url)\n    ");switch(e.type&&(t=t.eq("type",e.type)),e.status&&(t=t.eq("status",e.status)),e.sortBy){case"votes":t=t.order("votes_count",{ascending:!1});break;case"comments":t=t.order("comments_count",{ascending:!1});break;default:t=t.order("created_at",{ascending:!1})}const{data:s,error:r}=await t;if(r)throw r;const{data:{user:a}}=await Vr.auth.getUser();if(a&&s){const e=s.map(e=>e.id),{data:t}=await Vr.from("feedback_votes").select("feedback_id").eq("user_id",a.id).in("feedback_id",e),r=new Set(t?.map(e=>e.feedback_id)||[]);return s.map(e=>({...e,has_voted:r.has(e.id)}))}return s||[]}(a);t(e)}catch(e){}finally{r(!1)}}return o.useEffect(()=>{i()},[a]),s?l.jsx("div",{className:"flex justify-center py-12",children:l.jsx(Se,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h2",{className:"text-2xl font-bold",children:" Suggestions de la communaut"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ya,{variant:"votes"===a.sortBy?"default":"outline",size:"sm",onClick:()=>n({...a,sortBy:"votes"}),children:" Top votes"}),l.jsx(ya,{variant:"recent"===a.sortBy?"default":"outline",size:"sm",onClick:()=>n({...a,sortBy:"recent"}),children:" Rcent"})]})]}),0===e.length?l.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Aucun feedback pour le moment. Sois le premier ! "}):l.jsx("div",{className:"space-y-3",children:e.map(e=>l.jsx(cN,{feedback:e,onVoteChange:i},e.id))})]})}function uN(){const{user:e}=ha(),t=L(),[s,r]=o.useState(!1);return l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ln,{}),l.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[l.jsxs("div",{className:"text-center mb-12 space-y-4",children:[l.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:" Fais pousser VREAD avec nous"}),l.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Chaque feedback est une graine qui amliore l'exprience de toute la communaut"}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[l.jsx(ya,{size:"lg",onClick:()=>{e?r(!0):t("/auth")},className:"text-lg",children:" Donner mon feedback"}),l.jsx(ya,{size:"lg",variant:"outline",onClick:()=>document.getElementById("feedback-list")?.scrollIntoView({behavior:"smooth"}),children:" Voir les suggestions"})]}),l.jsx("p",{className:"text-sm text-muted-foreground",children:" En temps rel  Des centaines de feedbacks partags"})]}),!s&&l.jsx("div",{className:"mb-8",children:l.jsx(rN,{})}),s&&l.jsx("div",{className:"mb-8",children:l.jsx(iN,{onSuccess:()=>{r(!1),window.scrollTo({top:0,behavior:"smooth"})},onCancel:()=>r(!1)})}),l.jsx("div",{id:"feedback-list",children:l.jsx(dN,{})})]})]})}const mN=()=>l.jsxs(xs,{children:[l.jsx(vs,{path:"/",element:l.jsx(ka,{})}),l.jsx(vs,{path:"/landing",element:l.jsx(ka,{})}),l.jsx(vs,{path:"/home",element:l.jsx(Cl,{})}),l.jsx(vs,{path:"/auth",element:l.jsx(Pl,{})}),l.jsx(vs,{path:"/reset-password",element:l.jsx(Ol,{})}),l.jsx(vs,{path:"/profile/:userId",element:l.jsx(Cc,{})}),l.jsx(vs,{path:"/profile",element:l.jsx(Cc,{})}),l.jsx(vs,{path:"/u/:userId",element:l.jsx(Cc,{})}),l.jsx(vs,{path:"/book/:id",element:l.jsx(xb,{})}),l.jsx(vs,{path:"/books/:id",element:l.jsx(xb,{})}),l.jsx(vs,{path:"/blog",element:l.jsx(Nb,{})}),l.jsx(vs,{path:"/blog/page/1",element:l.jsx(At,{to:"/blog",replace:!0})}),l.jsx(vs,{path:"/blog/page/:page",element:l.jsx(Nb,{})}),l.jsx(vs,{path:"/blog/:slug",element:l.jsx(Ty,{})}),l.jsx(vs,{path:"/reading-list",element:l.jsx(Oy,{})}),l.jsx(vs,{path:"/discover",element:l.jsx(Ky,{})}),l.jsx(vs,{path:"/explore",element:l.jsx(Yy,{})}),l.jsx(vs,{path:"/search",element:l.jsx(sj,{})}),l.jsx(vs,{path:"/achievements",element:l.jsx(sw,{})}),l.jsx(vs,{path:"/followers/:type/:userId",element:l.jsx(aw,{})}),l.jsx(vs,{path:"/finished-chat/:slug",element:l.jsx(Qw,{})}),l.jsx(vs,{path:"/feedback",element:l.jsx(uN,{})}),l.jsx(vs,{path:"/a-propos",element:l.jsx(Jw,{})}),l.jsx(vs,{path:"/presse",element:l.jsx(ej,{})}),l.jsx(vs,{path:"/sitemap.xml",element:l.jsx(eN,{})}),l.jsx(vs,{path:"/apropos",element:l.jsx(At,{to:"/a-propos",replace:!0})}),l.jsx(vs,{path:"/about",element:l.jsx(At,{to:"/a-propos",replace:!0})}),l.jsx(vs,{path:"/press",element:l.jsx(At,{to:"/presse",replace:!0})}),l.jsx(vs,{path:"/a-propos/index.html",element:l.jsx(At,{to:"/a-propos",replace:!0})}),l.jsx(vs,{path:"/presse/index.html",element:l.jsx(At,{to:"/presse",replace:!0})}),l.jsx(vs,{path:"/legal/privacy",element:l.jsx(rj,{})}),l.jsx(vs,{path:"/legal/terms",element:l.jsx(aj,{})}),l.jsx(vs,{path:"/premium",element:l.jsx(Qj,{})}),l.jsx(vs,{path:"/request-book",element:l.jsx(Vn,{children:l.jsx(Jj,{})})}),l.jsx(vs,{path:"/settings/delete-account",element:l.jsx(Vn,{children:l.jsx(nj,{})})}),l.jsx(vs,{path:"/admin",element:l.jsx(Zw,{})}),l.jsx(vs,{path:"/admin/auto-covers",element:l.jsx(nw,{children:l.jsx(Gw,{})})}),l.jsx(vs,{path:"/admin/audit",element:l.jsx(nw,{children:l.jsx(Kw,{})})}),l.jsx(vs,{path:"/admin/book-requests",element:l.jsx(nw,{children:l.jsx(Yw,{})})}),l.jsx(vs,{path:"*",element:l.jsx(tj,{})})]}),hN="https://www.vread.fr/";function pN(){const{pathname:e}=Rt();return o.useEffect(()=>{const t=document.head.querySelector('link[rel="canonical"]:not([data-rh])');t&&("/"===e||"/index.html"===e?t.href!==hN&&(t.href=hN):t.parentElement?.removeChild(t))},[e]),null}function fN(){const{pathname:e}=Rt();return o.useEffect(()=>{document.head.querySelectorAll('meta[property="og:url"]:not([data-rh])').forEach(e=>e.parentElement?.removeChild(e))},[e]),null}const gN=o.lazy(()=>i(()=>import("./toaster-hlmAukfb.js"),__vite__mapDeps([5,2,3,1])).then(e=>({default:e.Toaster}))),xN=o.lazy(()=>i(()=>import("./sonner-BZcbXegF.js"),__vite__mapDeps([6,1,2,3])).then(e=>({default:e.Sonner}))),vN=()=>{const e="/landing"===Rt().pathname,{user:t,isInitialized:s}=ha(),r=_s.isNativePlatform();return l.jsxs(l.Fragment,{children:[l.jsx(o.Suspense,{fallback:null,children:l.jsx(gN,{})}),l.jsx(o.Suspense,{fallback:null,children:l.jsx(xN,{richColors:!1,position:"top-right",visibleToasts:e?0:void 0,className:"toaster w-full max-w-sm sm:max-w-sm"})}),!r&&l.jsx(fa,{}),l.jsx(pN,{}),l.jsx(fN,{}),l.jsx(mN,{}),!1]})},bN=()=>l.jsx(bs,{children:l.jsx(ys,{client:pa,children:l.jsx(ma,{children:l.jsx(Ir,{children:l.jsx(ws,{children:l.jsx(vN,{})})})})})});(async()=>{try{"ios"===_s.getPlatform()&&(await Ms.setOverlaysWebView({overlay:!1}),await Ms.setStyle({style:Is.Dark}))}catch(yN){}})(),js.createRoot(document.getElementById("root")).render(l.jsx(h.StrictMode,{children:l.jsx(bs,{children:l.jsx(iv,{children:l.jsx(bN,{})})})})),i(async()=>{const{registerPWA:e}=await import("./pwa-D2T-wxvP.js");return{registerPWA:e}},__vite__mapDeps([7,1,2,3])).then(({registerPWA:e})=>e());export{Cj as R,Oj as V,Es as W,va as a,$j as b,Pr as c,na as i,ia as u};
